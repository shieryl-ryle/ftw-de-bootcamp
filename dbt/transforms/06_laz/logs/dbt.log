[0m05:16:20.771468 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.82s]
[0m05:16:20.775790 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:16:20.799944 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:16:20.836455 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m05:16:20.839922 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:16:20.842798 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:16:20.844398 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:16:20.846258 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:16:20.847954 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:16:20.849823 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:16:20.852123 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:16:20.854013 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:16:20.855590 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:16:20.857251 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:16:20.858969 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:16:20.860693 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:16:20.862379 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:16:20.979968 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:16:21.039859 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:16:21.041303 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:16:21.043811 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:16:21.045821 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:16:21.057977 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:16:21.143425 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:16:21.339332 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:16:21.434871 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:16:21.539779 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:16:21.567790 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:16:21.639907 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:16:21.677578 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace` 
  ...
[0m05:16:21.762007 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:16:21.763215 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:16:21.769097 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace` 
  ...
[0m05:16:21.775007 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:16:21.857051 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:16:21.880366 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:16:21.882306 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:16:21.937065 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:16:21.940291 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:16:21.947230 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:16:21.955301 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:16:21.958296 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:16:21.960796 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7befcca2-2db3-4b93-868a-c5830bb7bace', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e14cd1a760>]}
[0m05:16:21.961923 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.10s]
[0m05:16:21.963289 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:16:21.964740 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:16:21.979360 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:16:21.983216 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:16:22.036030 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:16:22.041778 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:16:22.048316 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:16:22.049578 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:16:22.052253 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:16:22.053851 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:16:22.054800 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:16:22.069620 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:16:22.070892 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:16:22.072768 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace`)
      
    ...
[0m05:16:22.074599 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace`)
      
    ...
[0m05:16:22.091804 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:16:22.097256 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:16:22.098851 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:16:22.106194 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:16:22.108738 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:16:22.110928 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:16:22.135857 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace` 
    ...
[0m05:16:22.138879 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace` 
    ...
[0m05:16:22.144578 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:16:22.146242 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:16:22.152051 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace` 
  ...
[0m05:16:22.158273 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7befcca2_2db3_4b93_868a_c5830bb7bace` 
  ...
[0m05:16:22.161797 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:16:22.168224 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:16:22.174229 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:16:22.175220 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:16:22.178437 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:16:22.181685 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7befcca2-2db3-4b93-868a-c5830bb7bace', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e14cd99850>]}
[0m05:16:22.183012 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.33s]
[0m05:16:22.184432 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:16:22.235441 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:16:22.240828 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7befcca2-2db3-4b93-868a-c5830bb7bace', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e14ce37190>]}
[0m05:16:22.243191 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.39s]
[0m05:16:22.245416 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:16:22.248548 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:16:22.249735 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:16:22.250897 [debug] [MainThread]: On list__mart: Close
[0m05:16:22.251958 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:16:22.253032 [debug] [MainThread]: On list__clean: Close
[0m05:16:22.254088 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:16:22.255159 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:16:22.256371 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:16:22.257746 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:16:22.258905 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:16:22.260068 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:16:22.261173 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m05:16:22.262364 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m05:16:22.264728 [info ] [MainThread]: 
[0m05:16:22.266204 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.03 seconds (4.03s).
[0m05:16:22.274417 [debug] [MainThread]: Command end result
[0m05:16:22.545704 [info ] [MainThread]: 
[0m05:16:22.547316 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:16:22.548584 [info ] [MainThread]: 
[0m05:16:22.549947 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:16:22.552567 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.910447, "process_in_blocks": "312", "process_kernel_time": 0.629769, "process_mem_max_rss": "114620", "process_out_blocks": "9752", "process_user_time": 6.17214}
[0m05:16:22.554101 [debug] [MainThread]: Command `dbt build` succeeded at 05:16:22.553693 after 6.91 seconds
[0m05:16:22.555402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e151654e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e14e177280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74e150127790>]}
[0m05:16:22.556700 [debug] [MainThread]: Flushing usage events
[0m05:17:16.845932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aacd473d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aaca0e6c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aaca0e6b20>]}


============================== 05:17:16.855369 | f93a8f91-83e8-4879-9d14-14dff7523137 ==============================
[0m05:17:16.855369 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:17:16.856503 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'warn_error': 'None', 'empty': 'False', 'debug': 'False', 'log_format': 'default', 'version_check': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'use_colors': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'log_cache_events': 'False', 'target_path': 'None', 'no_print': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'write_json': 'True', 'cache_selected_only': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_path': '/workdir/transforms/04_btc/logs', 'profiles_dir': '.', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m05:17:17.434758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f93a8f91-83e8-4879-9d14-14dff7523137', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aaca51f3d0>]}
[0m05:17:17.631363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f93a8f91-83e8-4879-9d14-14dff7523137', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aacd656c70>]}
[0m05:17:17.632730 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:17:18.051867 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:17:18.556218 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:17:18.556877 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:17:18.759853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f93a8f91-83e8-4879-9d14-14dff7523137', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aac983bdf0>]}
[0m05:17:19.253807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f93a8f91-83e8-4879-9d14-14dff7523137', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aac9b01a00>]}
[0m05:17:19.254698 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:17:19.257948 [info ] [MainThread]: 
[0m05:17:19.258985 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:17:19.270642 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:17:19.312423 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:17:19.361531 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:17:19.414826 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:17:19.982790 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:17:19.992007 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:19.994792 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:17:20.022303 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:20.120378 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:17:20.122431 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:17:20.137618 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:17:20.143176 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:17:20.152314 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:20.162636 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:17:20.218294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f93a8f91-83e8-4879-9d14-14dff7523137', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aac8f62be0>]}
[0m05:17:20.219259 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:17:20.219949 [info ] [MainThread]: 
[0m05:17:20.232573 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:17:20.233710 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:17:20.234813 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:17:20.235624 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:17:20.253210 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:17:20.254505 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:17:20.448212 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:17:20.606351 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:17:20.607803 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:17:20.620176 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:20.741931 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:17:20.745137 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:17:20.747151 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:17:20.750276 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:17:20.756119 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:17:20.759253 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:17:20.761152 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:17:20.764129 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:17:20.856404 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:17:20.860113 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:17:20.914454 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f93a8f91-83e8-4879-9d14-14dff7523137', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aac8aceca0>]}
[0m05:17:20.915845 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.68s]
[0m05:17:20.917259 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:17:20.919331 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:17:20.920959 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:17:20.922954 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:17:20.924701 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:17:20.926844 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:17:20.928867 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:17:20.930935 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:17:20.932791 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:17:20.934861 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:17:20.936618 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:17:20.938215 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:17:20.939895 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:17:21.140994 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:17:21.144906 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:17:21.146689 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:17:21.149257 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:17:21.151063 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:17:21.227827 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:17:21.430595 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:17:21.451144 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:17:21.520308 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:17:21.523233 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:17:21.526250 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:17:21.532617 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:17:21.759991 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:17:21.775632 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:21.780669 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:17:21.823079 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m05:17:21.830703 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:17:21.833565 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:17:21.840525 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:21.846444 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m05:17:21.849405 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:21.852064 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:17:21.857797 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.93s]
[0m05:17:21.861361 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:17:21.913786 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:17:21.915112 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:17:21.916762 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:17:21.918308 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:17:21.920332 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:17:21.922931 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:17:21.924824 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:17:21.926344 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:17:21.928129 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:17:21.929769 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:17:21.931448 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:17:21.933189 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:17:22.051403 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:17:22.122737 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:17:22.137978 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:17:22.146834 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:17:22.150435 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:17:22.152839 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:17:22.155339 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:17:22.218990 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:17:22.313423 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:17:22.412400 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:17:22.529014 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:17:22.538495 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:17:22.618451 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:17:22.739063 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:17:22.845881 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:17:22.925889 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:17:23.017556 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137` 
  ...
[0m05:17:23.021472 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137` 
  ...
[0m05:17:23.024229 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:17:23.030251 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:17:23.043587 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:17:23.047342 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:17:23.156298 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:17:23.217417 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f93a8f91-83e8-4879-9d14-14dff7523137', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aac841ca60>]}
[0m05:17:23.253380 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.29s]
[0m05:17:23.318660 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:17:23.459127 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:17:23.512070 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:17:23.546546 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:17:23.562511 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:17:23.634666 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:17:23.637152 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:17:23.648703 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:23.652162 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:23.715827 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:17:23.721654 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:17:23.725132 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:17:23.727466 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:17:23.759173 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:17:23.761800 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:17:23.765906 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137`)
      
    ...
[0m05:17:23.770198 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137`)
      
    ...
[0m05:17:23.798984 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:17:23.813075 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:17:23.819577 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:17:23.824599 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:17:23.833990 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:23.841815 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:23.839875 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137` 
    ...
[0m05:17:23.848417 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137` 
    ...
[0m05:17:23.861043 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:23.864204 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:23.920943 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137` 
  ...
[0m05:17:23.934891 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f93a8f91_83e8_4879_9d14_14dff7523137` 
  ...
[0m05:17:23.939631 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:23.947440 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:23.954559 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:17:24.021645 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:17:24.027014 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:24.034629 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:17:24.041043 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f93a8f91-83e8-4879-9d14-14dff7523137', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aac82e0940>]}
[0m05:17:24.043472 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.11s]
[0m05:17:24.040602 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f93a8f91-83e8-4879-9d14-14dff7523137', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aac9fd8760>]}
[0m05:17:24.047227 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:17:24.049925 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.12s]
[0m05:17:24.053304 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:17:24.057288 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:17:24.058551 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:17:24.059708 [debug] [MainThread]: On list__mart: Close
[0m05:17:24.060812 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:17:24.112136 [debug] [MainThread]: On list__clean: Close
[0m05:17:24.113085 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:17:24.113942 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:17:24.114964 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m05:17:24.115708 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m05:17:24.116647 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:17:24.117366 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:17:24.118084 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:17:24.119064 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:17:24.120766 [info ] [MainThread]: 
[0m05:17:24.121871 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.86 seconds (4.86s).
[0m05:17:24.127371 [debug] [MainThread]: Command end result
[0m05:17:24.332286 [info ] [MainThread]: 
[0m05:17:24.334271 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:17:24.335772 [info ] [MainThread]: 
[0m05:17:24.337312 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:17:24.340581 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.68855, "process_in_blocks": "0", "process_kernel_time": 0.707257, "process_mem_max_rss": "115340", "process_out_blocks": "9744", "process_user_time": 6.410563}
[0m05:17:24.342427 [debug] [MainThread]: Command `dbt build` succeeded at 05:17:24.341891 after 7.69 seconds
[0m05:17:24.343761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aacd473d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aacb3034c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70aacabf6400>]}
[0m05:17:24.344984 [debug] [MainThread]: Flushing usage events
[0m05:18:16.067320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a98bdd7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a988a32b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a988a32a00>]}


============================== 05:18:16.076613 | 2c9c55e5-6e47-4718-b8bd-9f0640474d83 ==============================
[0m05:18:16.076613 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:18:16.077681 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'quiet': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'static_parser': 'True', 'cache_selected_only': 'False', 'printer_width': '80', 'log_format': 'default', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '.', 'use_colors': 'True', 'write_json': 'True', 'debug': 'False', 'introspect': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'version_check': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m05:18:16.661047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2c9c55e5-6e47-4718-b8bd-9f0640474d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a98892b940>]}
[0m05:18:16.855945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2c9c55e5-6e47-4718-b8bd-9f0640474d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a9889f8310>]}
[0m05:18:16.857215 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:18:17.268393 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:18:17.771161 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:18:17.771828 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:18:17.971624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2c9c55e5-6e47-4718-b8bd-9f0640474d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a988197eb0>]}
[0m05:18:18.448110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2c9c55e5-6e47-4718-b8bd-9f0640474d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a988085dc0>]}
[0m05:18:18.448994 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:18:18.452111 [info ] [MainThread]: 
[0m05:18:18.453124 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:18:18.464741 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:18:18.466207 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:18:18.577726 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:18:18.634253 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:18:19.431735 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:18:19.436571 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:18:19.439019 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:19.448776 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:19.532374 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:18:19.534453 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:18:19.575591 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:18:19.580417 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:18:19.642497 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:19.649949 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:19.674373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2c9c55e5-6e47-4718-b8bd-9f0640474d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a988911f70>]}
[0m05:18:19.676677 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:18:19.678140 [info ] [MainThread]: 
[0m05:18:19.746058 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:18:19.747366 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:18:19.748618 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:18:19.749545 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:18:19.768908 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:18:19.770440 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:18:19.958263 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:18:20.023918 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:18:20.025370 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:18:20.043214 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:20.166242 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:18:20.169958 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:18:20.171957 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:18:20.174894 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:18:20.180641 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:18:20.231691 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:18:20.233837 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:18:20.237066 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:18:20.332511 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:18:20.336081 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:18:20.342472 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c9c55e5-6e47-4718-b8bd-9f0640474d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a98b2eea60>]}
[0m05:18:20.343733 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m05:18:20.345033 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:18:20.347266 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:18:20.348785 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:18:20.350318 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:18:20.351771 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:18:20.353506 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:18:20.355266 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:18:20.356694 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:18:20.358847 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:18:20.360218 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:18:20.361795 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:18:20.363582 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:18:20.432226 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:18:20.438338 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:18:20.453187 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:18:20.463274 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:18:20.465605 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:18:20.467690 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:18:20.479780 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:18:20.660982 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:18:20.667804 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:18:20.680830 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:18:20.731985 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:18:20.733923 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:18:20.737490 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:18:20.901118 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:18:20.909137 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:18:20.913711 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:20.920166 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.56s]
[0m05:18:20.932619 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:18:20.922075 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:20.934405 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:18:20.938432 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.58s]
[0m05:18:20.940876 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:18:20.943019 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:20.945820 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.59s]
[0m05:18:20.947123 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:18:20.948775 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:18:20.949855 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:18:20.952047 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:18:20.951060 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:18:20.953248 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:18:20.954580 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:18:20.955743 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:18:20.956458 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:18:20.957319 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:18:20.958420 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:18:20.959233 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:18:20.960193 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:18:20.979107 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:18:21.039659 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:18:21.046178 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:18:21.047783 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:18:21.053763 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:18:21.059981 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:18:21.177406 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:18:21.274773 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:18:21.348557 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:18:21.370479 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:18:21.375794 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83` 
  ...
[0m05:18:21.453735 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83` 
  ...
[0m05:18:21.458126 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:18:21.461933 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:21.466235 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:18:21.468562 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:21.567464 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:18:21.663837 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:18:21.762258 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:18:21.778572 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:18:21.865840 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:18:21.946077 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:18:21.948280 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:18:21.959382 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:18:21.967435 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:18:21.972872 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c9c55e5-6e47-4718-b8bd-9f0640474d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a988a80f10>]}
[0m05:18:21.975504 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.02s]
[0m05:18:21.978706 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:18:22.032447 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:18:22.035412 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:18:22.075904 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:18:22.135749 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:18:22.145497 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:22.153338 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:22.162229 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:18:22.167820 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:18:22.170895 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:18:22.173205 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:18:22.205307 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:18:22.234150 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:18:22.238274 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83`)
      
    ...
[0m05:18:22.242601 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83`)
      
    ...
[0m05:18:22.273096 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:18:22.283295 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:18:22.289167 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:18:22.298751 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:18:22.337260 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:18:22.340063 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:18:22.345814 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83` 
    ...
[0m05:18:22.351952 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83` 
    ...
[0m05:18:22.363243 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:22.370967 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:22.383530 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83` 
  ...
[0m05:18:22.437309 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_2c9c55e5_6e47_4718_b8bd_9f0640474d83` 
  ...
[0m05:18:22.443194 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:22.451925 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:22.465846 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:18:22.474774 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:18:22.535290 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:18:22.542128 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c9c55e5-6e47-4718-b8bd-9f0640474d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a988a760d0>]}
[0m05:18:22.544885 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:18:22.547377 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.59s]
[0m05:18:22.553894 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2c9c55e5-6e47-4718-b8bd-9f0640474d83', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a988a769a0>]}
[0m05:18:22.556799 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:18:22.559423 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.60s]
[0m05:18:22.562866 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:18:22.566641 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:18:22.567772 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:18:22.568948 [debug] [MainThread]: On list__mart: Close
[0m05:18:22.570069 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:18:22.571653 [debug] [MainThread]: On list__clean: Close
[0m05:18:22.572979 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:18:22.574097 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:18:22.575300 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:18:22.576414 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:18:22.577497 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:18:22.578763 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:18:22.579954 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:18:22.581098 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:18:22.632914 [info ] [MainThread]: 
[0m05:18:22.633890 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.18 seconds (4.18s).
[0m05:18:22.638914 [debug] [MainThread]: Command end result
[0m05:18:22.853149 [info ] [MainThread]: 
[0m05:18:22.854748 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:18:22.856023 [info ] [MainThread]: 
[0m05:18:22.857376 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:18:22.859967 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.983995, "process_in_blocks": "0", "process_kernel_time": 0.669916, "process_mem_max_rss": "114768", "process_out_blocks": "9744", "process_user_time": 6.144342}
[0m05:18:22.861510 [debug] [MainThread]: Command `dbt build` succeeded at 05:18:22.861087 after 6.99 seconds
[0m05:18:22.862834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a98bdd7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a98892df10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73a989cf34f0>]}
[0m05:18:22.864029 [debug] [MainThread]: Flushing usage events
[0m05:19:15.846634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0053ca7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0050902c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0050902ac0>]}


============================== 05:19:15.855846 | 9a22c581-800a-4f58-9477-d38b8381c77c ==============================
[0m05:19:15.855846 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:19:15.856979 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'quiet': 'False', 'debug': 'False', 'no_print': 'None', 'printer_width': '80', 'warn_error': 'None', 'use_experimental_parser': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'static_parser': 'True', 'version_check': 'True', 'write_json': 'True', 'use_colors': 'True', 'log_format': 'default', 'target_path': 'None', 'cache_selected_only': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_path': '/workdir/transforms/04_btc/logs', 'log_cache_events': 'False', 'fail_fast': 'False'}
[0m05:19:16.444926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9a22c581-800a-4f58-9477-d38b8381c77c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0053232b80>]}
[0m05:19:16.639875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9a22c581-800a-4f58-9477-d38b8381c77c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c00507fdee0>]}
[0m05:19:16.641248 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:19:17.114506 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:19:17.620591 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:19:17.621249 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:19:17.820996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9a22c581-800a-4f58-9477-d38b8381c77c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0050064e80>]}
[0m05:19:18.273806 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9a22c581-800a-4f58-9477-d38b8381c77c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c005007ad30>]}
[0m05:19:18.274724 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:19:18.312183 [info ] [MainThread]: 
[0m05:19:18.313428 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:19:18.325361 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:19:18.326402 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:19:18.349438 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:19:18.353368 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:19:18.895232 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:19:18.918601 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:19:18.924617 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:19:18.926756 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:19:19.033075 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:19:19.034521 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:19:19.048852 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:19:19.052640 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:19:19.061041 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:19:19.113173 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:19:19.132201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9a22c581-800a-4f58-9477-d38b8381c77c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c00505d2b50>]}
[0m05:19:19.134138 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:19:19.135461 [info ] [MainThread]: 
[0m05:19:19.211676 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:19:19.213378 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:19:19.214881 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:19:19.215922 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:19:19.239514 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:19:19.241035 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:19:19.438403 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:19:19.505901 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:19:19.507447 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:19:19.526041 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:19:19.655577 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:19:19.659130 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:19:19.661097 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:19:19.712328 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:19:19.718102 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:19:19.721071 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:19:19.722869 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:19:19.725759 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:19:19.820099 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:19:19.824640 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:19:19.830674 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a22c581-800a-4f58-9477-d38b8381c77c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c004f9bf490>]}
[0m05:19:19.831815 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m05:19:19.833139 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:19:19.835245 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:19:19.836435 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:19:19.837981 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:19:19.839644 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:19:19.841005 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:19:19.842605 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:19:19.843839 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:19:19.844949 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:19:19.846246 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:19:19.847391 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:19:19.848471 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:19:19.849513 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:19:20.036642 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:19:20.046390 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:19:20.048256 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:19:20.051234 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:19:20.111899 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:19:20.118127 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:19:20.343676 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:19:20.345473 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:19:20.360098 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:19:20.413949 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:19:20.417140 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:19:20.419196 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:19:20.662102 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:19:20.676937 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:19:20.712650 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.85s]
[0m05:19:20.721276 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:19:20.728125 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:19:20.731116 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:19:20.743972 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:19:20.751969 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:19:20.750228 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.90s]
[0m05:19:20.758730 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.91s]
[0m05:19:20.761761 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:19:20.811852 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:19:20.815282 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:19:20.816416 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:19:20.818170 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:19:20.819930 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:19:20.821810 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:19:20.824170 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:19:20.826075 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:19:20.827818 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:19:20.829433 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:19:20.831135 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:19:20.832850 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:19:20.834482 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:19:20.945957 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:19:21.025556 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:19:21.032585 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:19:21.036458 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:19:21.049297 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:19:21.052049 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:19:21.117441 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:19:21.152823 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:19:21.255715 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:19:21.350998 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:19:21.450441 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:19:21.546523 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:19:21.718189 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m05:19:21.756371 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:19:21.850028 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c` 
  ...
[0m05:19:21.916315 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:19:21.920026 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m05:19:21.934810 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c` 
  ...
[0m05:19:21.951190 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:19:22.047718 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:19:22.118407 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:19:22.129456 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:19:22.133962 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:19:22.140952 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:19:22.147439 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:19:22.151039 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a22c581-800a-4f58-9477-d38b8381c77c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c004fdeec10>]}
[0m05:19:22.152356 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.32s]
[0m05:19:22.154033 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:19:22.168069 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:19:22.212574 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:19:22.251474 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:19:22.253687 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:19:22.313452 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:19:22.315508 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:19:22.328828 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:19:22.334404 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:19:22.337477 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:19:22.340024 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:19:22.371030 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:19:22.375148 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c`)
      
    ...
[0m05:19:22.378888 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:19:22.383308 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c`)
      
    ...
[0m05:19:22.442363 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:19:22.443641 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:19:22.451242 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:19:22.456025 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:19:22.462313 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:19:22.465933 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c` 
    ...
[0m05:19:22.468804 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:19:22.472231 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c` 
    ...
[0m05:19:22.474591 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:19:22.482771 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c` 
  ...
[0m05:19:22.484377 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:19:22.513416 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:19:22.517341 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9a22c581_800a_4f58_9477_d38b8381c77c` 
  ...
[0m05:19:22.528407 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:19:22.535392 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:19:22.548750 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:19:22.550466 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:19:22.557008 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a22c581-800a-4f58-9477-d38b8381c77c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c004f4802b0>]}
[0m05:19:22.611892 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.73s]
[0m05:19:22.615306 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:19:22.618399 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:19:22.625136 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a22c581-800a-4f58-9477-d38b8381c77c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c004fba3bb0>]}
[0m05:19:22.627514 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.80s]
[0m05:19:22.630850 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:19:22.634736 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:19:22.635876 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:19:22.637020 [debug] [MainThread]: On list__clean: Close
[0m05:19:22.638083 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:19:22.639193 [debug] [MainThread]: On list__mart: Close
[0m05:19:22.640243 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:19:22.641326 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:19:22.642367 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m05:19:22.643447 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m05:19:22.644489 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:19:22.645591 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:19:22.646653 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:19:22.647740 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:19:22.649943 [info ] [MainThread]: 
[0m05:19:22.651239 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.34 seconds (4.34s).
[0m05:19:22.659101 [debug] [MainThread]: Command end result
[0m05:19:22.916092 [info ] [MainThread]: 
[0m05:19:22.917678 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:19:22.918916 [info ] [MainThread]: 
[0m05:19:22.920238 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:19:22.922941 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.2697215, "process_in_blocks": "0", "process_kernel_time": 0.671412, "process_mem_max_rss": "115072", "process_out_blocks": "9744", "process_user_time": 6.325256}
[0m05:19:22.924481 [debug] [MainThread]: Command `dbt build` succeeded at 05:19:22.924067 after 7.27 seconds
[0m05:19:22.925794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0053ca7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c0053232b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c00507fdcd0>]}
[0m05:19:22.927152 [debug] [MainThread]: Flushing usage events
[0m05:20:15.664161 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3c1e28e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3bea77be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3bea77a90>]}


============================== 05:20:15.673396 | 045332f7-208a-42dc-a383-179ff650b524 ==============================
[0m05:20:15.673396 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:20:15.674486 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'target_path': 'None', 'printer_width': '80', 'profiles_dir': '.', 'warn_error': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True', 'fail_fast': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'empty': 'False', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'use_experimental_parser': 'False', 'write_json': 'True', 'introspect': 'True', 'version_check': 'True', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'cache_selected_only': 'False'}
[0m05:20:16.252709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '045332f7-208a-42dc-a383-179ff650b524', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3be955f10>]}
[0m05:20:16.394255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '045332f7-208a-42dc-a383-179ff650b524', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3beab0790>]}
[0m05:20:16.395515 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:20:16.862294 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:20:17.368137 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:20:17.368870 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:20:17.569056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '045332f7-208a-42dc-a383-179ff650b524', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3be1e4e50>]}
[0m05:20:18.053453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '045332f7-208a-42dc-a383-179ff650b524', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3be1a34f0>]}
[0m05:20:18.054347 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:20:18.057543 [info ] [MainThread]: 
[0m05:20:18.058647 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:20:18.070803 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:20:18.072393 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:20:18.161845 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:20:18.173815 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:20:18.854660 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:20:18.864571 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:18.866827 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:20:18.875320 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:18.972606 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:20:18.974227 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:20:18.989980 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:20:18.995440 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:20:19.058066 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:19.070236 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:20:19.082316 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '045332f7-208a-42dc-a383-179ff650b524', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3be9da9a0>]}
[0m05:20:19.083743 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:20:19.084685 [info ] [MainThread]: 
[0m05:20:19.149441 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:20:19.150597 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:20:19.151691 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:20:19.152467 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:20:19.170009 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:20:19.171321 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:20:19.367614 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:20:19.437475 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:20:19.438840 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:20:19.451111 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:19.591151 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:20:19.595187 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:20:19.597339 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:20:19.649106 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:20:19.655442 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:20:19.658799 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:20:19.660786 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:20:19.664347 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:20:19.762058 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:20:19.765188 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:20:19.771353 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '045332f7-208a-42dc-a383-179ff650b524', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3bd458940>]}
[0m05:20:19.772577 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.62s]
[0m05:20:19.773912 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:20:19.775573 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:20:19.776324 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:20:19.777208 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:20:19.778017 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:20:19.778993 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:20:19.779912 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:20:19.781032 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:20:19.782021 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:20:19.782980 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:20:19.783737 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:20:19.784561 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:20:19.785366 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:20:19.875413 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:20:19.878605 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:20:19.873061 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:20:19.880471 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:20:19.886594 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:20:19.960752 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:20:19.973687 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:20:19.986228 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:20:19.990662 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:20:19.992202 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:20:19.993096 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:20:19.994176 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:20:20.208218 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:20:20.217094 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:20:20.222091 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:20.223935 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:20:20.230751 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.45s]
[0m05:20:20.232195 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:20.234830 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:20:20.248900 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.47s]
[0m05:20:20.250911 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:20:20.253329 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:20:20.256723 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.48s]
[0m05:20:20.258442 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:20:20.259859 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:20:20.260715 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:20:20.261767 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:20:20.262626 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:20:20.263591 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:20:20.264444 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:20:20.265726 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:20:20.266795 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:20:20.267506 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:20:20.268480 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:20:20.269466 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:20:20.288324 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:20:20.289284 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:20:20.347711 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:20:20.359520 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:20:20.361100 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:20:20.372227 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:20:20.383609 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:20:20.484831 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:20:20.574714 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:20:20.760939 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m05:20:20.848572 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:20:20.868661 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:20.874213 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:20:21.058883 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m05:20:21.070708 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524` 
  ...
[0m05:20:21.069889 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524` 
  ...
[0m05:20:21.084230 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:20:21.090401 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:20:21.095042 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:21.165318 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:20:21.261410 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:20:21.361664 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:20:21.487309 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:20:21.564891 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:20:21.568317 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:20:21.570984 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:20:21.580065 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '045332f7-208a-42dc-a383-179ff650b524', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3bcdf0e80>]}
[0m05:20:21.582724 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.31s]
[0m05:20:21.585678 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:20:21.602589 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:20:21.649328 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:20:21.756265 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:20:21.761130 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:20:21.770448 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:21.778854 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:21.792907 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:20:21.850586 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:20:21.853231 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:20:21.857061 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:20:21.888235 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:20:21.892794 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524`)
      
    ...
[0m05:20:21.895853 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:20:21.900320 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524`)
      
    ...
[0m05:20:21.916589 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:20:21.922070 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:20:21.923491 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:20:21.930954 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:20:21.932441 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:21.952905 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524` 
    ...
[0m05:20:21.955271 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:21.961724 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524` 
    ...
[0m05:20:21.965279 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:21.971918 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524` 
  ...
[0m05:20:21.975438 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:21.982120 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:21.986832 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_045332f7_208a_42dc_a383_179ff650b524` 
  ...
[0m05:20:21.993886 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:20:22.048925 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:20:22.061297 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:20:22.063579 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:20:22.070842 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '045332f7-208a-42dc-a383-179ff650b524', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3bcdf08e0>]}
[0m05:20:22.073249 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:20:22.075724 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.80s]
[0m05:20:22.083110 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:20:22.081448 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '045332f7-208a-42dc-a383-179ff650b524', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3bfcb4400>]}
[0m05:20:22.085361 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.82s]
[0m05:20:22.087889 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:20:22.091626 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:20:22.092808 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:20:22.094037 [debug] [MainThread]: On list__mart: Close
[0m05:20:22.095124 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:20:22.096264 [debug] [MainThread]: On list__clean: Close
[0m05:20:22.148616 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:20:22.149827 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:20:22.150937 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m05:20:22.152090 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m05:20:22.153147 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:20:22.154329 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:20:22.155398 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:20:22.156643 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:20:22.158899 [info ] [MainThread]: 
[0m05:20:22.160255 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.10 seconds (4.10s).
[0m05:20:22.171017 [debug] [MainThread]: Command end result
[0m05:20:22.385583 [info ] [MainThread]: 
[0m05:20:22.386907 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:20:22.387931 [info ] [MainThread]: 
[0m05:20:22.389057 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:20:22.391131 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.9186835, "process_in_blocks": "0", "process_kernel_time": 0.660351, "process_mem_max_rss": "114516", "process_out_blocks": "9744", "process_user_time": 6.151799}
[0m05:20:22.392277 [debug] [MainThread]: Command `dbt build` succeeded at 05:20:22.391972 after 6.92 seconds
[0m05:20:22.393262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3c1e28e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3be8c5160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70a3be971ca0>]}
[0m05:20:22.394239 [debug] [MainThread]: Flushing usage events
[0m05:21:15.550136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa9690f310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa93577bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa93577a60>]}


============================== 05:21:15.610145 | ae640b83-fd45-49c2-9d95-8790a6ec4b7f ==============================
[0m05:21:15.610145 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:21:15.611263 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'profiles_dir': '.', 'log_format': 'default', 'invocation_command': 'dbt build --profiles-dir . --target local', 'cache_selected_only': 'False', 'debug': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'fail_fast': 'False', 'write_json': 'True', 'empty': 'False', 'version_check': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'target_path': 'None', 'log_path': '/workdir/transforms/04_btc/logs'}
[0m05:21:16.143965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ae640b83-fd45-49c2-9d95-8790a6ec4b7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa95eb0b80>]}
[0m05:21:16.341959 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ae640b83-fd45-49c2-9d95-8790a6ec4b7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa939e17f0>]}
[0m05:21:16.343783 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:21:16.808398 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:21:17.315772 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:21:17.316451 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:21:17.515906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ae640b83-fd45-49c2-9d95-8790a6ec4b7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa92cdae50>]}
[0m05:21:17.954710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ae640b83-fd45-49c2-9d95-8790a6ec4b7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa92cef5b0>]}
[0m05:21:17.955707 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:21:17.958902 [info ] [MainThread]: 
[0m05:21:17.959957 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:21:18.008701 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:21:18.010243 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:21:18.052386 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:21:18.106336 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:21:18.817771 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:21:18.820509 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:21:18.827230 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:18.829898 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:18.930048 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:21:18.931653 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:21:18.947216 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:21:19.006104 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:21:19.017210 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:19.019471 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:19.042663 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ae640b83-fd45-49c2-9d95-8790a6ec4b7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa934db670>]}
[0m05:21:19.044585 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:21:19.046153 [info ] [MainThread]: 
[0m05:21:19.122819 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:21:19.124016 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:21:19.125066 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:21:19.125831 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:21:19.142795 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:21:19.143984 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:21:19.329267 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:21:19.396703 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:21:19.398106 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:21:19.411196 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:19.547285 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:21:19.551704 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:21:19.554234 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:21:19.606787 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:21:19.612680 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:21:19.615695 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:21:19.617546 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:21:19.620404 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:21:19.713589 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:21:19.717230 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:21:19.723273 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae640b83-fd45-49c2-9d95-8790a6ec4b7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa92080af0>]}
[0m05:21:19.724420 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m05:21:19.725786 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:21:19.727916 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:21:19.729268 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:21:19.730601 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:21:19.732387 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:21:19.733898 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:21:19.736074 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:21:19.737953 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:21:19.739582 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:21:19.741578 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:21:19.743216 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:21:19.745245 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:21:19.841871 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:21:20.013025 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:21:20.018100 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:21:20.022576 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:21:20.024915 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:21:20.027020 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:21:20.033948 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:21:20.328193 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:21:20.331687 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:21:20.349276 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:21:20.352189 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:21:20.405110 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:21:20.408976 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:21:20.615659 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:21:20.628417 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:21:20.633693 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:21:20.639064 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:21:20.707029 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:21:20.711060 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.97s]
[0m05:21:20.713829 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:21:20.719366 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.98s]
[0m05:21:20.722290 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:21:20.727828 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.98s]
[0m05:21:20.730530 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:21:20.733876 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:21:20.737319 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:21:20.738441 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:21:20.740197 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:21:20.741933 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:21:20.743799 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:21:20.746211 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:21:20.748067 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:21:20.749613 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:21:20.751213 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:21:20.752934 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:21:20.754571 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:21:20.756248 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:21:20.838094 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:21:20.839093 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:21:20.848330 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:21:20.849970 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:21:20.851161 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:21:20.921339 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:21:21.043611 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:21:21.141916 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:21:21.316452 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m05:21:21.442136 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:21:21.622235 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:21:21.631594 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:21:21.738401 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:21:21.749277 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f` 
  ...
[0m05:21:21.815861 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f` 
  ...
[0m05:21:21.819112 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:21:21.825349 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:21:21.829410 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:21.837270 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:21.939655 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:21:22.034507 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:21:22.135506 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:21:22.237857 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:21:22.312361 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae640b83-fd45-49c2-9d95-8790a6ec4b7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa93559af0>]}
[0m05:21:22.325791 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.56s]
[0m05:21:22.328661 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:21:22.331753 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:21:22.334926 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:21:22.371484 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:21:22.382215 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:21:22.515289 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:21:22.514835 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:21:22.522970 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:22.524824 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:22.532250 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:21:22.535459 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:21:22.537055 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:21:22.539203 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:21:22.554778 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:22.556610 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:21:22.558836 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f`)
      
    ...
[0m05:21:22.561212 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f`)
      
    ...
[0m05:21:22.587295 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:21:22.605428 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:21:22.615482 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:21:22.625566 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:21:22.636523 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:22.644614 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:22.642571 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f` 
    ...
[0m05:21:22.651077 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f` 
    ...
[0m05:21:22.706696 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:21:22.708891 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:21:22.728041 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f` 
  ...
[0m05:21:22.741635 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_ae640b83_fd45_49c2_9d95_8790a6ec4b7f` 
  ...
[0m05:21:22.751104 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:22.754238 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:22.809951 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:21:22.817541 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:21:22.820780 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:21:22.824217 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae640b83-fd45-49c2-9d95-8790a6ec4b7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa91feaf40>]}
[0m05:21:22.825565 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:21:22.826664 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.07s]
[0m05:21:22.829711 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ae640b83-fd45-49c2-9d95-8790a6ec4b7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa917856d0>]}
[0m05:21:22.831030 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:21:22.832204 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.08s]
[0m05:21:22.833868 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:21:22.835731 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:21:22.836264 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:21:22.836811 [debug] [MainThread]: On list__mart: Close
[0m05:21:22.837301 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:21:22.837820 [debug] [MainThread]: On list__clean: Close
[0m05:21:22.838297 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:21:22.838807 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:21:22.839280 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:21:22.839807 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:21:22.840303 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:21:22.840880 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:21:22.841355 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m05:21:22.841911 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m05:21:22.843046 [info ] [MainThread]: 
[0m05:21:22.843749 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.88 seconds (4.88s).
[0m05:21:22.847680 [debug] [MainThread]: Command end result
[0m05:21:23.006782 [info ] [MainThread]: 
[0m05:21:23.007682 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:21:23.008304 [info ] [MainThread]: 
[0m05:21:23.009037 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:21:23.010443 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.602977, "process_in_blocks": "0", "process_kernel_time": 0.708887, "process_mem_max_rss": "114832", "process_out_blocks": "9744", "process_user_time": 6.46847}
[0m05:21:23.011263 [debug] [MainThread]: Command `dbt build` succeeded at 05:21:23.011067 after 7.60 seconds
[0m05:21:23.011925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa9690f310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa948a5a30>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7bfa94838220>]}
[0m05:21:23.012529 [debug] [MainThread]: Flushing usage events
[0m05:22:15.937801 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa5fa2310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa2bffbe0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa2bffa90>]}


============================== 05:22:15.946804 | 0adf6fc5-8581-4e8c-9846-b0666a57fe5a ==============================
[0m05:22:15.946804 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:22:15.947930 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'empty': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'profiles_dir': '.', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'use_colors': 'True', 'warn_error': 'None', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'static_parser': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'debug': 'False', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'version_check': 'True', 'no_print': 'None'}
[0m05:22:16.529483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0adf6fc5-8581-4e8c-9846-b0666a57fe5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa5532b80>]}
[0m05:22:16.671140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0adf6fc5-8581-4e8c-9846-b0666a57fe5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa2aec610>]}
[0m05:22:16.672406 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:22:17.138050 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:22:17.642970 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:22:17.643631 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:22:17.845714 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0adf6fc5-8581-4e8c-9846-b0666a57fe5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa2362e80>]}
[0m05:22:18.288542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0adf6fc5-8581-4e8c-9846-b0666a57fe5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa23778b0>]}
[0m05:22:18.289388 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:22:18.330865 [info ] [MainThread]: 
[0m05:22:18.331902 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:22:18.343518 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:22:18.350072 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:22:18.443457 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:22:18.453900 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:22:19.084989 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:22:19.089321 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:22:19.090756 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:22:19.095689 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:22:19.137160 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:22:19.138258 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:22:19.149886 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:22:19.153850 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:22:19.160159 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:19.162056 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:19.175766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0adf6fc5-8581-4e8c-9846-b0666a57fe5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa22bf2b0>]}
[0m05:22:19.177380 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:22:19.178305 [info ] [MainThread]: 
[0m05:22:19.246810 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:22:19.247958 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:22:19.249047 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:22:19.249798 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:22:19.266755 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:22:19.267977 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:22:19.441415 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:22:19.499404 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:22:19.500882 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:22:19.511847 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:19.648718 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:22:19.652312 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:22:19.654218 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:22:19.657192 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:22:19.662699 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:22:19.665603 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:22:19.667437 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:22:19.670267 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:22:19.763581 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:22:19.767189 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:22:19.773279 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0adf6fc5-8581-4e8c-9846-b0666a57fe5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa171d160>]}
[0m05:22:19.774422 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m05:22:19.775784 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:22:19.828332 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:22:19.778087 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:22:19.830530 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:22:19.832238 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:22:19.834327 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:22:19.836289 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:22:19.838637 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:22:19.840762 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:22:19.842851 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:22:19.844715 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:22:19.846517 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:22:19.848330 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:22:20.058677 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:22:20.060573 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:22:20.061721 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:22:20.064745 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:22:20.066265 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:22:20.067946 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:22:20.429323 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:22:20.370514 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:22:20.438086 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:22:20.440107 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:22:20.443032 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:22:20.444769 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:22:20.660843 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:22:20.677219 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:20.736509 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.90s]
[0m05:22:20.744657 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:22:20.753581 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:22:20.758442 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:22:20.767856 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:20.829198 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:22:20.831229 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.94s]
[0m05:22:20.836817 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.99s]
[0m05:22:20.839825 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:22:20.842713 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:22:20.845951 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:22:20.847277 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:22:20.849102 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:22:20.850866 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:22:20.852799 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:22:20.854669 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:22:20.856840 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:22:20.858522 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:22:20.860210 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:22:20.861861 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:22:20.863421 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:22:20.927874 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:22:20.966617 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:22:20.973054 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:22:21.037228 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:22:21.040066 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:22:21.042044 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:22:21.064471 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:22:21.168717 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:22:21.328321 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:22:21.444292 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:22:21.550131 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:22:21.659333 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:21.730705 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:22:21.761111 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:22:21.860922 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:22:21.867125 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a` 
  ...
[0m05:22:21.930877 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a` 
  ...
[0m05:22:21.935624 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:22:21.941467 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:21.946159 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:22:21.951127 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:22.047020 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:22:22.172954 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:22:22.253607 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:22:22.269767 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0adf6fc5-8581-4e8c-9846-b0666a57fe5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa0f83070>]}
[0m05:22:22.351476 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.41s]
[0m05:22:22.370521 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:22:22.373458 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:22:22.427762 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:22:22.462462 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:22:22.477140 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:22:22.536048 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:22:22.550165 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:22:22.555593 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:22.569121 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:22:22.572020 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:22:22.629698 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:22:22.632567 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:22:22.634733 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:22:22.666713 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:22:22.670932 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a`)
      
    ...
[0m05:22:22.673392 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:22:22.679333 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a`)
      
    ...
[0m05:22:22.712476 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:22:22.715252 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:22:22.725501 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:22:22.735319 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:22:22.745389 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:22.747984 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:22.753855 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a` 
    ...
[0m05:22:22.760012 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a` 
    ...
[0m05:22:22.770277 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:22.772804 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:22.829615 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a` 
  ...
[0m05:22:22.842074 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_0adf6fc5_8581_4e8c_9846_b0666a57fe5a` 
  ...
[0m05:22:22.848287 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:22:22.850731 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:22.862980 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:22:22.875118 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:22:22.934260 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:22.941051 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0adf6fc5-8581-4e8c-9846-b0666a57fe5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa0f83c40>]}
[0m05:22:22.943542 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:22:22.946086 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.08s]
[0m05:22:22.952674 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0adf6fc5-8581-4e8c-9846-b0666a57fe5a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa46de430>]}
[0m05:22:22.955433 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:22:22.958188 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.10s]
[0m05:22:22.961601 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:22:22.965413 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:22:22.966642 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:22:22.968037 [debug] [MainThread]: On list__clean: Close
[0m05:22:22.969361 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:22:22.970607 [debug] [MainThread]: On list__mart: Close
[0m05:22:22.971716 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:22:22.972871 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:22:22.974007 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:22:22.975212 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:22:22.976344 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:22:23.028721 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:22:23.030124 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m05:22:23.031409 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m05:22:23.033826 [info ] [MainThread]: 
[0m05:22:23.035371 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.70 seconds (4.70s).
[0m05:22:23.042418 [debug] [MainThread]: Command end result
[0m05:22:23.248962 [info ] [MainThread]: 
[0m05:22:23.250625 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:22:23.251970 [info ] [MainThread]: 
[0m05:22:23.253393 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:22:23.255928 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.5114765, "process_in_blocks": "0", "process_kernel_time": 0.6996, "process_mem_max_rss": "115160", "process_out_blocks": "9744", "process_user_time": 6.41481}
[0m05:22:23.257350 [debug] [MainThread]: Command `dbt build` succeeded at 05:22:23.257002 after 7.51 seconds
[0m05:22:23.258503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa5fa2310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa52ed8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73bfa22c9700>]}
[0m05:22:23.259688 [debug] [MainThread]: Flushing usage events
[0m05:23:16.410122 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a91bd9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a907d6bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a8e8e7970>]}


============================== 05:23:16.419314 | 48ddf370-fe5f-4a02-8c3d-0556c5838aca ==============================
[0m05:23:16.419314 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:23:16.420360 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'quiet': 'False', 'static_parser': 'True', 'printer_width': '80', 'indirect_selection': 'eager', 'profiles_dir': '.', 'version_check': 'True', 'warn_error': 'None', 'introspect': 'True', 'log_format': 'default', 'fail_fast': 'False', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'empty': 'False', 'cache_selected_only': 'False', 'target_path': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'debug': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'write_json': 'True'}
[0m05:23:16.948793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '48ddf370-fe5f-4a02-8c3d-0556c5838aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a911733a0>]}
[0m05:23:17.141154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '48ddf370-fe5f-4a02-8c3d-0556c5838aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a8f1648e0>]}
[0m05:23:17.142481 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:23:17.554422 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:23:18.106598 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:23:18.107270 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:23:18.307780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '48ddf370-fe5f-4a02-8c3d-0556c5838aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a8dfa3ee0>]}
[0m05:23:18.755177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '48ddf370-fe5f-4a02-8c3d-0556c5838aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a8dff3d60>]}
[0m05:23:18.756083 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:23:18.759336 [info ] [MainThread]: 
[0m05:23:18.760380 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:23:18.808062 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:23:18.814786 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:23:18.851880 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:23:18.912237 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:23:19.713029 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:23:19.717962 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:23:19.720309 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:23:19.721851 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:19.752485 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:23:19.753685 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:23:19.835460 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:23:19.830298 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:23:19.841875 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:23:19.843221 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:23:19.906639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '48ddf370-fe5f-4a02-8c3d-0556c5838aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a8d6214f0>]}
[0m05:23:19.908121 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:23:19.909196 [info ] [MainThread]: 
[0m05:23:19.928732 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:23:19.929845 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:23:19.930884 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:23:19.931629 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:23:19.947924 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:23:19.949031 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:23:20.123030 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:23:20.187403 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:23:20.188814 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:23:20.200463 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:23:20.331542 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:23:20.335297 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:20.337904 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:23:20.341760 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:20.347715 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:23:20.350346 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:20.352215 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:23:20.355106 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:20.446214 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:23:20.449682 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:20.455559 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48ddf370-fe5f-4a02-8c3d-0556c5838aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a8d34d3d0>]}
[0m05:23:20.505701 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m05:23:20.507266 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:23:20.509303 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:23:20.510929 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:23:20.512732 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:23:20.514351 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:23:20.516343 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:23:20.518332 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:23:20.520138 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:23:20.521745 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:23:20.523865 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:23:20.525272 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:23:20.526482 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:23:20.528190 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:23:20.626155 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:23:20.642661 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:23:20.637265 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:23:20.645282 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:23:20.647297 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:23:20.711476 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:23:21.019953 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:23:21.017383 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:23:21.021566 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:23:21.024176 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:23:21.027731 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:23:21.033637 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:23:21.309992 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:23:21.317304 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:23:21.323627 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:23:21.326230 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:23:21.334603 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:23:21.342435 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.82s]
[0m05:23:21.350952 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.83s]
[0m05:23:21.406315 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:23:21.409305 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:23:21.412037 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:23:21.418193 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m05:23:21.421826 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:23:21.424846 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:23:21.426041 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:23:21.427638 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:23:21.428919 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:23:21.431071 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:23:21.432980 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:23:21.435086 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:23:21.436586 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:23:21.438212 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:23:21.439890 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:23:21.441597 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:23:21.511027 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:23:21.524883 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:23:21.538378 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:23:21.552213 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:23:21.554203 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:23:21.607214 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:23:21.619236 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:23:21.738077 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:23:21.911102 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:23:22.007406 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:23:22.037729 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:23:22.140118 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca` 
  ...
[0m05:23:22.141754 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:23:22.151893 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca` 
  ...
[0m05:23:22.154525 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:23:22.207637 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:23:22.210968 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:22.217539 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:23:22.326896 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:23:22.417498 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:23:22.420043 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:23:22.422896 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:23:22.425020 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:23:22.429580 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:22.437016 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:23:22.440069 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:22.442785 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48ddf370-fe5f-4a02-8c3d-0556c5838aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a8cb057c0>]}
[0m05:23:22.444034 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.00s]
[0m05:23:22.445378 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:23:22.450264 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:23:22.506335 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:23:22.513471 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:23:22.519721 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:23:22.524933 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:22.526163 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:22.532573 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:23:22.535273 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:23:22.536749 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:23:22.537719 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:23:22.553937 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:23:22.556139 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca`)
      
    ...
[0m05:23:22.557301 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:23:22.560105 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca`)
      
    ...
[0m05:23:22.576641 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:23:22.605778 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:23:22.607163 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:23:22.613058 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:23:22.616513 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:23:22.617888 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:22.620578 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca` 
    ...
[0m05:23:22.623232 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca` 
    ...
[0m05:23:22.628868 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:22.630013 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:22.635970 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca` 
  ...
[0m05:23:22.642371 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_48ddf370_fe5f_4a02_8c3d_0556c5838aca` 
  ...
[0m05:23:22.647393 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:22.649472 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:22.708853 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:23:22.721620 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:23:22.727192 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:22.729628 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:23:22.735075 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48ddf370-fe5f-4a02-8c3d-0556c5838aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a8db35d30>]}
[0m05:23:22.741190 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '48ddf370-fe5f-4a02-8c3d-0556c5838aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a8d8946a0>]}
[0m05:23:22.743325 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.30s]
[0m05:23:22.746116 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.31s]
[0m05:23:22.749159 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:23:22.806809 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:23:22.811668 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:23:22.812832 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:23:22.813989 [debug] [MainThread]: On list__mart: Close
[0m05:23:22.815029 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:23:22.816161 [debug] [MainThread]: On list__clean: Close
[0m05:23:22.817222 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:23:22.818317 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:23:22.819367 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:23:22.820566 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:23:22.821639 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:23:22.822776 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:23:22.823812 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m05:23:22.824961 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m05:23:22.827247 [info ] [MainThread]: 
[0m05:23:22.828729 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.07 seconds (4.07s).
[0m05:23:22.836922 [debug] [MainThread]: Command end result
[0m05:23:23.035027 [info ] [MainThread]: 
[0m05:23:23.035907 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:23:23.036485 [info ] [MainThread]: 
[0m05:23:23.037119 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:23:23.038402 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.825234, "process_in_blocks": "0", "process_kernel_time": 0.679349, "process_mem_max_rss": "114940", "process_out_blocks": "9744", "process_user_time": 6.088549}
[0m05:23:23.039142 [debug] [MainThread]: Command `dbt build` succeeded at 05:23:23.038951 after 6.83 seconds
[0m05:23:23.039872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a91bd9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a8f1648e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a8a8e7345e0>]}
[0m05:23:23.040451 [debug] [MainThread]: Flushing usage events
[0m05:24:15.851318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c67f0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c345cb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c345c9d0>]}


============================== 05:24:15.860580 | 936bfa8f-24b4-4867-baa3-c25faf33f645 ==============================
[0m05:24:15.860580 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:24:15.861650 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'target_path': 'None', 'debug': 'False', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'log_format': 'default', 'warn_error': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True', 'version_check': 'True', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'empty': 'False', 'write_json': 'True', 'static_parser': 'True', 'printer_width': '80', 'profiles_dir': '.', 'fail_fast': 'False', 'partial_parse': 'True', 'use_colors': 'True'}
[0m05:24:16.441723 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '936bfa8f-24b4-4867-baa3-c25faf33f645', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c5d8fca0>]}
[0m05:24:16.636932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '936bfa8f-24b4-4867-baa3-c25faf33f645', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c35684f0>]}
[0m05:24:16.638232 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:24:17.054640 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:24:17.557577 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:24:17.558236 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:24:17.760738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '936bfa8f-24b4-4867-baa3-c25faf33f645', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c2bc1eb0>]}
[0m05:24:18.245988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '936bfa8f-24b4-4867-baa3-c25faf33f645', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c2bff760>]}
[0m05:24:18.246921 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:24:18.250305 [info ] [MainThread]: 
[0m05:24:18.251480 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:24:18.263425 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:24:18.264528 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:24:18.346909 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:24:18.349093 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:24:18.813113 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:24:18.831161 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:24:18.836493 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:24:18.846817 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:18.940231 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:24:18.946809 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:24:18.957206 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:24:18.962493 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:24:18.971094 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:18.975624 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:19.042871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '936bfa8f-24b4-4867-baa3-c25faf33f645', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c33a4af0>]}
[0m05:24:19.044712 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:24:19.046064 [info ] [MainThread]: 
[0m05:24:19.074126 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:24:19.075292 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:24:19.076379 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:24:19.077136 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:24:19.150168 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:24:19.151783 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:24:19.345972 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:24:19.412843 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:24:19.414212 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:24:19.428699 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:19.554498 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:24:19.558421 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:24:19.560417 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:24:19.563316 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:24:19.569125 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:24:19.573076 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:24:19.575073 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:24:19.578017 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:24:19.671421 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:24:19.674930 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:24:19.730584 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '936bfa8f-24b4-4867-baa3-c25faf33f645', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c1e5a940>]}
[0m05:24:19.731918 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m05:24:19.733294 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:24:19.735644 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:24:19.737133 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:24:19.738812 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:24:19.740528 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:24:19.743021 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:24:19.741979 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:24:19.744582 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:24:19.746377 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:24:19.748511 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:24:19.750550 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:24:19.773093 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:24:19.846215 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:24:19.852163 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:24:19.866627 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:24:19.934920 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:24:19.937609 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:24:19.939692 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:24:19.941385 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:24:20.233031 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:24:20.246077 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:24:20.248336 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:24:20.249597 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:24:20.250518 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:24:20.251438 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:24:20.431482 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:24:20.446640 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:20.451073 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:24:20.464290 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:24:20.465925 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.72s]
[0m05:24:20.469757 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:24:20.474234 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:20.477430 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.73s]
[0m05:24:20.479103 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:20.531724 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:24:20.535144 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.79s]
[0m05:24:20.537566 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:24:20.540163 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:24:20.541277 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:24:20.542186 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:24:20.543420 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:24:20.544838 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:24:20.546004 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:24:20.547134 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:24:20.548218 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:24:20.548987 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:24:20.549784 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:24:20.550808 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:24:20.551938 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:24:20.638749 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:24:20.639882 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:24:20.654824 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:24:20.657686 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:24:20.669968 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:24:20.735413 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:24:20.775019 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:24:20.857103 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:24:20.936975 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:24:20.977694 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:24:21.142168 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:24:21.172125 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:24:21.343412 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.16 seconds
[0m05:24:21.460664 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:24:21.566070 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645` 
  ...
[0m05:24:21.569397 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:21.642155 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:24:21.644037 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645` 
  ...
[0m05:24:21.648646 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:24:21.676411 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:24:21.742459 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:24:21.862434 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:24:21.971633 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:24:22.039705 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '936bfa8f-24b4-4867-baa3-c25faf33f645', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c2452c10>]}
[0m05:24:22.074207 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.49s]
[0m05:24:22.137461 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:24:22.140277 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:24:22.143462 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:24:22.180340 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:24:22.195951 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:24:22.249761 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:24:22.258333 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:24:22.265967 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:22.268749 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:22.337918 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:24:22.346099 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:24:22.348710 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:24:22.351224 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:24:22.381415 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:24:22.384131 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:24:22.388252 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645`)
      
    ...
[0m05:24:22.392318 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645`)
      
    ...
[0m05:24:22.419629 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:24:22.438896 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:24:22.441502 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:24:22.453935 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:24:22.457203 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:22.464956 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645` 
    ...
[0m05:24:22.470214 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:22.475473 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645` 
    ...
[0m05:24:22.478026 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:22.542559 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645` 
  ...
[0m05:24:22.545325 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:24:22.561497 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:22.559140 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_936bfa8f_24b4_4867_baa3_c25faf33f645` 
  ...
[0m05:24:22.574388 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:24:22.631760 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:24:22.646805 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:24:22.649477 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:24:22.658101 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '936bfa8f-24b4-4867-baa3-c25faf33f645', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c278d610>]}
[0m05:24:22.660633 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:24:22.662929 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.11s]
[0m05:24:22.669496 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '936bfa8f-24b4-4867-baa3-c25faf33f645', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c2452190>]}
[0m05:24:22.672225 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:24:22.674771 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.12s]
[0m05:24:22.678083 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:24:22.733754 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:24:22.734990 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:24:22.736188 [debug] [MainThread]: On list__mart: Close
[0m05:24:22.737457 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:24:22.738557 [debug] [MainThread]: On list__clean: Close
[0m05:24:22.739617 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:24:22.740692 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:24:22.741730 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:24:22.742856 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:24:22.743913 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:24:22.745150 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:24:22.746222 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m05:24:22.747290 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m05:24:22.749514 [info ] [MainThread]: 
[0m05:24:22.750836 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.50 seconds (4.50s).
[0m05:24:22.758936 [debug] [MainThread]: Command end result
[0m05:24:22.972323 [info ] [MainThread]: 
[0m05:24:22.973887 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:24:22.975024 [info ] [MainThread]: 
[0m05:24:22.976157 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:24:22.978235 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.3223386, "process_in_blocks": "0", "process_kernel_time": 0.71131, "process_mem_max_rss": "114576", "process_out_blocks": "9752", "process_user_time": 6.371947}
[0m05:24:22.979396 [debug] [MainThread]: Command `dbt build` succeeded at 05:24:22.979082 after 7.32 seconds
[0m05:24:23.031630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c67f0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c2bff760>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72d6c47193a0>]}
[0m05:24:23.032937 [debug] [MainThread]: Flushing usage events
[0m05:25:15.559433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21ba10c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b6d74b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b6d74a00>]}


============================== 05:25:15.568639 | 9cba2c39-0378-4a6c-b07b-14105a070b90 ==============================
[0m05:25:15.568639 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:25:15.569702 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'version_check': 'True', 'use_experimental_parser': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'debug': 'False', 'static_parser': 'True', 'log_format': 'default', 'quiet': 'False', 'target_path': 'None', 'printer_width': '80', 'empty': 'False', 'no_print': 'None', 'profiles_dir': '.', 'introspect': 'True', 'write_json': 'True', 'partial_parse': 'True', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'indirect_selection': 'eager', 'fail_fast': 'False'}
[0m05:25:16.149362 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9cba2c39-0378-4a6c-b07b-14105a070b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b6d2d9a0>]}
[0m05:25:16.347594 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9cba2c39-0378-4a6c-b07b-14105a070b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b6dd9580>]}
[0m05:25:16.348927 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:25:16.760818 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:25:17.266467 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:25:17.267135 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:25:17.465163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9cba2c39-0378-4a6c-b07b-14105a070b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b64caeb0>]}
[0m05:25:17.947618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9cba2c39-0378-4a6c-b07b-14105a070b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b63bf4c0>]}
[0m05:25:17.949049 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:25:17.952824 [info ] [MainThread]: 
[0m05:25:17.954056 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:25:17.966422 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:25:17.978281 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:25:18.132936 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:25:18.134734 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:25:18.934802 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:25:18.937208 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:25:18.943593 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:18.946124 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:19.047873 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:25:19.049492 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:25:19.064786 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:25:19.072429 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:25:19.131844 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:25:19.083264 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:19.155996 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9cba2c39-0378-4a6c-b07b-14105a070b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b6cb8af0>]}
[0m05:25:19.157962 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:25:19.159740 [info ] [MainThread]: 
[0m05:25:19.238611 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:25:19.240141 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:25:19.241636 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:25:19.242677 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:25:19.263690 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:25:19.264926 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:25:19.453716 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:25:19.524730 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:25:19.526318 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:25:19.541622 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:19.671262 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:25:19.675096 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:25:19.677186 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:25:19.680378 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:25:19.735050 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:25:19.738297 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:25:19.740250 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:25:19.743140 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:25:19.837779 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:25:19.841301 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:25:19.847301 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cba2c39-0378-4a6c-b07b-14105a070b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b5737e20>]}
[0m05:25:19.848448 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m05:25:19.849793 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:25:19.851935 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:25:19.852939 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:25:19.853935 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:25:19.855048 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:25:19.856918 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:25:19.858604 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:25:19.859953 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:25:19.862203 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:25:19.863598 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:25:19.865181 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:25:19.867010 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:25:19.931564 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:25:19.954901 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:25:19.974246 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:25:20.043785 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:25:20.046052 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:25:20.053687 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:25:20.060323 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:25:20.378222 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:25:20.431668 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:25:20.433363 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:25:20.436478 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:25:20.438287 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:25:20.441437 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:25:20.671717 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:25:20.686640 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:25:20.691468 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:25:20.694487 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:25:20.733022 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:25:20.751986 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:25:20.759492 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m05:25:20.761795 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m05:25:20.767640 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.91s]
[0m05:25:20.770685 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:25:20.773570 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:25:20.776469 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:25:20.834679 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:25:20.836320 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:25:20.838185 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:25:20.839930 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:25:20.841988 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:25:20.844328 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:25:20.846226 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:25:20.847884 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:25:20.849691 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:25:20.851372 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:25:20.853063 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:25:20.854849 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:25:20.962255 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:25:21.032695 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:25:20.979276 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:25:21.035293 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:25:21.037166 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:25:21.043357 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:25:21.131915 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:25:21.264220 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:25:21.447143 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90` 
  ...
[0m05:25:21.452993 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90` 
  ...
[0m05:25:21.455775 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m05:25:21.458164 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:25:21.465274 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:25:21.472372 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:25:21.559069 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:25:21.631764 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:25:21.632517 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:25:21.634243 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:25:21.638731 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:25:21.645134 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:25:21.648067 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:25:21.650223 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:25:21.652933 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:25:21.659661 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:25:21.661020 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:25:21.674969 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:25:21.735809 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:25:21.736821 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:25:21.734638 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:25:21.739624 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cba2c39-0378-4a6c-b07b-14105a070b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b50b94c0>]}
[0m05:25:21.744373 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.89s]
[0m05:25:21.746347 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:25:21.748025 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:21.749283 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:21.755751 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:25:21.758813 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:25:21.760440 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:25:21.761487 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:25:21.777530 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:21.778789 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:25:21.780855 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90`)
      
    ...
[0m05:25:21.782827 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90`)
      
    ...
[0m05:25:21.800666 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:25:21.833765 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:25:21.835140 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:25:21.845568 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:25:21.848032 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:21.854895 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90` 
    ...
[0m05:25:21.860748 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:21.866627 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90` 
    ...
[0m05:25:21.868897 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:21.936237 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90` 
  ...
[0m05:25:21.933187 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:25:21.947696 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9cba2c39_0378_4a6c_b07b_14105a070b90` 
  ...
[0m05:25:21.949261 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:21.958288 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:25:21.959723 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:21.968741 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:25:21.970530 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:21.977191 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cba2c39-0378-4a6c-b07b-14105a070b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b50b98b0>]}
[0m05:25:22.030107 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:25:22.033124 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.13s]
[0m05:25:22.039846 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9cba2c39-0378-4a6c-b07b-14105a070b90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b71c5460>]}
[0m05:25:22.042621 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:25:22.045078 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.19s]
[0m05:25:22.048463 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:25:22.052256 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:25:22.053497 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:25:22.054751 [debug] [MainThread]: On list__clean: Close
[0m05:25:22.055931 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:25:22.057155 [debug] [MainThread]: On list__mart: Close
[0m05:25:22.058292 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:25:22.059461 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:25:22.060643 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:25:22.061819 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:25:22.062924 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:25:22.064086 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:25:22.065197 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:25:22.066342 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:25:22.068664 [info ] [MainThread]: 
[0m05:25:22.070215 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.11 seconds (4.11s).
[0m05:25:22.078889 [debug] [MainThread]: Command end result
[0m05:25:22.263689 [info ] [MainThread]: 
[0m05:25:22.264976 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:25:22.265978 [info ] [MainThread]: 
[0m05:25:22.267053 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:25:22.269052 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.9014564, "process_in_blocks": "0", "process_kernel_time": 0.666104, "process_mem_max_rss": "114836", "process_out_blocks": "9744", "process_user_time": 6.12995}
[0m05:25:22.270209 [debug] [MainThread]: Command `dbt build` succeeded at 05:25:22.269922 after 6.90 seconds
[0m05:25:22.271185 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21ba10c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b6428280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f21b4fd9550>]}
[0m05:25:22.272663 [debug] [MainThread]: Flushing usage events
[0m05:26:16.319617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae18c3e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae15890b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae15890a00>]}


============================== 05:26:16.328725 | 407fa117-d205-42bc-a6d4-e84328e6013b ==============================
[0m05:26:16.328725 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:26:16.329763 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'target_path': 'None', 'indirect_selection': 'eager', 'version_check': 'True', 'profiles_dir': '.', 'static_parser': 'True', 'no_print': 'None', 'fail_fast': 'False', 'empty': 'False', 'use_colors': 'True', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'log_format': 'default', 'warn_error': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'partial_parse': 'True', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'debug': 'False', 'printer_width': '80'}
[0m05:26:16.927449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '407fa117-d205-42bc-a6d4-e84328e6013b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae15789490>]}
[0m05:26:17.193825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '407fa117-d205-42bc-a6d4-e84328e6013b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae163733a0>]}
[0m05:26:17.195144 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:26:17.613626 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:26:18.119927 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:26:18.120623 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:26:18.320591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '407fa117-d205-42bc-a6d4-e84328e6013b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae14ffaeb0>]}
[0m05:26:18.802588 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '407fa117-d205-42bc-a6d4-e84328e6013b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae14eef4c0>]}
[0m05:26:18.803467 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:26:18.806677 [info ] [MainThread]: 
[0m05:26:18.807720 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:26:18.819137 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:26:18.820674 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:26:18.910529 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:26:18.928918 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:26:19.656630 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:26:19.664604 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:26:19.666804 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:19.687020 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:26:19.731663 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:26:19.786042 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:26:19.799440 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:26:19.807080 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:26:19.816436 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:19.818552 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:19.889155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '407fa117-d205-42bc-a6d4-e84328e6013b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae148be280>]}
[0m05:26:19.891206 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:26:19.892715 [info ] [MainThread]: 
[0m05:26:19.920402 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:26:19.921967 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:26:19.923442 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:26:19.924487 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:26:19.995661 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:26:19.996971 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:26:20.192917 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:26:20.259278 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:26:20.260694 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:26:20.272574 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:20.405161 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:26:20.409752 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:26:20.411804 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:26:20.414623 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:26:20.420231 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:26:20.423132 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:26:20.424953 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:26:20.427748 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:26:20.520482 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:26:20.523989 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:26:20.529965 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '407fa117-d205-42bc-a6d4-e84328e6013b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae14291940>]}
[0m05:26:20.531210 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m05:26:20.532610 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:26:20.534483 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:26:20.535525 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:26:20.586163 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:26:20.587500 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:26:20.589969 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:26:20.591883 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:26:20.594032 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:26:20.595918 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:26:20.598100 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:26:20.600251 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:26:20.612429 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:26:20.686041 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:26:20.703456 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:26:20.720116 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:26:20.785622 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:26:20.788590 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:26:20.790262 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:26:20.823167 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:26:21.010652 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:26:21.096045 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:26:21.109201 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:26:21.110856 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:26:21.111862 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:26:21.113603 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:26:21.355729 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:26:21.388027 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:26:21.390772 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:26:21.395443 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:26:21.408952 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:26:21.411325 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.81s]
[0m05:26:21.419783 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.83s]
[0m05:26:21.423841 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:26:21.426861 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:26:21.430332 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:26:21.488471 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.89s]
[0m05:26:21.491516 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:26:21.494160 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:26:21.495514 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:26:21.497110 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:26:21.498501 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:26:21.500974 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:26:21.502825 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:26:21.504718 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:26:21.506600 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:26:21.508298 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:26:21.509889 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:26:21.511568 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:26:21.528804 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:26:21.628635 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:26:21.686374 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:26:21.690947 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:26:21.693609 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:26:21.695236 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:26:21.707644 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:26:21.896228 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:26:22.012224 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:26:22.097129 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:26:22.220884 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:26:22.308782 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:26:22.393676 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:26:22.432095 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b` 
  ...
[0m05:26:22.491586 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:26:22.518441 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b` 
  ...
[0m05:26:22.521361 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:22.587025 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:26:22.612660 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:26:22.622596 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:26:22.686995 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m05:26:22.703458 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:22.803780 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:26:22.895998 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:26:22.906495 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '407fa117-d205-42bc-a6d4-e84328e6013b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae1485aa00>]}
[0m05:26:22.914209 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.40s]
[0m05:26:22.987240 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:26:23.026259 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:26:23.032152 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:26:23.119485 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:26:23.136300 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:26:23.193415 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:26:23.195270 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:26:23.204867 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:23.207729 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:23.226373 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:26:23.285353 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:26:23.288172 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:26:23.292036 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:26:23.321078 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:26:23.323705 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:26:23.327854 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b`)
      
    ...
[0m05:26:23.331946 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b`)
      
    ...
[0m05:26:23.362439 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:26:23.376968 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:26:23.374787 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:26:23.391826 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:26:23.400776 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:23.403414 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:23.409224 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b` 
    ...
[0m05:26:23.415221 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b` 
    ...
[0m05:26:23.426412 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:23.429032 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:23.488772 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b` 
  ...
[0m05:26:23.500960 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_407fa117_d205_42bc_a6d4_e84328e6013b` 
  ...
[0m05:26:23.508270 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:23.510748 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:23.522608 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:26:23.586358 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:26:23.591254 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:26:23.599105 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:26:23.600315 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '407fa117-d205-42bc-a6d4-e84328e6013b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae14b2d9a0>]}
[0m05:26:23.606712 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '407fa117-d205-42bc-a6d4-e84328e6013b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae142aaee0>]}
[0m05:26:23.609135 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m05:26:23.611676 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.10s]
[0m05:26:23.614569 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:26:23.617496 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:26:23.621969 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:26:23.623254 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:26:23.624580 [debug] [MainThread]: On list__clean: Close
[0m05:26:23.625720 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:26:23.626906 [debug] [MainThread]: On list__mart: Close
[0m05:26:23.628055 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:26:23.629240 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:26:23.630357 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:26:23.631666 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:26:23.632771 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:26:23.633947 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:26:23.635061 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:26:23.686200 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:26:23.688628 [info ] [MainThread]: 
[0m05:26:23.690137 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.88 seconds (4.88s).
[0m05:26:23.698213 [debug] [MainThread]: Command end result
[0m05:26:23.917586 [info ] [MainThread]: 
[0m05:26:23.919131 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:26:23.920301 [info ] [MainThread]: 
[0m05:26:23.921505 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:26:23.923760 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.7966413, "process_in_blocks": "0", "process_kernel_time": 0.688304, "process_mem_max_rss": "114648", "process_out_blocks": "9744", "process_user_time": 6.568558}
[0m05:26:23.925071 [debug] [MainThread]: Command `dbt build` succeeded at 05:26:23.924749 after 7.80 seconds
[0m05:26:23.926139 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae18c3e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae16b44dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74ae15789490>]}
[0m05:26:23.927185 [debug] [MainThread]: Flushing usage events
[0m05:27:16.024923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e57e43b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e57b0a8bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e57b0a8a60>]}


============================== 05:27:16.034212 | 30972437-912e-4476-9bbd-7a3c4596e0dc ==============================
[0m05:27:16.034212 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:27:16.035304 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'fail_fast': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'log_cache_events': 'False', 'version_check': 'True', 'introspect': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'target_path': 'None', 'printer_width': '80', 'partial_parse': 'True', 'empty': 'False', 'no_print': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'profiles_dir': '.', 'warn_error': 'None', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_path': '/workdir/transforms/04_btc/logs', 'static_parser': 'True', 'cache_selected_only': 'False'}
[0m05:27:16.621323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '30972437-912e-4476-9bbd-7a3c4596e0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e57d9d1ca0>]}
[0m05:27:16.816126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '30972437-912e-4476-9bbd-7a3c4596e0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e57b0743d0>]}
[0m05:27:16.817446 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:27:17.235865 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:27:17.795413 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:27:17.796076 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:27:17.996332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '30972437-912e-4476-9bbd-7a3c4596e0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e57a7fbe80>]}
[0m05:27:18.441106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '30972437-912e-4476-9bbd-7a3c4596e0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e57a7e5dc0>]}
[0m05:27:18.442002 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:27:18.445250 [info ] [MainThread]: 
[0m05:27:18.446289 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:27:18.496708 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:27:18.498330 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:27:18.531110 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:27:18.595901 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:27:19.179497 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:27:19.191384 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:19.200661 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:27:19.211492 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:19.306588 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:27:19.308359 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:27:19.326585 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:27:19.332917 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:27:19.341319 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:19.399516 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:27:19.415442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '30972437-912e-4476-9bbd-7a3c4596e0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e57e38e7c0>]}
[0m05:27:19.417422 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:27:19.418798 [info ] [MainThread]: 
[0m05:27:19.496300 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:27:19.497562 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:27:19.498683 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:27:19.499435 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:27:19.515750 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:27:19.516940 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:27:19.699229 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:27:19.768575 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:27:19.769989 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:27:19.782065 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:19.912172 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:27:19.916330 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:27:19.918440 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:27:19.921458 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:27:19.927199 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:27:19.930082 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:27:19.931863 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:27:19.934809 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:27:20.028196 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:27:20.031691 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:27:20.037736 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '30972437-912e-4476-9bbd-7a3c4596e0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e579a8db20>]}
[0m05:27:20.038882 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.54s]
[0m05:27:20.040205 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:27:20.092062 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:27:20.093309 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:27:20.094837 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:27:20.096294 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:27:20.097883 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:27:20.099213 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:27:20.100840 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:27:20.128883 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:27:20.192276 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:27:20.193594 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:27:20.194894 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:27:20.196134 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:27:20.197127 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:27:20.197852 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:27:20.205099 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:27:20.212268 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:27:20.294707 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:27:20.295984 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:27:20.300451 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:27:20.301370 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:27:20.302170 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:27:20.306470 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:27:20.307472 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:27:20.309424 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:27:20.471399 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:27:20.479801 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:27:20.483197 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:20.491597 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.30s]
[0m05:27:20.493168 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:27:20.494778 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:27:20.497708 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:27:20.500915 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.31s]
[0m05:27:20.502434 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:27:20.504154 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:20.506992 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.41s]
[0m05:27:20.508382 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:27:20.509844 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:27:20.510834 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:27:20.511598 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:27:20.512592 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:27:20.513681 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:27:20.514738 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:27:20.515600 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:27:20.516324 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:27:20.517043 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:27:20.517779 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:27:20.518568 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:27:20.519300 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:27:20.593156 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:27:20.597850 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:27:20.604577 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:27:20.606030 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:27:20.606770 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:27:20.618206 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:27:20.736274 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:27:20.927213 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:27:21.006925 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc` 
  ...
[0m05:27:21.009771 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc` 
  ...
[0m05:27:21.015589 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:27:21.034389 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:27:21.036294 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:27:21.121119 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:27:21.208725 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:21.233717 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:27:21.334851 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:27:21.402424 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:27:21.415937 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:27:21.413398 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:27:21.426014 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:27:21.430906 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:27:21.436507 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:27:21.496230 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:27:21.498891 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:27:21.506240 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:27:21.611232 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:27:21.617485 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:27:21.620867 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:21.633049 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '30972437-912e-4476-9bbd-7a3c4596e0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e57a390dc0>]}
[0m05:27:21.635859 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:21.694616 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:27:21.692136 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.12s]
[0m05:27:21.710172 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:27:21.716521 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:27:21.719913 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:27:21.723258 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:27:21.726727 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:27:21.761626 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:27:21.764250 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:27:21.791391 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc`)
      
    ...
[0m05:27:21.795733 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc`)
      
    ...
[0m05:27:21.824123 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:27:21.833175 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:27:21.835643 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:27:21.850130 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:21.848022 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:27:21.855274 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc` 
    ...
[0m05:27:21.893162 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:27:21.896702 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc` 
    ...
[0m05:27:21.899399 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:27:21.909665 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc` 
  ...
[0m05:27:21.912519 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:21.920946 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_30972437_912e_4476_9bbd_7a3c4596e0dc` 
  ...
[0m05:27:21.922505 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:21.932892 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:27:21.935164 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:22.002620 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:27:22.004360 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:27:22.010725 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '30972437-912e-4476-9bbd-7a3c4596e0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e579a8d910>]}
[0m05:27:22.015223 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.49s]
[0m05:27:22.017907 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:27:22.020638 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:27:22.027043 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '30972437-912e-4476-9bbd-7a3c4596e0dc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e57cf29970>]}
[0m05:27:22.029841 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.51s]
[0m05:27:22.032657 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:27:22.036992 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:27:22.038164 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:27:22.039304 [debug] [MainThread]: On list__clean: Close
[0m05:27:22.090764 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:27:22.091934 [debug] [MainThread]: On list__mart: Close
[0m05:27:22.093015 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:27:22.094242 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:27:22.095308 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m05:27:22.096458 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m05:27:22.097558 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:27:22.098694 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:27:22.099787 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:27:22.100909 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:27:22.103272 [info ] [MainThread]: 
[0m05:27:22.104724 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.66 seconds (3.66s).
[0m05:27:22.112869 [debug] [MainThread]: Command end result
[0m05:27:22.330864 [info ] [MainThread]: 
[0m05:27:22.332170 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:27:22.333165 [info ] [MainThread]: 
[0m05:27:22.334216 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:27:22.336274 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.514344, "process_in_blocks": "0", "process_kernel_time": 0.685085, "process_mem_max_rss": "114288", "process_out_blocks": "9744", "process_user_time": 5.994005}
[0m05:27:22.337414 [debug] [MainThread]: Command `dbt build` succeeded at 05:27:22.337119 after 6.52 seconds
[0m05:27:22.338355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e57e43b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e57942fdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72e579285cd0>]}
[0m05:27:22.339254 [debug] [MainThread]: Flushing usage events
[0m05:28:15.852108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad9af74dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad97bdcc40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad97bdcaf0>]}


============================== 05:28:15.861208 | 0c51dbfc-fa60-4cea-8303-b5cecb92d21f ==============================
[0m05:28:15.861208 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:28:15.862267 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'log_format': 'default', 'fail_fast': 'False', 'log_cache_events': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'warn_error': 'None', 'profiles_dir': '.', 'empty': 'False', 'indirect_selection': 'eager', 'debug': 'False', 'introspect': 'True', 'write_json': 'True', 'version_check': 'True', 'printer_width': '80', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False', 'use_colors': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'no_print': 'None'}
[0m05:28:16.462480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0c51dbfc-fa60-4cea-8303-b5cecb92d21f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad98df7af0>]}
[0m05:28:16.660050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0c51dbfc-fa60-4cea-8303-b5cecb92d21f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad986edc70>]}
[0m05:28:16.661404 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:28:17.130510 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:28:17.634861 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:28:17.635508 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:28:17.835178 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0c51dbfc-fa60-4cea-8303-b5cecb92d21f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad9732edf0>]}
[0m05:28:18.323289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0c51dbfc-fa60-4cea-8303-b5cecb92d21f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad975f5cd0>]}
[0m05:28:18.324568 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:28:18.327897 [info ] [MainThread]: 
[0m05:28:18.328981 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:28:18.340515 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:28:18.342060 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:28:18.442855 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:28:18.451835 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:28:19.192342 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:28:19.201848 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:28:19.218395 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:28:19.229542 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:19.320666 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:28:19.322236 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:28:19.339048 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:28:19.346294 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:28:19.354137 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:19.364080 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:28:19.427785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0c51dbfc-fa60-4cea-8303-b5cecb92d21f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad978a3d60>]}
[0m05:28:19.429729 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:28:19.430999 [info ] [MainThread]: 
[0m05:28:19.457908 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:28:19.459048 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:28:19.460126 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:28:19.460885 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:28:19.532893 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:28:19.534554 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:28:19.729416 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:28:19.793955 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:28:19.795494 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:28:19.808030 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:19.947003 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:28:19.950942 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:28:19.952887 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:28:19.955789 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:28:19.961571 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:28:19.964689 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:28:19.966573 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:28:19.969385 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:28:20.060355 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:28:20.064275 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:28:20.120855 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c51dbfc-fa60-4cea-8303-b5cecb92d21f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad966a6fd0>]}
[0m05:28:20.122238 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.66s]
[0m05:28:20.123540 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:28:20.125835 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:28:20.127004 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:28:20.128091 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:28:20.129286 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:28:20.130397 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:28:20.131543 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:28:20.132431 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:28:20.133712 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:28:20.135909 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:28:20.157803 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:28:20.159320 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:28:20.161166 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:28:20.163088 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:28:20.217040 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:28:20.236268 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:28:20.245337 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:28:20.338094 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:28:20.357065 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:28:20.432460 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:28:20.439858 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:28:20.449303 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:28:20.451924 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:28:20.453987 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:28:20.457847 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:28:20.726893 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:28:20.741427 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:28:20.745045 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:28:20.755699 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:28:20.817768 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:28:20.830754 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:28:20.839232 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.71s]
[0m05:28:20.836225 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.68s]
[0m05:28:20.845796 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.71s]
[0m05:28:20.848750 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:28:20.851757 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:28:20.854704 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:28:20.858585 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:28:20.859776 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:28:20.861394 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:28:20.863049 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:28:20.864868 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:28:20.918029 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:28:20.919811 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:28:20.921325 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:28:20.922990 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:28:20.924557 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:28:20.926277 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:28:20.928017 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:28:21.045500 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:28:21.049934 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:28:21.059402 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:28:21.061926 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:28:21.063456 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:28:21.127108 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:28:21.253681 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:28:21.353107 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:28:21.442834 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:28:21.618719 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:28:21.648452 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:21.724567 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:28:21.762082 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:21.853350 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:28:22.017766 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:28:22.034233 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:28:22.038174 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f` 
  ...
[0m05:28:22.042595 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f` 
  ...
[0m05:28:22.048827 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:22.051334 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:22.059296 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:22.121003 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:28:22.222951 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:28:22.241136 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c51dbfc-fa60-4cea-8303-b5cecb92d21f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad9673ccd0>]}
[0m05:28:22.328024 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.32s]
[0m05:28:22.356996 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:28:22.462616 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:28:22.520118 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:28:22.552362 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:28:22.569698 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:28:22.626701 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:28:22.631086 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:28:22.637498 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:22.640239 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:22.653261 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:28:22.658873 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:28:22.662072 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:28:22.664658 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:28:22.746674 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:28:22.751013 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f`)
      
    ...
[0m05:28:22.753608 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:28:22.759797 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f`)
      
    ...
[0m05:28:22.782904 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:28:22.795529 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:28:22.798275 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:28:22.819216 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:28:22.831687 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:28:22.830095 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f` 
    ...
[0m05:28:22.842428 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:22.846004 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:22.852022 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f` 
    ...
[0m05:28:22.866327 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f` 
  ...
[0m05:28:22.916883 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:28:22.931830 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:22.933917 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_0c51dbfc_fa60_4cea_8303_b5cecb92d21f` 
  ...
[0m05:28:22.947294 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:28:22.951629 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:22.954245 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:23.019338 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:28:23.025742 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c51dbfc-fa60-4cea-8303-b5cecb92d21f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad970ba760>]}
[0m05:28:23.029898 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.11s]
[0m05:28:23.032916 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:28:23.035680 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:28:23.042377 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0c51dbfc-fa60-4cea-8303-b5cecb92d21f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad96f0b490>]}
[0m05:28:23.045154 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.12s]
[0m05:28:23.047953 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:28:23.051869 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:28:23.053026 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:28:23.054150 [debug] [MainThread]: On list__clean: Close
[0m05:28:23.055238 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:28:23.056415 [debug] [MainThread]: On list__mart: Close
[0m05:28:23.057476 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:28:23.058584 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:28:23.059641 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:28:23.060714 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:28:23.061765 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:28:23.062840 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:28:23.063950 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:28:23.065159 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:28:23.117424 [info ] [MainThread]: 
[0m05:28:23.118338 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.79 seconds (4.79s).
[0m05:28:23.122380 [debug] [MainThread]: Command end result
[0m05:28:23.231593 [info ] [MainThread]: 
[0m05:28:23.232430 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:28:23.233055 [info ] [MainThread]: 
[0m05:28:23.233712 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:28:23.235020 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.5741296, "process_in_blocks": "0", "process_kernel_time": 0.707111, "process_mem_max_rss": "114204", "process_out_blocks": "9744", "process_user_time": 6.435608}
[0m05:28:23.235766 [debug] [MainThread]: Command `dbt build` succeeded at 05:28:23.235570 after 7.57 seconds
[0m05:28:23.236368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad9af74dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad97362d60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75ad95eae3a0>]}
[0m05:28:23.236996 [debug] [MainThread]: Flushing usage events
[0m05:29:15.565350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e10b66c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e1082d8b20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e1082d89d0>]}


============================== 05:29:15.574717 | 3b999004-58fa-4e47-b226-09c6ac91c5c4 ==============================
[0m05:29:15.574717 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:29:15.575781 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'write_json': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'debug': 'False', 'fail_fast': 'False', 'target_path': 'None', 'log_format': 'default', 'quiet': 'False', 'cache_selected_only': 'False', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'no_print': 'None', 'printer_width': '80', 'use_colors': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'partial_parse': 'True', 'warn_error': 'None'}
[0m05:29:16.153242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3b999004-58fa-4e47-b226-09c6ac91c5c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e1081a50a0>]}
[0m05:29:16.352017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3b999004-58fa-4e47-b226-09c6ac91c5c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e1083e54f0>]}
[0m05:29:16.353700 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:29:16.771150 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:29:17.279259 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:29:17.279954 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:29:17.479024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3b999004-58fa-4e47-b226-09c6ac91c5c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e107a3eeb0>]}
[0m05:29:17.962355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3b999004-58fa-4e47-b226-09c6ac91c5c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e1079334c0>]}
[0m05:29:17.963226 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:29:17.966408 [info ] [MainThread]: 
[0m05:29:17.967413 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:29:17.979567 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:29:17.991526 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:29:18.082081 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:29:18.089382 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:29:18.858133 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:29:18.863068 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:29:18.867791 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:29:18.870562 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:29:18.970149 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:29:18.971485 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:29:18.986372 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:29:18.992193 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:29:19.052470 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:29:19.062645 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:29:19.077288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3b999004-58fa-4e47-b226-09c6ac91c5c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e107167730>]}
[0m05:29:19.079133 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:29:19.080581 [info ] [MainThread]: 
[0m05:29:19.155123 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:29:19.156264 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:29:19.157370 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:29:19.158140 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:29:19.174496 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:29:19.175700 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:29:19.355968 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:29:19.412301 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:29:19.413807 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:29:19.423395 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:29:19.561304 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:29:19.564224 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:29:19.566242 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:29:19.568857 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:29:19.574873 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:29:19.577653 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:29:19.579632 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:29:19.582258 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:29:19.680001 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:29:19.683149 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:29:19.689410 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b999004-58fa-4e47-b226-09c6ac91c5c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e106ccbe50>]}
[0m05:29:19.690702 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m05:29:19.692082 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:29:19.693769 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:29:19.694615 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:29:19.744417 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:29:19.695506 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:29:19.745889 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:29:19.746825 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:29:19.747994 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:29:19.748955 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:29:19.749948 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:29:19.750745 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:29:19.751467 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:29:19.752280 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:29:19.780016 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:29:19.781763 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:29:19.790284 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:29:19.792826 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:29:19.791846 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:29:19.864888 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:29:19.975192 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:29:19.988637 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:29:19.990293 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:29:19.992879 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:29:19.991965 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:29:19.993916 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:29:20.244471 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:29:20.255969 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:29:20.260068 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:29:20.264787 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:29:20.277368 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.53s]
[0m05:29:20.280357 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:29:20.285378 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:29:20.344942 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.54s]
[0m05:29:20.348173 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:29:20.351315 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:29:20.357032 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.61s]
[0m05:29:20.360394 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:29:20.363437 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:29:20.364796 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:29:20.366742 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:29:20.368274 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:29:20.370225 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:29:20.372209 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:29:20.374819 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:29:20.376688 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:29:20.378526 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:29:20.380108 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:29:20.381987 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:29:20.455681 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:29:20.476530 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:29:20.550443 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:29:20.559964 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:29:20.562395 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:29:20.563999 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:29:20.644479 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:29:20.756753 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:29:20.850061 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:29:20.890913 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:29:21.045089 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:29:21.080932 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:29:21.179022 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:29:21.268107 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:29:21.384910 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:29:21.486573 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:29:21.492219 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4` 
  ...
[0m05:29:21.558236 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:29:21.560062 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4` 
  ...
[0m05:29:21.566449 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:29:21.570651 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:29:21.583322 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:29:21.678594 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:29:21.762377 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:29:21.778727 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b999004-58fa-4e47-b226-09c6ac91c5c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e1066414f0>]}
[0m05:29:21.954200 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.40s]
[0m05:29:21.972783 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:29:21.985716 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:29:21.988344 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:29:22.044856 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:29:22.081473 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:29:22.084167 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:29:22.144322 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:29:22.147480 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:29:22.154197 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:29:22.157013 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:29:22.159291 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:29:22.162516 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:29:22.164118 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:29:22.171816 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:29:22.174949 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4`)
      
    ...
[0m05:29:22.180192 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:29:22.182282 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4`)
      
    ...
[0m05:29:22.192592 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:29:22.200782 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:29:22.202433 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:29:22.245395 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:29:22.249817 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:29:22.254307 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4` 
    ...
[0m05:29:22.264169 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:29:22.266751 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:29:22.272432 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4` 
    ...
[0m05:29:22.285150 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4` 
  ...
[0m05:29:22.293233 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:29:22.345324 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:29:22.360443 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:29:22.369481 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_3b999004_58fa_4e47_b226_09c6ac91c5c4` 
  ...
[0m05:29:22.374081 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:29:22.376615 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:29:22.383026 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b999004-58fa-4e47-b226-09c6ac91c5c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e106dad1c0>]}
[0m05:29:22.448182 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:29:22.451083 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.01s]
[0m05:29:22.455929 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:29:22.458862 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:29:22.466047 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3b999004-58fa-4e47-b226-09c6ac91c5c4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e106d26ee0>]}
[0m05:29:22.468346 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m05:29:22.471087 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:29:22.474936 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:29:22.476086 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:29:22.477231 [debug] [MainThread]: On list__mart: Close
[0m05:29:22.478339 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:29:22.479489 [debug] [MainThread]: On list__clean: Close
[0m05:29:22.480595 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:29:22.481726 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:29:22.482779 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:29:22.483906 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:29:22.484964 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:29:22.486134 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:29:22.487184 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:29:22.488296 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:29:22.490626 [info ] [MainThread]: 
[0m05:29:22.492031 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.52 seconds (4.52s).
[0m05:29:22.550638 [debug] [MainThread]: Command end result
[0m05:29:22.764471 [info ] [MainThread]: 
[0m05:29:22.766070 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:29:22.767115 [info ] [MainThread]: 
[0m05:29:22.767973 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:29:22.769835 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.394583, "process_in_blocks": "0", "process_kernel_time": 0.730932, "process_mem_max_rss": "114420", "process_out_blocks": "9744", "process_user_time": 6.371411}
[0m05:29:22.770838 [debug] [MainThread]: Command `dbt build` succeeded at 05:29:22.770571 after 7.40 seconds
[0m05:29:22.771670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e10b66c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e10815d280>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e10a16dc40>]}
[0m05:29:22.772484 [debug] [MainThread]: Flushing usage events
[0m05:30:15.441808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef5448ce20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef510e7bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef510e7a60>]}


============================== 05:30:15.451518 | 078d858a-a8f9-4dae-9053-32000483d499 ==============================
[0m05:30:15.451518 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:30:15.452724 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'debug': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'partial_parse': 'True', 'version_check': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'static_parser': 'True', 'printer_width': '80', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'fail_fast': 'False', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'empty': 'False', 'introspect': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'quiet': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default'}
[0m05:30:16.038163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '078d858a-a8f9-4dae-9053-32000483d499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef50ff3a90>]}
[0m05:30:16.234582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '078d858a-a8f9-4dae-9053-32000483d499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef511a7580>]}
[0m05:30:16.235862 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:30:16.647877 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:30:17.153892 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:30:17.154587 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:30:17.353550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '078d858a-a8f9-4dae-9053-32000483d499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef5084de20>]}
[0m05:30:17.835577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '078d858a-a8f9-4dae-9053-32000483d499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef50813af0>]}
[0m05:30:17.836449 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:30:17.839885 [info ] [MainThread]: 
[0m05:30:17.840933 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:30:17.852501 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:30:17.854288 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:30:17.964837 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:30:17.964140 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:30:18.789550 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:30:18.796452 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:30:18.800618 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:18.804609 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:18.863098 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:30:18.869864 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:30:18.941819 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:30:18.951682 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:30:18.960379 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:18.962893 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:19.035101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '078d858a-a8f9-4dae-9053-32000483d499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef50dc3e20>]}
[0m05:30:19.037127 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:30:19.038608 [info ] [MainThread]: 
[0m05:30:19.065467 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:30:19.066683 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:30:19.067776 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:30:19.068521 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:30:19.141390 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:30:19.142955 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:30:19.333816 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:30:19.402461 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:30:19.403826 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:30:19.415707 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:19.537578 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:30:19.540480 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:30:19.542389 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:30:19.545110 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:30:19.550837 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:30:19.553498 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:30:19.555481 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:30:19.558279 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:30:19.652293 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:30:19.655662 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:30:19.661429 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078d858a-a8f9-4dae-9053-32000483d499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef5398cc10>]}
[0m05:30:19.662569 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m05:30:19.663930 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:30:19.666206 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:30:19.667783 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:30:19.669607 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:30:19.670941 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:30:19.673359 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:30:19.674279 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:30:19.723964 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:30:19.726343 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:30:19.728587 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:30:19.730379 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:30:19.732164 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:30:19.734042 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:30:19.946203 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:30:19.950666 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:30:19.951807 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:30:19.954312 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:30:19.955991 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:30:20.029208 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:30:20.270527 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:30:20.266315 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:30:20.332648 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:30:20.335496 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:30:20.338035 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:30:20.341993 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:30:20.553449 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:30:20.562600 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:20.579116 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.85s]
[0m05:30:20.582275 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:30:20.640322 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:30:20.645687 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:30:20.657877 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:20.668216 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.99s]
[0m05:30:20.671060 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:30:20.673919 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:30:20.726700 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.00s]
[0m05:30:20.730319 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:30:20.733164 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:30:20.734276 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:30:20.736048 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:30:20.737287 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:30:20.739435 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:30:20.741422 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:30:20.743434 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:30:20.745170 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:30:20.746859 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:30:20.748504 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:30:20.750100 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:30:20.772506 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:30:20.847128 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:30:20.872375 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:30:20.926125 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:30:20.928661 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:30:20.930935 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:30:20.943008 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:30:21.051933 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:30:21.239886 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:30:21.335074 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:30:21.439371 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:30:21.530083 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:30:21.539892 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:30:21.635887 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:30:21.739894 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:30:21.833635 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499` 
  ...
[0m05:30:21.840474 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:30:21.846748 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499` 
  ...
[0m05:30:21.853082 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:30:21.855757 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:21.861845 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:30:21.928848 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:30:22.031615 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:30:22.130024 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:30:22.158763 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078d858a-a8f9-4dae-9053-32000483d499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef5118a1f0>]}
[0m05:30:22.229920 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.41s]
[0m05:30:22.248567 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:30:22.337414 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:30:22.339613 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:30:22.368330 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:30:22.383922 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:30:22.387660 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:30:22.423990 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:30:22.431060 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:22.432499 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:22.442185 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:30:22.446809 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:30:22.448667 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:30:22.449902 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:30:22.469153 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:30:22.470828 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:30:22.473757 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499`)
      
    ...
[0m05:30:22.476470 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499`)
      
    ...
[0m05:30:22.502766 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:30:22.524205 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:30:22.527437 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:30:22.533157 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:30:22.539640 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:22.541988 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:22.548737 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499` 
    ...
[0m05:30:22.551858 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499` 
    ...
[0m05:30:22.559343 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:22.560452 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:22.566641 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499` 
  ...
[0m05:30:22.573326 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_078d858a_a8f9_4dae_9053_32000483d499` 
  ...
[0m05:30:22.577212 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:30:22.578915 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:30:22.628242 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:30:22.634201 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:30:22.637202 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:30:22.640287 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078d858a-a8f9-4dae-9053-32000483d499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef51180ee0>]}
[0m05:30:22.641437 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.90s]
[0m05:30:22.642990 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:30:22.644360 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:30:22.647636 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078d858a-a8f9-4dae-9053-32000483d499', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef4fac5610>]}
[0m05:30:22.648763 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.91s]
[0m05:30:22.650063 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:30:22.652041 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:30:22.652608 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:30:22.653149 [debug] [MainThread]: On list__clean: Close
[0m05:30:22.653639 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:30:22.654120 [debug] [MainThread]: On list__mart: Close
[0m05:30:22.654632 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:30:22.655113 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:30:22.655586 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:30:22.656069 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:30:22.656541 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:30:22.657031 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:30:22.657627 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:30:22.658577 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:30:22.659774 [info ] [MainThread]: 
[0m05:30:22.660437 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.82 seconds (4.82s).
[0m05:30:22.664133 [debug] [MainThread]: Command end result
[0m05:30:22.771782 [info ] [MainThread]: 
[0m05:30:22.772644 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:30:22.773239 [info ] [MainThread]: 
[0m05:30:22.823842 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:30:22.825247 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.58007, "process_in_blocks": "0", "process_kernel_time": 0.658936, "process_mem_max_rss": "114864", "process_out_blocks": "9744", "process_user_time": 6.459555}
[0m05:30:22.825986 [debug] [MainThread]: Command `dbt build` succeeded at 05:30:22.825778 after 7.58 seconds
[0m05:30:22.826610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef5448ce20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef507dca90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70ef5075b400>]}
[0m05:30:22.827202 [debug] [MainThread]: Flushing usage events
[0m05:31:15.798337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737078f68310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737075bbfaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737075bbf9a0>]}


============================== 05:31:15.807587 | b3bea388-cbad-44b7-8ca2-54dddf922282 ==============================
[0m05:31:15.807587 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:31:15.808629 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'indirect_selection': 'eager', 'version_check': 'True', 'empty': 'False', 'cache_selected_only': 'False', 'printer_width': '80', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_format': 'default', 'no_print': 'None', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'log_path': '/workdir/transforms/04_btc/logs', 'introspect': 'True', 'debug': 'False', 'partial_parse': 'True', 'quiet': 'False', 'warn_error': 'None', 'log_cache_events': 'False', 'target_path': 'None'}
[0m05:31:16.392780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b3bea388-cbad-44b7-8ca2-54dddf922282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7370784f33a0>]}
[0m05:31:16.534902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b3bea388-cbad-44b7-8ca2-54dddf922282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737075c203a0>]}
[0m05:31:16.536214 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:31:17.000725 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:31:17.504668 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:31:17.505307 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:31:17.703771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b3bea388-cbad-44b7-8ca2-54dddf922282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737075313ee0>]}
[0m05:31:18.190506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b3bea388-cbad-44b7-8ca2-54dddf922282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7370752fdc70>]}
[0m05:31:18.191450 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:31:18.194765 [info ] [MainThread]: 
[0m05:31:18.195806 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:31:18.209281 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:31:18.210670 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:31:18.287903 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:31:18.293637 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:31:18.761246 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:31:18.765019 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:31:18.768841 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:31:18.790055 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:31:18.811447 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:31:18.812431 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:31:18.823587 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:31:18.828059 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:31:18.834318 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:31:18.835493 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:31:18.895683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3bea388-cbad-44b7-8ca2-54dddf922282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737075c03e80>]}
[0m05:31:18.896668 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:31:18.897393 [info ] [MainThread]: 
[0m05:31:18.910210 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:31:18.911386 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:31:18.912483 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:31:18.913251 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:31:18.930349 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:31:18.931612 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:31:19.104326 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:31:19.160400 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:31:19.161820 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:31:19.172557 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:31:19.194323 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:31:19.197810 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:31:19.199957 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:31:19.203028 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:31:19.323447 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:31:19.326908 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:31:19.328762 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:31:19.331655 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:31:19.426978 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:31:19.430441 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:31:19.436526 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3bea388-cbad-44b7-8ca2-54dddf922282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73707508b430>]}
[0m05:31:19.437661 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m05:31:19.488529 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:31:19.491182 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:31:19.493042 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:31:19.494832 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:31:19.496892 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:31:19.498145 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:31:19.499817 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:31:19.501515 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:31:19.503670 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:31:19.505420 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:31:19.507602 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:31:19.509234 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:31:19.531592 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:31:19.688748 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:31:19.690390 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:31:19.700028 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:31:19.702685 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:31:19.704653 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:31:19.717964 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:31:20.028654 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:31:20.031570 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:31:20.033076 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:31:20.088624 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:31:20.036088 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:31:20.094387 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:31:20.262478 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:31:20.292420 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:31:20.307713 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.81s]
[0m05:31:20.313208 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:31:20.316052 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:31:20.318963 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:31:20.333955 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:31:20.336573 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:31:20.342414 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.84s]
[0m05:31:20.396520 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:31:20.394150 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m05:31:20.400995 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:31:20.403875 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:31:20.404950 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:31:20.406769 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:31:20.408297 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:31:20.410377 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:31:20.412540 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:31:20.414289 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:31:20.415317 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:31:20.416415 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:31:20.417831 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:31:20.418843 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:31:20.419974 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:31:20.534154 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:31:20.605701 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:31:20.607696 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:31:20.609938 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:31:20.627595 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:31:20.693801 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:31:20.735604 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:31:20.836133 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:31:20.999715 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:31:21.115177 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:31:21.217102 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:31:21.296843 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:31:21.405360 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:31:21.515831 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282` 
  ...
[0m05:31:21.520222 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:31:21.597198 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282` 
  ...
[0m05:31:21.600061 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:31:21.611313 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:31:21.619340 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:31:21.623432 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:31:21.727403 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:31:21.823920 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:31:21.931887 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:31:22.007995 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3bea388-cbad-44b7-8ca2-54dddf922282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73707467bbb0>]}
[0m05:31:22.015590 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.59s]
[0m05:31:22.090694 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:31:22.109149 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:31:22.110689 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:31:22.146797 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:31:22.163325 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:31:22.219636 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:31:22.221225 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:31:22.230240 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:31:22.233082 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:31:22.305157 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:31:22.307083 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:31:22.310026 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:31:22.312156 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:31:22.343066 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:31:22.345112 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:31:22.347887 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282`)
      
    ...
[0m05:31:22.351941 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282`)
      
    ...
[0m05:31:22.388693 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:31:22.398604 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:31:22.404956 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:31:22.415064 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:31:22.426364 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:31:22.430002 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:31:22.435886 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282` 
    ...
[0m05:31:22.490468 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282` 
    ...
[0m05:31:22.503075 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:31:22.505724 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:31:22.522021 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282` 
  ...
[0m05:31:22.537914 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b3bea388_cbad_44b7_8ca2_54dddf922282` 
  ...
[0m05:31:22.589789 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:31:22.603804 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:31:22.606030 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:31:22.618491 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:31:22.624680 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:31:22.631566 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3bea388-cbad-44b7-8ca2-54dddf922282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7370746bd6d0>]}
[0m05:31:22.634316 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:31:22.688218 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.22s]
[0m05:31:22.695412 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3bea388-cbad-44b7-8ca2-54dddf922282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7370746bf8e0>]}
[0m05:31:22.698673 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:31:22.701512 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.28s]
[0m05:31:22.704910 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:31:22.708764 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:31:22.710000 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:31:22.711176 [debug] [MainThread]: On list__clean: Close
[0m05:31:22.712287 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:31:22.713364 [debug] [MainThread]: On list__mart: Close
[0m05:31:22.714400 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:31:22.715497 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:31:22.716563 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:31:22.717629 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:31:22.718656 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:31:22.719711 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:31:22.720749 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m05:31:22.721817 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m05:31:22.724038 [info ] [MainThread]: 
[0m05:31:22.725400 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.53 seconds (4.53s).
[0m05:31:22.733412 [debug] [MainThread]: Command end result
[0m05:31:22.914089 [info ] [MainThread]: 
[0m05:31:22.915682 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:31:22.916798 [info ] [MainThread]: 
[0m05:31:22.918221 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:31:22.920998 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.315117, "process_in_blocks": "0", "process_kernel_time": 0.660253, "process_mem_max_rss": "114416", "process_out_blocks": "9744", "process_user_time": 6.417301}
[0m05:31:22.922251 [debug] [MainThread]: Command `dbt build` succeeded at 05:31:22.921923 after 7.32 seconds
[0m05:31:22.923271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737078f68310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737076ede850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x737076edbd00>]}
[0m05:31:22.924226 [debug] [MainThread]: Flushing usage events
[0m05:32:16.820965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559de1bd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559dae18b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559dae18a30>]}


============================== 05:32:16.880824 | 8e1ff60d-9bc6-416f-ada1-d58ca9190a7e ==============================
[0m05:32:16.880824 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:32:16.881891 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'log_cache_events': 'False', 'debug': 'False', 'printer_width': '80', 'indirect_selection': 'eager', 'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir . --target local', 'version_check': 'True', 'static_parser': 'True', 'log_format': 'default', 'no_print': 'None', 'partial_parse': 'True', 'fail_fast': 'False', 'target_path': 'None', 'use_colors': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'introspect': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'warn_error': 'None', 'quiet': 'False'}
[0m05:32:17.414201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8e1ff60d-9bc6-416f-ada1-d58ca9190a7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559dad04af0>]}
[0m05:32:17.607357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8e1ff60d-9bc6-416f-ada1-d58ca9190a7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559daeb13d0>]}
[0m05:32:17.608704 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:32:18.025540 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:32:18.584492 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:32:18.585155 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:32:18.790627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8e1ff60d-9bc6-416f-ada1-d58ca9190a7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559da581e80>]}
[0m05:32:19.235308 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8e1ff60d-9bc6-416f-ada1-d58ca9190a7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559da56b1f0>]}
[0m05:32:19.236243 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:32:19.239627 [info ] [MainThread]: 
[0m05:32:19.278168 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:32:19.290774 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:32:19.292642 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:32:19.378465 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:32:19.384323 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:32:20.079078 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:32:20.086531 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:32:20.088881 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:32:20.098647 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:32:20.196309 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:32:20.198026 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:32:20.225291 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:32:20.281155 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:32:20.289493 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:32:20.291752 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:32:20.315973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8e1ff60d-9bc6-416f-ada1-d58ca9190a7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559dad7bcd0>]}
[0m05:32:20.318005 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:32:20.319399 [info ] [MainThread]: 
[0m05:32:20.395362 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:32:20.396514 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:32:20.397605 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:32:20.398360 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:32:20.414669 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:32:20.415848 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:32:20.603227 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:32:20.671155 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:32:20.672524 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:32:20.689571 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:32:20.812047 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:32:20.815838 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:32:20.817976 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:32:20.821070 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:32:20.827001 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:32:20.830080 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:32:20.880101 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:32:20.883442 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:32:20.982888 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:32:20.986427 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:32:20.992414 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e1ff60d-9bc6-416f-ada1-d58ca9190a7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559dd6c1a60>]}
[0m05:32:20.993588 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m05:32:20.995073 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:32:20.996786 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:32:20.997869 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:32:20.999089 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:32:21.000294 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:32:21.001997 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:32:21.003687 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:32:21.005099 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:32:21.007416 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:32:21.008860 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:32:21.010369 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:32:21.012236 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:32:21.078354 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:32:21.096527 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:32:21.111308 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:32:21.122037 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:32:21.125412 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:32:21.127125 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:32:21.205843 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:32:21.481377 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:32:21.497595 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:32:21.492167 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:32:21.499862 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:32:21.500630 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:32:21.502124 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:32:21.645956 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:32:21.653683 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:32:21.662817 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.65s]
[0m05:32:21.666378 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:32:21.668000 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:32:21.681357 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:32:21.690367 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:32:21.695115 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.69s]
[0m05:32:21.696869 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:32:21.698630 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:32:21.702205 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.70s]
[0m05:32:21.704067 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:32:21.705617 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:32:21.706360 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:32:21.708167 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:32:21.707423 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:32:21.709363 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:32:21.710442 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:32:21.711349 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:32:21.712036 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:32:21.712758 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:32:21.713504 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:32:21.714276 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:32:21.715057 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:32:21.782811 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:32:21.790971 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:32:21.798235 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:32:21.799790 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:32:21.800485 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:32:21.801377 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:32:21.993540 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:32:22.088636 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:32:22.183190 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e` 
  ...
[0m05:32:22.185065 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:32:22.202763 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e` 
  ...
[0m05:32:22.210156 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:32:22.214337 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:32:22.312558 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:32:22.320124 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m05:32:22.381898 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:32:22.496745 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:32:22.500725 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:32:22.507375 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:32:22.512285 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:32:22.520385 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:32:22.579643 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:32:22.582245 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:32:22.525442 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:32:22.683156 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:32:22.687104 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:32:22.693144 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:32:22.705062 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:32:22.712979 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:32:22.783794 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:32:22.782148 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:32:22.792470 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:32:22.798827 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:32:22.802393 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:32:22.804691 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:32:22.812809 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e1ff60d-9bc6-416f-ada1-d58ca9190a7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559da0b7be0>]}
[0m05:32:22.818785 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.10s]
[0m05:32:22.879773 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:32:22.824339 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:32:22.883510 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:32:22.887574 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e`)
      
    ...
[0m05:32:22.892353 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e`)
      
    ...
[0m05:32:22.923189 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:32:22.928183 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:32:22.930137 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:32:22.940988 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:32:22.945963 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:32:22.979827 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:32:22.951945 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e` 
    ...
[0m05:32:22.986527 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e` 
    ...
[0m05:32:22.998733 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:32:23.006595 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:32:23.014617 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e` 
  ...
[0m05:32:23.027384 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8e1ff60d_9bc6_416f_ada1_d58ca9190a7e` 
  ...
[0m05:32:23.078288 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:32:23.092393 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:32:23.094002 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:32:23.107507 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:32:23.113706 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:32:23.116349 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:32:23.122880 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e1ff60d-9bc6-416f-ada1-d58ca9190a7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559dadd63d0>]}
[0m05:32:23.180491 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8e1ff60d-9bc6-416f-ada1-d58ca9190a7e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559d918ba60>]}
[0m05:32:23.182103 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.41s]
[0m05:32:23.183693 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.47s]
[0m05:32:23.185739 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:32:23.187438 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:32:23.190146 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:32:23.190825 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:32:23.191458 [debug] [MainThread]: On list__mart: Close
[0m05:32:23.192068 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:32:23.192682 [debug] [MainThread]: On list__clean: Close
[0m05:32:23.193258 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:32:23.193878 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:32:23.194468 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:32:23.195085 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:32:23.195712 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:32:23.196314 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:32:23.196957 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:32:23.197568 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:32:23.199025 [info ] [MainThread]: 
[0m05:32:23.199877 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.96 seconds (3.96s).
[0m05:32:23.207063 [debug] [MainThread]: Command end result
[0m05:32:23.409525 [info ] [MainThread]: 
[0m05:32:23.410415 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:32:23.411004 [info ] [MainThread]: 
[0m05:32:23.411646 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:32:23.412909 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.7862315, "process_in_blocks": "0", "process_kernel_time": 0.705182, "process_mem_max_rss": "114592", "process_out_blocks": "9744", "process_user_time": 6.114893}
[0m05:32:23.413629 [debug] [MainThread]: Command `dbt build` succeeded at 05:32:23.413426 after 6.79 seconds
[0m05:32:23.414229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559de1bd310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559d90a8a60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7559dc0da4f0>]}
[0m05:32:23.414811 [debug] [MainThread]: Flushing usage events
[0m05:33:16.977310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820bdef9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820bab5ab50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820bab5aa00>]}


============================== 05:33:16.986688 | 7059f389-c53f-427d-87c2-3712d3f24521 ==============================
[0m05:33:16.986688 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:33:16.987727 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'quiet': 'False', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'debug': 'False', 'no_print': 'None', 'use_colors': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_path': '/workdir/transforms/04_btc/logs', 'indirect_selection': 'eager', 'empty': 'False'}
[0m05:33:17.574846 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7059f389-c53f-427d-87c2-3712d3f24521', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820baa52490>]}
[0m05:33:17.773998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7059f389-c53f-427d-87c2-3712d3f24521', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820bb62d3a0>]}
[0m05:33:17.775346 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:33:18.192950 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:33:18.747985 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:33:18.748725 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:33:18.948347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7059f389-c53f-427d-87c2-3712d3f24521', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820ba2bceb0>]}
[0m05:33:19.400330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7059f389-c53f-427d-87c2-3712d3f24521', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820ba1b14c0>]}
[0m05:33:19.401217 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:33:19.404444 [info ] [MainThread]: 
[0m05:33:19.405468 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:33:19.452424 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:33:19.454430 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:33:19.553906 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:33:19.555032 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:33:20.148596 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:33:20.157743 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:33:20.160016 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:33:20.171077 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:33:20.271581 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:33:20.273133 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:33:20.289029 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:33:20.295679 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:33:20.356109 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:33:20.371194 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:33:20.382098 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7059f389-c53f-427d-87c2-3712d3f24521', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820b9da9520>]}
[0m05:33:20.384058 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:33:20.385419 [info ] [MainThread]: 
[0m05:33:20.460718 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:33:20.461866 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:33:20.462980 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:33:20.463725 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:33:20.480218 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:33:20.481372 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:33:20.657698 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:33:20.725072 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:33:20.726513 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:33:20.739063 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:33:20.870596 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:33:20.874504 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:33:20.876614 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:33:20.879631 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:33:20.885197 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:33:20.888053 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:33:20.889890 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:33:20.892775 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:33:20.985273 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:33:20.988808 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:33:20.994680 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7059f389-c53f-427d-87c2-3712d3f24521', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820b9561dc0>]}
[0m05:33:20.995835 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.53s]
[0m05:33:20.997191 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:33:20.999049 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:33:21.048598 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:33:21.050843 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:33:21.052783 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:33:21.054701 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:33:21.057092 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:33:21.058933 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:33:21.061139 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:33:21.062831 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:33:21.064805 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:33:21.066437 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:33:21.078727 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:33:21.286321 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:33:21.289364 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:33:21.291216 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:33:21.293783 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:33:21.296339 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:33:21.375374 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:33:21.590485 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:33:21.659256 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:33:21.662163 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:33:21.664966 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:33:21.667920 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:33:21.673713 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:33:21.926253 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:33:21.970820 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:33:21.979092 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:33:21.981990 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:33:21.991941 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.93s]
[0m05:33:22.049219 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:33:22.052025 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:33:22.057988 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.99s]
[0m05:33:22.061024 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:33:22.064235 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:33:22.069980 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.01s]
[0m05:33:22.073437 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:33:22.076335 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:33:22.077686 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:33:22.079750 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:33:22.081872 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:33:22.083950 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:33:22.086194 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:33:22.088036 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:33:22.089699 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:33:22.091307 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:33:22.092958 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:33:22.094647 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:33:22.148346 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:33:22.252096 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:33:22.288321 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:33:22.293244 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:33:22.295493 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:33:22.348229 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:33:22.366322 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:33:22.373909 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:33:22.453450 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:33:22.554176 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m05:33:22.668752 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:33:22.788395 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:33:22.855912 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:33:22.891455 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:33:22.984697 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:33:23.160326 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521` 
  ...
[0m05:33:23.162611 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:33:23.165888 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521` 
  ...
[0m05:33:23.172213 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:33:23.177211 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:33:23.182299 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:33:23.192498 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:33:23.363722 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:33:23.474107 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:33:23.559443 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7059f389-c53f-427d-87c2-3712d3f24521', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820b8e95730>]}
[0m05:33:23.565806 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.47s]
[0m05:33:23.574308 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:33:23.577399 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:33:23.578974 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:33:23.611982 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:33:23.648886 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:33:23.679106 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:33:23.684075 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:33:23.693966 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:33:23.748003 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:33:23.761453 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:33:23.767007 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:33:23.769980 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:33:23.774109 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:33:23.803066 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:33:23.807485 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521`)
      
    ...
[0m05:33:23.812302 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:33:23.818719 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521`)
      
    ...
[0m05:33:23.850471 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:33:23.861785 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:33:23.871197 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:33:23.876411 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521` 
    ...
[0m05:33:23.879195 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:33:23.890996 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:33:23.893451 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:33:23.954161 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:33:23.957956 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521` 
  ...
[0m05:33:23.963795 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521` 
    ...
[0m05:33:23.971060 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:33:23.983925 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:33:23.986602 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:33:24.049047 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:33:24.054639 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_7059f389_c53f_427d_87c2_3712d3f24521` 
  ...
[0m05:33:24.061512 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7059f389-c53f-427d-87c2-3712d3f24521', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820b9e8d2e0>]}
[0m05:33:24.066021 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.97s]
[0m05:33:24.069036 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:33:24.071852 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:33:24.084904 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:33:24.090850 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:33:24.148406 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7059f389-c53f-427d-87c2-3712d3f24521', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820b9ea8fa0>]}
[0m05:33:24.151135 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.06s]
[0m05:33:24.153860 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:33:24.157835 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:33:24.159137 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:33:24.160476 [debug] [MainThread]: On list__mart: Close
[0m05:33:24.161613 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:33:24.162797 [debug] [MainThread]: On list__clean: Close
[0m05:33:24.163841 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:33:24.165018 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:33:24.166064 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:33:24.167174 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:33:24.168220 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:33:24.169343 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:33:24.170384 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:33:24.171484 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:33:24.173754 [info ] [MainThread]: 
[0m05:33:24.175141 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.77 seconds (4.77s).
[0m05:33:24.183088 [debug] [MainThread]: Command end result
[0m05:33:24.459119 [info ] [MainThread]: 
[0m05:33:24.460744 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:33:24.462019 [info ] [MainThread]: 
[0m05:33:24.463335 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:33:24.465932 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.679432, "process_in_blocks": "0", "process_kernel_time": 0.737328, "process_mem_max_rss": "114832", "process_out_blocks": "9744", "process_user_time": 6.804965}
[0m05:33:24.467440 [debug] [MainThread]: Command `dbt build` succeeded at 05:33:24.467034 after 7.68 seconds
[0m05:33:24.469020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820bdef9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820bac1adc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7820b8bcc940>]}
[0m05:33:24.470301 [debug] [MainThread]: Flushing usage events
[0m05:34:16.597915 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc66dc6b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc66a8ceac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc66a8ce970>]}


============================== 05:34:16.607181 | 8b49593b-284c-4d54-8ee0-ee74180e69c6 ==============================
[0m05:34:16.607181 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:34:16.608298 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'log_path': '/workdir/transforms/04_btc/logs', 'target_path': 'None', 'log_format': 'default', 'write_json': 'True', 'quiet': 'False', 'cache_selected_only': 'False', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'printer_width': '80', 'debug': 'False', 'use_experimental_parser': 'False', 'empty': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'use_colors': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_cache_events': 'False', 'no_print': 'None', 'partial_parse': 'True', 'introspect': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True'}
[0m05:34:17.192913 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8b49593b-284c-4d54-8ee0-ee74180e69c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc66a7c65e0>]}
[0m05:34:17.390910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8b49593b-284c-4d54-8ee0-ee74180e69c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc66e07ef10>]}
[0m05:34:17.392198 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:34:17.805866 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:34:18.309300 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:34:18.309960 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:34:18.509462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8b49593b-284c-4d54-8ee0-ee74180e69c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc66a033f10>]}
[0m05:34:18.997426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8b49593b-284c-4d54-8ee0-ee74180e69c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc66a0711f0>]}
[0m05:34:18.998300 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:34:19.001686 [info ] [MainThread]: 
[0m05:34:19.002773 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:34:19.014665 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:34:19.021054 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:34:19.170690 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:34:19.172059 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:34:19.828902 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:34:19.833720 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:34:19.834957 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:34:19.838978 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:34:19.892365 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:34:19.903943 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:34:19.908906 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:34:19.964351 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:34:19.975172 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:19.977988 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:20.001682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8b49593b-284c-4d54-8ee0-ee74180e69c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc66a72ef10>]}
[0m05:34:20.003689 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:34:20.005184 [info ] [MainThread]: 
[0m05:34:20.075377 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:34:20.076541 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:34:20.077632 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:34:20.078387 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:34:20.094914 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:34:20.096028 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:34:20.282548 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:34:20.349163 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:34:20.350915 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:34:20.363976 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:20.493780 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:34:20.497322 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:34:20.499384 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:34:20.502621 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:34:20.508304 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:34:20.511133 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:34:20.513076 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:34:20.564384 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:34:20.611046 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:34:20.662721 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:34:20.668992 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b49593b-284c-4d54-8ee0-ee74180e69c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc6693a1820>]}
[0m05:34:20.670214 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m05:34:20.671650 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:34:20.673552 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:34:20.674636 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:34:20.675484 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:34:20.676437 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:34:20.677694 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:34:20.678646 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:34:20.679757 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:34:20.680724 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:34:20.681725 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:34:20.682520 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:34:20.683499 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:34:20.684551 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:34:20.779915 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:34:20.784901 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:34:20.793441 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:34:20.794912 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:34:20.801034 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:34:20.882387 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:34:20.893971 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:34:20.896188 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:34:20.901671 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:34:20.903427 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:34:20.904172 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:34:20.905163 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:34:21.070270 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:34:21.077264 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:21.083463 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.40s]
[0m05:34:21.087040 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:34:21.096687 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:34:21.098110 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:34:21.106059 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:21.107208 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:21.110190 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.43s]
[0m05:34:21.112971 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.43s]
[0m05:34:21.114308 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:34:21.115573 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:34:21.117253 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:34:21.118019 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:34:21.118828 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:34:21.161736 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:34:21.162954 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:34:21.164047 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:34:21.164939 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:34:21.165694 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:34:21.166461 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:34:21.167214 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:34:21.168023 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:34:21.168831 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:34:21.189428 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:34:21.198861 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:34:21.206196 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:34:21.207654 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:34:21.261538 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:34:21.267603 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:34:21.366878 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:34:21.467305 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:34:21.579955 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:34:21.701745 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:34:21.785515 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:21.800298 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:34:21.892090 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6` 
  ...
[0m05:34:21.905689 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:34:21.994519 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:34:21.997217 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:34:21.981562 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6` 
  ...
[0m05:34:22.064846 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:34:22.069240 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:34:22.077065 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:22.163409 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:34:22.270775 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:34:22.363033 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:34:22.367803 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:34:22.372611 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:34:22.377721 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b49593b-284c-4d54-8ee0-ee74180e69c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc668c613a0>]}
[0m05:34:22.382499 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.21s]
[0m05:34:22.385125 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:34:22.406938 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:34:22.417612 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:34:22.476245 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:34:22.486394 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:34:22.496170 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:22.504064 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:22.561974 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:34:22.567765 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:34:22.570715 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:34:22.574514 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:34:22.605888 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:34:22.608457 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:34:22.612894 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6`)
      
    ...
[0m05:34:22.617631 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6`)
      
    ...
[0m05:34:22.651036 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:34:22.667840 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:34:22.665970 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:34:22.678660 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:34:22.687555 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:22.696607 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:22.693240 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6` 
    ...
[0m05:34:22.704255 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6` 
    ...
[0m05:34:22.762899 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:34:22.715623 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:22.781290 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6` 
  ...
[0m05:34:22.787876 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8b49593b_284c_4d54_8ee0_ee74180e69c6` 
  ...
[0m05:34:22.794204 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:34:22.808093 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:34:22.861435 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:34:22.876168 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:22.877525 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:34:22.883983 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b49593b-284c-4d54-8ee0-ee74180e69c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc669c12d90>]}
[0m05:34:22.888179 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.72s]
[0m05:34:22.891036 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:34:22.893691 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:34:22.900517 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8b49593b-284c-4d54-8ee0-ee74180e69c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc668c619a0>]}
[0m05:34:22.903249 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.73s]
[0m05:34:22.906122 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:34:22.910195 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:34:22.962212 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:34:22.963443 [debug] [MainThread]: On list__clean: Close
[0m05:34:22.964583 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:34:22.965729 [debug] [MainThread]: On list__mart: Close
[0m05:34:22.966831 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:34:22.967979 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:34:22.969115 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:34:22.970265 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:34:22.971368 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:34:22.972521 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:34:22.973640 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:34:22.974783 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:34:22.977132 [info ] [MainThread]: 
[0m05:34:22.978659 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.97 seconds (3.97s).
[0m05:34:22.986762 [debug] [MainThread]: Command end result
[0m05:34:23.198397 [info ] [MainThread]: 
[0m05:34:23.199213 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:34:23.199852 [info ] [MainThread]: 
[0m05:34:23.200481 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:34:23.201745 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.795641, "process_in_blocks": "0", "process_kernel_time": 0.705803, "process_mem_max_rss": "114640", "process_out_blocks": "9744", "process_user_time": 6.113667}
[0m05:34:23.202465 [debug] [MainThread]: Command `dbt build` succeeded at 05:34:23.202276 after 6.80 seconds
[0m05:34:23.203078 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc66dc6b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc668b559d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7dc66bb06af0>]}
[0m05:34:23.203666 [debug] [MainThread]: Flushing usage events
[0m05:35:15.945488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab6ce1cdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab69a81be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab69a81a90>]}


============================== 05:35:15.954889 | 0e3eab44-05fa-4818-9fb5-d05dd599b8c9 ==============================
[0m05:35:15.954889 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:35:15.955985 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'debug': 'False', 'profiles_dir': '.', 'static_parser': 'True', 'introspect': 'True', 'version_check': 'True', 'target_path': 'None', 'printer_width': '80', 'quiet': 'False', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'fail_fast': 'False', 'warn_error': 'None', 'no_print': 'None', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default', 'use_colors': 'True'}
[0m05:35:16.538575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0e3eab44-05fa-4818-9fb5-d05dd599b8c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab69a712b0>]}
[0m05:35:16.734760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0e3eab44-05fa-4818-9fb5-d05dd599b8c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab69a47ca0>]}
[0m05:35:16.736260 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:35:17.167513 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:35:17.724824 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:35:17.725487 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:35:17.928599 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0e3eab44-05fa-4818-9fb5-d05dd599b8c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab691e6e20>]}
[0m05:35:18.368483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0e3eab44-05fa-4818-9fb5-d05dd599b8c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab691fc970>]}
[0m05:35:18.369349 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:35:18.372476 [info ] [MainThread]: 
[0m05:35:18.373499 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:35:18.422020 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:35:18.423756 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:35:18.469218 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:35:18.527486 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:35:19.327310 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:35:19.335316 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:35:19.339907 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:19.344797 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:19.446963 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:35:19.448603 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:35:19.469597 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:35:19.527797 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:35:19.539602 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:19.541918 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:19.565743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0e3eab44-05fa-4818-9fb5-d05dd599b8c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab69144250>]}
[0m05:35:19.567597 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:35:19.568993 [info ] [MainThread]: 
[0m05:35:19.642758 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:35:19.643892 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:35:19.644944 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:35:19.645700 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:35:19.662355 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:35:19.663516 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:35:19.856491 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:35:19.968581 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:35:19.970074 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:35:19.982163 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:20.123007 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:35:20.127332 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:35:20.129334 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:35:20.132215 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:35:20.137786 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:35:20.140635 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:35:20.142453 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:35:20.145289 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:35:20.238274 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:35:20.242062 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:35:20.250079 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e3eab44-05fa-4818-9fb5-d05dd599b8c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab6c333be0>]}
[0m05:35:20.251301 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m05:35:20.252706 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:35:20.254365 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:35:20.255188 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:35:20.256083 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:35:20.257042 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:35:20.258079 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:35:20.259084 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:35:20.260067 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:35:20.260970 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:35:20.261897 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:35:20.262864 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:35:20.333467 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:35:20.345127 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:35:20.346134 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:35:20.354886 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:35:20.366459 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:35:20.366051 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:35:20.422052 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:35:20.453855 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:35:20.458309 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:35:20.459929 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:35:20.462003 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:35:20.522613 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:35:20.525064 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:35:20.529279 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:35:20.759417 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:35:20.776136 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:20.791446 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.53s]
[0m05:35:20.827970 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:35:20.833028 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:35:20.843317 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:35:20.852731 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:35:20.858591 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.60s]
[0m05:35:20.860619 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:20.862400 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:35:20.866231 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.61s]
[0m05:35:20.868289 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:35:20.870207 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:35:20.921982 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:35:20.923758 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:35:20.871302 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:35:20.926358 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:35:20.928485 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:35:20.930194 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:35:20.931765 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:35:20.933256 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:35:20.934915 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:35:20.936808 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:35:20.938512 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:35:21.065992 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:35:21.135472 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:35:21.140498 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:35:21.142448 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:35:21.156302 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:35:21.158264 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:35:21.159887 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:35:21.232875 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:35:21.328041 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:35:21.353411 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:35:21.428331 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:35:21.448085 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:35:21.533600 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:35:21.638458 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:35:21.668814 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:21.766522 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:35:21.862551 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:35:22.033184 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:35:22.128335 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9` 
  ...
[0m05:35:22.131359 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:35:22.159484 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e3eab44-05fa-4818-9fb5-d05dd599b8c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab68e9b4c0>]}
[0m05:35:22.155424 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9` 
  ...
[0m05:35:22.163361 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:35:22.165792 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.23s]
[0m05:35:22.223269 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:35:22.237878 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:35:22.564520 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:35:22.623602 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:35:22.656521 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:35:22.671203 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:35:22.721603 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:35:22.729705 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:35:22.740455 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:22.742459 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:22.769767 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:35:22.767702 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:35:22.822304 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:35:22.824323 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:35:22.856800 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:35:22.858873 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:35:22.862880 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9`)
      
    ...
[0m05:35:22.867052 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9`)
      
    ...
[0m05:35:22.899258 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:35:22.901127 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:35:22.908494 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:35:22.913730 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:35:22.919156 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:35:22.922611 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9` 
    ...
[0m05:35:22.923972 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:22.927497 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9` 
    ...
[0m05:35:22.929832 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:22.936242 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9` 
  ...
[0m05:35:22.937776 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:22.946438 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_0e3eab44_05fa_4818_9fb5_d05dd599b8c9` 
  ...
[0m05:35:22.947885 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:22.954599 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:35:22.955806 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:22.962502 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:35:22.963727 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:35:22.967911 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e3eab44-05fa-4818-9fb5-d05dd599b8c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab68e9b610>]}
[0m05:35:22.969559 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:35:22.971022 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.04s]
[0m05:35:23.025880 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0e3eab44-05fa-4818-9fb5-d05dd599b8c9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab698ef220>]}
[0m05:35:23.028681 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:35:23.030977 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.10s]
[0m05:35:23.033708 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:35:23.037411 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:35:23.038670 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:35:23.039923 [debug] [MainThread]: On list__mart: Close
[0m05:35:23.041055 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:35:23.042220 [debug] [MainThread]: On list__clean: Close
[0m05:35:23.043320 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:35:23.044466 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:35:23.045517 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m05:35:23.046659 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m05:35:23.047729 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:35:23.048965 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:35:23.050046 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:35:23.051247 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:35:23.053519 [info ] [MainThread]: 
[0m05:35:23.054900 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.68 seconds (4.68s).
[0m05:35:23.063014 [debug] [MainThread]: Command end result
[0m05:35:23.332084 [info ] [MainThread]: 
[0m05:35:23.333749 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:35:23.335034 [info ] [MainThread]: 
[0m05:35:23.336439 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:35:23.339078 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.58429, "process_in_blocks": "0", "process_kernel_time": 0.679654, "process_mem_max_rss": "114640", "process_out_blocks": "9744", "process_user_time": 6.505829}
[0m05:35:23.340649 [debug] [MainThread]: Command `dbt build` succeeded at 05:35:23.340229 after 7.59 seconds
[0m05:35:23.341925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab6ce1cdc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab69095070>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76ab6ad37b80>]}
[0m05:35:23.343170 [debug] [MainThread]: Flushing usage events
[0m05:36:15.784692 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c757e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c41e5b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c41e5a00>]}


============================== 05:36:15.846452 | 4af15fde-23ee-41c3-bf18-28a6db477e86 ==============================
[0m05:36:15.846452 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:36:15.847560 [debug] [MainThread]: running dbt with arguments {'log_path': '/workdir/transforms/04_btc/logs', 'fail_fast': 'False', 'log_cache_events': 'False', 'empty': 'False', 'log_format': 'default', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'profiles_dir': '.', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'no_print': 'None', 'write_json': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'cache_selected_only': 'False', 'printer_width': '80', 'introspect': 'True', 'debug': 'False', 'version_check': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'target_path': 'None'}
[0m05:36:16.458123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4af15fde-23ee-41c3-bf18-28a6db477e86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c41bd580>]}
[0m05:36:16.650772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4af15fde-23ee-41c3-bf18-28a6db477e86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c4648b20>]}
[0m05:36:16.652042 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:36:17.065251 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:36:17.571137 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:36:17.571821 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:36:17.772021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4af15fde-23ee-41c3-bf18-28a6db477e86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c394aeb0>]}
[0m05:36:18.251867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4af15fde-23ee-41c3-bf18-28a6db477e86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c383f4c0>]}
[0m05:36:18.252731 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:36:18.255893 [info ] [MainThread]: 
[0m05:36:18.256943 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:36:18.268837 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:36:18.270650 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:36:18.366764 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:36:18.375343 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:36:19.047620 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:36:19.054565 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:19.076328 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:36:19.085677 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:19.171951 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:36:19.179063 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:36:19.262830 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:36:19.265031 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:36:19.278338 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:19.280920 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:19.352127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4af15fde-23ee-41c3-bf18-28a6db477e86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c421e1c0>]}
[0m05:36:19.354002 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:36:19.355331 [info ] [MainThread]: 
[0m05:36:19.382202 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:36:19.384033 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:36:19.435123 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:36:19.436408 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:36:19.459921 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:36:19.461394 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:36:19.657260 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:36:19.725860 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:36:19.727349 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:36:19.743911 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:36:19.865133 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:36:19.868348 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:36:19.870464 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:36:19.873247 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:36:19.879908 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:36:19.882875 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:36:19.884881 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:36:19.936699 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:36:19.984225 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:36:20.037176 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:36:20.043473 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4af15fde-23ee-41c3-bf18-28a6db477e86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c2cc4c40>]}
[0m05:36:20.044754 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m05:36:20.046101 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:36:20.047721 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:36:20.048527 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:36:20.049425 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:36:20.050233 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:36:20.051123 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:36:20.052042 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:36:20.053136 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:36:20.054083 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:36:20.055024 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:36:20.055877 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:36:20.056662 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:36:20.057411 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:36:20.137800 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:36:20.139870 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:36:20.148013 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:36:20.149625 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:36:20.150379 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:36:20.239653 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:36:20.256505 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:36:20.263940 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:36:20.261988 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:36:20.265890 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:36:20.267149 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:36:20.269414 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:36:20.436908 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:36:20.445575 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:20.447212 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:36:20.454819 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.40s]
[0m05:36:20.457488 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:36:20.458927 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:36:20.461927 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:20.465122 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.41s]
[0m05:36:20.466749 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:20.467986 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:36:20.471095 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.42s]
[0m05:36:20.473067 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:36:20.474495 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:36:20.475427 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:36:20.476375 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:36:20.477482 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:36:20.478769 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:36:20.479726 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:36:20.480975 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:36:20.482126 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:36:20.482927 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:36:20.483793 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:36:20.484811 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:36:20.552570 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:36:20.553574 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:36:20.562191 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:36:20.573773 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:36:20.574391 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:36:20.645514 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:36:20.657197 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:36:20.773184 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:36:20.861601 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:36:20.975552 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:36:21.071291 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:36:21.169066 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:36:21.177301 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:36:21.265080 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:36:21.282889 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86` 
  ...
[0m05:36:21.353015 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:36:21.438107 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86` 
  ...
[0m05:36:21.440888 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:36:21.445380 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:21.453376 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:21.480873 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:36:21.659448 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:36:21.756155 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:36:21.775505 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:36:21.781791 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:36:21.835788 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:36:21.845184 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4af15fde-23ee-41c3-bf18-28a6db477e86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c34caa60>]}
[0m05:36:21.847877 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.36s]
[0m05:36:21.850939 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:36:21.867262 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:36:21.885622 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:36:21.967953 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:36:21.973423 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:36:21.984114 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:22.039759 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:22.053305 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:36:22.060947 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:36:22.063520 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:36:22.067406 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:36:22.098456 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:36:22.102848 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86`)
      
    ...
[0m05:36:22.136018 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:36:22.108008 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:36:22.149683 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:36:22.153798 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86`)
      
    ...
[0m05:36:22.163512 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:22.169821 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86` 
    ...
[0m05:36:22.180273 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:22.182871 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:36:22.239558 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86` 
  ...
[0m05:36:22.249716 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:36:22.256459 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:36:22.271837 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:36:22.276291 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:36:22.284495 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:22.282432 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86` 
    ...
[0m05:36:22.341921 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4af15fde-23ee-41c3-bf18-28a6db477e86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c252dbe0>]}
[0m05:36:22.346428 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.86s]
[0m05:36:22.350186 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:36:22.352905 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:36:22.365411 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_4af15fde_23ee_41c3_bf18_28a6db477e86` 
  ...
[0m05:36:22.371304 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:36:22.434436 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:36:22.440110 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:36:22.446582 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4af15fde-23ee-41c3-bf18-28a6db477e86', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c2cc4430>]}
[0m05:36:22.448878 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.96s]
[0m05:36:22.451641 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:36:22.455611 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:36:22.456803 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:36:22.457946 [debug] [MainThread]: On list__clean: Close
[0m05:36:22.459008 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:36:22.460295 [debug] [MainThread]: On list__mart: Close
[0m05:36:22.461336 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:36:22.462557 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:36:22.463690 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:36:22.464750 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:36:22.465797 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:36:22.466885 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:36:22.467917 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:36:22.468973 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:36:22.471181 [info ] [MainThread]: 
[0m05:36:22.472584 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.21 seconds (4.21s).
[0m05:36:22.481185 [debug] [MainThread]: Command end result
[0m05:36:22.736580 [info ] [MainThread]: 
[0m05:36:22.738259 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:36:22.739604 [info ] [MainThread]: 
[0m05:36:22.740993 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:36:22.743635 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.1646385, "process_in_blocks": "0", "process_kernel_time": 0.682766, "process_mem_max_rss": "114680", "process_out_blocks": "9744", "process_user_time": 6.301241}
[0m05:36:22.745182 [debug] [MainThread]: Command `dbt build` succeeded at 05:36:22.744795 after 7.17 seconds
[0m05:36:22.746285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c757e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c37f7400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7a61c41bd580>]}
[0m05:36:22.747144 [debug] [MainThread]: Flushing usage events
[0m05:37:17.922809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cfc38310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cc8aaac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cc8aa970>]}


============================== 05:37:17.931871 | f15795c7-343e-4348-8f7a-05864802be19 ==============================
[0m05:37:17.931871 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:37:17.932936 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'log_cache_events': 'False', 'warn_error': 'None', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True', 'no_print': 'None', 'quiet': 'False', 'use_experimental_parser': 'False', 'introspect': 'True', 'empty': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'version_check': 'True', 'use_colors': 'True', 'printer_width': '80', 'profiles_dir': '.', 'indirect_selection': 'eager', 'target_path': 'None', 'static_parser': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'log_format': 'default'}
[0m05:37:18.514407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f15795c7-343e-4348-8f7a-05864802be19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cc7a55e0>]}
[0m05:37:18.708431 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f15795c7-343e-4348-8f7a-05864802be19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cfe6ef10>]}
[0m05:37:18.709707 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:37:19.121789 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:37:19.630182 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:37:19.630819 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:37:19.832470 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f15795c7-343e-4348-8f7a-05864802be19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cc012f10>]}
[0m05:37:20.318831 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f15795c7-343e-4348-8f7a-05864802be19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cc0501f0>]}
[0m05:37:20.319707 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:37:20.323203 [info ] [MainThread]: 
[0m05:37:20.324201 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:37:20.336029 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:37:20.337646 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:37:20.509599 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:37:20.517562 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:37:21.327589 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:37:21.334350 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:37:21.397091 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:37:21.408217 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:37:21.434279 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:37:21.492936 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:37:21.503156 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:37:21.507131 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:37:21.514409 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:37:21.517860 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:37:21.529495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f15795c7-343e-4348-8f7a-05864802be19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cc90d220>]}
[0m05:37:21.530652 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:37:21.531468 [info ] [MainThread]: 
[0m05:37:21.592842 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:37:21.594613 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:37:21.596227 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:37:21.597337 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:37:21.623123 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:37:21.624486 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:37:21.819949 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:37:21.886344 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:37:21.893756 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:37:21.906230 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:37:22.038910 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:37:22.042408 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:37:22.094633 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:37:22.097823 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:37:22.103428 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:37:22.106314 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:37:22.108353 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:37:22.111731 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:37:22.205252 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:37:22.209002 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:37:22.215230 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f15795c7-343e-4348-8f7a-05864802be19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cb7b0670>]}
[0m05:37:22.216442 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.62s]
[0m05:37:22.217859 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:37:22.220471 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:37:22.221991 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:37:22.223875 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:37:22.226314 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:37:22.228056 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:37:22.230305 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:37:22.233405 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:37:22.235680 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:37:22.238377 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:37:22.240275 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:37:22.241744 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:37:22.293022 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:37:22.404273 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:37:22.406261 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:37:22.419332 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:37:22.421529 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:37:22.423925 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:37:22.441015 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:37:22.721793 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:37:22.739116 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:37:22.805965 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:37:22.807696 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:37:22.808577 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:37:22.809771 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:37:22.997818 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:37:23.006211 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:37:23.007832 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:37:23.020031 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:37:23.021217 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:37:23.018550 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.79s]
[0m05:37:23.024136 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.79s]
[0m05:37:23.026838 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:37:23.028168 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:37:23.033250 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:37:23.036182 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.80s]
[0m05:37:23.037586 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:37:23.039252 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:37:23.041079 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:37:23.040293 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:37:23.042090 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:37:23.043256 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:37:23.044264 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:37:23.045268 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:37:23.046113 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:37:23.046886 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:37:23.047739 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:37:23.048490 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:37:23.108263 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:37:23.111521 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:37:23.119768 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:37:23.126507 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:37:23.128023 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:37:23.128769 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:37:23.139931 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:37:23.239254 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:37:23.437915 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:37:23.517695 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19` 
  ...
[0m05:37:23.524304 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19` 
  ...
[0m05:37:23.526799 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:37:23.528951 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:37:23.535706 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:37:23.597751 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:37:23.710598 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:37:23.795987 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:37:23.824659 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:37:23.828874 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:37:23.836717 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:37:23.894210 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:37:23.896908 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:37:23.913859 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:37:24.000220 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:37:24.015143 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:37:24.026185 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:37:24.028122 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:37:24.035241 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:37:24.094433 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:37:24.107651 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:37:24.114060 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:37:24.127745 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:37:24.133527 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:37:24.138776 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:37:24.194210 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:37:24.196180 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:37:24.204124 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f15795c7-343e-4348-8f7a-05864802be19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cabea190>]}
[0m05:37:24.210065 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.16s]
[0m05:37:24.214269 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:37:24.233656 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:37:24.238954 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19`)
      
    ...
[0m05:37:24.241844 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:37:24.249648 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19`)
      
    ...
[0m05:37:24.265381 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:37:24.294318 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:37:24.299746 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:37:24.305947 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:37:24.311709 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:37:24.313098 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:37:24.315938 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19` 
    ...
[0m05:37:24.320592 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19` 
    ...
[0m05:37:24.327212 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:37:24.334404 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:37:24.340406 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19` 
  ...
[0m05:37:24.403781 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f15795c7_343e_4348_8f7a_05864802be19` 
  ...
[0m05:37:24.408858 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:37:24.422788 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:37:24.424076 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:37:24.436817 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:37:24.494226 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:37:24.502228 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f15795c7-343e-4348-8f7a-05864802be19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cc66cfd0>]}
[0m05:37:24.504529 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:37:24.507086 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.46s]
[0m05:37:24.514172 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f15795c7-343e-4348-8f7a-05864802be19', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cabeaac0>]}
[0m05:37:24.517200 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:37:24.519794 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.47s]
[0m05:37:24.523165 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:37:24.526998 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:37:24.528273 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:37:24.529559 [debug] [MainThread]: On list__clean: Close
[0m05:37:24.530697 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:37:24.531900 [debug] [MainThread]: On list__mart: Close
[0m05:37:24.533053 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:37:24.534218 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:37:24.535337 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:37:24.536501 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:37:24.537661 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:37:24.538829 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:37:24.539945 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:37:24.541108 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:37:24.543405 [info ] [MainThread]: 
[0m05:37:24.594086 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.22 seconds (4.22s).
[0m05:37:24.602392 [debug] [MainThread]: Command end result
[0m05:37:24.812554 [info ] [MainThread]: 
[0m05:37:24.813450 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:37:24.814055 [info ] [MainThread]: 
[0m05:37:24.814661 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:37:24.815928 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.0884743, "process_in_blocks": "0", "process_kernel_time": 0.724574, "process_mem_max_rss": "115120", "process_out_blocks": "9744", "process_user_time": 6.165777}
[0m05:37:24.816644 [debug] [MainThread]: Command `dbt build` succeeded at 05:37:24.816445 after 7.09 seconds
[0m05:37:24.817242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cfc38310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3cc772850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7cc3ca96e9a0>]}
[0m05:37:24.817834 [debug] [MainThread]: Flushing usage events
[0m05:38:17.699896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798afe1a4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798afae0db80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798afae0da30>]}


============================== 05:38:17.709555 | 179b70c8-f6fc-4b66-ad4d-9964a97c0b42 ==============================
[0m05:38:17.709555 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:38:17.710680 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'empty': 'False', 'use_colors': 'True', 'target_path': 'None', 'introspect': 'True', 'debug': 'False', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'printer_width': '80', 'use_experimental_parser': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'quiet': 'False', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'version_check': 'True', 'indirect_selection': 'eager', 'log_format': 'default'}
[0m05:38:18.301064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '179b70c8-f6fc-4b66-ad4d-9964a97c0b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798afd731b80>]}
[0m05:38:18.499590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '179b70c8-f6fc-4b66-ad4d-9964a97c0b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798afaed1e50>]}
[0m05:38:18.500871 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:38:18.916521 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:38:19.480817 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:38:19.481530 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:38:19.684209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '179b70c8-f6fc-4b66-ad4d-9964a97c0b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798afa562e50>]}
[0m05:38:20.134674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '179b70c8-f6fc-4b66-ad4d-9964a97c0b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798afa5852b0>]}
[0m05:38:20.135551 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:38:20.138766 [info ] [MainThread]: 
[0m05:38:20.139800 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:38:20.183992 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:38:20.190816 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:38:20.289033 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:38:20.293486 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:38:20.889042 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:38:20.898191 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:38:20.911409 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:38:20.976624 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:38:21.012626 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:38:21.014352 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:38:21.082451 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:38:21.090156 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:38:21.099930 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:38:21.110118 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:38:21.124902 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '179b70c8-f6fc-4b66-ad4d-9964a97c0b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798afa4c0340>]}
[0m05:38:21.126724 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:38:21.176589 [info ] [MainThread]: 
[0m05:38:21.205703 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:38:21.206873 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:38:21.208024 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:38:21.208810 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:38:21.225788 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:38:21.227025 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:38:21.417481 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:38:21.535246 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:38:21.536672 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:38:21.548923 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:38:21.685617 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:38:21.690286 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:38:21.693058 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:38:21.697036 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:38:21.703592 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:38:21.706859 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:38:21.708864 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:38:21.712062 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:38:21.805028 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:38:21.808548 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:38:21.814826 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '179b70c8-f6fc-4b66-ad4d-9964a97c0b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798af98c33a0>]}
[0m05:38:21.816012 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m05:38:21.817349 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:38:21.819834 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:38:21.820893 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:38:21.822258 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:38:21.824024 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:38:21.825911 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:38:21.827615 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:38:21.828972 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:38:21.877928 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:38:21.879763 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:38:21.881866 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:38:21.883575 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:38:21.895760 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:38:21.993594 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:38:22.013581 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:38:22.018512 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:38:22.021138 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:38:22.078057 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:38:22.084370 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:38:22.211040 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:38:22.288102 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:38:22.294885 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:38:22.306185 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:38:22.310382 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:38:22.313207 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:38:22.578085 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:38:22.594957 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:38:22.600022 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:38:22.613058 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:38:22.615239 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.79s]
[0m05:38:22.622646 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:38:22.678523 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:38:22.681176 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:38:22.687273 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.81s]
[0m05:38:22.693027 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.82s]
[0m05:38:22.696136 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:38:22.699349 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:38:22.703217 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:38:22.704421 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:38:22.706275 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:38:22.707860 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:38:22.709562 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:38:22.711892 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:38:22.713611 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:38:22.715172 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:38:22.716860 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:38:22.718426 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:38:22.720176 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:38:22.721962 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:38:22.900194 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:38:22.910569 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:38:22.911814 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:38:22.914311 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:38:22.916821 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:38:23.005031 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:38:23.006226 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:38:23.097480 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:38:23.203765 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:38:23.323575 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:38:23.325152 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42` 
  ...
[0m05:38:23.384883 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42` 
  ...
[0m05:38:23.387923 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:38:23.390700 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:38:23.394202 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:38:23.401182 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:38:23.424124 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:38:23.576772 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:38:23.579444 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:38:23.581663 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:38:23.584879 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:38:23.588720 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:38:23.591726 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:38:23.600149 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:38:23.603271 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:38:23.605949 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '179b70c8-f6fc-4b66-ad4d-9964a97c0b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798af917ef40>]}
[0m05:38:23.607142 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:38:23.608407 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.89s]
[0m05:38:23.616518 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:38:23.624029 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:38:23.681555 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:38:23.687017 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:38:23.693134 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:38:23.694552 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:38:23.700859 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:38:23.703763 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:38:23.705373 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:38:23.707372 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:38:23.723765 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:38:23.725031 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:38:23.727085 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42`)
      
    ...
[0m05:38:23.729371 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42`)
      
    ...
[0m05:38:23.748987 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:38:23.779801 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:38:23.782144 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:38:23.789627 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:38:23.791026 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:38:23.795088 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42` 
    ...
[0m05:38:23.797044 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:38:23.803496 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42` 
    ...
[0m05:38:23.805448 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:38:23.814937 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42` 
  ...
[0m05:38:23.816868 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:38:23.877306 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_179b70c8_f6fc_4b66_ad4d_9964a97c0b42` 
  ...
[0m05:38:23.878839 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:38:23.885869 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:38:23.887156 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:38:23.894569 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:38:23.895772 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:38:23.899854 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '179b70c8-f6fc-4b66-ad4d-9964a97c0b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798af98c3ca0>]}
[0m05:38:23.901047 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:38:23.902278 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.19s]
[0m05:38:23.905359 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '179b70c8-f6fc-4b66-ad4d-9964a97c0b42', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798af9ddaa30>]}
[0m05:38:23.906731 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:38:23.907957 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.19s]
[0m05:38:23.909574 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:38:23.911759 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:38:23.912714 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:38:23.913674 [debug] [MainThread]: On list__clean: Close
[0m05:38:23.914572 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:38:23.915457 [debug] [MainThread]: On list__mart: Close
[0m05:38:23.916334 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:38:23.917263 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:38:23.918166 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:38:23.919091 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:38:23.919959 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:38:23.920868 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:38:23.921751 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:38:23.922654 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:38:23.924800 [info ] [MainThread]: 
[0m05:38:23.976431 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.78 seconds (3.78s).
[0m05:38:23.983713 [debug] [MainThread]: Command end result
[0m05:38:24.103928 [info ] [MainThread]: 
[0m05:38:24.104835 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:38:24.105456 [info ] [MainThread]: 
[0m05:38:24.106095 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:38:24.107390 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.6186795, "process_in_blocks": "0", "process_kernel_time": 0.685109, "process_mem_max_rss": "114344", "process_out_blocks": "9744", "process_user_time": 6.029758}
[0m05:38:24.108329 [debug] [MainThread]: Command `dbt build` succeeded at 05:38:24.108053 after 6.62 seconds
[0m05:38:24.108988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798afe1a4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798afc0bc040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x798afd731b80>]}
[0m05:38:24.109611 [debug] [MainThread]: Flushing usage events
[0m05:39:18.111623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8dbac9d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8d873ac40>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8d873aaf0>]}


============================== 05:39:18.122195 | 83fd9738-a87f-42fd-9d12-38296e476bab ==============================
[0m05:39:18.122195 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:39:18.123298 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'no_print': 'None', 'introspect': 'True', 'use_colors': 'True', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'debug': 'False', 'write_json': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'profiles_dir': '.', 'cache_selected_only': 'False', 'target_path': 'None', 'partial_parse': 'True', 'empty': 'False', 'fail_fast': 'False'}
[0m05:39:18.783414 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '83fd9738-a87f-42fd-9d12-38296e476bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8daf6a970>]}
[0m05:39:18.981522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '83fd9738-a87f-42fd-9d12-38296e476bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8d8725670>]}
[0m05:39:18.982842 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:39:19.393472 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:39:19.898693 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:39:19.899332 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:39:20.104341 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '83fd9738-a87f-42fd-9d12-38296e476bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8d7e9bdc0>]}
[0m05:39:20.587789 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '83fd9738-a87f-42fd-9d12-38296e476bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8d7ebe430>]}
[0m05:39:20.588701 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:39:20.591871 [info ] [MainThread]: 
[0m05:39:20.592906 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:39:20.604713 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:39:20.611231 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:39:20.722389 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:39:20.723792 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:39:21.446615 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:39:21.454728 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:39:21.456970 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:39:21.477829 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:39:21.522834 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:39:21.575778 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:39:21.591516 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:39:21.597806 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:39:21.611698 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:39:21.613770 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:39:21.680766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '83fd9738-a87f-42fd-9d12-38296e476bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8d86edfa0>]}
[0m05:39:21.682800 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:39:21.684317 [info ] [MainThread]: 
[0m05:39:21.711413 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:39:21.712593 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:39:21.713707 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:39:21.714460 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:39:21.783891 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:39:21.785577 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:39:21.913182 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:39:22.015108 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:39:22.016665 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:39:22.026311 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:39:22.123137 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:39:22.176156 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:39:22.178358 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:39:22.181140 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:39:22.187118 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:39:22.189945 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:39:22.191945 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:39:22.194885 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:39:22.291502 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:39:22.294741 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:39:22.301090 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83fd9738-a87f-42fd-9d12-38296e476bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8dafe6bb0>]}
[0m05:39:22.302370 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m05:39:22.303777 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:39:22.305347 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:39:22.306334 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:39:22.307375 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:39:22.308431 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:39:22.309307 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:39:22.310422 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:39:22.311845 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:39:22.312838 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:39:22.313998 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:39:22.315096 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:39:22.315885 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:39:22.316798 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:39:22.394381 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:39:22.401162 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:39:22.407353 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:39:22.409381 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:39:22.410348 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:39:22.421399 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:39:22.506632 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:39:22.504658 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:39:22.511206 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:39:22.512724 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:39:22.513439 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:39:22.515639 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:39:22.684188 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:39:22.690681 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:39:22.692702 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:39:22.697500 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:39:22.709581 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:39:22.707408 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.39s]
[0m05:39:22.711352 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:39:22.715943 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.40s]
[0m05:39:22.717780 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:39:22.775497 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.46s]
[0m05:39:22.777434 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:39:22.779640 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:39:22.781876 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:39:22.782732 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:39:22.783709 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:39:22.784690 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:39:22.785822 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:39:22.786988 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:39:22.788205 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:39:22.789424 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:39:22.790336 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:39:22.791325 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:39:22.792094 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:39:22.818489 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:39:22.819408 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:39:22.885510 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:39:22.892459 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:39:22.895435 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:39:22.897084 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:39:22.903619 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:39:23.079047 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:39:23.285145 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:39:23.376521 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:39:23.501834 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:39:23.588161 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:39:23.607902 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:39:23.715152 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:39:23.720982 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab` 
  ...
[0m05:39:23.802503 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:39:23.877231 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:39:23.897061 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab` 
  ...
[0m05:39:23.900486 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:39:23.986446 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:39:24.001136 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:39:24.181322 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:39:24.210373 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:39:24.213263 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:39:24.223246 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:39:24.279303 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:39:24.282033 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83fd9738-a87f-42fd-9d12-38296e476bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8d85feb20>]}
[0m05:39:24.283306 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.49s]
[0m05:39:24.284652 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:39:24.299153 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:39:24.314813 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:39:24.390598 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:39:24.403820 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:39:24.413982 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:39:24.416920 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:39:24.480108 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:39:24.488343 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:39:24.491847 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:39:24.495591 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:39:24.523014 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:39:24.524608 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:39:24.527137 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab`)
      
    ...
[0m05:39:24.529967 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab`)
      
    ...
[0m05:39:24.552687 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:39:24.557945 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:39:24.559338 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:39:24.582297 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:39:24.586197 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:39:24.591269 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab` 
    ...
[0m05:39:24.593323 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:39:24.598099 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab` 
    ...
[0m05:39:24.606539 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:39:24.613757 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab` 
  ...
[0m05:39:24.615769 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:39:24.623234 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_83fd9738_a87f_42fd_9d12_38296e476bab` 
  ...
[0m05:39:24.624873 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:39:24.675579 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:39:24.684342 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:39:24.697785 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:39:24.702133 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:39:24.706057 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83fd9738-a87f-42fd-9d12-38296e476bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8d72abc10>]}
[0m05:39:24.708011 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:39:24.709816 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.92s]
[0m05:39:24.715006 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '83fd9738-a87f-42fd-9d12-38296e476bab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8d8713910>]}
[0m05:39:24.716721 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:39:24.718126 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.93s]
[0m05:39:24.719724 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:39:24.722073 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:39:24.722755 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:39:24.774973 [debug] [MainThread]: On list__mart: Close
[0m05:39:24.776221 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:39:24.777382 [debug] [MainThread]: On list__clean: Close
[0m05:39:24.778548 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:39:24.779744 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:39:24.780854 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:39:24.782044 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:39:24.783167 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:39:24.784329 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:39:24.785529 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:39:24.786693 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:39:24.789020 [info ] [MainThread]: 
[0m05:39:24.790571 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.20 seconds (4.20s).
[0m05:39:24.798831 [debug] [MainThread]: Command end result
[0m05:39:25.008789 [info ] [MainThread]: 
[0m05:39:25.009751 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:39:25.010429 [info ] [MainThread]: 
[0m05:39:25.011118 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:39:25.012434 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.100714, "process_in_blocks": "0", "process_kernel_time": 0.630859, "process_mem_max_rss": "114508", "process_out_blocks": "9744", "process_user_time": 6.298741}
[0m05:39:25.013182 [debug] [MainThread]: Command `dbt build` succeeded at 05:39:25.012995 after 7.10 seconds
[0m05:39:25.013814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8dbac9d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8d7e95640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71b8d7e61c10>]}
[0m05:39:25.014397 [debug] [MainThread]: Flushing usage events
[0m05:40:16.183056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1ec883310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1e94d7af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1e94d79a0>]}


============================== 05:40:16.193349 | b1a01230-a440-491a-978b-f5b9b7c3c04d ==============================
[0m05:40:16.193349 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:40:16.194767 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'static_parser': 'True', 'profiles_dir': '.', 'debug': 'False', 'no_print': 'None', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'introspect': 'True', 'use_colors': 'True', 'warn_error': 'None', 'write_json': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'fail_fast': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'version_check': 'True'}
[0m05:40:16.774541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b1a01230-a440-491a-978b-f5b9b7c3c04d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1e9404160>]}
[0m05:40:16.921632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b1a01230-a440-491a-978b-f5b9b7c3c04d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1e9414f70>]}
[0m05:40:16.923220 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:40:17.397018 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:40:17.900185 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:40:17.900855 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:40:18.101424 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b1a01230-a440-491a-978b-f5b9b7c3c04d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1e8c2dee0>]}
[0m05:40:18.591770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b1a01230-a440-491a-978b-f5b9b7c3c04d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1e8c17130>]}
[0m05:40:18.592723 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:40:18.596272 [info ] [MainThread]: 
[0m05:40:18.597380 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:40:18.609266 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:40:18.624918 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:40:18.682436 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:40:18.686473 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:40:19.164221 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:40:19.180163 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:40:19.182239 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:40:19.192497 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:40:19.287974 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:40:19.299653 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:40:19.307068 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:40:19.314269 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:40:19.324622 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:40:19.379123 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:40:19.390633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b1a01230-a440-491a-978b-f5b9b7c3c04d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1ebc83970>]}
[0m05:40:19.392252 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:40:19.393431 [info ] [MainThread]: 
[0m05:40:19.412266 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:40:19.413495 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:40:19.414656 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:40:19.415460 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:40:19.484640 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:40:19.485889 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:40:19.680750 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:40:19.746286 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:40:19.747680 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:40:19.759706 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:40:19.889260 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:40:19.892961 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:40:19.895312 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:40:19.898980 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:40:19.905132 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:40:19.908348 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:40:19.910459 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:40:19.913232 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:40:20.007522 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:40:20.011017 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:40:20.017156 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1a01230-a440-491a-978b-f5b9b7c3c04d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1e7fb43a0>]}
[0m05:40:20.018318 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m05:40:20.019744 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:40:20.021752 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:40:20.023196 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:40:20.025208 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:40:20.075282 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:40:20.078774 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:40:20.081289 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:40:20.084174 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:40:20.086572 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:40:20.088931 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:40:20.090731 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:40:20.092475 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:40:20.094231 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:40:20.319443 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:40:20.375436 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:40:20.321783 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:40:20.378686 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:40:20.380738 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:40:20.387460 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:40:20.622570 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:40:20.688165 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:40:20.703198 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:40:20.705793 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:40:20.707647 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:40:20.710277 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:40:21.267474 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:40:21.282742 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:40:21.286059 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:40:21.290839 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:40:21.304182 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.22s]
[0m05:40:21.307106 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:40:21.312110 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:40:21.318900 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.23s]
[0m05:40:21.322127 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:40:21.325454 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:40:21.377589 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.29s]
[0m05:40:21.381322 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:40:21.384276 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:40:21.385744 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:40:21.387628 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:40:21.389267 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:40:21.391519 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:40:21.393267 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:40:21.395397 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:40:21.397188 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:40:21.398865 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:40:21.400659 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:40:21.402314 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:40:21.419555 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:40:21.514211 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:40:21.575856 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:40:21.581522 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:40:21.584496 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:40:21.586477 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:40:21.598436 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:40:21.699641 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:40:21.822272 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:40:21.918957 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:40:21.996229 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:40:22.108583 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:40:22.185482 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:40:22.302034 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d` 
  ...
[0m05:40:22.310003 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:40:22.376089 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:40:22.386158 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d` 
  ...
[0m05:40:22.388471 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:40:22.476465 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:40:22.504827 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:40:22.598077 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:40:22.695467 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:40:22.716454 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:40:22.719857 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:40:22.787093 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:40:22.796235 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:40:22.801862 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1a01230-a440-491a-978b-f5b9b7c3c04d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1e886a340>]}
[0m05:40:22.804271 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.40s]
[0m05:40:22.807319 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:40:22.819140 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:40:22.876282 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:40:22.920042 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:40:22.976485 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:40:22.985654 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:40:22.998851 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:40:23.001913 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:40:23.008151 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:40:23.011266 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:40:23.013491 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:40:23.044174 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:40:23.046885 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:40:23.080850 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d`)
      
    ...
[0m05:40:23.086279 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d`)
      
    ...
[0m05:40:23.116202 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:40:23.118882 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:40:23.131658 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:40:23.142521 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:40:23.182004 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:40:23.190017 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:40:23.188706 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d` 
    ...
[0m05:40:23.195702 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d` 
    ...
[0m05:40:23.202439 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:40:23.203973 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:40:23.211051 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d` 
  ...
[0m05:40:23.216933 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_b1a01230_a440_491a_978b_f5b9b7c3c04d` 
  ...
[0m05:40:23.220458 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:40:23.274776 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:40:23.227141 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:40:23.285972 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:40:23.287343 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:40:23.292105 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1a01230-a440-491a-978b-f5b9b7c3c04d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1e886ab80>]}
[0m05:40:23.294016 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:40:23.295820 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.90s]
[0m05:40:23.298861 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b1a01230-a440-491a-978b-f5b9b7c3c04d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1e883dfa0>]}
[0m05:40:23.300192 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:40:23.301437 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.91s]
[0m05:40:23.303661 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:40:23.306758 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:40:23.307902 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:40:23.308993 [debug] [MainThread]: On list__mart: Close
[0m05:40:23.310078 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:40:23.311188 [debug] [MainThread]: On list__clean: Close
[0m05:40:23.312277 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:40:23.313366 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:40:23.314457 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m05:40:23.315584 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m05:40:23.316629 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:40:23.317729 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:40:23.318775 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:40:23.319742 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:40:23.322062 [info ] [MainThread]: 
[0m05:40:23.323372 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.72 seconds (4.72s).
[0m05:40:23.381437 [debug] [MainThread]: Command end result
[0m05:40:23.600209 [info ] [MainThread]: 
[0m05:40:23.601872 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:40:23.603139 [info ] [MainThread]: 
[0m05:40:23.604510 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:40:23.607167 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.6153655, "process_in_blocks": "0", "process_kernel_time": 0.698359, "process_mem_max_rss": "115080", "process_out_blocks": "9744", "process_user_time": 6.343431}
[0m05:40:23.608657 [debug] [MainThread]: Command `dbt build` succeeded at 05:40:23.608263 after 7.62 seconds
[0m05:40:23.609865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1ec883310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1eb0171c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78b1e88ef580>]}
[0m05:40:23.611036 [debug] [MainThread]: Flushing usage events
[0m05:41:18.018051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf74b42310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf717b0a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf717b0940>]}


============================== 05:41:18.027770 | c724a58e-d307-46b2-8882-3061e67ec191 ==============================
[0m05:41:18.027770 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:41:18.028868 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'quiet': 'False', 'use_experimental_parser': 'False', 'debug': 'False', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'profiles_dir': '.', 'cache_selected_only': 'False', 'no_print': 'None', 'fail_fast': 'False', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True', 'static_parser': 'True', 'version_check': 'True', 'target_path': 'None', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_format': 'default', 'log_cache_events': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_colors': 'True', 'partial_parse': 'True'}
[0m05:41:18.607030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c724a58e-d307-46b2-8882-3061e67ec191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf740edfd0>]}
[0m05:41:18.750048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c724a58e-d307-46b2-8882-3061e67ec191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf72290430>]}
[0m05:41:18.751350 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:41:19.218752 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:41:19.728694 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:41:19.729500 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:41:19.935330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c724a58e-d307-46b2-8882-3061e67ec191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf70f16f10>]}
[0m05:41:20.446640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c724a58e-d307-46b2-8882-3061e67ec191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf73d80c70>]}
[0m05:41:20.447551 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:41:20.450953 [info ] [MainThread]: 
[0m05:41:20.452086 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:41:20.467507 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:41:20.468987 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:41:20.541216 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:41:20.548922 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:41:21.165376 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:41:21.168488 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:41:21.172291 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:41:21.174229 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:41:21.233220 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:41:21.234662 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:41:21.249813 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:41:21.305404 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:41:21.316844 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:41:21.329201 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:41:21.344321 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c724a58e-d307-46b2-8882-3061e67ec191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf7161c940>]}
[0m05:41:21.346268 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:41:21.347650 [info ] [MainThread]: 
[0m05:41:21.422204 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:41:21.423420 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:41:21.424574 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:41:21.425430 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:41:21.442681 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:41:21.443949 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:41:21.618327 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:41:21.675742 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:41:21.677146 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:41:21.686887 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:41:21.822904 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:41:21.825829 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:41:21.827825 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:41:21.830427 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:41:21.836177 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:41:21.838897 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:41:21.840843 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:41:21.843440 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:41:21.940328 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:41:21.943454 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:41:21.949806 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c724a58e-d307-46b2-8882-3061e67ec191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf740e5820>]}
[0m05:41:21.951129 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m05:41:21.952528 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:41:21.954137 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:41:22.005404 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:41:22.006790 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:41:21.955086 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:41:22.008252 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:41:22.009680 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:41:22.010643 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:41:22.011988 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:41:22.013109 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:41:22.014144 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:41:22.015123 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:41:22.036942 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:41:22.037987 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:41:22.049170 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:41:22.109423 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:41:22.110781 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:41:22.111920 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:41:22.123190 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:41:22.222650 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:41:22.248122 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:41:22.249624 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:41:22.250759 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:41:22.251791 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:41:22.253343 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:41:22.518116 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:41:22.520347 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:41:22.522263 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:41:22.530587 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:41:22.537732 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.53s]
[0m05:41:22.539722 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:41:22.541472 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:41:22.543097 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:41:22.547120 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.53s]
[0m05:41:22.550617 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.54s]
[0m05:41:22.553095 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:41:22.555506 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:41:22.608367 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:41:22.609683 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:41:22.611910 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:41:22.614853 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:41:22.617955 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:41:22.619928 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:41:22.621081 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:41:22.622397 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:41:22.623254 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:41:22.624452 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:41:22.625797 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:41:22.626792 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:41:22.645657 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:41:22.711408 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:41:22.727840 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:41:22.730721 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:41:22.738185 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:41:22.745254 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:41:22.825344 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:41:22.926718 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:41:23.011752 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:41:23.115314 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:41:23.151121 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:41:23.213343 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:41:23.416247 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m05:41:23.532916 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:41:23.646629 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:41:23.654067 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191` 
  ...
[0m05:41:23.709787 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191` 
  ...
[0m05:41:23.715176 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:41:23.722197 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:41:23.724990 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:41:23.806717 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:41:23.834617 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:41:23.942194 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:41:23.952599 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c724a58e-d307-46b2-8882-3061e67ec191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf6fb2aa60>]}
[0m05:41:24.027067 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.33s]
[0m05:41:24.106690 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:41:24.127805 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:41:24.134681 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:41:24.223430 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:41:24.239104 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m05:41:24.317887 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:41:24.326692 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:41:24.331988 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:41:24.348064 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:41:24.349246 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:41:24.406082 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:41:24.409950 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:41:24.412366 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:41:24.444521 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:41:24.446763 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191`)
      
    ...
[0m05:41:24.448658 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:41:24.456246 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191`)
      
    ...
[0m05:41:24.473769 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:41:24.487411 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:41:24.505751 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:41:24.520381 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:41:24.525141 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:41:24.531126 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191` 
    ...
[0m05:41:24.537583 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:41:24.545700 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191` 
    ...
[0m05:41:24.550013 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:41:24.606410 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:41:24.624642 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191` 
  ...
[0m05:41:24.633878 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c724a58e_d307_46b2_8882_3061e67ec191` 
  ...
[0m05:41:24.639348 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:41:24.705276 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:41:24.707156 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:41:24.721777 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:41:24.724304 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:41:24.732701 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c724a58e-d307-46b2-8882-3061e67ec191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf70aefca0>]}
[0m05:41:24.735159 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:41:24.737961 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.11s]
[0m05:41:24.744524 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c724a58e-d307-46b2-8882-3061e67ec191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf70283340>]}
[0m05:41:24.747505 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:41:24.753799 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.12s]
[0m05:41:24.807945 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:41:24.811971 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:41:24.813157 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:41:24.814370 [debug] [MainThread]: On list__mart: Close
[0m05:41:24.815473 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:41:24.816620 [debug] [MainThread]: On list__clean: Close
[0m05:41:24.817706 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:41:24.818852 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:41:24.819962 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m05:41:24.821151 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m05:41:24.822239 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:41:24.823353 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:41:24.824435 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:41:24.825564 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:41:24.827797 [info ] [MainThread]: 
[0m05:41:24.829151 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.38 seconds (4.38s).
[0m05:41:24.837220 [debug] [MainThread]: Command end result
[0m05:41:25.050416 [info ] [MainThread]: 
[0m05:41:25.051672 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:41:25.052628 [info ] [MainThread]: 
[0m05:41:25.053659 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:41:25.106465 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.281465, "process_in_blocks": "0", "process_kernel_time": 0.646446, "process_mem_max_rss": "114556", "process_out_blocks": "9744", "process_user_time": 6.407606}
[0m05:41:25.108379 [debug] [MainThread]: Command `dbt build` succeeded at 05:41:25.107819 after 7.28 seconds
[0m05:41:25.109728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf74b42310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf6f9c86d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7abf72a6bf10>]}
[0m05:41:25.111015 [debug] [MainThread]: Flushing usage events
[0m05:42:16.551347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802e22e4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802def3db20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802def3d9d0>]}


============================== 05:42:16.610855 | 3240154d-5adf-4a71-b854-1eb643b6d93a ==============================
[0m05:42:16.610855 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:42:16.611955 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'use_colors': 'True', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'debug': 'False', 'fail_fast': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'printer_width': '80', 'log_cache_events': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'empty': 'False', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'no_print': 'None', 'profiles_dir': '.', 'cache_selected_only': 'False', 'version_check': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'static_parser': 'True'}
[0m05:42:17.137611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3240154d-5adf-4a71-b854-1eb643b6d93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802e1867ca0>]}
[0m05:42:17.331005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3240154d-5adf-4a71-b854-1eb643b6d93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802df02a4f0>]}
[0m05:42:17.332322 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:42:17.750657 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:42:18.319671 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:42:18.320346 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:42:18.521487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3240154d-5adf-4a71-b854-1eb643b6d93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802de691eb0>]}
[0m05:42:18.959576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3240154d-5adf-4a71-b854-1eb643b6d93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802de6cf760>]}
[0m05:42:18.960430 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:42:18.963645 [info ] [MainThread]: 
[0m05:42:18.964649 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:42:19.014964 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:42:19.016577 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:42:19.118490 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:42:19.133829 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:42:19.866505 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:42:19.874509 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:42:19.878632 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:19.882709 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:19.946996 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:42:19.953785 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:42:20.019145 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:42:20.030211 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:42:20.032273 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:20.045699 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:20.106634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3240154d-5adf-4a71-b854-1eb643b6d93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802dee78af0>]}
[0m05:42:20.108548 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:42:20.109924 [info ] [MainThread]: 
[0m05:42:20.134882 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:42:20.136599 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:42:20.137853 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:42:20.138864 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:42:20.209206 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:42:20.210807 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:42:20.352661 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:42:20.469578 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:42:20.471011 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:42:20.483805 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:20.618939 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:42:20.625021 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:42:20.627493 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:42:20.630576 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:42:20.636423 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:42:20.639586 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:42:20.641458 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:42:20.644151 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:42:20.737288 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:42:20.740843 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:42:20.746706 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3240154d-5adf-4a71-b854-1eb643b6d93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802ddd30250>]}
[0m05:42:20.747896 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m05:42:20.749233 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:42:20.751251 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:42:20.752422 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:42:20.753804 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:42:20.755045 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:42:20.756858 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:42:20.806518 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:42:20.808564 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:42:20.810741 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:42:20.812484 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:42:20.814687 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:42:20.816302 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:42:20.838852 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:42:20.923617 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:42:20.935079 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:42:20.952306 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:42:21.004763 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:42:21.006815 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:42:21.008606 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:42:21.231269 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:42:21.235408 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:42:21.305101 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:42:21.307451 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:42:21.310101 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:42:21.312375 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:42:21.497460 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:42:21.516718 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:42:21.519508 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:42:21.521047 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:21.532866 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.72s]
[0m05:42:21.534888 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:42:21.537002 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:21.539012 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:42:21.543237 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.73s]
[0m05:42:21.549923 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.74s]
[0m05:42:21.552789 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:42:21.555431 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:42:21.608088 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:42:21.609231 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:42:21.610791 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:42:21.612017 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:42:21.614124 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:42:21.615885 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:42:21.617734 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:42:21.619620 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:42:21.621183 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:42:21.622866 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:42:21.624295 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:42:21.641620 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:42:21.741148 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:42:21.748865 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:42:21.753492 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:42:21.807794 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:42:21.814584 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:42:21.838724 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:42:21.948611 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:42:22.031941 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:42:22.132022 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:42:22.226455 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:42:22.337870 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:42:22.421904 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:42:22.532926 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:42:22.622767 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:42:22.743150 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:42:22.807992 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:42:22.810467 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a` 
  ...
[0m05:42:22.818263 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a` 
  ...
[0m05:42:22.823526 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:22.827815 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:22.841021 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:42:22.844893 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:42:23.029178 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:42:23.113824 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3240154d-5adf-4a71-b854-1eb643b6d93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802dd9b7af0>]}
[0m05:42:23.148853 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.49s]
[0m05:42:23.233708 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:42:23.306715 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:42:23.253330 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:42:23.341199 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:42:23.357613 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:42:23.358832 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:42:23.366025 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:42:23.372087 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:42:23.379462 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:23.412869 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:42:23.418405 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:42:23.421547 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:42:23.423311 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:42:23.448209 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:42:23.451463 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:42:23.455387 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a`)
      
    ...
[0m05:42:23.459638 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a`)
      
    ...
[0m05:42:23.493101 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:42:23.508509 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:42:23.511176 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:42:23.522371 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:42:23.527021 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:23.532857 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a` 
    ...
[0m05:42:23.536043 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:23.543371 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a` 
    ...
[0m05:42:23.550672 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:23.553303 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:23.620647 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a` 
  ...
[0m05:42:23.629328 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_3240154d_5adf_4a71_b854_1eb643b6d93a` 
  ...
[0m05:42:23.635029 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:23.637509 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:23.649907 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:42:23.713090 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:42:23.719185 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:42:23.725655 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3240154d-5adf-4a71-b854-1eb643b6d93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802dd9b7d60>]}
[0m05:42:23.728062 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.11s]
[0m05:42:23.730829 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:42:23.733700 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:42:23.740121 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3240154d-5adf-4a71-b854-1eb643b6d93a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802de2bfb50>]}
[0m05:42:23.743194 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.12s]
[0m05:42:23.746072 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:42:23.750259 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:42:23.751863 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:42:23.753053 [debug] [MainThread]: On list__mart: Close
[0m05:42:23.754115 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:42:23.805683 [debug] [MainThread]: On list__clean: Close
[0m05:42:23.806807 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:42:23.807948 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:42:23.809100 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m05:42:23.810236 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m05:42:23.811298 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:42:23.812458 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:42:23.813503 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:42:23.814645 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:42:23.816958 [info ] [MainThread]: 
[0m05:42:23.818365 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.85 seconds (4.85s).
[0m05:42:23.826626 [debug] [MainThread]: Command end result
[0m05:42:24.034994 [info ] [MainThread]: 
[0m05:42:24.036517 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:42:24.037664 [info ] [MainThread]: 
[0m05:42:24.038856 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:42:24.041088 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.631371, "process_in_blocks": "0", "process_kernel_time": 0.689863, "process_mem_max_rss": "115216", "process_out_blocks": "9744", "process_user_time": 6.489125}
[0m05:42:24.042417 [debug] [MainThread]: Command `dbt build` succeeded at 05:42:24.042073 after 7.63 seconds
[0m05:42:24.043658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802e22e4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802e1867ca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7802dd10c8b0>]}
[0m05:42:24.044899 [debug] [MainThread]: Flushing usage events
[0m05:43:16.777451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bafb545310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72baf81a4bb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72baf81a4a60>]}


============================== 05:43:16.789124 | 462ae009-4d87-4a76-93d5-86fd6bb82b87 ==============================
[0m05:43:16.789124 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:43:16.790332 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'printer_width': '80', 'write_json': 'True', 'static_parser': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True', 'use_colors': 'True', 'quiet': 'False', 'fail_fast': 'False', 'target_path': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'version_check': 'True', 'warn_error': 'None', 'debug': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'empty': 'False', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'no_print': 'None'}
[0m05:43:17.368322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '462ae009-4d87-4a76-93d5-86fd6bb82b87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72baf819b610>]}
[0m05:43:17.561017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '462ae009-4d87-4a76-93d5-86fd6bb82b87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72baf828a9a0>]}
[0m05:43:17.562312 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:43:17.971922 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:43:18.478619 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:43:18.479541 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:43:18.679413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '462ae009-4d87-4a76-93d5-86fd6bb82b87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72baf7905e80>]}
[0m05:43:19.167828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '462ae009-4d87-4a76-93d5-86fd6bb82b87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72baf791a7c0>]}
[0m05:43:19.168703 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:43:19.171891 [info ] [MainThread]: 
[0m05:43:19.172872 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:43:19.184663 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:43:19.248093 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:43:19.277649 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:43:19.289177 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:43:19.914900 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:43:19.920266 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:43:19.922461 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:43:19.949338 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:43:19.982993 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:43:19.989970 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list__mart'
[0m05:43:20.052263 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:43:20.059765 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:43:20.068237 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:43:20.197362 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:43:20.208719 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:43:20.224638 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '462ae009-4d87-4a76-93d5-86fd6bb82b87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bafb49b790>]}
[0m05:43:20.226608 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:43:20.228035 [info ] [MainThread]: 
[0m05:43:20.266822 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:43:20.267948 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:43:20.269039 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:43:20.269814 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:43:20.286238 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:43:20.287453 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:43:20.586783 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:43:20.702068 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:43:20.704122 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:43:20.715038 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:43:20.747602 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:43:20.751706 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:43:20.754955 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:43:20.758649 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:43:20.768587 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:43:20.772444 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:43:20.775888 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:43:20.779717 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:43:20.877024 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:43:20.879981 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:43:20.886136 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '462ae009-4d87-4a76-93d5-86fd6bb82b87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72baf7505a30>]}
[0m05:43:20.887348 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.62s]
[0m05:43:20.888781 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:43:20.890655 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:43:20.891804 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:43:20.892520 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:43:20.893445 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:43:20.894820 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:43:20.895760 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:43:20.897116 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:43:20.898374 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:43:20.899405 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:43:20.948518 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:43:20.949626 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:43:20.950461 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:43:20.991330 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:43:20.995299 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:43:21.054367 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:43:21.055833 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:43:21.061851 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:43:21.062634 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:43:21.168185 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:43:21.170881 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:43:21.172636 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:43:21.174057 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:43:21.174845 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:43:21.176462 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:43:21.392145 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:43:21.400245 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:43:21.401888 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:43:21.413927 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:43:21.412505 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.51s]
[0m05:43:21.415514 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:43:21.418736 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:43:21.422514 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.53s]
[0m05:43:21.424176 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:43:21.425807 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:43:21.428710 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.53s]
[0m05:43:21.430376 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:43:21.447633 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:43:21.432042 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:43:21.448830 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:43:21.449904 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:43:21.451029 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:43:21.452104 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:43:21.453064 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:43:21.453865 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:43:21.454630 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:43:21.455404 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:43:21.456228 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:43:21.457012 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:43:21.483066 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:43:21.493727 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:43:21.558731 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:43:21.561329 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:43:21.563174 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:43:21.588148 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:43:21.678990 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:43:21.848335 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:43:21.894357 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:43:22.048240 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:43:22.183575 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:43:22.276155 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:43:22.366481 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:43:22.474644 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:43:22.467782 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87` 
  ...
[0m05:43:22.492238 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87` 
  ...
[0m05:43:22.547698 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:43:22.551203 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:43:22.554149 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:43:22.579303 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:43:22.775167 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m05:43:22.871612 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:43:22.954455 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:43:22.964912 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '462ae009-4d87-4a76-93d5-86fd6bb82b87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72baf6c96f40>]}
[0m05:43:22.985017 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:43:22.988109 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:43:22.990870 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.51s]
[0m05:43:23.050361 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:43:23.099478 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m05:43:23.114956 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.12 seconds
[0m05:43:23.170224 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:43:23.168574 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:43:23.181312 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:43:23.195165 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:43:23.253076 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:43:23.252354 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:43:23.257082 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:43:23.259422 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:43:23.285455 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:43:23.288525 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87`)
      
    ...
[0m05:43:23.290176 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:43:23.295399 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87`)
      
    ...
[0m05:43:23.312200 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:43:23.319284 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:43:23.321718 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:43:23.326571 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:43:23.332437 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:43:23.349281 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:43:23.355204 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87` 
    ...
[0m05:43:23.361022 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87` 
    ...
[0m05:43:23.371304 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:43:23.379178 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:43:23.392006 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87` 
  ...
[0m05:43:23.448726 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_462ae009_4d87_4a76_93d5_86fd6bb82b87` 
  ...
[0m05:43:23.451956 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:43:23.466448 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:43:23.469146 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:43:23.484857 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:43:23.486582 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:43:23.492969 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '462ae009-4d87-4a76-93d5-86fd6bb82b87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72baf71c49a0>]}
[0m05:43:23.548899 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.04s]
[0m05:43:23.551312 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:43:23.553430 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:43:23.560549 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '462ae009-4d87-4a76-93d5-86fd6bb82b87', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72baf6b54910>]}
[0m05:43:23.562514 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.11s]
[0m05:43:23.564265 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:43:23.566797 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:43:23.567493 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:43:23.568190 [debug] [MainThread]: On list__clean: Close
[0m05:43:23.568825 [debug] [MainThread]: Connection 'list_' was left open.
[0m05:43:23.569617 [debug] [MainThread]: On list_: Close
[0m05:43:23.570205 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:43:23.570861 [debug] [MainThread]: On list__mart: Close
[0m05:43:23.571451 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:43:23.572076 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:43:23.572674 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:43:23.573293 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:43:23.573894 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:43:23.574478 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:43:23.575111 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m05:43:23.575718 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m05:43:23.577127 [info ] [MainThread]: 
[0m05:43:23.577902 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.40 seconds (4.40s).
[0m05:43:23.582060 [debug] [MainThread]: Command end result
[0m05:43:23.774612 [info ] [MainThread]: 
[0m05:43:23.776295 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:43:23.777623 [info ] [MainThread]: 
[0m05:43:23.779005 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:43:23.781500 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.197309, "process_in_blocks": "0", "process_kernel_time": 0.712169, "process_mem_max_rss": "115080", "process_out_blocks": "9744", "process_user_time": 6.30666}
[0m05:43:23.783123 [debug] [MainThread]: Command `dbt build` succeeded at 05:43:23.782760 after 7.20 seconds
[0m05:43:23.784286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72bafb545310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72baf78ca220>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x72baf6240b80>]}
[0m05:43:23.785370 [debug] [MainThread]: Flushing usage events
[0m05:44:16.592142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74336c848310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433694a7b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433694a7a00>]}


============================== 05:44:16.629263 | cc1e9f83-3c75-47ff-9cfc-88fd23f2ffe0 ==============================
[0m05:44:16.629263 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:44:16.630510 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'version_check': 'True', 'printer_width': '80', 'fail_fast': 'False', 'use_colors': 'True', 'cache_selected_only': 'False', 'no_print': 'None', 'target_path': 'None', 'profiles_dir': '.', 'indirect_selection': 'eager', 'warn_error': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'debug': 'False', 'use_experimental_parser': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'empty': 'False', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'log_cache_events': 'False', 'log_format': 'default', 'invocation_command': 'dbt build --profiles-dir . --target local'}
[0m05:44:17.190290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cc1e9f83-3c75-47ff-9cfc-88fd23f2ffe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74336ca32c40>]}
[0m05:44:17.388521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cc1e9f83-3c75-47ff-9cfc-88fd23f2ffe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743369290df0>]}
[0m05:44:17.390507 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:44:17.804077 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:44:18.305832 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:44:18.306482 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:44:18.509843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cc1e9f83-3c75-47ff-9cfc-88fd23f2ffe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743368c0ceb0>]}
[0m05:44:18.990746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cc1e9f83-3c75-47ff-9cfc-88fd23f2ffe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743368b014c0>]}
[0m05:44:18.991622 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:44:18.994772 [info ] [MainThread]: 
[0m05:44:18.995769 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:44:19.007871 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:44:19.020229 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:44:19.113346 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:44:19.118432 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:44:19.792861 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:44:19.797388 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:44:19.800100 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:19.812197 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:19.906784 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:44:19.918891 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:44:19.923907 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:44:19.929327 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:44:19.984382 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:19.999305 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:44:20.010705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc1e9f83-3c75-47ff-9cfc-88fd23f2ffe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x743368accb20>]}
[0m05:44:20.012719 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:44:20.014055 [info ] [MainThread]: 
[0m05:44:20.093256 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:44:20.094891 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:44:20.096332 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:44:20.097363 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:44:20.118861 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:44:20.120210 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:44:20.317805 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:44:20.428285 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:44:20.429806 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:44:20.441948 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:20.527453 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:44:20.530891 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:44:20.532997 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:44:20.584996 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:44:20.590670 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:44:20.593763 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:44:20.595612 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:44:20.598445 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:44:20.693365 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:44:20.697134 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:44:20.703427 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc1e9f83-3c75-47ff-9cfc-88fd23f2ffe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433687db4c0>]}
[0m05:44:20.704592 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m05:44:20.705942 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:44:20.707967 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:44:20.709299 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:44:20.710590 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:44:20.712233 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:44:20.714089 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:44:20.716515 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:44:20.718417 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:44:20.720662 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:44:20.722379 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:44:20.724770 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:44:20.726668 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:44:20.795367 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:44:20.923962 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:44:20.933244 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:44:20.987116 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:44:20.990311 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:44:20.992796 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:44:20.994408 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:44:21.287382 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:44:21.230247 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:44:21.312409 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:44:21.315114 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:44:21.317364 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:44:21.319105 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:44:21.603107 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:44:21.611111 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:44:21.614002 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:44:21.621269 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:21.687385 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:44:21.690309 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:44:21.692976 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.97s]
[0m05:44:21.698987 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.98s]
[0m05:44:21.704706 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.99s]
[0m05:44:21.707903 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:44:21.710934 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:44:21.713838 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:44:21.717790 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:44:21.719025 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:44:21.720587 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:44:21.721446 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:44:21.723546 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:44:21.725412 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:44:21.727486 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:44:21.729370 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:44:21.731101 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:44:21.786136 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:44:21.787942 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:44:21.805334 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:44:21.888836 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:44:21.911660 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:44:21.917279 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:44:21.919839 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:44:21.921785 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:44:22.000514 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:44:22.112149 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:44:22.290462 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:44:22.386060 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:44:22.505333 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:44:22.596518 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:44:22.624755 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:44:22.696430 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:44:22.798777 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0` 
  ...
[0m05:44:22.811924 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:44:22.830570 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0` 
  ...
[0m05:44:22.833296 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:22.888553 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:44:22.896890 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:22.906258 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:44:23.031719 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:44:23.213388 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:44:23.303489 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:23.386319 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:44:23.391824 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc1e9f83-3c75-47ff-9cfc-88fd23f2ffe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74336775c730>]}
[0m05:44:23.333187 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:44:23.398186 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.61s]
[0m05:44:23.405383 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:44:23.424608 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:44:23.440130 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:44:23.508797 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:44:23.511254 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:44:23.520230 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:23.522942 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:23.585373 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:44:23.590064 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:44:23.592383 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:44:23.593927 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:44:23.615195 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:44:23.617195 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:44:23.621065 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0`)
      
    ...
[0m05:44:23.624446 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0`)
      
    ...
[0m05:44:23.648435 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:44:23.656015 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:44:23.657715 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:44:23.665859 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:44:23.684773 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:23.689265 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0` 
    ...
[0m05:44:23.690957 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:23.695132 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0` 
    ...
[0m05:44:23.697742 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:23.705172 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0` 
  ...
[0m05:44:23.707102 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:23.715150 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_cc1e9f83_3c75_47ff_9cfc_88fd23f2ffe0` 
  ...
[0m05:44:23.717041 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:23.725346 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:44:23.726863 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:44:23.785409 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:44:23.786695 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:44:23.789934 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc1e9f83-3c75-47ff-9cfc-88fd23f2ffe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74336775c340>]}
[0m05:44:23.793592 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:44:23.796852 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc1e9f83-3c75-47ff-9cfc-88fd23f2ffe0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74336a6c3730>]}
[0m05:44:23.792171 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.06s]
[0m05:44:23.798138 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.07s]
[0m05:44:23.799617 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:44:23.801022 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:44:23.803261 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:44:23.803832 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:44:23.804349 [debug] [MainThread]: On list__mart: Close
[0m05:44:23.804858 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:44:23.805357 [debug] [MainThread]: On list__clean: Close
[0m05:44:23.805849 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:44:23.806334 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:44:23.806832 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m05:44:23.807322 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m05:44:23.807822 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:44:23.808310 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:44:23.808794 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:44:23.809290 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:44:23.810418 [info ] [MainThread]: 
[0m05:44:23.811169 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.81 seconds (4.81s).
[0m05:44:23.814929 [debug] [MainThread]: Command end result
[0m05:44:23.924361 [info ] [MainThread]: 
[0m05:44:23.925208 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:44:23.925849 [info ] [MainThread]: 
[0m05:44:23.926498 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:44:23.928471 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.530954, "process_in_blocks": "8", "process_kernel_time": 0.713646, "process_mem_max_rss": "115008", "process_out_blocks": "9744", "process_user_time": 6.419863}
[0m05:44:23.929615 [debug] [MainThread]: Command `dbt build` succeeded at 05:44:23.929271 after 7.53 seconds
[0m05:44:23.930731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74336c848310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x74336a767160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7433676aafd0>]}
[0m05:44:23.931815 [debug] [MainThread]: Flushing usage events
[0m05:45:15.766144 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038ff12310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038cb76af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038cb769a0>]}


============================== 05:45:15.775408 | 1a3f4f73-43df-4339-a160-ca7df5a39535 ==============================
[0m05:45:15.775408 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:45:15.776473 [debug] [MainThread]: running dbt with arguments {'fail_fast': 'False', 'static_parser': 'True', 'no_print': 'None', 'partial_parse': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'quiet': 'False', 'warn_error': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True', 'debug': 'False', 'empty': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'log_cache_events': 'False', 'version_check': 'True', 'use_colors': 'True', 'printer_width': '80'}
[0m05:45:16.366492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1a3f4f73-43df-4339-a160-ca7df5a39535', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038caae160>]}
[0m05:45:16.562461 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1a3f4f73-43df-4339-a160-ca7df5a39535', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038cabef70>]}
[0m05:45:16.563848 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:45:16.984392 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:45:17.499426 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:45:17.500206 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:45:17.701830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1a3f4f73-43df-4339-a160-ca7df5a39535', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038c2d8ee0>]}
[0m05:45:18.216937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1a3f4f73-43df-4339-a160-ca7df5a39535', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038c2c2130>]}
[0m05:45:18.217810 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:45:18.221018 [info ] [MainThread]: 
[0m05:45:18.222058 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:45:18.270787 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:45:18.282556 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:45:18.303506 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:45:18.369847 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:45:19.049045 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:45:19.063320 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:45:19.069096 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:45:19.075784 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:45:19.160912 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:45:19.162419 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:45:19.203794 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:45:19.205771 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:45:19.262202 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:45:19.275047 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:45:19.289631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a3f4f73-43df-4339-a160-ca7df5a39535', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038f32a970>]}
[0m05:45:19.291394 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:45:19.292695 [info ] [MainThread]: 
[0m05:45:19.369797 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:45:19.370984 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:45:19.372053 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:45:19.372838 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:45:19.389409 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:45:19.390615 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:45:19.574500 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:45:19.641859 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:45:19.643277 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:45:19.654582 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:45:19.784972 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:45:19.787933 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:45:19.790058 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:45:19.792929 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:45:19.798806 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:45:19.801519 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:45:19.803549 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:45:19.806485 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:45:19.904028 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:45:19.907246 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:45:19.965399 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a3f4f73-43df-4339-a160-ca7df5a39535', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038b671910>]}
[0m05:45:19.966889 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m05:45:19.968250 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:45:19.969886 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:45:19.970702 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:45:19.971463 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:45:19.972359 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:45:19.973285 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:45:19.974379 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:45:19.975350 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:45:19.976439 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:45:19.977324 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:45:19.978348 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:45:19.979172 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:45:20.000720 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:45:20.001641 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:45:20.009410 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:45:20.063762 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:45:20.065297 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:45:20.076501 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:45:20.098224 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:45:20.160849 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:45:20.165768 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:45:20.179647 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:45:20.181125 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:45:20.182103 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:45:20.182816 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:45:20.347269 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:45:20.353999 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:45:20.359118 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:45:20.362688 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:45:20.364412 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:45:20.375036 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:45:20.372679 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.40s]
[0m05:45:20.379795 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.40s]
[0m05:45:20.382891 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.41s]
[0m05:45:20.384275 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:45:20.386130 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:45:20.387877 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:45:20.389875 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:45:20.390792 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:45:20.391878 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:45:20.393122 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:45:20.394185 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:45:20.395558 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:45:20.396697 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:45:20.397463 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:45:20.398309 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:45:20.399319 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:45:20.400150 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:45:20.401073 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:45:20.469215 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:45:20.479088 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:45:20.490509 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:45:20.492417 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:45:20.493340 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:45:20.494209 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:45:20.678113 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:45:20.802702 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:45:20.967138 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.11 seconds
[0m05:45:21.073445 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:45:21.098826 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:45:21.188369 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:45:21.300831 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:45:21.363485 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535` 
  ...
[0m05:45:21.400898 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:45:21.403908 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535` 
  ...
[0m05:45:21.463723 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:45:21.466516 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:45:21.481474 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:45:21.484065 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:45:21.562188 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:45:21.691746 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:45:21.788098 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:45:21.869602 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a3f4f73-43df-4339-a160-ca7df5a39535', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038bec1490>]}
[0m05:45:21.887570 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.47s]
[0m05:45:21.901819 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:45:21.903894 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:45:21.907315 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:45:21.994346 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:45:22.010105 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:45:22.086838 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:45:22.085758 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:45:22.097004 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:45:22.099823 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:45:22.167326 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:45:22.174987 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:45:22.177615 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:45:22.181686 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:45:22.210780 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:45:22.213618 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:45:22.217756 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535`)
      
    ...
[0m05:45:22.221957 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535`)
      
    ...
[0m05:45:22.250107 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:45:22.264468 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:45:22.266026 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:45:22.279965 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:45:22.281729 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:45:22.287616 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535` 
    ...
[0m05:45:22.297714 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:45:22.304317 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535` 
    ...
[0m05:45:22.307288 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:45:22.362209 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:45:22.373245 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535` 
  ...
[0m05:45:22.387794 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_1a3f4f73_43df_4339_a160_ca7df5a39535` 
  ...
[0m05:45:22.393094 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:45:22.401669 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:45:22.408010 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:45:22.469591 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:45:22.475830 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:45:22.478612 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:45:22.485012 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a3f4f73-43df-4339-a160-ca7df5a39535', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038bc5c490>]}
[0m05:45:22.491131 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a3f4f73-43df-4339-a160-ca7df5a39535', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038bdbb700>]}
[0m05:45:22.493664 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.09s]
[0m05:45:22.496117 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.09s]
[0m05:45:22.499228 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:45:22.502172 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:45:22.506551 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:45:22.507722 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:45:22.508856 [debug] [MainThread]: On list__clean: Close
[0m05:45:22.510025 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:45:22.561372 [debug] [MainThread]: On list__mart: Close
[0m05:45:22.562598 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:45:22.563785 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:45:22.564945 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m05:45:22.566114 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m05:45:22.567235 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:45:22.568484 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:45:22.569615 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:45:22.570833 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:45:22.573177 [info ] [MainThread]: 
[0m05:45:22.574622 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.35 seconds (4.35s).
[0m05:45:22.582671 [debug] [MainThread]: Command end result
[0m05:45:22.792299 [info ] [MainThread]: 
[0m05:45:22.793185 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:45:22.793890 [info ] [MainThread]: 
[0m05:45:22.794529 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:45:22.795891 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.2241874, "process_in_blocks": "0", "process_kernel_time": 0.718175, "process_mem_max_rss": "114504", "process_out_blocks": "9744", "process_user_time": 6.253043}
[0m05:45:22.796680 [debug] [MainThread]: Command `dbt build` succeeded at 05:45:22.796461 after 7.23 seconds
[0m05:45:22.797313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038ff12310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038dda3640>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71038ace8ca0>]}
[0m05:45:22.797913 [debug] [MainThread]: Flushing usage events
[0m05:46:16.733379 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e99aff310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e96757ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e96757970>]}


============================== 05:46:16.742829 | 9d81b8e6-3b36-4332-80ee-f4d9d92ad871 ==============================
[0m05:46:16.742829 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:46:16.743922 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'log_cache_events': 'False', 'log_format': 'default', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'quiet': 'False', 'version_check': 'True', 'no_print': 'None', 'empty': 'False', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'static_parser': 'True', 'profiles_dir': '.', 'target_path': 'None', 'introspect': 'True', 'indirect_selection': 'eager', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'printer_width': '80'}
[0m05:46:17.271837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9d81b8e6-3b36-4332-80ee-f4d9d92ad871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e96736160>]}
[0m05:46:17.465269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9d81b8e6-3b36-4332-80ee-f4d9d92ad871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e99d12a00>]}
[0m05:46:17.466627 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:46:17.929497 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:46:18.431563 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:46:18.432236 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:46:18.633648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9d81b8e6-3b36-4332-80ee-f4d9d92ad871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e95ec7f40>]}
[0m05:46:19.074030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9d81b8e6-3b36-4332-80ee-f4d9d92ad871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e95f05400>]}
[0m05:46:19.074958 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:46:19.078156 [info ] [MainThread]: 
[0m05:46:19.079198 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:46:19.131662 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:46:19.133039 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:46:19.154905 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:46:19.159419 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:46:19.706427 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:46:19.728462 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:46:19.730831 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:46:19.742898 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:46:19.828148 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:46:19.830032 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:46:19.846099 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:46:19.851682 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:46:19.860090 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:46:19.868513 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:46:19.930554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9d81b8e6-3b36-4332-80ee-f4d9d92ad871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e966a2ac0>]}
[0m05:46:19.932557 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:46:19.933816 [info ] [MainThread]: 
[0m05:46:19.960928 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:46:19.962488 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:46:19.963985 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:46:19.965066 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:46:20.036648 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:46:20.038317 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:46:20.233176 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:46:20.296987 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:46:20.298339 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:46:20.312212 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:46:20.439381 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:46:20.443291 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:46:20.445371 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:46:20.448562 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:46:20.454375 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:46:20.457238 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:46:20.459167 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:46:20.461985 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:46:20.555436 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:46:20.558798 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:46:20.564476 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d81b8e6-3b36-4332-80ee-f4d9d92ad871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e95242b20>]}
[0m05:46:20.565660 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m05:46:20.566980 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:46:20.568908 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:46:20.570081 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:46:20.571300 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:46:20.572146 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:46:20.573385 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:46:20.575664 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:46:20.577476 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:46:20.628743 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:46:20.630506 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:46:20.632851 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:46:20.634744 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:46:20.657352 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:46:20.743199 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:46:20.752197 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:46:20.766287 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:46:20.769069 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:46:20.837776 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:46:20.860563 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:46:21.049498 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:46:21.069530 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:46:21.071572 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:46:21.072881 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:46:21.074003 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:46:21.128173 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:46:21.330629 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:46:21.338144 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:46:21.343020 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:46:21.351405 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:46:21.365507 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:46:21.373459 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:46:21.429123 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.80s]
[0m05:46:21.440223 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.81s]
[0m05:46:21.443463 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:46:21.435027 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.86s]
[0m05:46:21.447131 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:46:21.450719 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:46:21.454576 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:46:21.455898 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:46:21.458057 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:46:21.459341 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:46:21.461359 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:46:21.464681 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:46:21.466653 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:46:21.468644 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:46:21.470911 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:46:21.472735 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:46:21.474496 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:46:21.527072 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:46:21.629951 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:46:21.651492 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:46:21.645997 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:46:21.654034 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:46:21.656395 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:46:21.673817 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:46:21.828132 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:46:21.856393 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:46:21.965260 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:46:22.073478 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:46:22.243112 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:46:22.351087 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:46:22.438062 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:46:22.532447 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:46:22.571907 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871` 
  ...
[0m05:46:22.635427 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871` 
  ...
[0m05:46:22.642044 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:46:22.644783 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:46:22.649237 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:46:22.651932 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:46:22.738507 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:46:22.834904 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:46:22.857626 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:46:22.870724 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d81b8e6-3b36-4332-80ee-f4d9d92ad871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e94aa58e0>]}
[0m05:46:22.926877 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.40s]
[0m05:46:22.934892 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:46:22.937008 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:46:22.938461 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:46:22.964313 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:46:22.979338 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:46:22.982822 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:46:22.991404 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:46:23.027488 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:46:23.030078 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:46:23.040297 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:46:23.043380 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:46:23.045111 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:46:23.046470 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:46:23.063735 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:46:23.065301 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:46:23.068409 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871`)
      
    ...
[0m05:46:23.070949 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871`)
      
    ...
[0m05:46:23.090829 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:46:23.096174 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:46:23.097701 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:46:23.105204 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:46:23.128503 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871` 
    ...
[0m05:46:23.103831 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:46:23.134477 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:46:23.135811 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:46:23.138389 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871` 
    ...
[0m05:46:23.144231 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871` 
  ...
[0m05:46:23.148309 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:46:23.154438 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:46:23.155692 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:46:23.162233 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_9d81b8e6_3b36_4332_80ee_f4d9d92ad871` 
  ...
[0m05:46:23.163625 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:46:23.167696 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d81b8e6-3b36-4332-80ee-f4d9d92ad871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e94a9d4c0>]}
[0m05:46:23.169000 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:46:23.170118 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.70s]
[0m05:46:23.226992 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:46:23.228638 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:46:23.231594 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:46:23.234788 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9d81b8e6-3b36-4332-80ee-f4d9d92ad871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e95717160>]}
[0m05:46:23.235957 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.77s]
[0m05:46:23.237293 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:46:23.239349 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:46:23.239943 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:46:23.240569 [debug] [MainThread]: On list__clean: Close
[0m05:46:23.241433 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:46:23.242322 [debug] [MainThread]: On list__mart: Close
[0m05:46:23.243202 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:46:23.244035 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:46:23.244587 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m05:46:23.245139 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m05:46:23.245666 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:46:23.246185 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:46:23.246740 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:46:23.247282 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:46:23.248558 [info ] [MainThread]: 
[0m05:46:23.249367 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.17 seconds (4.17s).
[0m05:46:23.253420 [debug] [MainThread]: Command end result
[0m05:46:23.371694 [info ] [MainThread]: 
[0m05:46:23.372519 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:46:23.373190 [info ] [MainThread]: 
[0m05:46:23.373811 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:46:23.375110 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.8996434, "process_in_blocks": "0", "process_kernel_time": 0.660437, "process_mem_max_rss": "114480", "process_out_blocks": "9744", "process_user_time": 6.146232}
[0m05:46:23.426575 [debug] [MainThread]: Command `dbt build` succeeded at 05:46:23.426207 after 6.95 seconds
[0m05:46:23.427351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e99aff310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e95e2f520>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f5e94735c70>]}
[0m05:46:23.427985 [debug] [MainThread]: Flushing usage events
[0m05:47:16.153794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc9d7a0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc9a3feb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc9a3fea00>]}


============================== 05:47:16.163230 | c1d6d411-1d1e-4d97-888e-19601ae4d9ad ==============================
[0m05:47:16.163230 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:47:16.164340 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'fail_fast': 'False', 'introspect': 'True', 'empty': 'False', 'cache_selected_only': 'False', 'printer_width': '80', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'partial_parse': 'True', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_cache_events': 'False', 'no_print': 'None', 'write_json': 'True', 'indirect_selection': 'eager', 'static_parser': 'True', 'profiles_dir': '.', 'log_format': 'default', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m05:47:16.755803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c1d6d411-1d1e-4d97-888e-19601ae4d9ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc9bee35b0>]}
[0m05:47:16.950921 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c1d6d411-1d1e-4d97-888e-19601ae4d9ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc9a86bca0>]}
[0m05:47:16.952205 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:47:17.367244 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:47:17.933153 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:47:17.933800 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:47:18.135033 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c1d6d411-1d1e-4d97-888e-19601ae4d9ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc99b60eb0>]}
[0m05:47:18.578775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c1d6d411-1d1e-4d97-888e-19601ae4d9ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc99a554c0>]}
[0m05:47:18.579672 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:47:18.582805 [info ] [MainThread]: 
[0m05:47:18.583829 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:47:18.632874 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:47:18.639752 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:47:18.732926 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:47:18.743135 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:47:19.274339 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:47:19.279214 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:47:19.282285 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:47:19.291685 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:47:19.336244 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:47:19.347478 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:47:19.349850 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:47:19.353938 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:47:19.360285 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:47:19.368092 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:47:19.373209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1d6d411-1d1e-4d97-888e-19601ae4d9ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc9d6f17c0>]}
[0m05:47:19.374181 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:47:19.374850 [info ] [MainThread]: 
[0m05:47:19.434697 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:47:19.436328 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:47:19.437924 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:47:19.438846 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:47:19.456649 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:47:19.457880 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:47:19.628765 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:47:19.685903 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:47:19.687336 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:47:19.696817 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:47:19.835290 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:47:19.838774 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:47:19.840726 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:47:19.843467 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:47:19.849109 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:47:19.851922 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:47:19.853682 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:47:19.856341 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:47:19.947746 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:47:19.951088 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:47:19.956908 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1d6d411-1d1e-4d97-888e-19601ae4d9ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc9cca8a60>]}
[0m05:47:19.958003 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.52s]
[0m05:47:19.959326 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:47:19.961710 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:47:19.962880 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:47:19.964240 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:47:19.965632 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:47:19.967412 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:47:19.969805 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:47:19.971944 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:47:20.024250 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:47:20.026101 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:47:20.028092 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:47:20.029865 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:47:20.052187 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:47:20.139389 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:47:20.159140 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:47:20.150137 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:47:20.161997 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:47:20.163761 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:47:20.222885 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:47:20.531629 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:47:20.546167 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:47:20.543138 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:47:20.549412 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:47:20.551175 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:47:20.554339 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:47:20.824777 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:47:20.841575 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:47:20.844525 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:47:20.849136 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:47:20.865683 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:47:20.868446 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.84s]
[0m05:47:20.924064 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:47:20.928109 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.90s]
[0m05:47:20.930931 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:47:20.936646 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.97s]
[0m05:47:20.939493 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:47:20.942919 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:47:20.946900 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:47:20.948507 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:47:20.950227 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:47:20.952130 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:47:20.954393 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:47:20.956503 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:47:20.958211 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:47:20.959992 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:47:20.961635 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:47:20.963333 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:47:20.965122 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:47:20.966835 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:47:21.148033 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:47:21.152048 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:47:21.159615 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:47:21.162087 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:47:21.222877 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:47:21.228824 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:47:21.230724 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:47:21.263319 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:47:21.459398 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.10 seconds
[0m05:47:21.538998 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:47:21.639402 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:47:21.648974 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:47:21.739283 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:47:21.863289 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:47:21.964781 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad` 
  ...
[0m05:47:22.024109 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:47:22.050199 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:47:22.048277 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad` 
  ...
[0m05:47:22.055694 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:47:22.154345 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:47:22.167820 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:47:22.335752 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:47:22.441133 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:47:22.456715 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1d6d411-1d1e-4d97-888e-19601ae4d9ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc98f17ee0>]}
[0m05:47:22.469481 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.50s]
[0m05:47:22.533849 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:47:22.536032 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:47:22.540043 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:47:22.577390 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:47:22.593287 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:47:22.660493 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:47:22.662943 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:47:22.673134 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:47:22.725051 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:47:22.738682 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:47:22.744250 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:47:22.747260 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:47:22.751827 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:47:22.782877 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:47:22.787214 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad`)
      
    ...
[0m05:47:22.791490 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:47:22.823879 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:47:22.796384 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad`)
      
    ...
[0m05:47:22.835444 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:47:22.846348 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:47:22.852701 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad` 
    ...
[0m05:47:22.862166 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:47:22.864833 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:47:22.878225 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:47:22.932379 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad` 
  ...
[0m05:47:22.940659 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:47:22.954206 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:47:22.955830 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:47:22.961594 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad` 
    ...
[0m05:47:23.023908 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:47:22.968967 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:47:23.037091 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1d6d411_1d1e_4d97_888e_19601ae4d9ad` 
  ...
[0m05:47:23.044010 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1d6d411-1d1e-4d97-888e-19601ae4d9ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc998e50a0>]}
[0m05:47:23.048669 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.08s]
[0m05:47:23.052582 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:47:23.055493 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:47:23.070270 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:47:23.127785 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:47:23.134149 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1d6d411-1d1e-4d97-888e-19601ae4d9ad', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc98ef9fa0>]}
[0m05:47:23.136443 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.18s]
[0m05:47:23.139370 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:47:23.143299 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:47:23.144431 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:47:23.145619 [debug] [MainThread]: On list__mart: Close
[0m05:47:23.146673 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:47:23.147742 [debug] [MainThread]: On list__clean: Close
[0m05:47:23.148776 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:47:23.149865 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:47:23.150947 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m05:47:23.152054 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m05:47:23.153092 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:47:23.154247 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:47:23.155325 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:47:23.156463 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:47:23.158781 [info ] [MainThread]: 
[0m05:47:23.160159 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.57 seconds (4.57s).
[0m05:47:23.170924 [debug] [MainThread]: Command end result
[0m05:47:23.437431 [info ] [MainThread]: 
[0m05:47:23.439021 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:47:23.440242 [info ] [MainThread]: 
[0m05:47:23.441613 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:47:23.444326 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.4839754, "process_in_blocks": "0", "process_kernel_time": 0.666135, "process_mem_max_rss": "115084", "process_out_blocks": "9744", "process_user_time": 6.39272}
[0m05:47:23.446115 [debug] [MainThread]: Command `dbt build` succeeded at 05:47:23.445626 after 7.49 seconds
[0m05:47:23.447519 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc9d7a0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc9bee35b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73fc9a86bca0>]}
[0m05:47:23.448905 [debug] [MainThread]: Flushing usage events
[0m05:48:16.278603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847ff2c9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847fbf2fbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847fbf2fa60>]}


============================== 05:48:16.287834 | c1aa79eb-feb1-4d41-9aaa-5d40a52a800a ==============================
[0m05:48:16.287834 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:48:16.288890 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'introspect': 'True', 'quiet': 'False', 'static_parser': 'True', 'debug': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'write_json': 'True', 'target_path': 'None', 'empty': 'False', 'partial_parse': 'True', 'log_format': 'default', 'profiles_dir': '.', 'fail_fast': 'False', 'printer_width': '80', 'indirect_selection': 'eager', 'cache_selected_only': 'False', 'no_print': 'None', 'use_colors': 'True', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'warn_error': 'None', 'use_experimental_parser': 'False', 'log_path': '/workdir/transforms/04_btc/logs'}
[0m05:48:16.812383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c1aa79eb-feb1-4d41-9aaa-5d40a52a800a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847fc005160>]}
[0m05:48:17.007713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c1aa79eb-feb1-4d41-9aaa-5d40a52a800a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847fbef93a0>]}
[0m05:48:17.009005 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:48:17.479726 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:48:17.988659 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:48:17.989379 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:48:18.190631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c1aa79eb-feb1-4d41-9aaa-5d40a52a800a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847fb682e80>]}
[0m05:48:18.670498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c1aa79eb-feb1-4d41-9aaa-5d40a52a800a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847fb698550>]}
[0m05:48:18.671407 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:48:18.674643 [info ] [MainThread]: 
[0m05:48:18.675633 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:48:18.687461 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:48:18.699576 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:48:18.787171 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:48:18.795201 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:48:19.573392 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:48:19.580772 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:48:19.582996 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:48:19.588059 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:19.613369 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:48:19.666453 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:48:19.684080 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:48:19.686719 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:48:19.699324 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:48:19.701292 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:48:19.714368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1aa79eb-feb1-4d41-9aaa-5d40a52a800a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847fb1d0280>]}
[0m05:48:19.715341 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:48:19.716134 [info ] [MainThread]: 
[0m05:48:19.785789 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:48:19.786952 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:48:19.788073 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:48:19.788834 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:48:19.806219 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:48:19.807585 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:48:20.006617 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:48:20.124148 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:48:20.125729 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:48:20.138501 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:48:20.274717 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:48:20.278954 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:20.280923 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:48:20.283822 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:20.289410 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:48:20.292300 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:20.294160 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:48:20.296925 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:20.390693 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:48:20.394216 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:20.400173 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1aa79eb-feb1-4d41-9aaa-5d40a52a800a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847faa09640>]}
[0m05:48:20.401299 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.61s]
[0m05:48:20.402634 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:48:20.404828 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:48:20.406182 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:48:20.407942 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:48:20.409522 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:48:20.411428 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:48:20.413383 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:48:20.465812 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:48:20.468233 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:48:20.470331 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:48:20.472108 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:48:20.473970 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:48:20.475697 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:48:20.690750 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:48:20.698055 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:48:20.702555 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:48:20.704808 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:48:20.707396 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:48:20.776935 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:48:21.094782 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:48:21.096473 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:48:21.099179 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:48:21.102248 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:48:21.104338 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:48:21.108656 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:48:21.408310 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:48:21.422344 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:48:21.429492 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:48:21.467495 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:48:21.476734 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:48:21.484703 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 1.07s]
[0m05:48:21.491366 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 1.02s]
[0m05:48:21.497053 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:48:21.501293 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:48:21.507742 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:48:21.513375 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 1.05s]
[0m05:48:21.516133 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:48:21.523709 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:48:21.566579 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:48:21.568719 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:48:21.524878 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:48:21.570854 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:48:21.572790 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:48:21.574974 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:48:21.576733 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:48:21.578429 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:48:21.580096 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:48:21.581697 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:48:21.604117 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:48:21.673343 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:48:21.681994 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:48:21.692364 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:48:21.694523 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:48:21.695775 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:48:21.707869 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:48:21.792483 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:48:21.877153 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:48:21.997000 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:48:22.096961 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:48:22.200981 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:48:22.289549 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:48:22.282892 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a` 
  ...
[0m05:48:22.295191 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a` 
  ...
[0m05:48:22.298631 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:22.301448 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:22.302799 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:22.308615 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:48:22.487016 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:48:22.508384 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:48:22.565886 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:48:22.567161 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:48:22.572992 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:22.581395 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:48:22.584411 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:22.587106 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1aa79eb-feb1-4d41-9aaa-5d40a52a800a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847fb23cdf0>]}
[0m05:48:22.588353 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.01s]
[0m05:48:22.589705 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:48:22.591342 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:48:22.606842 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:48:22.610908 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:48:22.615486 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:48:22.671340 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:22.672856 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:22.679221 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:48:22.682148 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:48:22.683694 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:48:22.684707 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:48:22.700427 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:48:22.701653 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:48:22.703750 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a`)
      
    ...
[0m05:48:22.705750 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a`)
      
    ...
[0m05:48:22.724488 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:48:22.731242 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:48:22.733114 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:48:22.766722 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:48:22.742530 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:48:22.770560 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a` 
    ...
[0m05:48:22.776380 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:48:22.781259 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a` 
    ...
[0m05:48:22.782886 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:48:22.792020 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a` 
  ...
[0m05:48:22.793808 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:48:22.804942 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c1aa79eb_feb1_4d41_9aaa_5d40a52a800a` 
  ...
[0m05:48:22.806978 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:48:22.814775 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:48:22.816477 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:48:22.878816 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:48:22.882207 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:48:22.889952 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:48:22.894091 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1aa79eb-feb1-4d41-9aaa-5d40a52a800a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847faee50a0>]}
[0m05:48:22.888269 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c1aa79eb-feb1-4d41-9aaa-5d40a52a800a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847fb258880>]}
[0m05:48:22.896647 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.31s]
[0m05:48:22.898762 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.32s]
[0m05:48:22.901176 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:48:22.903920 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:48:22.908794 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:48:22.910016 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:48:22.911278 [debug] [MainThread]: On list__clean: Close
[0m05:48:22.912435 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:48:22.913630 [debug] [MainThread]: On list__mart: Close
[0m05:48:22.914775 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:48:22.966209 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:48:22.967254 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:48:22.968237 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:48:22.969043 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:48:22.970170 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:48:22.971303 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:48:22.972448 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:48:22.974960 [info ] [MainThread]: 
[0m05:48:22.976450 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.30 seconds (4.30s).
[0m05:48:22.984619 [debug] [MainThread]: Command end result
[0m05:48:23.205812 [info ] [MainThread]: 
[0m05:48:23.207251 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:48:23.208367 [info ] [MainThread]: 
[0m05:48:23.209593 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:48:23.211734 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.1301994, "process_in_blocks": "0", "process_kernel_time": 0.717489, "process_mem_max_rss": "114868", "process_out_blocks": "9744", "process_user_time": 6.454402}
[0m05:48:23.212947 [debug] [MainThread]: Command `dbt build` succeeded at 05:48:23.212633 after 7.13 seconds
[0m05:48:23.214035 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847ff2c9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847fd1daf70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7847fb67b400>]}
[0m05:48:23.215025 [debug] [MainThread]: Flushing usage events
[0m05:49:15.929941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c601e49b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c601b105b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c601b105a30>]}


============================== 05:49:15.939290 | d8ff93eb-f1dd-4ee7-b0ca-cf14a869de90 ==============================
[0m05:49:15.939290 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:49:15.940378 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'printer_width': '80', 'no_print': 'None', 'introspect': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'debug': 'False', 'empty': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'fail_fast': 'False', 'partial_parse': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'write_json': 'True', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_cache_events': 'False', 'warn_error': 'None', 'profiles_dir': '.', 'target_path': 'None', 'static_parser': 'True', 'version_check': 'True', 'send_anonymous_usage_stats': 'True'}
[0m05:49:16.526747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd8ff93eb-f1dd-4ee7-b0ca-cf14a869de90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c601b0b3760>]}
[0m05:49:16.722306 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd8ff93eb-f1dd-4ee7-b0ca-cf14a869de90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c601bbe2fd0>]}
[0m05:49:16.723654 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:49:17.134636 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:49:17.639653 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:49:17.640309 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:49:17.840544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd8ff93eb-f1dd-4ee7-b0ca-cf14a869de90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c601a858e80>]}
[0m05:49:18.348908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd8ff93eb-f1dd-4ee7-b0ca-cf14a869de90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c601a8418b0>]}
[0m05:49:18.349816 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:49:18.353189 [info ] [MainThread]: 
[0m05:49:18.354271 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:49:18.366000 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:49:18.367081 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:49:18.443292 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:49:18.444082 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:49:18.959631 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:49:18.967433 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:49:18.969364 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:49:18.975458 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:49:19.027489 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:49:19.029163 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:49:19.044353 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:49:19.049789 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:49:19.108624 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:49:19.058503 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:49:19.133012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8ff93eb-f1dd-4ee7-b0ca-cf14a869de90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c601b059670>]}
[0m05:49:19.134925 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:49:19.136332 [info ] [MainThread]: 
[0m05:49:19.214008 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:49:19.215671 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:49:19.217192 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:49:19.218276 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:49:19.238869 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:49:19.240052 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:49:19.431771 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:49:19.498496 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:49:19.499950 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:49:19.517461 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:49:19.639169 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:49:19.642887 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:49:19.644843 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:49:19.648214 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:49:19.654307 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:49:19.657562 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:49:19.708179 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:49:19.711739 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:49:19.758303 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:49:19.810169 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:49:19.816153 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8ff93eb-f1dd-4ee7-b0ca-cf14a869de90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6019bc7670>]}
[0m05:49:19.817431 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.60s]
[0m05:49:19.819002 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:49:19.821209 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:49:19.822516 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:49:19.824062 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:49:19.825580 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:49:19.827343 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:49:19.829161 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:49:19.831416 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:49:19.833490 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:49:19.835431 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:49:19.837191 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:49:19.838864 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:49:19.840358 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:49:20.047293 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:49:20.048391 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:49:20.050955 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:49:20.052466 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:49:20.053223 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:49:20.118050 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:49:20.319074 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:49:20.326151 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:49:20.344373 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:49:20.346443 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:49:20.347940 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:49:20.349953 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:49:20.623423 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:49:20.633732 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:49:20.639958 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:49:20.648243 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:49:20.713681 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:49:20.716617 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:49:20.721992 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.89s]
[0m05:49:20.727611 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.89s]
[0m05:49:20.734091 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.90s]
[0m05:49:20.737216 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:49:20.740047 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:49:20.742935 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:49:20.746630 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:49:20.747711 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:49:20.749363 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:49:20.751356 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:49:20.753600 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:49:20.808390 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:49:20.810385 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:49:20.812021 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:49:20.813725 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:49:20.815325 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:49:20.816984 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:49:20.818712 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:49:20.936569 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:49:20.941062 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:49:20.949745 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:49:20.953104 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:49:21.007509 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:49:21.014853 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:49:21.133197 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:49:21.223419 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:49:21.339221 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:49:21.430460 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:49:21.630374 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.09 seconds
[0m05:49:21.715954 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:49:21.837977 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:49:21.920424 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90` 
  ...
[0m05:49:21.935651 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90` 
  ...
[0m05:49:21.944163 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:49:21.949494 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:49:21.953891 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:49:22.013864 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m05:49:22.048620 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:49:22.135859 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:49:22.255300 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:49:22.352473 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:49:22.425309 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:49:22.427037 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:49:22.421367 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8ff93eb-f1dd-4ee7-b0ca-cf14a869de90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c601948b700>]}
[0m05:49:22.434618 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 1.61s]
[0m05:49:22.439620 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:49:22.466717 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m05:49:22.508955 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.08 seconds
[0m05:49:22.531173 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:49:22.532290 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:49:22.541119 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:49:22.543759 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:49:22.557664 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:49:22.610955 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:49:22.614398 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:49:22.617343 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:49:22.651686 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:49:22.654051 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:49:22.657833 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90`)
      
    ...
[0m05:49:22.661380 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90`)
      
    ...
[0m05:49:22.691899 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:49:22.694932 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:49:22.708404 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:49:22.718814 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:49:22.728025 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:49:22.735935 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:49:22.734046 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90` 
    ...
[0m05:49:22.742654 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90` 
    ...
[0m05:49:22.753258 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:49:22.761218 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:49:22.814434 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90` 
  ...
[0m05:49:22.827031 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_d8ff93eb_f1dd_4ee7_b0ca_cf14a869de90` 
  ...
[0m05:49:22.833201 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:49:22.841388 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:49:22.853905 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:49:22.913718 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:49:22.918341 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:49:22.924831 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8ff93eb-f1dd-4ee7-b0ca-cf14a869de90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c601aebeaf0>]}
[0m05:49:22.927205 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 2.11s]
[0m05:49:22.929937 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:49:22.932780 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:49:22.941264 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd8ff93eb-f1dd-4ee7-b0ca-cf14a869de90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c6019451dc0>]}
[0m05:49:22.944192 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 2.13s]
[0m05:49:22.947275 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:49:22.951119 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:49:22.952259 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:49:22.953424 [debug] [MainThread]: On list__mart: Close
[0m05:49:23.008297 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:49:23.009427 [debug] [MainThread]: On list__clean: Close
[0m05:49:23.010496 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:49:23.011703 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:49:23.012774 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m05:49:23.013866 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m05:49:23.014948 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:49:23.016194 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:49:23.017255 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:49:23.018378 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:49:23.020766 [info ] [MainThread]: 
[0m05:49:23.022221 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 4.67 seconds (4.67s).
[0m05:49:23.030428 [debug] [MainThread]: Command end result
[0m05:49:23.209801 [info ] [MainThread]: 
[0m05:49:23.210677 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:49:23.211291 [info ] [MainThread]: 
[0m05:49:23.211981 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:49:23.213252 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 7.477424, "process_in_blocks": "0", "process_kernel_time": 0.696983, "process_mem_max_rss": "114644", "process_out_blocks": "9744", "process_user_time": 6.448846}
[0m05:49:23.213998 [debug] [MainThread]: Command `dbt build` succeeded at 05:49:23.213805 after 7.48 seconds
[0m05:49:23.214613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c601e49b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c601b1dbf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7c601ba02760>]}
[0m05:49:23.215184 [debug] [MainThread]: Flushing usage events
[0m05:50:15.730634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa680761310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa67d3cbaf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa67d3cb9a0>]}


============================== 05:50:15.739807 | 84213d24-3e04-4b89-8727-93690468d4e8 ==============================
[0m05:50:15.739807 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:50:15.740872 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'debug': 'False', 'log_format': 'default', 'printer_width': '80', 'empty': 'False', 'version_check': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error': 'None', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'partial_parse': 'True', 'use_colors': 'True', 'write_json': 'True', 'fail_fast': 'False', 'no_print': 'None', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'quiet': 'False', 'profiles_dir': '.', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'log_path': '/workdir/transforms/04_btc/logs'}
[0m05:50:16.319953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '84213d24-3e04-4b89-8727-93690468d4e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa67fcfe3a0>]}
[0m05:50:16.511577 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '84213d24-3e04-4b89-8727-93690468d4e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa67d42c3a0>]}
[0m05:50:16.512870 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:50:16.923786 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:50:17.426482 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m05:50:17.427140 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m05:50:17.636561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '84213d24-3e04-4b89-8727-93690468d4e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa67cb1eee0>]}
[0m05:50:18.115623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '84213d24-3e04-4b89-8727-93690468d4e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa67cb08c70>]}
[0m05:50:18.116488 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m05:50:18.119671 [info ] [MainThread]: 
[0m05:50:18.120692 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m05:50:18.132516 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:50:18.134390 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m05:50:18.228831 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:50:18.243056 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m05:50:18.877852 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:50:18.907677 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:50:18.930488 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m05:50:18.938782 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:50:19.024968 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m05:50:19.026563 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m05:50:19.047368 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m05:50:19.105635 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m05:50:19.115239 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:50:19.124805 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:50:19.138441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84213d24-3e04-4b89-8727-93690468d4e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa67d2be370>]}
[0m05:50:19.140324 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m05:50:19.141586 [info ] [MainThread]: 
[0m05:50:19.216567 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m05:50:19.217778 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m05:50:19.219027 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m05:50:19.219865 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m05:50:19.237708 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:50:19.238912 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m05:50:19.423298 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m05:50:19.486802 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m05:50:19.488180 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:50:19.498391 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:50:19.635846 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:50:19.639560 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:50:19.641418 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m05:50:19.644272 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:50:19.650399 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m05:50:19.653479 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:50:19.703180 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m05:50:19.706558 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:50:19.752908 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m05:50:19.805898 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:50:19.812135 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84213d24-3e04-4b89-8727-93690468d4e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa67fcf67f0>]}
[0m05:50:19.813406 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.59s]
[0m05:50:19.814809 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m05:50:19.817182 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:50:19.818381 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m05:50:19.819579 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:50:19.820986 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:50:19.822896 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m05:50:19.824085 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m05:50:19.825892 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m05:50:19.827307 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:50:19.828547 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m05:50:19.830687 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m05:50:19.903941 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:50:19.917229 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:50:19.919028 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:50:19.933693 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:50:19.949716 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:50:19.951509 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:50:20.003376 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:50:20.005187 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:50:20.337442 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m05:50:20.342262 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m05:50:20.347686 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m05:50:20.350275 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m05:50:20.352284 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m05:50:20.404045 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m05:50:20.546445 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m05:50:20.564896 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:50:20.617587 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m05:50:20.614611 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.79s]
[0m05:50:20.625158 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m05:50:20.627964 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m05:50:20.634291 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:50:20.640748 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.81s]
[0m05:50:20.644000 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:50:20.646645 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m05:50:20.705255 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.88s]
[0m05:50:20.708229 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m05:50:20.709898 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:50:20.711089 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:50:20.712254 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m05:50:20.713490 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:50:20.715408 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m05:50:20.716939 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m05:50:20.719010 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m05:50:20.720445 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m05:50:20.721886 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:50:20.723495 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m05:50:20.725185 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:50:20.742524 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m05:50:20.831947 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:50:20.839806 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:50:20.906432 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:50:20.909293 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:50:20.916051 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:50:20.938573 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m05:50:21.046153 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m05:50:21.246420 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m05:50:21.330132 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:50:21.340164 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8` 
  ...
[0m05:50:21.407504 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:50:21.419305 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8` 
  ...
[0m05:50:21.420906 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:50:21.423737 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:50:21.430250 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:50:21.508587 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m05:50:21.536016 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m05:50:21.536980 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m05:50:21.540987 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:50:21.547615 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:50:21.550470 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:50:21.552484 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m05:50:21.603005 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:50:21.604775 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m05:50:21.605865 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.07 seconds
[0m05:50:21.621968 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:50:21.628850 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m05:50:21.634004 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:50:21.638790 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:50:21.640923 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:50:21.643883 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84213d24-3e04-4b89-8727-93690468d4e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa67b7233d0>]}
[0m05:50:21.645340 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:50:21.705135 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m05:50:21.706611 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.92s]
[0m05:50:21.710960 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m05:50:21.712876 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m05:50:21.714103 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m05:50:21.716552 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m05:50:21.734128 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:50:21.735241 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:50:21.737154 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8`)
      
    ...
[0m05:50:21.739057 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8`)
      
    ...
[0m05:50:21.759908 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m05:50:21.767955 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:50:21.769752 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:50:21.777462 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m05:50:21.779030 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:50:21.783470 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8` 
    ...
[0m05:50:21.805148 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m05:50:21.811522 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8` 
    ...
[0m05:50:21.813055 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:50:21.820111 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8` 
  ...
[0m05:50:21.823558 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m05:50:21.824915 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:50:21.830817 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_84213d24_3e04_4b89_8727_93690468d4e8` 
  ...
[0m05:50:21.837201 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m05:50:21.840836 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:50:21.842159 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:50:21.848661 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m05:50:21.904376 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84213d24-3e04-4b89-8727-93690468d4e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa6809560d0>]}
[0m05:50:21.907888 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 1.19s]
[0m05:50:21.910235 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m05:50:21.912563 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m05:50:21.918764 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84213d24-3e04-4b89-8727-93690468d4e8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa67b723fa0>]}
[0m05:50:21.921209 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 1.20s]
[0m05:50:21.923706 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m05:50:21.926261 [debug] [MainThread]: Connection 'master' was properly closed.
[0m05:50:21.926887 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m05:50:21.927419 [debug] [MainThread]: On list__mart: Close
[0m05:50:21.927914 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m05:50:21.928406 [debug] [MainThread]: On list__clean: Close
[0m05:50:21.928887 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m05:50:21.929388 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m05:50:21.929869 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m05:50:21.930380 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m05:50:21.930875 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m05:50:21.931376 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m05:50:21.931884 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m05:50:21.932402 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m05:50:21.933571 [info ] [MainThread]: 
[0m05:50:21.934252 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 3.81 seconds (3.81s).
[0m05:50:21.938114 [debug] [MainThread]: Command end result
[0m05:50:22.131665 [info ] [MainThread]: 
[0m05:50:22.133193 [info ] [MainThread]: [32mCompleted successfully[0m
[0m05:50:22.134354 [info ] [MainThread]: 
[0m05:50:22.135652 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m05:50:22.138064 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 6.602676, "process_in_blocks": "0", "process_kernel_time": 0.694921, "process_mem_max_rss": "114376", "process_out_blocks": "9744", "process_user_time": 5.914774}
[0m05:50:22.139395 [debug] [MainThread]: Command `dbt build` succeeded at 05:50:22.139040 after 6.60 seconds
[0m05:50:22.140483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa680761310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa67e6eb850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7fa67e6e8d00>]}
[0m05:50:22.141519 [debug] [MainThread]: Flushing usage events
[0m05:59:17.147402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79245cd08310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79245996fb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79245996f9d0>]}


============================== 05:59:17.156810 | b9ec2ba7-126e-4b55-9299-dd3778d8bb1b ==============================
[0m05:59:17.156810 [info ] [MainThread]: Running with dbt=1.8.9
[0m05:59:17.157879 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'log_cache_events': 'False', 'partial_parse': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'static_parser': 'True', 'debug': 'False', 'warn_error': 'None', 'target_path': 'None', 'log_path': '/workdir/transforms/05_poke/logs', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'introspect': 'True', 'profiles_dir': '.', 'log_format': 'default', 'quiet': 'False', 'version_check': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'empty': 'False'}
[0m05:59:17.747496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b9ec2ba7-126e-4b55-9299-dd3778d8bb1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79245c2affd0>]}
[0m05:59:17.950076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b9ec2ba7-126e-4b55-9299-dd3778d8bb1b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7924598ab160>]}
[0m05:59:17.951406 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m05:59:18.373572 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m05:59:18.929274 [debug] [MainThread]: Partial parsing enabled: 4 files deleted, 2 files added, 1 files changed.
[0m05:59:18.930219 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/clean/stg_pokemon.sql
[0m05:59:18.930811 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/vw_poke_type_stats.sql
[0m05:59:18.931582 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m05:59:18.932073 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/mart_btc__daily_ohlc.sql
[0m05:59:18.932658 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/clean/stg_btc__market_price.sql
[0m05:59:18.933139 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/vw_btc__latest_24h.sql
[0m05:59:18.933643 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/mart_btc__market_price_hourly.sql
[0m05:59:19.954464 [warn ] [MainThread]: [[33mWARNING[0m]: Deprecated functionality
The `tests` config has been renamed to `data_tests`. Please see
https://docs.getdbt.com/docs/build/data-tests#new-data_tests-syntax for more
information.
[0m05:59:19.955507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'b9ec2ba7-126e-4b55-9299-dd3778d8bb1b', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x792459023820>]}
[0m05:59:20.032334 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'stg_btc__market_price' in the 'models' section of file 'models/clean/btc_schema.yml'
[0m05:59:20.348824 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.ex_03_meteo.stg_pokemon' (models/clean/stg_pokemon.sql) depends on a source named 'pokemon.gen1' which was not found
[0m05:59:20.350477 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 3.398568, "process_in_blocks": "40", "process_kernel_time": 0.546906, "process_mem_max_rss": "104472", "process_out_blocks": "6616", "process_user_time": 4.548906}
[0m05:59:20.351281 [debug] [MainThread]: Command `dbt build` failed at 05:59:20.351075 after 3.40 seconds
[0m05:59:20.351975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79245cd08310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x792458ceb040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x792458c8cf70>]}
[0m05:59:20.352654 [debug] [MainThread]: Flushing usage events
[0m06:01:24.335368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f14b5c5310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f1482304c0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f148230610>]}


============================== 06:01:24.358916 | ce0c7b18-a317-44b2-a7cb-3da0205a7aca ==============================
[0m06:01:24.358916 [info ] [MainThread]: Running with dbt=1.8.9
[0m06:01:24.398140 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'use_colors': 'True', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'log_path': '/workdir/transforms/05_poke/logs', 'partial_parse': 'True', 'static_parser': 'True', 'no_print': 'None', 'log_format': 'default', 'fail_fast': 'False', 'introspect': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error': 'None', 'write_json': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'quiet': 'False', 'debug': 'False', 'printer_width': '80', 'version_check': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])'}
[0m06:01:25.002216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ce0c7b18-a317-44b2-a7cb-3da0205a7aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f14808dca0>]}
[0m06:01:25.198514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ce0c7b18-a317-44b2-a7cb-3da0205a7aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f14865df70>]}
[0m06:01:25.199896 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m06:01:25.616047 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m06:01:26.120459 [debug] [MainThread]: Partial parsing enabled: 5 files deleted, 2 files added, 1 files changed.
[0m06:01:26.121407 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/mart/vw_poke_type_stats.sql
[0m06:01:26.122011 [debug] [MainThread]: Partial parsing: added file: ex_03_meteo://models/clean/stg_pokemon.sql
[0m06:01:26.122749 [debug] [MainThread]: Partial parsing: updated file: ex_03_meteo://models/sources.yml
[0m06:01:26.123360 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/mart_btc__daily_ohlc.sql
[0m06:01:26.123863 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/clean/stg_btc__market_price.sql
[0m06:01:26.124357 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/vw_btc__latest_24h.sql
[0m06:01:26.124863 [debug] [MainThread]: Partial parsing: deleted file: ex_03_meteo://models/mart/mart_btc__market_price_hourly.sql
[0m06:01:27.335930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ce0c7b18-a317-44b2-a7cb-3da0205a7aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f147315eb0>]}
[0m06:01:28.364117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ce0c7b18-a317-44b2-a7cb-3da0205a7aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f1472b1430>]}
[0m06:01:28.365035 [info ] [MainThread]: Found 2 models, 3 sources, 471 macros
[0m06:01:28.367882 [info ] [MainThread]: 
[0m06:01:28.368961 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m06:01:28.380906 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m06:01:28.382588 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m06:01:28.423186 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:01:28.431683 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:01:29.303303 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m06:01:29.311109 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m06:01:29.313448 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m06:01:29.323484 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m06:01:29.420241 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m06:01:29.432019 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m06:01:29.436999 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m06:01:29.442613 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m06:01:29.504344 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m06:01:29.506543 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m06:01:29.529794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ce0c7b18-a317-44b2-a7cb-3da0205a7aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f147227640>]}
[0m06:01:29.531566 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m06:01:29.532867 [info ] [MainThread]: 
[0m06:01:29.605775 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_pokemon
[0m06:01:29.607092 [info ] [Thread-1  ]: 1 of 2 START sql view model `clean`.`stg_pokemon` .............................. [RUN]
[0m06:01:29.608131 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__clean, now model.ex_03_meteo.stg_pokemon)
[0m06:01:29.608894 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_pokemon
[0m06:01:29.626781 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_pokemon"
[0m06:01:29.627861 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_pokemon
[0m06:01:29.722963 [debug] [Thread-1  ]: Creating new relation stg_pokemon
[0m06:01:29.743659 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_pokemon"
[0m06:01:29.744900 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_pokemon: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_pokemon"} */


  create view `clean`.`stg_pokemon` 
  
    
    
  as (
    

with base as (
  select
    toInt32(id)              as pokemon_id,
    lowerUTF8(name)          as pokemon_name,
    toInt32(height)          as height_dm,
    toInt32(weight)          as weight_hg,
    base_stats_json,
    types,
    sprite_url
  from `raw`.`pokemon___gen1`
)
select
  pokemon_id,
  pokemon_name,
  (height_dm * 0.1)          as height_m,
  (weight_hg * 0.1)          as weight_kg,

  JSONExtractInt(base_stats_json, 'hp')               as hp,
  JSONExtractInt(base_stats_json, 'attack')           as attack,
  JSONExtractInt(base_stats_json, 'defense')          as defense,
  JSONExtractInt(base_stats_json, 'special-attack')   as special_attack,
  JSONExtractInt(base_stats_json, 'special-defense')  as special_defense,
  JSONExtractInt(base_stats_json, 'speed')            as speed,

  arrayJoin(types)            as type,     -- ← explode to one type per row
  sprite_url
from base
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m06:01:29.797911 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_pokemon"} */


  create view `clean`.`stg_pokemon` 
  
    
    
  as (
    

with base as (
  select
    toInt32(id)              as pokemon_id,
    lowerUTF8(name)          as pokemon_name,
    toInt32(height)          as height_dm,
    toInt32(weight)          as weight_hg,
    base_stats_json,
    types,
    sprite_url
  from `raw`.`pokemon___gen1`
)
select
  pokemon_id,
  pokemon_name,
  (height_dm * 0.1)          as height_m,
  (weight_hg * 0.1)          as weight_kg,

  JSONExtractInt(base_stats_json, 'hp')               as hp,
  JSONExtractInt(base_stats_json, 'attack')           as attack,
  JSONExtractInt(base_stats_json, 'defense')          as defense,
  JSONExtractInt(base_stats_json, 'special-attack')   as special_attack,
  JSONExtractInt(base_stats_json, 'special-defense')  as special_defense,
  JSONExtractInt(base_stats_json, 'speed')            as speed,

  arrayJoin(types)            as type,     -- ← explode to one type per row
  sprite_url
from base
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m06:01:29.807201 [debug] [Thread-1  ]: Database Error in model stg_pokemon (models/clean/stg_pokemon.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 47
   Code: 47. DB::Exception: Missing columns: 'types' while processing query: 'SELECT toInt32(id) AS pokemon_id, lowerUTF8(name) AS pokemon_name, toInt32(height) AS height_dm, toInt32(weight) AS weight_hg, base_stats_json, types, sprite_url FROM raw.pokemon___gen1', required columns: 'sprite_url' 'id' 'name' 'base_stats_json' 'types' 'height' 'weight', maybe you meant: 'sprite_url', 'id', 'name', 'base_stats_json', 'height' or 'weight'. (UNKNOWN_IDENTIFIER) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_pokemon.sql
[0m06:01:29.809666 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ce0c7b18-a317-44b2-a7cb-3da0205a7aca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f1481eab80>]}
[0m06:01:29.810812 [error] [Thread-1  ]: 1 of 2 ERROR creating sql view model `clean`.`stg_pokemon` ..................... [[31mERROR[0m in 0.20s]
[0m06:01:29.812143 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_pokemon
[0m06:01:29.814584 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_poke_type_stats
[0m06:01:29.816313 [info ] [Thread-3  ]: 2 of 2 SKIP relation mart.vw_poke_type_stats ................................... [[33mSKIP[0m]
[0m06:01:29.818290 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_poke_type_stats
[0m06:01:29.821202 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:01:29.822028 [debug] [MainThread]: Connection 'model.ex_03_meteo.stg_pokemon' was left open.
[0m06:01:29.822845 [debug] [MainThread]: On model.ex_03_meteo.stg_pokemon: Close
[0m06:01:29.823558 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m06:01:29.824407 [debug] [MainThread]: On list__mart: Close
[0m06:01:29.825676 [info ] [MainThread]: 
[0m06:01:29.826635 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.46 seconds (1.46s).
[0m06:01:29.829741 [debug] [MainThread]: Command end result
[0m06:01:30.049555 [info ] [MainThread]: 
[0m06:01:30.050409 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m06:01:30.051119 [info ] [MainThread]: 
[0m06:01:30.052042 [error] [MainThread]:   Database Error in model stg_pokemon (models/clean/stg_pokemon.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 47
   Code: 47. DB::Exception: Missing columns: 'types' while processing query: 'SELECT toInt32(id) AS pokemon_id, lowerUTF8(name) AS pokemon_name, toInt32(height) AS height_dm, toInt32(weight) AS weight_hg, base_stats_json, types, sprite_url FROM raw.pokemon___gen1', required columns: 'sprite_url' 'id' 'name' 'base_stats_json' 'types' 'height' 'weight', maybe you meant: 'sprite_url', 'id', 'name', 'base_stats_json', 'height' or 'weight'. (UNKNOWN_IDENTIFIER) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_03_meteo/models/clean/stg_pokemon.sql
[0m06:01:30.052822 [info ] [MainThread]: 
[0m06:01:30.053546 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=1 TOTAL=2
[0m06:01:30.054994 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 5.9224916, "process_in_blocks": "376", "process_kernel_time": 0.662756, "process_mem_max_rss": "114804", "process_out_blocks": "10472", "process_user_time": 5.478593}
[0m06:01:30.055951 [debug] [MainThread]: Command `dbt build` failed at 06:01:30.055736 after 5.92 seconds
[0m06:01:30.056693 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f14b5c5310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f14718f880>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77f1470915e0>]}
[0m06:01:30.057477 [debug] [MainThread]: Flushing usage events
[0m06:02:21.594315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce55c73fd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce5593a4be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce5593a4a90>]}


============================== 06:02:21.603461 | 7d91faa5-2f19-4151-956f-aad315e2851c ==============================
[0m06:02:21.603461 [info ] [MainThread]: Running with dbt=1.8.9
[0m06:02:21.604695 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'static_parser': 'True', 'quiet': 'False', 'empty': 'False', 'target_path': 'None', 'use_colors': 'True', 'warn_error': 'None', 'version_check': 'True', 'printer_width': '80', 'debug': 'False', 'no_print': 'None', 'partial_parse': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'log_path': '/workdir/transforms/05_poke/logs', 'fail_fast': 'False', 'cache_selected_only': 'False', 'log_format': 'default', 'introspect': 'True', 'log_cache_events': 'False', 'write_json': 'True', 'profiles_dir': '.', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local'}
[0m06:02:22.199444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7d91faa5-2f19-4151-956f-aad315e2851c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce55c961a60>]}
[0m06:02:22.397332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7d91faa5-2f19-4151-956f-aad315e2851c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce559806760>]}
[0m06:02:22.398858 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m06:02:22.880645 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m06:02:23.285724 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m06:02:23.286667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '7d91faa5-2f19-4151-956f-aad315e2851c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce55a65c7f0>]}
[0m06:02:28.019755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7d91faa5-2f19-4151-956f-aad315e2851c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce558637130>]}
[0m06:02:28.822389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7d91faa5-2f19-4151-956f-aad315e2851c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce558547e20>]}
[0m06:02:28.823410 [info ] [MainThread]: Found 2 models, 3 sources, 471 macros
[0m06:02:28.826469 [info ] [MainThread]: 
[0m06:02:28.827541 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m06:02:28.841357 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m06:02:28.843273 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m06:02:28.869549 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:02:28.877906 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:02:29.408443 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m06:02:29.413455 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m06:02:29.437724 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m06:02:29.477302 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m06:02:29.507763 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m06:02:29.509577 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m06:02:29.525572 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m06:02:29.580528 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m06:02:29.591522 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m06:02:29.602332 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m06:02:29.617090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d91faa5-2f19-4151-956f-aad315e2851c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce558129a60>]}
[0m06:02:29.618939 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m06:02:29.620323 [info ] [MainThread]: 
[0m06:02:29.695434 [debug] [Thread-1  ]: Began running node model.ex_05_poke.stg_pokemon
[0m06:02:29.696598 [info ] [Thread-1  ]: 1 of 2 START sql view model `clean`.`stg_pokemon` .............................. [RUN]
[0m06:02:29.697747 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_05_poke.stg_pokemon'
[0m06:02:29.698475 [debug] [Thread-1  ]: Began compiling node model.ex_05_poke.stg_pokemon
[0m06:02:29.716250 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_05_poke.stg_pokemon"
[0m06:02:29.717854 [debug] [Thread-1  ]: Began executing node model.ex_05_poke.stg_pokemon
[0m06:02:29.808342 [debug] [Thread-1  ]: Creating new relation stg_pokemon
[0m06:02:29.876187 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m06:02:29.933405 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_05_poke.stg_pokemon"
[0m06:02:29.935031 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_05_poke.stg_pokemon: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_05_poke.stg_pokemon"} */


  create view `clean`.`stg_pokemon` 
  
    
    
  as (
    

with base as (
  select
    toInt32(id)              as pokemon_id,
    lowerUTF8(name)          as pokemon_name,
    toInt32(height)          as height_dm,
    toInt32(weight)          as weight_hg,
    base_stats_json,
    types,
    sprite_url
  from `raw`.`pokemon___gen1`
)
select
  pokemon_id,
  pokemon_name,
  (height_dm * 0.1)          as height_m,
  (weight_hg * 0.1)          as weight_kg,

  JSONExtractInt(base_stats_json, 'hp')               as hp,
  JSONExtractInt(base_stats_json, 'attack')           as attack,
  JSONExtractInt(base_stats_json, 'defense')          as defense,
  JSONExtractInt(base_stats_json, 'special-attack')   as special_attack,
  JSONExtractInt(base_stats_json, 'special-defense')  as special_defense,
  JSONExtractInt(base_stats_json, 'speed')            as speed,

  arrayJoin(types)            as type,     -- ← explode to one type per row
  sprite_url
from base
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m06:02:29.939610 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_05_poke.stg_pokemon"} */


  create view `clean`.`stg_pokemon` 
  
    
    
  as (
    

with base as (
  select
    toInt32(id)              as pokemon_id,
    lowerUTF8(name)          as pokemon_name,
    toInt32(height)          as height_dm,
    toInt32(weight)          as weight_hg,
    base_stats_json,
    types,
    sprite_url
  from `raw`.`pokemon___gen1`
)
select
  pokemon_id,
  pokemon_name,
  (height_dm * 0.1)          as height_m,
  (weight_hg * 0.1)          as weight_kg,

  JSONExtractInt(base_stats_json, 'hp')               as hp,
  JSONExtractInt(base_stats_json, 'attack')           as attack,
  JSONExtractInt(base_stats_json, 'defense')          as defense,
  JSONExtractInt(base_stats_json, 'special-attack')   as special_attack,
  JSONExtractInt(base_stats_json, 'special-defense')  as special_defense,
  JSONExtractInt(base_stats_json, 'speed')            as speed,

  arrayJoin(types)            as type,     -- ← explode to one type per row
  sprite_url
from base
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m06:02:29.948269 [debug] [Thread-1  ]: Database Error in model stg_pokemon (models/clean/stg_pokemon.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 47
   Code: 47. DB::Exception: Missing columns: 'types' while processing query: 'SELECT toInt32(id) AS pokemon_id, lowerUTF8(name) AS pokemon_name, toInt32(height) AS height_dm, toInt32(weight) AS weight_hg, base_stats_json, types, sprite_url FROM raw.pokemon___gen1', required columns: 'sprite_url' 'id' 'name' 'base_stats_json' 'types' 'height' 'weight', maybe you meant: 'sprite_url', 'id', 'name', 'base_stats_json', 'height' or 'weight'. (UNKNOWN_IDENTIFIER) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_05_poke/models/clean/stg_pokemon.sql
[0m06:02:29.951057 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d91faa5-2f19-4151-956f-aad315e2851c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce5578a1790>]}
[0m06:02:29.952311 [error] [Thread-1  ]: 1 of 2 ERROR creating sql view model `clean`.`stg_pokemon` ..................... [[31mERROR[0m in 0.25s]
[0m06:02:29.953881 [debug] [Thread-1  ]: Finished running node model.ex_05_poke.stg_pokemon
[0m06:02:29.955497 [debug] [Thread-3  ]: Began running node model.ex_05_poke.vw_poke_type_stats
[0m06:02:29.956623 [info ] [Thread-3  ]: 2 of 2 SKIP relation mart.vw_poke_type_stats ................................... [[33mSKIP[0m]
[0m06:02:29.957767 [debug] [Thread-3  ]: Finished running node model.ex_05_poke.vw_poke_type_stats
[0m06:02:29.959947 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:02:29.960593 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m06:02:29.961199 [debug] [MainThread]: On list__mart: Close
[0m06:02:29.961744 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m06:02:29.962274 [debug] [MainThread]: On list__clean: Close
[0m06:02:29.962827 [debug] [MainThread]: Connection 'model.ex_05_poke.stg_pokemon' was left open.
[0m06:02:29.963332 [debug] [MainThread]: On model.ex_05_poke.stg_pokemon: Close
[0m06:02:29.964261 [info ] [MainThread]: 
[0m06:02:29.965024 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.14 seconds (1.14s).
[0m06:02:29.977044 [debug] [MainThread]: Command end result
[0m06:02:30.080285 [info ] [MainThread]: 
[0m06:02:30.081265 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m06:02:30.081961 [info ] [MainThread]: 
[0m06:02:30.082819 [error] [MainThread]:   Database Error in model stg_pokemon (models/clean/stg_pokemon.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 47
   Code: 47. DB::Exception: Missing columns: 'types' while processing query: 'SELECT toInt32(id) AS pokemon_id, lowerUTF8(name) AS pokemon_name, toInt32(height) AS height_dm, toInt32(weight) AS weight_hg, base_stats_json, types, sprite_url FROM raw.pokemon___gen1', required columns: 'sprite_url' 'id' 'name' 'base_stats_json' 'types' 'height' 'weight', maybe you meant: 'sprite_url', 'id', 'name', 'base_stats_json', 'height' or 'weight'. (UNKNOWN_IDENTIFIER) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_05_poke/models/clean/stg_pokemon.sql
[0m06:02:30.083539 [info ] [MainThread]: 
[0m06:02:30.084236 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=1 TOTAL=2
[0m06:02:30.085677 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 8.684464, "process_in_blocks": "1296", "process_kernel_time": 0.63879, "process_mem_max_rss": "115360", "process_out_blocks": "10496", "process_user_time": 6.98391}
[0m06:02:30.086588 [debug] [MainThread]: Command `dbt build` failed at 06:02:30.086366 after 8.69 seconds
[0m06:02:30.087374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce55c73fd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce559ecaac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ce55784cac0>]}
[0m06:02:30.088104 [debug] [MainThread]: Flushing usage events
[0m06:04:03.078312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77df7f175310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77df7bdcfa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77df7bdcf940>]}


============================== 06:04:03.138994 | a222a186-f779-4d15-b156-c0f0eaf861d4 ==============================
[0m06:04:03.138994 [info ] [MainThread]: Running with dbt=1.8.9
[0m06:04:03.140708 [debug] [MainThread]: running dbt with arguments {'log_path': '/workdir/transforms/05_poke/logs', 'version_check': 'True', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'empty': 'False', 'debug': 'False', 'cache_selected_only': 'False', 'log_format': 'default', 'target_path': 'None', 'printer_width': '80', 'partial_parse': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'profiles_dir': '.', 'fail_fast': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'write_json': 'True', 'introspect': 'True', 'no_print': 'None', 'use_experimental_parser': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m06:04:03.675694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a222a186-f779-4d15-b156-c0f0eaf861d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77df7bceba30>]}
[0m06:04:03.879757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a222a186-f779-4d15-b156-c0f0eaf861d4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77df7c20c250>]}
[0m06:04:03.931231 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m06:04:04.438725 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m06:04:04.938855 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m06:04:04.939986 [debug] [MainThread]: Partial parsing: updated file: ex_05_poke://models/mart/vw_poke_type_stats.sql
[0m06:04:04.940715 [debug] [MainThread]: Partial parsing: updated file: ex_05_poke://models/clean/stg_pokemon.sql
[0m06:04:05.565569 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.ex_05_poke.stg_pokemon' (models/clean/stg_pokemon.sql) depends on a source named 'pokemon.pokemon___gen1' which was not found
[0m06:04:05.567635 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 2.6338563, "process_in_blocks": "976", "process_kernel_time": 0.526136, "process_mem_max_rss": "99776", "process_out_blocks": "6608", "process_user_time": 4.235646}
[0m06:04:05.568893 [debug] [MainThread]: Command `dbt build` failed at 06:04:05.568567 after 2.64 seconds
[0m06:04:05.569871 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77df7f175310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77df7b5d9580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x77df7b5cd4f0>]}
[0m06:04:05.570744 [debug] [MainThread]: Flushing usage events
[0m06:04:42.283478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7960da8b0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7960d7512a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7960d7512940>]}


============================== 06:04:42.293029 | 84cc887d-2a50-4689-bba6-09db04fc04a0 ==============================
[0m06:04:42.293029 [info ] [MainThread]: Running with dbt=1.8.9
[0m06:04:42.294177 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'quiet': 'False', 'use_experimental_parser': 'False', 'version_check': 'True', 'write_json': 'True', 'log_path': '/workdir/transforms/05_poke/logs', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'warn_error': 'None', 'target_path': 'None', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'profiles_dir': '.', 'debug': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_colors': 'True', 'indirect_selection': 'eager', 'no_print': 'None'}
[0m06:04:42.819394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '84cc887d-2a50-4689-bba6-09db04fc04a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7960d9e5afd0>]}
[0m06:04:43.014865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '84cc887d-2a50-4689-bba6-09db04fc04a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7960d7ffc430>]}
[0m06:04:43.016212 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m06:04:43.492162 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m06:04:43.993387 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m06:04:43.994435 [debug] [MainThread]: Partial parsing: updated file: ex_05_poke://models/clean/stg_pokemon.sql
[0m06:04:43.995235 [debug] [MainThread]: Partial parsing: updated file: ex_05_poke://models/mart/vw_poke_type_stats.sql
[0m06:04:44.821658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '84cc887d-2a50-4689-bba6-09db04fc04a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7960d6833130>]}
[0m06:04:45.227741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '84cc887d-2a50-4689-bba6-09db04fc04a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7960d6792a30>]}
[0m06:04:45.228686 [info ] [MainThread]: Found 2 models, 3 sources, 471 macros
[0m06:04:45.231540 [info ] [MainThread]: 
[0m06:04:45.232653 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m06:04:45.283709 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m06:04:45.290809 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m06:04:45.319525 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:04:45.332212 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m06:04:46.043417 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m06:04:46.053509 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m06:04:46.056415 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m06:04:46.090571 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m06:04:46.317564 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m06:04:46.319056 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m06:04:46.388528 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m06:04:46.391459 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m06:04:46.401470 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m06:04:46.406483 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m06:04:46.426176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '84cc887d-2a50-4689-bba6-09db04fc04a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7960d627b8e0>]}
[0m06:04:46.428048 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m06:04:46.429408 [info ] [MainThread]: 
[0m06:04:46.501674 [debug] [Thread-1  ]: Began running node model.ex_05_poke.stg_pokemon
[0m06:04:46.502812 [info ] [Thread-1  ]: 1 of 2 START sql view model `clean`.`stg_pokemon` .............................. [RUN]
[0m06:04:46.503725 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_05_poke.stg_pokemon)
[0m06:04:46.504485 [debug] [Thread-1  ]: Began compiling node model.ex_05_poke.stg_pokemon
[0m06:04:46.520806 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_05_poke.stg_pokemon"
[0m06:04:46.521943 [debug] [Thread-1  ]: Began executing node model.ex_05_poke.stg_pokemon
[0m06:04:46.619083 [debug] [Thread-1  ]: Creating new relation stg_pokemon
[0m06:04:46.693427 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_05_poke.stg_pokemon"
[0m06:04:46.695357 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_05_poke.stg_pokemon: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_05_poke.stg_pokemon"} */


  create view `clean`.`stg_pokemon` 
  
    
    
  as (
    

with base as (
  select
    toInt32(id)     as pokemon_id,
    lowerUTF8(name) as pokemon_name,
    toInt32(height) as height_dm,
    toInt32(weight) as weight_hg,
    base_stats_json,
    sprite_url
  from `raw`.`pokemon___gen1`
)
select
  pokemon_id,
  pokemon_name,
  (height_dm * 0.1) as height_m,
  (weight_hg * 0.1) as weight_kg,

  JSONExtractInt(base_stats_json, 'hp')               as hp,
  JSONExtractInt(base_stats_json, 'attack')           as attack,
  JSONExtractInt(base_stats_json, 'defense')          as defense,
  JSONExtractInt(base_stats_json, 'special-attack')   as special_attack,
  JSONExtractInt(base_stats_json, 'special-defense')  as special_defense,
  JSONExtractInt(base_stats_json, 'speed')            as speed,

  sprite_url
from base
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m06:04:46.714039 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m06:04:46.786811 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84cc887d-2a50-4689-bba6-09db04fc04a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7960d9e52820>]}
[0m06:04:46.788094 [info ] [Thread-1  ]: 1 of 2 OK created sql view model `clean`.`stg_pokemon` ......................... [[32mOK[0m in 0.28s]
[0m06:04:46.789436 [debug] [Thread-1  ]: Finished running node model.ex_05_poke.stg_pokemon
[0m06:04:46.791607 [debug] [Thread-3  ]: Began running node model.ex_05_poke.vw_poke_type_stats
[0m06:04:46.793094 [info ] [Thread-3  ]: 2 of 2 START sql view model `mart`.`vw_poke_type_stats` ........................ [RUN]
[0m06:04:46.794690 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.ex_05_poke.vw_poke_type_stats'
[0m06:04:46.795909 [debug] [Thread-3  ]: Began compiling node model.ex_05_poke.vw_poke_type_stats
[0m06:04:46.803606 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_05_poke.vw_poke_type_stats"
[0m06:04:46.805072 [debug] [Thread-3  ]: Began executing node model.ex_05_poke.vw_poke_type_stats
[0m06:04:46.811112 [debug] [Thread-3  ]: Creating new relation vw_poke_type_stats
[0m06:04:46.813273 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m06:04:46.916778 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_05_poke.vw_poke_type_stats"
[0m06:04:46.918074 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_05_poke.vw_poke_type_stats: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_05_poke.vw_poke_type_stats"} */


  create view `mart`.`vw_poke_type_stats` 
  
    
    
  as (
    

select
  avg(hp)               as avg_hp,
  avg(attack)           as avg_attack,
  avg(defense)          as avg_defense,
  avg(special_attack)   as avg_special_attack,
  avg(special_defense)  as avg_special_defense,
  avg(speed)            as avg_speed,
  avg(height_m)         as avg_height_m,
  avg(weight_kg)        as avg_weight_kg,
  countDistinct(pokemon_id) as n_pokemon
from `clean`.`stg_pokemon`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m06:04:46.932359 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m06:04:46.935794 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '84cc887d-2a50-4689-bba6-09db04fc04a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7960daaaf070>]}
[0m06:04:46.936963 [info ] [Thread-3  ]: 2 of 2 OK created sql view model `mart`.`vw_poke_type_stats` ................... [[32mOK[0m in 0.14s]
[0m06:04:46.938334 [debug] [Thread-3  ]: Finished running node model.ex_05_poke.vw_poke_type_stats
[0m06:04:46.940571 [debug] [MainThread]: Connection 'master' was properly closed.
[0m06:04:46.941132 [debug] [MainThread]: Connection 'model.ex_05_poke.stg_pokemon' was left open.
[0m06:04:46.941683 [debug] [MainThread]: On model.ex_05_poke.stg_pokemon: Close
[0m06:04:46.942166 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m06:04:46.942689 [debug] [MainThread]: On list__clean: Close
[0m06:04:46.943166 [debug] [MainThread]: Connection 'model.ex_05_poke.vw_poke_type_stats' was left open.
[0m06:04:46.943687 [debug] [MainThread]: On model.ex_05_poke.vw_poke_type_stats: Close
[0m06:04:46.944574 [info ] [MainThread]: 
[0m06:04:46.945234 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.71 seconds (1.71s).
[0m06:04:46.946968 [debug] [MainThread]: Command end result
[0m06:04:47.018964 [info ] [MainThread]: 
[0m06:04:47.019869 [info ] [MainThread]: [32mCompleted successfully[0m
[0m06:04:47.020442 [info ] [MainThread]: 
[0m06:04:47.021118 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m06:04:47.022391 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 4.932673, "process_in_blocks": "0", "process_kernel_time": 0.650711, "process_mem_max_rss": "113888", "process_out_blocks": "10496", "process_user_time": 5.25636}
[0m06:04:47.023135 [debug] [MainThread]: Command `dbt build` succeeded at 06:04:47.022944 after 4.93 seconds
[0m06:04:47.023771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7960da8b0310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7960d7ffc430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7960d68e66a0>]}
[0m06:04:47.024409 [debug] [MainThread]: Flushing usage events
[0m07:17:17.279938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e7fd5c3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e7fa22caf0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e7fa22c9a0>]}


============================== 07:17:17.290666 | 8750b1a1-092a-4417-a9f9-fc4a77392875 ==============================
[0m07:17:17.290666 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:17:17.292281 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt build --profiles-dir . --target local', 'profiles_dir': '.', 'log_path': '/workdir/transforms/06_laz/logs', 'indirect_selection': 'eager', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_cache_events': 'False', 'fail_fast': 'False', 'introspect': 'True', 'warn_error': 'None', 'log_format': 'default', 'printer_width': '80', 'cache_selected_only': 'False', 'debug': 'False', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'target_path': 'None', 'version_check': 'True', 'quiet': 'False', 'static_parser': 'True', 'use_colors': 'True', 'no_print': 'None', 'empty': 'False', 'send_anonymous_usage_stats': 'True'}
[0m07:17:17.877682 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8750b1a1-092a-4417-a9f9-fc4a77392875', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e7fcb6bfd0>]}
[0m07:17:18.076661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8750b1a1-092a-4417-a9f9-fc4a77392875', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e7fa1eebe0>]}
[0m07:17:18.077969 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m07:17:18.546307 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m07:17:18.880501 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m07:17:18.881403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '8750b1a1-092a-4417-a9f9-fc4a77392875', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e7fb55c0d0>]}
[0m07:17:23.547948 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.ex_06_laz.stg_lazada_products' (models/clean/stg_lazada_products.sql) depends on a source named 'lazada.lazada_products___lazada_products' which was not found
[0m07:17:23.549625 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 6.468355, "process_in_blocks": "0", "process_kernel_time": 0.537716, "process_mem_max_rss": "100464", "process_out_blocks": "6608", "process_user_time": 6.112831}
[0m07:17:23.550450 [debug] [MainThread]: Command `dbt build` failed at 07:17:23.550250 after 6.47 seconds
[0m07:17:23.551121 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e7fd5c3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e7fc912ee0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75e7f9a1be80>]}
[0m07:17:23.551762 [debug] [MainThread]: Flushing usage events
[0m07:17:58.581608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71143e9b9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71143b619b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71143b619a30>]}


============================== 07:17:58.590889 | 4cc657b2-f217-4433-9f7e-a93ec529c566 ==============================
[0m07:17:58.590889 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:17:58.591975 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'printer_width': '80', 'log_format': 'default', 'empty': 'False', 'log_cache_events': 'False', 'use_colors': 'True', 'indirect_selection': 'eager', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'cache_selected_only': 'False', 'introspect': 'True', 'quiet': 'False', 'debug': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'write_json': 'True', 'fail_fast': 'False', 'log_path': '/workdir/transforms/06_laz/logs', 'version_check': 'True', 'target_path': 'None', 'warn_error': 'None'}
[0m07:17:59.122273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4cc657b2-f217-4433-9f7e-a93ec529c566', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71143df55b80>]}
[0m07:17:59.315927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4cc657b2-f217-4433-9f7e-a93ec529c566', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71143ba69fd0>]}
[0m07:17:59.317203 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m07:17:59.781927 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m07:18:00.114106 [info ] [MainThread]: Unable to do partial parsing because a project dependency has been added
[0m07:18:00.115020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4cc657b2-f217-4433-9f7e-a93ec529c566', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71143c8e06d0>]}
[0m07:18:04.899644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4cc657b2-f217-4433-9f7e-a93ec529c566', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71143a8b0e80>]}
[0m07:18:05.290190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4cc657b2-f217-4433-9f7e-a93ec529c566', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71143a847f10>]}
[0m07:18:05.291069 [info ] [MainThread]: Found 3 models, 1 source, 471 macros
[0m07:18:05.293908 [info ] [MainThread]: 
[0m07:18:05.294902 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m07:18:05.307379 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m07:18:05.308913 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m07:18:05.389050 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:18:05.387945 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:18:06.180070 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m07:18:06.187703 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:18:06.190100 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m07:18:06.196869 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:18:06.277649 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m07:18:06.278711 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m07:18:06.291590 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m07:18:06.296172 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m07:18:06.302214 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:18:06.303450 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:18:06.315013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4cc657b2-f217-4433-9f7e-a93ec529c566', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71143e926790>]}
[0m07:18:06.315915 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m07:18:06.316577 [info ] [MainThread]: 
[0m07:18:06.385523 [debug] [Thread-1  ]: Began running node model.ex_06_laz.stg_lazada_products
[0m07:18:06.386817 [info ] [Thread-1  ]: 1 of 3 START sql view model `clean`.`stg_lazada_products` ...................... [RUN]
[0m07:18:06.387800 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_06_laz.stg_lazada_products)
[0m07:18:06.388723 [debug] [Thread-1  ]: Began compiling node model.ex_06_laz.stg_lazada_products
[0m07:18:06.406774 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_06_laz.stg_lazada_products"
[0m07:18:06.407984 [debug] [Thread-1  ]: Began executing node model.ex_06_laz.stg_lazada_products
[0m07:18:06.507414 [debug] [Thread-1  ]: Creating new relation stg_lazada_products
[0m07:18:06.583861 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_06_laz.stg_lazada_products"
[0m07:18:06.585984 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_06_laz.stg_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.stg_lazada_products"} */


  create view `clean`.`stg_lazada_products` 
  
    
    
  as (
    

-- Clean the raw scrape into one row per product with numeric price fields.
-- Handles both single prices and ranges like "₱1,299 - ₱1,599".

with base as (
  select
    toInt32OrZero(page)       as page,
    trim(BOTH ' ' FROM name)  as name,
    price,
    url
  from `raw`.`lazada_products_20250827063214___lazada_products`
  where url is not null
),

-- extract all number-like strings (e.g., ["1,299","1,599"])
nums as (
  select
    *,
    extractAll(price, '(\\d[\\d,\\.]*)') as num_strs
  from base
),

-- convert to float array (remove commas), then derive min/max/avg
priced as (
  select
    page,
    name,
    price,
    url,
    arrayMap(x -> toFloat64OrZero(replaceAll(x, ',', '')), num_strs) as num_vals,
    length(num_strs) as n_parts
  from nums
)

select
  page,
  name,
  price                        as price_raw,
  url,

  -- if no numbers detected, NULLs
  if(empty(num_vals), NULL, arrayMin(num_vals)) as min_price,
  if(empty(num_vals), NULL, arrayMax(num_vals)) as max_price,
  if(empty(num_vals), NULL,
     round( (arrayMin(num_vals) + arrayMax(num_vals)) / 2, 2)
  ) as price_avg,

  n_parts > 1                  as is_price_range
from priced
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m07:18:06.602315 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.stg_lazada_products"} */


  create view `clean`.`stg_lazada_products` 
  
    
    
  as (
    

-- Clean the raw scrape into one row per product with numeric price fields.
-- Handles both single prices and ranges like "₱1,299 - ₱1,599".

with base as (
  select
    toInt32OrZero(page)       as page,
    trim(BOTH ' ' FROM name)  as name,
    price,
    url
  from `raw`.`lazada_products_20250827063214___lazada_products`
  where url is not null
),

-- extract all number-like strings (e.g., ["1,299","1,599"])
nums as (
  select
    *,
    extractAll(price, '(\\d[\\d,\\.]*)') as num_strs
  from base
),

-- convert to float array (remove commas), then derive min/max/avg
priced as (
  select
    page,
    name,
    price,
    url,
    arrayMap(x -> toFloat64OrZero(replaceAll(x, ',', '')), num_strs) as num_vals,
    length(num_strs) as n_parts
  from nums
)

select
  page,
  name,
  price                        as price_raw,
  url,

  -- if no numbers detected, NULLs
  if(empty(num_vals), NULL, arrayMin(num_vals)) as min_price,
  if(empty(num_vals), NULL, arrayMax(num_vals)) as max_price,
  if(empty(num_vals), NULL,
     round( (arrayMin(num_vals) + arrayMax(num_vals)) / 2, 2)
  ) as price_avg,

  n_parts > 1                  as is_price_range
from priced
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m07:18:06.611720 [debug] [Thread-1  ]: Database Error in model stg_lazada_products (models/clean/stg_lazada_products.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 43
   Code: 43. DB::Exception: Illegal type Int64 of first argument of function toInt32OrZero. Conversion functions with postfix 'OrZero' or 'OrNull' should take String argument: While processing toInt32OrZero(page) AS page, replaceRegexpAll(name, concat('^[', regexpQuoteMeta(' '), ']+|[', regexpQuoteMeta(' '), ']+$'), '') AS name, price, url. (ILLEGAL_TYPE_OF_ARGUMENT) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_06_laz/models/clean/stg_lazada_products.sql
[0m07:18:06.614300 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cc657b2-f217-4433-9f7e-a93ec529c566', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711439ad2880>]}
[0m07:18:06.615552 [error] [Thread-1  ]: 1 of 3 ERROR creating sql view model `clean`.`stg_lazada_products` ............. [[31mERROR[0m in 0.22s]
[0m07:18:06.616999 [debug] [Thread-1  ]: Finished running node model.ex_06_laz.stg_lazada_products
[0m07:18:06.619100 [debug] [Thread-3  ]: Began running node model.ex_06_laz.vw_lazada_products
[0m07:18:06.620260 [debug] [Thread-4  ]: Began running node model.ex_06_laz.vw_price_bins
[0m07:18:06.621734 [info ] [Thread-3  ]: 2 of 3 SKIP relation mart.vw_lazada_products ................................... [[33mSKIP[0m]
[0m07:18:06.623600 [info ] [Thread-4  ]: 3 of 3 SKIP relation mart.vw_price_bins ........................................ [[33mSKIP[0m]
[0m07:18:06.625570 [debug] [Thread-3  ]: Finished running node model.ex_06_laz.vw_lazada_products
[0m07:18:06.627378 [debug] [Thread-4  ]: Finished running node model.ex_06_laz.vw_price_bins
[0m07:18:06.631643 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:18:06.632811 [debug] [MainThread]: Connection 'model.ex_06_laz.stg_lazada_products' was left open.
[0m07:18:06.634038 [debug] [MainThread]: On model.ex_06_laz.stg_lazada_products: Close
[0m07:18:06.635161 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m07:18:06.636523 [debug] [MainThread]: On list__clean: Close
[0m07:18:06.638281 [info ] [MainThread]: 
[0m07:18:06.672818 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 1.34 seconds (1.34s).
[0m07:18:06.676571 [debug] [MainThread]: Command end result
[0m07:18:06.897764 [info ] [MainThread]: 
[0m07:18:06.899410 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:18:06.900714 [info ] [MainThread]: 
[0m07:18:06.902571 [error] [MainThread]:   Database Error in model stg_lazada_products (models/clean/stg_lazada_products.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 43
   Code: 43. DB::Exception: Illegal type Int64 of first argument of function toInt32OrZero. Conversion functions with postfix 'OrZero' or 'OrNull' should take String argument: While processing toInt32OrZero(page) AS page, replaceRegexpAll(name, concat('^[', regexpQuoteMeta(' '), ']+|[', regexpQuoteMeta(' '), ']+$'), '') AS name, price, url. (ILLEGAL_TYPE_OF_ARGUMENT) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_06_laz/models/clean/stg_lazada_products.sql
[0m07:18:06.904020 [info ] [MainThread]: 
[0m07:18:06.905610 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=2 TOTAL=3
[0m07:18:06.907981 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 8.516762, "process_in_blocks": "320", "process_kernel_time": 0.601023, "process_mem_max_rss": "115000", "process_out_blocks": "10488", "process_user_time": 7.004622}
[0m07:18:06.909319 [debug] [MainThread]: Command `dbt build` failed at 07:18:06.908978 after 8.52 seconds
[0m07:18:06.910425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71143e9b9310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71143a847c70>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x71143df55b80>]}
[0m07:18:06.911646 [debug] [MainThread]: Flushing usage events
[0m07:21:37.129754 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be171e3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be13e4ba90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be13e4b940>]}


============================== 07:21:37.139086 | a04ca378-6204-4aa1-bee5-0f2c66543d90 ==============================
[0m07:21:37.139086 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:21:37.140240 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'version_check': 'True', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'use_colors': 'True', 'quiet': 'False', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'printer_width': '80', 'log_path': '/workdir/transforms/06_laz/logs', 'warn_error': 'None', 'invocation_command': 'dbt build --profiles-dir . --target local', 'indirect_selection': 'eager', 'partial_parse': 'True', 'no_print': 'None', 'log_format': 'default', 'profiles_dir': '.', 'empty': 'False'}
[0m07:21:37.751635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a04ca378-6204-4aa1-bee5-0f2c66543d90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be13e0a250>]}
[0m07:21:37.951863 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a04ca378-6204-4aa1-bee5-0f2c66543d90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be15df35b0>]}
[0m07:21:37.953163 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m07:21:38.428541 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m07:21:38.856287 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m07:21:38.857335 [debug] [MainThread]: Partial parsing: updated file: ex_06_laz://models/clean/stg_lazada_products.sql
[0m07:21:39.747042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a04ca378-6204-4aa1-bee5-0f2c66543d90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be1320d130>]}
[0m07:21:40.161546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a04ca378-6204-4aa1-bee5-0f2c66543d90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be1304c3a0>]}
[0m07:21:40.162464 [info ] [MainThread]: Found 3 models, 1 source, 471 macros
[0m07:21:40.165626 [info ] [MainThread]: 
[0m07:21:40.166657 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m07:21:40.178624 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m07:21:40.185096 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m07:21:40.244551 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:21:40.262452 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:21:40.911254 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m07:21:40.935221 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m07:21:40.937030 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:21:40.948860 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:21:41.230830 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m07:21:41.232398 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m07:21:41.247846 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m07:21:41.252081 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m07:21:41.260918 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:21:41.272727 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m07:21:41.329688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a04ca378-6204-4aa1-bee5-0f2c66543d90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be1377e7c0>]}
[0m07:21:41.330683 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m07:21:41.331400 [info ] [MainThread]: 
[0m07:21:41.344451 [debug] [Thread-1  ]: Began running node model.ex_06_laz.stg_lazada_products
[0m07:21:41.345629 [info ] [Thread-1  ]: 1 of 3 START sql view model `clean`.`stg_lazada_products` ...................... [RUN]
[0m07:21:41.346524 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_06_laz.stg_lazada_products)
[0m07:21:41.347249 [debug] [Thread-1  ]: Began compiling node model.ex_06_laz.stg_lazada_products
[0m07:21:41.364319 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_06_laz.stg_lazada_products"
[0m07:21:41.365598 [debug] [Thread-1  ]: Began executing node model.ex_06_laz.stg_lazada_products
[0m07:21:41.455086 [debug] [Thread-1  ]: Creating new relation stg_lazada_products
[0m07:21:41.473369 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_06_laz.stg_lazada_products"
[0m07:21:41.474960 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_06_laz.stg_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.stg_lazada_products"} */


  create view `clean`.`stg_lazada_products` 
  
    
    
  as (
    

-- Minimal: keep page numeric, parse price strings to numbers (min/max/avg).

with base as (
  select
    -- page is Int64 in your table; keep it or make Int32. Avoid OrZero on numeric types.
    toInt32(page) as page,
    name,
    price,
    url
  from `raw`.`lazada_products_20250827063214___lazada_products`
  where url is not null
),

nums as (
  select
    *,
    -- grab all number-like substrings from the price text (handles ₱, commas, ranges)
    extractAll(price, '(\\d[\\d,\\.]*)') as num_strs
  from base
),

priced as (
  select
    page,
    name,
    price,
    url,
    arrayMap(x -> toFloat64OrZero(replaceAll(x, ',', '')), num_strs) as num_vals
  from nums
)

select
  page,
  name,
  price                                as price_raw,
  url,
  if(empty(num_vals), NULL, arrayMin(num_vals))                              as min_price,
  if(empty(num_vals), NULL, arrayMax(num_vals))                              as max_price,
  if(empty(num_vals), NULL, round( (arrayMin(num_vals)+arrayMax(num_vals))/2, 2)) as price_avg,
  length(num_vals) > 1                                                       as is_price_range
from priced
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m07:21:41.534820 [debug] [Thread-1  ]: dbt_clickhouse adapter: Error running SQL: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.stg_lazada_products"} */


  create view `clean`.`stg_lazada_products` 
  
    
    
  as (
    

-- Minimal: keep page numeric, parse price strings to numbers (min/max/avg).

with base as (
  select
    -- page is Int64 in your table; keep it or make Int32. Avoid OrZero on numeric types.
    toInt32(page) as page,
    name,
    price,
    url
  from `raw`.`lazada_products_20250827063214___lazada_products`
  where url is not null
),

nums as (
  select
    *,
    -- grab all number-like substrings from the price text (handles ₱, commas, ranges)
    extractAll(price, '(\\d[\\d,\\.]*)') as num_strs
  from base
),

priced as (
  select
    page,
    name,
    price,
    url,
    arrayMap(x -> toFloat64OrZero(replaceAll(x, ',', '')), num_strs) as num_vals
  from nums
)

select
  page,
  name,
  price                                as price_raw,
  url,
  if(empty(num_vals), NULL, arrayMin(num_vals))                              as min_price,
  if(empty(num_vals), NULL, arrayMax(num_vals))                              as max_price,
  if(empty(num_vals), NULL, round( (arrayMin(num_vals)+arrayMax(num_vals))/2, 2)) as price_avg,
  length(num_vals) > 1                                                       as is_price_range
from priced
    
  )
      
      
                    -- end_of_sql
                    
                    
[0m07:21:41.538262 [debug] [Thread-1  ]: Database Error in model stg_lazada_products (models/clean/stg_lazada_products.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 43
   Code: 43. DB::Exception: Nested type Array(String) cannot be inside Nullable type: While processing page, name, price, url, extractAll(price, '(\\d[\\d,\\.]*)') AS num_strs. (ILLEGAL_TYPE_OF_ARGUMENT) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_06_laz/models/clean/stg_lazada_products.sql
[0m07:21:41.540777 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a04ca378-6204-4aa1-bee5-0f2c66543d90', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be13cc4c40>]}
[0m07:21:41.541984 [error] [Thread-1  ]: 1 of 3 ERROR creating sql view model `clean`.`stg_lazada_products` ............. [[31mERROR[0m in 0.19s]
[0m07:21:41.543333 [debug] [Thread-1  ]: Finished running node model.ex_06_laz.stg_lazada_products
[0m07:21:41.544978 [debug] [Thread-3  ]: Began running node model.ex_06_laz.vw_lazada_products
[0m07:21:41.546131 [debug] [Thread-4  ]: Began running node model.ex_06_laz.vw_price_bins
[0m07:21:41.547141 [info ] [Thread-3  ]: 2 of 3 SKIP relation mart.vw_lazada_products ................................... [[33mSKIP[0m]
[0m07:21:41.548689 [info ] [Thread-4  ]: 3 of 3 SKIP relation mart.vw_price_bins ........................................ [[33mSKIP[0m]
[0m07:21:41.550228 [debug] [Thread-3  ]: Finished running node model.ex_06_laz.vw_lazada_products
[0m07:21:41.551703 [debug] [Thread-4  ]: Finished running node model.ex_06_laz.vw_price_bins
[0m07:21:41.554932 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:21:41.555566 [debug] [MainThread]: Connection 'model.ex_06_laz.stg_lazada_products' was left open.
[0m07:21:41.556422 [debug] [MainThread]: On model.ex_06_laz.stg_lazada_products: Close
[0m07:21:41.557568 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m07:21:41.558643 [debug] [MainThread]: On list__clean: Close
[0m07:21:41.560123 [info ] [MainThread]: 
[0m07:21:41.561333 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 1.39 seconds (1.39s).
[0m07:21:41.564353 [debug] [MainThread]: Command end result
[0m07:21:41.742339 [info ] [MainThread]: 
[0m07:21:41.743895 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:21:41.745025 [info ] [MainThread]: 
[0m07:21:41.746504 [error] [MainThread]:   Database Error in model stg_lazada_products (models/clean/stg_lazada_products.sql)
  HTTPDriver for http://clickhouse:8123 received ClickHouse error code 43
   Code: 43. DB::Exception: Nested type Array(String) cannot be inside Nullable type: While processing page, name, price, url, extractAll(price, '(\\d[\\d,\\.]*)') AS num_strs. (ILLEGAL_TYPE_OF_ARGUMENT) (version 23.12.6.19 (official build))
  compiled code at target/run/ex_06_laz/models/clean/stg_lazada_products.sql
[0m07:21:41.747756 [info ] [MainThread]: 
[0m07:21:41.748931 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=2 TOTAL=3
[0m07:21:41.751106 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 4.8181553, "process_in_blocks": "0", "process_kernel_time": 0.689888, "process_mem_max_rss": "114080", "process_out_blocks": "10488", "process_user_time": 5.367574}
[0m07:21:41.752415 [debug] [MainThread]: Command `dbt build` failed at 07:21:41.752091 after 4.82 seconds
[0m07:21:41.753524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be171e3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be1510e040>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x79be12fe4d00>]}
[0m07:21:41.754589 [debug] [MainThread]: Flushing usage events
[0m07:24:10.435013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711af31a7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711aefe06af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711aefe069a0>]}


============================== 07:24:10.444835 | 3017ccdf-206c-4e7d-8a3d-033cfd128eb2 ==============================
[0m07:24:10.444835 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:24:10.498383 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'use_experimental_parser': 'False', 'log_format': 'default', 'introspect': 'True', 'fail_fast': 'False', 'profiles_dir': '.', 'version_check': 'True', 'partial_parse': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'target_path': 'None', 'use_colors': 'True', 'log_path': '/workdir/transforms/06_laz/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'printer_width': '80', 'debug': 'False', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'quiet': 'False', 'warn_error': 'None'}
[0m07:24:11.038956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3017ccdf-206c-4e7d-8a3d-033cfd128eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711af2750fd0>]}
[0m07:24:11.236710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3017ccdf-206c-4e7d-8a3d-033cfd128eb2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711aefdd3be0>]}
[0m07:24:11.238131 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m07:24:11.707599 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m07:24:12.142959 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m07:24:12.144020 [debug] [MainThread]: Partial parsing: updated file: ex_06_laz://models/mart/vw_price_bins.sql
[0m07:24:12.144769 [debug] [MainThread]: Partial parsing: updated file: ex_06_laz://models/clean/stg_lazada_products.sql
[0m07:24:12.734722 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.ex_06_laz.stg_lazada_products' (models/clean/stg_lazada_products.sql) depends on a source named 'lazada.lazada_products___lazada_products' which was not found
[0m07:24:12.736385 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": false, "command_wall_clock_time": 2.4961627, "process_in_blocks": "0", "process_kernel_time": 0.541058, "process_mem_max_rss": "99920", "process_out_blocks": "6608", "process_user_time": 4.161376}
[0m07:24:12.737218 [debug] [MainThread]: Command `dbt build` failed at 07:24:12.736988 after 2.50 seconds
[0m07:24:12.737928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711af31a7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711aef4d1610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x711aef4d1eb0>]}
[0m07:24:12.738680 [debug] [MainThread]: Flushing usage events
[0m07:24:38.669123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738825c57310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7388228bbb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7388228bb9d0>]}


============================== 07:24:38.678431 | ca157f7b-3799-409e-9fc6-41429d5ba23c ==============================
[0m07:24:38.678431 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:24:38.679590 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'empty': 'False', 'log_format': 'default', 'printer_width': '80', 'warn_error': 'None', 'version_check': 'True', 'no_print': 'None', 'static_parser': 'True', 'introspect': 'True', 'write_json': 'True', 'partial_parse': 'True', 'use_colors': 'True', 'profiles_dir': '.', 'log_path': '/workdir/transforms/06_laz/logs', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'target_path': 'None', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'cache_selected_only': 'False', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'send_anonymous_usage_stats': 'True'}
[0m07:24:39.261587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ca157f7b-3799-409e-9fc6-41429d5ba23c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738828434910>]}
[0m07:24:39.463826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ca157f7b-3799-409e-9fc6-41429d5ba23c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7388229a17c0>]}
[0m07:24:39.465119 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m07:24:39.877011 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m07:24:40.431815 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m07:24:40.433001 [debug] [MainThread]: Partial parsing: updated file: ex_06_laz://models/mart/vw_price_bins.sql
[0m07:24:40.433747 [debug] [MainThread]: Partial parsing: updated file: ex_06_laz://models/clean/stg_lazada_products.sql
[0m07:24:41.249397 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ca157f7b-3799-409e-9fc6-41429d5ba23c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738821be3130>]}
[0m07:24:41.642583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ca157f7b-3799-409e-9fc6-41429d5ba23c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738821b3bca0>]}
[0m07:24:41.643445 [info ] [MainThread]: Found 3 models, 1 source, 471 macros
[0m07:24:41.646498 [info ] [MainThread]: 
[0m07:24:41.647714 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m07:24:41.659938 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m07:24:41.666593 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m07:24:41.748247 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:24:41.766210 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:24:42.433470 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m07:24:42.439759 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m07:24:42.444666 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:24:42.450255 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:24:42.669954 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m07:24:42.671513 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m07:24:42.744160 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m07:24:42.747200 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m07:24:42.760481 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:24:42.775087 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m07:24:42.832339 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ca157f7b-3799-409e-9fc6-41429d5ba23c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7388216a28e0>]}
[0m07:24:42.834245 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m07:24:42.835635 [info ] [MainThread]: 
[0m07:24:42.861967 [debug] [Thread-1  ]: Began running node model.ex_06_laz.stg_lazada_products
[0m07:24:42.863093 [info ] [Thread-1  ]: 1 of 3 START sql view model `clean`.`stg_lazada_products` ...................... [RUN]
[0m07:24:42.864060 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_06_laz.stg_lazada_products)
[0m07:24:42.864850 [debug] [Thread-1  ]: Began compiling node model.ex_06_laz.stg_lazada_products
[0m07:24:42.932124 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_06_laz.stg_lazada_products"
[0m07:24:42.933851 [debug] [Thread-1  ]: Began executing node model.ex_06_laz.stg_lazada_products
[0m07:24:43.035869 [debug] [Thread-1  ]: Creating new relation stg_lazada_products
[0m07:24:43.060889 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_06_laz.stg_lazada_products"
[0m07:24:43.062695 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_06_laz.stg_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.stg_lazada_products"} */


  create view `clean`.`stg_lazada_products` 
  
    
    
  as (
    -- models/clean/stg_lazada_products.sql


with base as (
  select
    toInt32(page)          as page,           -- keep numeric cast (or just use page)
    name,                                    -- raw name (you can trim later)
    ifNull(price, '')     as price_str,      -- ← force NON-NULL String
    url
  from `raw`.`lazada_products_20250827063214___lazada_products`
  where url is not null
),
nums as (
  select
    *,
    extractAll(price_str, '(\\d[\\d,\\.]*)') as num_strs
  from base
),
priced as (
  select
    page,
    name,
    price_str,
    url,
    arrayMap(x -> toFloat64OrZero(replaceAll(x, ',', '')), num_strs) as num_vals
  from nums
)
select
  page,
  name,
  price_str                         as price_raw,
  url,
  if(empty(num_vals), NULL, arrayMin(num_vals))                              as min_price,
  if(empty(num_vals), NULL, arrayMax(num_vals))                              as max_price,
  if(empty(num_vals), NULL, round((arrayMin(num_vals) + arrayMax(num_vals)) / 2, 2)) as price_avg,
  length(num_vals) > 1                                                      as is_price_range
from priced
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m07:24:43.086619 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m07:24:43.155413 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca157f7b-3799-409e-9fc6-41429d5ba23c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738821754400>]}
[0m07:24:43.156665 [info ] [Thread-1  ]: 1 of 3 OK created sql view model `clean`.`stg_lazada_products` ................. [[32mOK[0m in 0.29s]
[0m07:24:43.158009 [debug] [Thread-1  ]: Finished running node model.ex_06_laz.stg_lazada_products
[0m07:24:43.159872 [debug] [Thread-3  ]: Began running node model.ex_06_laz.vw_lazada_products
[0m07:24:43.161041 [debug] [Thread-4  ]: Began running node model.ex_06_laz.vw_price_bins
[0m07:24:43.162706 [info ] [Thread-3  ]: 2 of 3 START sql view model `mart`.`vw_lazada_products` ........................ [RUN]
[0m07:24:43.164600 [info ] [Thread-4  ]: 3 of 3 START sql view model `mart`.`vw_price_bins` ............................. [RUN]
[0m07:24:43.167013 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.ex_06_laz.vw_lazada_products'
[0m07:24:43.169230 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.ex_06_laz.vw_price_bins'
[0m07:24:43.171000 [debug] [Thread-3  ]: Began compiling node model.ex_06_laz.vw_lazada_products
[0m07:24:43.172892 [debug] [Thread-4  ]: Began compiling node model.ex_06_laz.vw_price_bins
[0m07:24:43.235646 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_06_laz.vw_lazada_products"
[0m07:24:43.246767 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_06_laz.vw_price_bins"
[0m07:24:43.249928 [debug] [Thread-3  ]: Began executing node model.ex_06_laz.vw_lazada_products
[0m07:24:43.251812 [debug] [Thread-4  ]: Began executing node model.ex_06_laz.vw_price_bins
[0m07:24:43.261253 [debug] [Thread-3  ]: Creating new relation vw_lazada_products
[0m07:24:43.270684 [debug] [Thread-4  ]: Creating new relation vw_price_bins
[0m07:24:43.273888 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m07:24:43.279333 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m07:24:43.492456 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_06_laz.vw_lazada_products"
[0m07:24:43.495253 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_lazada_products"} */


  create view `mart`.`vw_lazada_products` 
  
    
    
  as (
    

select
  url,
  name,
  page,
  price_raw,
  min_price,
  max_price,
  price_avg,
  is_price_range
from `clean`.`stg_lazada_products`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m07:24:43.497828 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_06_laz.vw_price_bins"
[0m07:24:43.499276 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_price_bins: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_price_bins"} */


  create view `mart`.`vw_price_bins` 
  
    
    
  as (
    

-- Bucket prices by ₱500 for a quick histogram
select
  intDiv(toInt64(price_avg), 500) * 500  as price_bin_php,
  count()                                as n_products
from `clean`.`stg_lazada_products`
where price_avg is not null
group by price_bin_php
order by price_bin_php
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m07:24:43.505819 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:24:43.509059 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca157f7b-3799-409e-9fc6-41429d5ba23c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7388217772e0>]}
[0m07:24:43.510226 [info ] [Thread-3  ]: 2 of 3 OK created sql view model `mart`.`vw_lazada_products` ................... [[32mOK[0m in 0.34s]
[0m07:24:43.511650 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:24:43.513017 [debug] [Thread-3  ]: Finished running node model.ex_06_laz.vw_lazada_products
[0m07:24:43.531377 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ca157f7b-3799-409e-9fc6-41429d5ba23c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738821762070>]}
[0m07:24:43.533802 [info ] [Thread-4  ]: 3 of 3 OK created sql view model `mart`.`vw_price_bins` ........................ [[32mOK[0m in 0.35s]
[0m07:24:43.535813 [debug] [Thread-4  ]: Finished running node model.ex_06_laz.vw_price_bins
[0m07:24:43.538316 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:24:43.539162 [debug] [MainThread]: Connection 'model.ex_06_laz.stg_lazada_products' was left open.
[0m07:24:43.540126 [debug] [MainThread]: On model.ex_06_laz.stg_lazada_products: Close
[0m07:24:43.540898 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m07:24:43.541410 [debug] [MainThread]: On list__clean: Close
[0m07:24:43.541935 [debug] [MainThread]: Connection 'model.ex_06_laz.vw_lazada_products' was left open.
[0m07:24:43.542423 [debug] [MainThread]: On model.ex_06_laz.vw_lazada_products: Close
[0m07:24:43.542904 [debug] [MainThread]: Connection 'model.ex_06_laz.vw_price_bins' was left open.
[0m07:24:43.543384 [debug] [MainThread]: On model.ex_06_laz.vw_price_bins: Close
[0m07:24:43.544330 [info ] [MainThread]: 
[0m07:24:43.544996 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 1.90 seconds (1.90s).
[0m07:24:43.547124 [debug] [MainThread]: Command end result
[0m07:24:43.648799 [info ] [MainThread]: 
[0m07:24:43.649699 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:24:43.650371 [info ] [MainThread]: 
[0m07:24:43.651086 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m07:24:43.652478 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 5.1735086, "process_in_blocks": "0", "process_kernel_time": 0.612756, "process_mem_max_rss": "114188", "process_out_blocks": "10520", "process_user_time": 5.292795}
[0m07:24:43.653276 [debug] [MainThread]: Command `dbt build` succeeded at 07:24:43.653056 after 5.17 seconds
[0m07:24:43.653930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738825c57310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738823bf1400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x738821b08ee0>]}
[0m07:24:43.654681 [debug] [MainThread]: Flushing usage events
[0m07:31:02.893969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df011742e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df00e3a3b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df00e3a3a30>]}


============================== 07:31:02.904213 | 262467ec-5e01-4e1c-a85b-672a41fd9082 ==============================
[0m07:31:02.904213 [info ] [MainThread]: Running with dbt=1.8.9
[0m07:31:02.905349 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'profiles_dir': '.', 'debug': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'version_check': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'cache_selected_only': 'False', 'use_colors': 'True', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'fail_fast': 'False', 'target_path': 'None', 'indirect_selection': 'eager', 'log_format': 'default', 'log_path': '/workdir/transforms/06_laz/logs', 'introspect': 'True', 'empty': 'False'}
[0m07:31:03.514810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '262467ec-5e01-4e1c-a85b-672a41fd9082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df010bdc910>]}
[0m07:31:03.716700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '262467ec-5e01-4e1c-a85b-672a41fd9082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df00e3fc0d0>]}
[0m07:31:03.718282 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m07:31:04.183484 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m07:31:04.607355 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m07:31:04.608454 [debug] [MainThread]: Partial parsing: updated file: ex_06_laz://models/clean/stg_lazada_products.sql
[0m07:31:05.491002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '262467ec-5e01-4e1c-a85b-672a41fd9082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df00d76c130>]}
[0m07:31:05.891603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '262467ec-5e01-4e1c-a85b-672a41fd9082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df00d649e80>]}
[0m07:31:05.892605 [info ] [MainThread]: Found 3 models, 1 source, 471 macros
[0m07:31:05.895488 [info ] [MainThread]: 
[0m07:31:05.896614 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m07:31:05.908999 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m07:31:05.920403 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m07:31:05.991576 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:31:05.997249 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:31:06.578288 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m07:31:06.584442 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m07:31:06.586100 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m07:31:06.598297 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:31:06.806157 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m07:31:06.807871 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m07:31:06.822785 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m07:31:06.880912 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m07:31:06.894061 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:31:06.896378 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:31:06.923505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '262467ec-5e01-4e1c-a85b-672a41fd9082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df011694430>]}
[0m07:31:06.925386 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m07:31:06.976438 [info ] [MainThread]: 
[0m07:31:07.004249 [debug] [Thread-1  ]: Began running node model.ex_06_laz.stg_lazada_products
[0m07:31:07.005544 [info ] [Thread-1  ]: 1 of 3 START sql view model `clean`.`stg_lazada_products` ...................... [RUN]
[0m07:31:07.006523 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly list__mart, now model.ex_06_laz.stg_lazada_products)
[0m07:31:07.007323 [debug] [Thread-1  ]: Began compiling node model.ex_06_laz.stg_lazada_products
[0m07:31:07.023575 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_06_laz.stg_lazada_products"
[0m07:31:07.024686 [debug] [Thread-1  ]: Began executing node model.ex_06_laz.stg_lazada_products
[0m07:31:07.220468 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_06_laz.stg_lazada_products"
[0m07:31:07.222147 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_06_laz.stg_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.stg_lazada_products"} */


  create view `clean`.`stg_lazada_products__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_lazada_products.sql


with base as (
  select
    -- keep page numeric; remove OrZero (that's for String inputs)
    toInt32(page)                      as page,
    name,
    ifNull(price, '')                  as price_str,      -- ensure NON-NULL String
    url
  from `raw`.`lazada_products_20250827063214___lazada_products`
  where url is not null
),

-- Pull out every number-like token (supports: 2,609 • 2,124.24 • 145.5 • 12,136.01)
tokens as (
  select
    *,
    extractAll(price_str, '(\\d[\\d,\\.]*)') as num_strs
  from base
),

-- Normalize: remove thousands separators, cast to floats
norm as (
  select
    page,
    name,
    price_str,
    url,
    arrayMap(x -> toFloat64OrZero(replaceAll(x, ',', '')), num_strs) as num_vals
  from tokens
)

select
  page,
  name,
  price_str                              as price_raw,
  url,

  -- if single value -> min=max=avg; if a range -> min/max distinct
  if(empty(num_vals), NULL, arrayMin(num_vals))                               as min_price,
  if(empty(num_vals), NULL, arrayMax(num_vals))                               as max_price,
  if(empty(num_vals), NULL, round( (arrayMin(num_vals) + arrayMax(num_vals)) / 2, 2)) as price_avg,
  length(num_vals) > 1                                                        as is_price_range
from norm
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m07:31:07.241949 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m07:31:07.288279 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_06_laz.stg_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.stg_lazada_products"} */

    drop table if exists `clean`.`stg_lazada_products__dbt_backup` 
  
  ...
[0m07:31:07.291481 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m07:31:07.293572 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_06_laz.stg_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.stg_lazada_products"} */

    rename table `clean`.`stg_lazada_products` to `clean`.`stg_lazada_products__dbt_backup` 
  
  ...
[0m07:31:07.296409 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m07:31:07.303301 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_06_laz.stg_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.stg_lazada_products"} */

    drop table if exists `clean`.`stg_lazada_products` 
  
  ...
[0m07:31:07.306771 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m07:31:07.309256 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_06_laz.stg_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.stg_lazada_products"} */

    rename table `clean`.`stg_lazada_products__dbt_tmp` to `clean`.`stg_lazada_products` 
  
  ...
[0m07:31:07.312296 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m07:31:07.406386 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_06_laz.stg_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.stg_lazada_products"} */

    drop table if exists `clean`.`stg_lazada_products__dbt_backup` 
  ...
[0m07:31:07.410051 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m07:31:07.416089 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '262467ec-5e01-4e1c-a85b-672a41fd9082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df00c993580>]}
[0m07:31:07.417201 [info ] [Thread-1  ]: 1 of 3 OK created sql view model `clean`.`stg_lazada_products` ................. [[32mOK[0m in 0.41s]
[0m07:31:07.418607 [debug] [Thread-1  ]: Finished running node model.ex_06_laz.stg_lazada_products
[0m07:31:07.420587 [debug] [Thread-3  ]: Began running node model.ex_06_laz.vw_lazada_products
[0m07:31:07.421903 [debug] [Thread-4  ]: Began running node model.ex_06_laz.vw_price_bins
[0m07:31:07.424139 [info ] [Thread-3  ]: 2 of 3 START sql view model `mart`.`vw_lazada_products` ........................ [RUN]
[0m07:31:07.425796 [info ] [Thread-4  ]: 3 of 3 START sql view model `mart`.`vw_price_bins` ............................. [RUN]
[0m07:31:07.427257 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'model.ex_06_laz.vw_lazada_products'
[0m07:31:07.478331 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'model.ex_06_laz.vw_price_bins'
[0m07:31:07.480198 [debug] [Thread-3  ]: Began compiling node model.ex_06_laz.vw_lazada_products
[0m07:31:07.481926 [debug] [Thread-4  ]: Began compiling node model.ex_06_laz.vw_price_bins
[0m07:31:07.495871 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_06_laz.vw_lazada_products"
[0m07:31:07.508696 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_06_laz.vw_price_bins"
[0m07:31:07.511629 [debug] [Thread-3  ]: Began executing node model.ex_06_laz.vw_lazada_products
[0m07:31:07.513181 [debug] [Thread-4  ]: Began executing node model.ex_06_laz.vw_price_bins
[0m07:31:07.578097 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m07:31:07.591499 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m07:31:07.778506 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_06_laz.vw_lazada_products"
[0m07:31:07.781429 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_lazada_products"} */


  create view `mart`.`vw_lazada_products__dbt_tmp` 
  
    
    
  as (
    

select
  url,
  name,
  page,
  price_raw,
  min_price,
  max_price,
  price_avg,
  is_price_range
from `clean`.`stg_lazada_products`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m07:31:07.786025 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_06_laz.vw_price_bins"
[0m07:31:07.788611 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_price_bins: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_price_bins"} */


  create view `mart`.`vw_price_bins__dbt_tmp` 
  
    
    
  as (
    

-- Bucket prices by ₱500 for a quick histogram
select
  intDiv(toInt64(price_avg), 500) * 500  as price_bin_php,
  count()                                as n_products
from `clean`.`stg_lazada_products`
where price_avg is not null
group by price_bin_php
order by price_bin_php
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m07:31:07.797119 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:31:07.809891 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_lazada_products"} */

    drop table if exists `mart`.`vw_lazada_products__dbt_backup` 
  
  ...
[0m07:31:07.812322 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m07:31:07.876581 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_price_bins: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_price_bins"} */

    drop table if exists `mart`.`vw_price_bins__dbt_backup` 
  
  ...
[0m07:31:07.826958 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:31:07.882973 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_lazada_products"} */

    rename table `mart`.`vw_lazada_products` to `mart`.`vw_lazada_products__dbt_backup` 
  
  ...
[0m07:31:07.887254 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:31:07.889894 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m07:31:07.893985 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_price_bins: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_price_bins"} */

    rename table `mart`.`vw_price_bins` to `mart`.`vw_price_bins__dbt_backup` 
  
  ...
[0m07:31:07.908077 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_lazada_products"} */

    drop table if exists `mart`.`vw_lazada_products` 
  
  ...
[0m07:31:07.912530 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:31:07.915392 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:31:07.979781 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_price_bins: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_price_bins"} */

    drop table if exists `mart`.`vw_price_bins` 
  
  ...
[0m07:31:07.984139 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_lazada_products"} */

    rename table `mart`.`vw_lazada_products__dbt_tmp` to `mart`.`vw_lazada_products` 
  
  ...
[0m07:31:07.990160 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m07:31:07.992823 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:31:07.996758 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_price_bins: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_price_bins"} */

    rename table `mart`.`vw_price_bins__dbt_tmp` to `mart`.`vw_price_bins` 
  
  ...
[0m07:31:08.011349 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_lazada_products: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_lazada_products"} */

    drop table if exists `mart`.`vw_lazada_products__dbt_backup` 
  ...
[0m07:31:08.018800 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:31:08.077840 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m07:31:08.087732 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_06_laz.vw_price_bins: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_06_laz.vw_price_bins"} */

    drop table if exists `mart`.`vw_price_bins__dbt_backup` 
  ...
[0m07:31:08.093097 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '262467ec-5e01-4e1c-a85b-672a41fd9082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df00e0b5ac0>]}
[0m07:31:08.097354 [info ] [Thread-3  ]: 2 of 3 OK created sql view model `mart`.`vw_lazada_products` ................... [[32mOK[0m in 0.67s]
[0m07:31:08.100334 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m07:31:08.102910 [debug] [Thread-3  ]: Finished running node model.ex_06_laz.vw_lazada_products
[0m07:31:08.108211 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '262467ec-5e01-4e1c-a85b-672a41fd9082', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df00d25feb0>]}
[0m07:31:08.111030 [info ] [Thread-4  ]: 3 of 3 OK created sql view model `mart`.`vw_price_bins` ........................ [[32mOK[0m in 0.63s]
[0m07:31:08.114286 [debug] [Thread-4  ]: Finished running node model.ex_06_laz.vw_price_bins
[0m07:31:08.119098 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:31:08.120373 [debug] [MainThread]: Connection 'model.ex_06_laz.stg_lazada_products' was left open.
[0m07:31:08.121557 [debug] [MainThread]: On model.ex_06_laz.stg_lazada_products: Close
[0m07:31:08.122657 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m07:31:08.123796 [debug] [MainThread]: On list__clean: Close
[0m07:31:08.176654 [debug] [MainThread]: Connection 'model.ex_06_laz.vw_lazada_products' was left open.
[0m07:31:08.177882 [debug] [MainThread]: On model.ex_06_laz.vw_lazada_products: Close
[0m07:31:08.178957 [debug] [MainThread]: Connection 'model.ex_06_laz.vw_price_bins' was left open.
[0m07:31:08.180069 [debug] [MainThread]: On model.ex_06_laz.vw_price_bins: Close
[0m07:31:08.182133 [info ] [MainThread]: 
[0m07:31:08.183601 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 2.29 seconds (2.29s).
[0m07:31:08.188450 [debug] [MainThread]: Command end result
[0m07:31:08.318319 [info ] [MainThread]: 
[0m07:31:08.319190 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:31:08.319835 [info ] [MainThread]: 
[0m07:31:08.320476 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m07:31:08.321806 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 5.6314006, "process_in_blocks": "0", "process_kernel_time": 0.642248, "process_mem_max_rss": "113928", "process_out_blocks": "10544", "process_user_time": 5.588256}
[0m07:31:08.322565 [debug] [MainThread]: Command `dbt build` succeeded at 07:31:08.322355 after 5.63 seconds
[0m07:31:08.323199 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df011742e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df00fe9a8e0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7df00de998b0>]}
[0m07:31:08.323855 [debug] [MainThread]: Flushing usage events
