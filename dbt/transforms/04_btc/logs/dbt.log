[0m23:36:14.033341 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_fe3cc19e_13df_43ed_b475_fa4bf3fbf855`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:36:14.044040 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:36:14.117856 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:36:14.123662 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:36:14.126926 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_fe3cc19e_13df_43ed_b475_fa4bf3fbf855` 
    ...
[0m23:36:14.132750 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:36:14.139697 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_fe3cc19e_13df_43ed_b475_fa4bf3fbf855` 
  ...
[0m23:36:14.141750 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:36:14.144152 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_fe3cc19e_13df_43ed_b475_fa4bf3fbf855`)
      
    ...
[0m23:36:14.145444 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:36:14.154761 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:36:14.158565 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:36:14.164326 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe3cc19e-13df-43ed-b475-fa4bf3fbf855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db48620c40>]}
[0m23:36:14.165963 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:36:14.167555 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.57s]
[0m23:36:14.173211 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:36:14.175247 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:36:14.180830 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:36:14.183791 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_fe3cc19e_13df_43ed_b475_fa4bf3fbf855` 
    ...
[0m23:36:14.189746 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:36:14.196113 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_fe3cc19e_13df_43ed_b475_fa4bf3fbf855` 
  ...
[0m23:36:14.199500 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:36:14.205287 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:36:14.208085 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:36:14.211170 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fe3cc19e-13df-43ed-b475-fa4bf3fbf855', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db4652f1c0>]}
[0m23:36:14.212445 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.62s]
[0m23:36:14.213817 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:36:14.215779 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:36:14.216342 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:36:14.216900 [debug] [MainThread]: On list__mart: Close
[0m23:36:14.217438 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:36:14.217964 [debug] [MainThread]: On list__clean: Close
[0m23:36:14.218498 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:36:14.219041 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:36:14.219590 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:36:14.220089 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:36:14.220600 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:36:14.221097 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:36:14.221612 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m23:36:14.222119 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m23:36:14.223327 [info ] [MainThread]: 
[0m23:36:14.224016 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.83 seconds (1.83s).
[0m23:36:14.227812 [debug] [MainThread]: Command end result
[0m23:36:14.337016 [info ] [MainThread]: 
[0m23:36:14.338049 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:36:14.338695 [info ] [MainThread]: 
[0m23:36:14.339384 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:36:14.340832 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.2418401, "process_in_blocks": "816", "process_kernel_time": 0.616229, "process_mem_max_rss": "114372", "process_out_blocks": "9752", "process_user_time": 5.787154}
[0m23:36:14.341604 [debug] [MainThread]: Command `dbt build` succeeded at 23:36:14.341407 after 3.24 seconds
[0m23:36:14.342226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db4aedb310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db479a0df0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75db4725bb20>]}
[0m23:36:14.342890 [debug] [MainThread]: Flushing usage events
[0m23:37:11.050510 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5dfee4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5dcb49a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5dcb49940>]}


============================== 23:37:11.059992 | a7abc0d7-7296-42d2-a085-0f819b10ef08 ==============================
[0m23:37:11.059992 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:37:11.061123 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'empty': 'False', 'log_cache_events': 'False', 'no_print': 'None', 'partial_parse': 'True', 'log_format': 'default', 'debug': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'warn_error': 'None', 'introspect': 'True', 'profiles_dir': '.', 'fail_fast': 'False', 'use_colors': 'True', 'target_path': 'None', 'write_json': 'True', 'quiet': 'False', 'printer_width': '80', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'log_path': '/workdir/transforms/04_btc/logs', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False'}
[0m23:37:11.348210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a7abc0d7-7296-42d2-a085-0f819b10ef08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5df487fd0>]}
[0m23:37:11.443720 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a7abc0d7-7296-42d2-a085-0f819b10ef08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5dd624430>]}
[0m23:37:11.445064 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:37:11.618258 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:37:11.883907 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:37:11.884613 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:37:11.993183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a7abc0d7-7296-42d2-a085-0f819b10ef08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5dc2aef10>]}
[0m23:37:12.248127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a7abc0d7-7296-42d2-a085-0f819b10ef08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5df121c70>]}
[0m23:37:12.249028 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:37:12.253712 [info ] [MainThread]: 
[0m23:37:12.255408 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:37:12.275765 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:37:12.277297 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:37:12.320431 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:37:12.323095 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:37:12.590710 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:37:12.596308 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:37:12.597426 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:37:12.601830 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:37:12.625381 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:37:12.637145 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:37:12.638104 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:37:12.644663 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:37:12.653518 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:12.657636 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:12.673593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a7abc0d7-7296-42d2-a085-0f819b10ef08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5dc9b3940>]}
[0m23:37:12.674699 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:37:12.675482 [info ] [MainThread]: 
[0m23:37:12.690401 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:37:12.691662 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:37:12.692798 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:37:12.693574 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:37:12.711278 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:37:12.712543 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:37:12.784511 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:37:12.840884 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:37:12.842338 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:37:12.852388 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:12.931943 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:37:12.934911 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:37:12.936964 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:37:12.939683 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:37:12.945521 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:37:12.948385 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:37:12.950386 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:37:12.953274 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:37:13.003963 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:37:13.007192 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:37:13.013801 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7abc0d7-7296-42d2-a085-0f819b10ef08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5db5418e0>]}
[0m23:37:13.015144 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.32s]
[0m23:37:13.016595 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:37:13.018842 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:37:13.020046 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:37:13.021524 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:37:13.022399 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:37:13.023414 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:37:13.024283 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:37:13.025426 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:37:13.026732 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:37:13.028308 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:37:13.029562 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:37:13.031117 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:37:13.032524 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:37:13.078978 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:37:13.082523 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:37:13.092307 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:37:13.093817 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:37:13.094647 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:37:13.105781 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:37:13.152761 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:37:13.155691 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:37:13.156997 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:37:13.158420 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:37:13.159406 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:37:13.161394 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:37:13.262402 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:37:13.270744 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:37:13.273531 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:13.281561 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.26s]
[0m23:37:13.283219 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:13.284479 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:37:13.285668 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:37:13.288636 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.26s]
[0m23:37:13.292078 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:37:13.302119 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:13.305611 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.28s]
[0m23:37:13.306949 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:37:13.308488 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:37:13.309388 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:37:13.310436 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:37:13.311505 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:37:13.312807 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:37:13.313743 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:37:13.315028 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:37:13.316190 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:37:13.316967 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:37:13.317875 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:37:13.318911 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:37:13.335371 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:37:13.339568 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:37:13.348004 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:37:13.359518 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:37:13.361328 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:37:13.362161 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:37:13.368201 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:37:13.441680 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:37:13.534024 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:37:13.582276 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08` 
  ...
[0m23:37:13.588627 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08` 
  ...
[0m23:37:13.591805 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:37:13.593339 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:37:13.595267 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:37:13.607282 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:37:13.685434 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:37:13.699503 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:37:13.734028 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:37:13.751016 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:37:13.758901 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:37:13.766509 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:37:13.771630 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:37:13.773814 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:37:13.776702 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:37:13.783628 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:37:13.786696 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:37:13.789418 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7abc0d7-7296-42d2-a085-0f819b10ef08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5dc035580>]}
[0m23:37:13.790643 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.47s]
[0m23:37:13.791967 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:37:13.793311 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:37:13.795045 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:37:13.811786 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:37:13.820879 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:37:13.826717 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:37:13.828647 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:13.836731 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:37:13.840319 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:37:13.841831 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:37:13.842909 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:37:13.862871 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:37:13.866662 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08`)
      
    ...
[0m23:37:13.869800 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:37:13.872244 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08`)
      
    ...
[0m23:37:13.890047 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:37:13.896541 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:37:13.898031 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:37:13.904369 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:37:13.905984 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:13.910231 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08` 
    ...
[0m23:37:13.914182 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:13.917758 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08` 
    ...
[0m23:37:13.919171 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:13.926163 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08` 
  ...
[0m23:37:13.928375 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:13.934585 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_a7abc0d7_7296_42d2_a085_0f819b10ef08` 
  ...
[0m23:37:13.936948 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:13.943205 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:37:13.945683 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:13.952846 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:37:13.954375 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:13.958806 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7abc0d7-7296-42d2-a085-0f819b10ef08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5db527400>]}
[0m23:37:13.960146 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.65s]
[0m23:37:13.961801 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:37:13.963186 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:37:13.966817 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a7abc0d7-7296-42d2-a085-0f819b10ef08', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5dbddb580>]}
[0m23:37:13.968664 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.65s]
[0m23:37:13.970167 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:37:13.972932 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:37:13.973852 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:37:13.974752 [debug] [MainThread]: On list__mart: Close
[0m23:37:13.975567 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:37:13.976418 [debug] [MainThread]: On list__clean: Close
[0m23:37:13.977210 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:37:13.978084 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:37:13.978885 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:37:13.979731 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:37:13.980535 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m23:37:13.981390 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m23:37:13.982165 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:37:13.983018 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:37:13.984818 [info ] [MainThread]: 
[0m23:37:13.985971 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.73 seconds (1.73s).
[0m23:37:13.992091 [debug] [MainThread]: Command end result
[0m23:37:14.054920 [info ] [MainThread]: 
[0m23:37:14.055798 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:37:14.056387 [info ] [MainThread]: 
[0m23:37:14.057383 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:37:14.058754 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.1074986, "process_in_blocks": "0", "process_kernel_time": 0.648709, "process_mem_max_rss": "114196", "process_out_blocks": "9744", "process_user_time": 5.986316}
[0m23:37:14.059488 [debug] [MainThread]: Command `dbt build` succeeded at 23:37:14.059298 after 3.11 seconds
[0m23:37:14.060095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5dfee4310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5dc9aa580>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x73e5dad28340>]}
[0m23:37:14.060690 [debug] [MainThread]: Flushing usage events
[0m23:38:12.242447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df6caa310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df3900af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df39009a0>]}


============================== 23:38:12.252096 | 89a744fd-3ad1-42b0-812f-0e5003a4eb65 ==============================
[0m23:38:12.252096 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:38:12.253217 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'introspect': 'True', 'indirect_selection': 'eager', 'use_colors': 'True', 'write_json': 'True', 'static_parser': 'True', 'no_print': 'None', 'empty': 'False', 'printer_width': '80', 'partial_parse': 'True', 'fail_fast': 'False', 'profiles_dir': '.', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'version_check': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'target_path': 'None', 'log_cache_events': 'False', 'cache_selected_only': 'False', 'warn_error': 'None'}
[0m23:38:12.546865 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '89a744fd-3ad1-42b0-812f-0e5003a4eb65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df3837160>]}
[0m23:38:12.642020 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '89a744fd-3ad1-42b0-812f-0e5003a4eb65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df3848f70>]}
[0m23:38:12.643354 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:38:12.814617 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:38:13.081916 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:38:13.082619 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:38:13.187706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '89a744fd-3ad1-42b0-812f-0e5003a4eb65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df3065ee0>]}
[0m23:38:13.729048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '89a744fd-3ad1-42b0-812f-0e5003a4eb65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df304f130>]}
[0m23:38:13.730028 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:38:13.733559 [info ] [MainThread]: 
[0m23:38:13.734770 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:38:13.746935 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:38:13.748002 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:38:13.780853 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:38:13.783909 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:38:14.043551 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:38:14.046922 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:38:14.048186 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:38:14.052123 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:38:14.076227 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:38:14.077209 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:38:14.089171 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:38:14.093161 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:38:14.099510 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:14.100836 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:14.115803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '89a744fd-3ad1-42b0-812f-0e5003a4eb65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df2a70820>]}
[0m23:38:14.116874 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:38:14.117546 [info ] [MainThread]: 
[0m23:38:14.130484 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:38:14.131687 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:38:14.132820 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:38:14.133727 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:38:14.151479 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:38:14.152688 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:38:14.221775 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:38:14.276349 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:38:14.277728 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:38:14.287894 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:14.369107 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:38:14.372183 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:38:14.374278 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:38:14.377036 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:38:14.382952 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:38:14.385827 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:38:14.387805 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:38:14.390521 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:38:14.439106 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:38:14.442204 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:38:14.448572 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89a744fd-3ad1-42b0-812f-0e5003a4eb65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df23cd970>]}
[0m23:38:14.449850 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.31s]
[0m23:38:14.451277 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:38:14.452800 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:38:14.453635 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:38:14.454480 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:38:14.455340 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:38:14.456161 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:38:14.457288 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:38:14.458077 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:38:14.459073 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:38:14.459845 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:38:14.460725 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:38:14.461540 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:38:14.482883 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:38:14.485623 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:38:14.492633 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:38:14.499773 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:38:14.501420 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:38:14.502135 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:38:14.518637 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:38:14.555723 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:38:14.559038 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:38:14.567411 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:38:14.569032 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:38:14.570164 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:38:14.572083 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:38:14.670809 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:38:14.678631 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:38:14.682659 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:14.691039 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.23s]
[0m23:38:14.692640 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:14.694178 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:38:14.695685 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:38:14.698460 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.24s]
[0m23:38:14.701498 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:38:14.707784 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:14.710674 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.25s]
[0m23:38:14.712047 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:38:14.713539 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:38:14.714269 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:38:14.715085 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:38:14.716051 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:38:14.717146 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:38:14.718205 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:38:14.719100 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:38:14.719840 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:38:14.720607 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:38:14.721466 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:38:14.722428 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:38:14.723467 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:38:14.742512 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:38:14.751132 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:38:14.758082 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:38:14.759578 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:38:14.760324 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:38:14.766298 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:38:14.814280 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:38:14.909524 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:38:14.933537 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65` 
  ...
[0m23:38:14.954333 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65` 
  ...
[0m23:38:14.958599 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:38:14.959801 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:38:14.971547 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:38:15.003117 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:38:15.036296 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:38:15.043561 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:38:15.059612 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:38:15.053845 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:38:15.062865 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:15.075287 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:38:15.079366 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:38:15.082838 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:38:15.085810 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:38:15.087541 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:38:15.099378 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:38:15.106269 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:38:15.117895 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:38:15.123756 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:38:15.129757 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:38:15.131454 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:15.133368 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:15.139649 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:38:15.143620 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89a744fd-3ad1-42b0-812f-0e5003a4eb65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df38dca30>]}
[0m23:38:15.146533 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:38:15.148417 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.42s]
[0m23:38:15.149877 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:38:15.151842 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:38:15.153193 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:38:15.175595 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:38:15.178016 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65`)
      
    ...
[0m23:38:15.179352 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:38:15.182275 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65`)
      
    ...
[0m23:38:15.204033 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:38:15.211426 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:38:15.212935 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:38:15.219229 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:38:15.221778 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:15.224708 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65` 
    ...
[0m23:38:15.226999 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:15.229736 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65` 
    ...
[0m23:38:15.237015 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:15.249788 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:38:15.250841 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65` 
  ...
[0m23:38:15.266184 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_89a744fd_3ad1_42b0_812f_0e5003a4eb65` 
  ...
[0m23:38:15.273337 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:15.287389 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:38:15.285539 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:38:15.304624 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:38:15.307096 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:15.317855 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89a744fd-3ad1-42b0-812f-0e5003a4eb65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df23cd850>]}
[0m23:38:15.323475 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:38:15.320219 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.60s]
[0m23:38:15.333037 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:38:15.329597 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '89a744fd-3ad1-42b0-812f-0e5003a4eb65', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df22d8b50>]}
[0m23:38:15.336574 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.61s]
[0m23:38:15.339190 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:38:15.348651 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:38:15.349804 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:38:15.350851 [debug] [MainThread]: On list__clean: Close
[0m23:38:15.354072 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:38:15.355120 [debug] [MainThread]: On list__mart: Close
[0m23:38:15.356067 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:38:15.357018 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:38:15.357946 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m23:38:15.358891 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m23:38:15.359821 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:38:15.360769 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:38:15.361688 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:38:15.362602 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:38:15.368177 [info ] [MainThread]: 
[0m23:38:15.369464 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.63 seconds (1.63s).
[0m23:38:15.376381 [debug] [MainThread]: Command end result
[0m23:38:15.485787 [info ] [MainThread]: 
[0m23:38:15.487207 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:38:15.488445 [info ] [MainThread]: 
[0m23:38:15.489659 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:38:15.492078 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.3450096, "process_in_blocks": "0", "process_kernel_time": 0.647045, "process_mem_max_rss": "114008", "process_out_blocks": "9744", "process_user_time": 5.91442}
[0m23:38:15.493636 [debug] [MainThread]: Command `dbt build` succeeded at 23:38:15.493224 after 3.35 seconds
[0m23:38:15.494866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df6caa310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df3837160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x728df5f6fcd0>]}
[0m23:38:15.496065 [debug] [MainThread]: Flushing usage events
[0m23:39:10.944732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aee002db310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aedfcf4ab80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aedfcf4aa30>]}


============================== 23:39:10.967217 | 8978b42f-3e9e-40d1-97d1-bdff8543b3f9 ==============================
[0m23:39:10.967217 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:39:10.969211 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'printer_width': '80', 'log_format': 'default', 'profiles_dir': '.', 'warn_error': 'None', 'partial_parse': 'True', 'fail_fast': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'introspect': 'True', 'debug': 'False', 'version_check': 'True', 'log_cache_events': 'False', 'empty': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'no_print': 'None', 'use_colors': 'True', 'static_parser': 'True', 'target_path': 'None'}
[0m23:39:11.365617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8978b42f-3e9e-40d1-97d1-bdff8543b3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aedfea1dd60>]}
[0m23:39:11.460657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8978b42f-3e9e-40d1-97d1-bdff8543b3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aedfcd875e0>]}
[0m23:39:11.462015 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:39:11.628844 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:39:11.894223 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:39:11.894966 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:39:12.003230 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8978b42f-3e9e-40d1-97d1-bdff8543b3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aedfc69eee0>]}
[0m23:39:12.260134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8978b42f-3e9e-40d1-97d1-bdff8543b3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aedfc688d30>]}
[0m23:39:12.261122 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:39:12.264537 [info ] [MainThread]: 
[0m23:39:12.265668 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:39:12.277492 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:39:12.288064 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:39:12.308972 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:39:12.317800 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:39:12.578437 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:39:12.582641 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:39:12.583963 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:39:12.588138 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:39:12.610769 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:39:12.611802 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:39:12.623574 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:39:12.627580 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:39:12.633808 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:39:12.644494 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:39:12.650474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8978b42f-3e9e-40d1-97d1-bdff8543b3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aedfce85bb0>]}
[0m23:39:12.651571 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:39:12.652209 [info ] [MainThread]: 
[0m23:39:12.665391 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:39:12.666835 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:39:12.667951 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:39:12.668690 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:39:12.685752 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:39:12.686983 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:39:12.757760 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:39:12.815399 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:39:12.816883 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:39:12.829017 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:12.909072 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:39:12.912037 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:39:12.914207 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:39:12.917058 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:39:12.922989 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:39:12.925797 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:39:12.927807 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:39:12.930573 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:39:12.982059 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:39:12.985091 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:39:12.991424 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8978b42f-3e9e-40d1-97d1-bdff8543b3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aedfb91a490>]}
[0m23:39:12.992699 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.32s]
[0m23:39:12.994086 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:39:12.995812 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:39:12.996713 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:39:12.997473 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:39:12.998397 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:39:12.999147 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:39:13.000356 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:39:13.001353 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:39:13.002410 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:39:13.003210 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:39:13.004180 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:39:13.004939 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:39:13.026776 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:39:13.028698 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:39:13.035809 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:39:13.042740 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:39:13.044349 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:39:13.050329 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:39:13.061687 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:39:13.097288 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:39:13.098251 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:39:13.106968 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:39:13.108071 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:39:13.109709 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:39:13.110733 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:39:13.220599 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:39:13.230572 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.232196 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:39:13.239671 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.24s]
[0m23:39:13.241271 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:39:13.243879 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:39:13.248940 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.253224 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.25s]
[0m23:39:13.254909 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.256206 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:39:13.259103 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.26s]
[0m23:39:13.260707 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:39:13.262256 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:39:13.263054 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:39:13.263999 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:39:13.264869 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:39:13.265858 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:39:13.266727 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:39:13.267672 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:39:13.268633 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:39:13.269651 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:39:13.270444 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:39:13.271356 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:39:13.290292 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:39:13.291122 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:39:13.305799 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:39:13.315767 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:39:13.316791 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:39:13.323486 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:39:13.345011 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:39:13.372290 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:39:13.404503 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:39:13.469777 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m23:39:13.491839 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:39:13.497290 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9` 
  ...
[0m23:39:13.506456 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.513351 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.516460 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:39:13.532892 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9` 
  ...
[0m23:39:13.571194 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:39:13.586869 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:39:13.594359 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:39:13.596648 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.601874 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:39:13.604472 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.607816 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:39:13.611652 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:39:13.618948 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:39:13.620371 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:39:13.633924 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:39:13.643909 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:39:13.639591 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:39:13.645753 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:39:13.651798 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8978b42f-3e9e-40d1-97d1-bdff8543b3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aedfcd94e20>]}
[0m23:39:13.653469 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.654663 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.38s]
[0m23:39:13.656011 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.662368 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:39:13.663828 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:39:13.667061 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:39:13.668784 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:39:13.670750 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:39:13.687845 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:39:13.690001 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9`)
      
    ...
[0m23:39:13.692055 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:39:13.694297 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9`)
      
    ...
[0m23:39:13.713499 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:39:13.719837 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:39:13.721592 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:39:13.729973 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:39:13.731834 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.737595 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9` 
    ...
[0m23:39:13.739783 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.746203 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9` 
    ...
[0m23:39:13.748195 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.757374 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9` 
  ...
[0m23:39:13.759189 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.768523 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_8978b42f_3e9e_40d1_97d1_bdff8543b3f9` 
  ...
[0m23:39:13.769883 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.776791 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:39:13.778008 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.785103 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:39:13.786419 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:39:13.790510 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8978b42f-3e9e-40d1-97d1-bdff8543b3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aedfc28ef40>]}
[0m23:39:13.791749 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:39:13.792856 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.52s]
[0m23:39:13.796080 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8978b42f-3e9e-40d1-97d1-bdff8543b3f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aedfb91af40>]}
[0m23:39:13.797431 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:39:13.798778 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.53s]
[0m23:39:13.800210 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:39:13.802223 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:39:13.802820 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:39:13.803373 [debug] [MainThread]: On list__clean: Close
[0m23:39:13.803868 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:39:13.804418 [debug] [MainThread]: On list__mart: Close
[0m23:39:13.804909 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:39:13.805461 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:39:13.805974 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:39:13.806538 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:39:13.807020 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m23:39:13.807550 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m23:39:13.808030 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:39:13.808558 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:39:13.809741 [info ] [MainThread]: 
[0m23:39:13.810450 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.54 seconds (1.54s).
[0m23:39:13.814246 [debug] [MainThread]: Command end result
[0m23:39:13.874626 [info ] [MainThread]: 
[0m23:39:13.875626 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:39:13.876231 [info ] [MainThread]: 
[0m23:39:13.876959 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:39:13.878365 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.1101215, "process_in_blocks": "0", "process_kernel_time": 0.675572, "process_mem_max_rss": "114360", "process_out_blocks": "9744", "process_user_time": 5.756357}
[0m23:39:13.879176 [debug] [MainThread]: Command `dbt build` succeeded at 23:39:13.878976 after 3.11 seconds
[0m23:39:13.879834 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aee002db310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aedfea1dd60>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7aedfb1cd4f0>]}
[0m23:39:13.880503 [debug] [MainThread]: Flushing usage events
[0m23:40:15.085793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a32032310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a2ec83ac0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a2ec83970>]}


============================== 23:40:15.095458 | 6ef4c15f-00a3-412e-abdc-fe1c9ded18ea ==============================
[0m23:40:15.095458 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:40:15.096572 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'partial_parse': 'True', 'static_parser': 'True', 'warn_error': 'None', 'use_colors': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'printer_width': '80', 'write_json': 'True', 'version_check': 'True', 'fail_fast': 'False', 'target_path': 'None', 'empty': 'False', 'cache_selected_only': 'False', 'debug': 'False', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'no_print': 'None', 'profiles_dir': '.', 'log_cache_events': 'False'}
[0m23:40:15.387381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6ef4c15f-00a3-412e-abdc-fe1c9ded18ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a2eb7b5e0>]}
[0m23:40:15.481312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6ef4c15f-00a3-412e-abdc-fe1c9ded18ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a3224df10>]}
[0m23:40:15.482602 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:40:15.647621 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:40:15.917346 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:40:15.918016 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:40:16.019603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6ef4c15f-00a3-412e-abdc-fe1c9ded18ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a2e3e8f10>]}
[0m23:40:16.276102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6ef4c15f-00a3-412e-abdc-fe1c9ded18ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a2e4261f0>]}
[0m23:40:16.277058 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:40:16.280399 [info ] [MainThread]: 
[0m23:40:16.281505 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:40:16.293563 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:40:16.294727 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:40:16.332482 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:40:16.333245 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:40:16.608278 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:40:16.614035 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:40:16.618535 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:40:16.622643 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:40:16.648333 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:40:16.649333 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:40:16.661108 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:40:16.665006 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:40:16.671246 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:16.672684 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:16.693893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ef4c15f-00a3-412e-abdc-fe1c9ded18ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a2ece3220>]}
[0m23:40:16.695510 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:40:16.696529 [info ] [MainThread]: 
[0m23:40:16.713470 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:40:16.714633 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:40:16.715681 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:40:16.716417 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:40:16.733167 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:40:16.734464 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:40:16.808881 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:40:16.919878 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:40:16.922348 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:40:16.940537 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:40:17.074661 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:40:17.080031 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:40:17.084113 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:40:17.089507 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:40:17.101656 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:40:17.107201 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:40:17.111380 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:40:17.116850 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:40:17.206571 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:40:17.211972 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:40:17.223470 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ef4c15f-00a3-412e-abdc-fe1c9ded18ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a2d6808b0>]}
[0m23:40:17.225762 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.50s]
[0m23:40:17.228440 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:40:17.234649 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:40:17.236377 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:40:17.238210 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:40:17.239786 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:40:17.241709 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:40:17.243481 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:40:17.247440 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:40:17.249280 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:40:17.252513 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:40:17.254644 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:40:17.266218 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:40:17.284938 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:40:17.338184 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:40:17.348772 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:40:17.350843 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:40:17.329617 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:40:17.376070 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:40:17.401518 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:40:17.445877 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:40:17.449100 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:40:17.450470 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:40:17.452220 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:40:17.453284 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:40:17.454441 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:40:17.570073 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:40:17.578615 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:40:17.582526 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:17.584107 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:40:17.592505 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:17.590543 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.34s]
[0m23:40:17.598123 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.36s]
[0m23:40:17.599870 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:40:17.601839 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:40:17.605239 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:17.608074 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.35s]
[0m23:40:17.609420 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:40:17.611021 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:40:17.611863 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:40:17.612760 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:40:17.613725 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:40:17.614823 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:40:17.616055 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:40:17.616995 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:40:17.617783 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:40:17.618580 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:40:17.619379 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:40:17.620214 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:40:17.621096 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:40:17.640551 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:40:17.648688 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:40:17.655369 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:40:17.656728 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:40:17.657636 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:40:17.679032 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:40:17.726513 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:40:17.823529 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:40:17.828925 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea` 
  ...
[0m23:40:17.845592 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea` 
  ...
[0m23:40:17.848768 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:17.860519 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:40:17.861935 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:17.880479 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:40:17.928694 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:40:17.930393 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:17.935092 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:40:17.938376 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:40:17.943114 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:40:17.951007 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:40:17.953925 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:40:17.956946 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:40:17.961276 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:40:17.962927 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:40:17.972391 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:40:17.974126 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:40:17.990374 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:40:17.997754 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:40:17.999205 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:18.005007 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ef4c15f-00a3-412e-abdc-fe1c9ded18ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a2d6dd130>]}
[0m23:40:18.008113 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:18.006368 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.39s]
[0m23:40:18.010338 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:18.016806 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:40:18.018178 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:40:18.021055 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:40:18.022776 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:40:18.024805 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:40:18.044029 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:40:18.047519 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea`)
      
    ...
[0m23:40:18.049118 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:40:18.052366 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea`)
      
    ...
[0m23:40:18.070673 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:40:18.076141 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:40:18.078672 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:40:18.083679 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:40:18.085995 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:18.088913 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea` 
    ...
[0m23:40:18.093294 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:18.096278 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea` 
    ...
[0m23:40:18.097523 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:18.104701 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea` 
  ...
[0m23:40:18.106113 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:18.113499 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_6ef4c15f_00a3_412e_abdc_fe1c9ded18ea` 
  ...
[0m23:40:18.114925 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:18.121929 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:40:18.124061 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:18.130062 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:40:18.132353 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:18.135572 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ef4c15f-00a3-412e-abdc-fe1c9ded18ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a2d6dd700>]}
[0m23:40:18.136756 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.52s]
[0m23:40:18.138158 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:40:18.139558 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:40:18.142854 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ef4c15f-00a3-412e-abdc-fe1c9ded18ea', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a2e1702e0>]}
[0m23:40:18.144327 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.53s]
[0m23:40:18.145662 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:40:18.147569 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:40:18.148119 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:40:18.148661 [debug] [MainThread]: On list__clean: Close
[0m23:40:18.149143 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:40:18.149646 [debug] [MainThread]: On list__mart: Close
[0m23:40:18.150103 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:40:18.150616 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:40:18.151074 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:40:18.151563 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:40:18.152015 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:40:18.152531 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:40:18.152998 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m23:40:18.153487 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m23:40:18.154649 [info ] [MainThread]: 
[0m23:40:18.155339 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.87 seconds (1.87s).
[0m23:40:18.159039 [debug] [MainThread]: Command end result
[0m23:40:18.215995 [info ] [MainThread]: 
[0m23:40:18.216907 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:40:18.217488 [info ] [MainThread]: 
[0m23:40:18.218095 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:40:18.219432 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.230723, "process_in_blocks": "0", "process_kernel_time": 0.63575, "process_mem_max_rss": "114536", "process_out_blocks": "9744", "process_user_time": 5.87769}
[0m23:40:18.220198 [debug] [MainThread]: Command `dbt build` succeeded at 23:40:18.220000 after 3.23 seconds
[0m23:40:18.220838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a32032310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a2feb8af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7f4a2f7b40a0>]}
[0m23:40:18.221418 [debug] [MainThread]: Flushing usage events
[0m23:41:17.273561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005c17ad310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005be408af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005be4089a0>]}


============================== 23:41:17.283328 | 42cad62e-8b3a-4f5e-9c48-ebb79677b313 ==============================
[0m23:41:17.283328 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:41:17.284468 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'debug': 'False', 'warn_error': 'None', 'log_cache_events': 'False', 'partial_parse': 'True', 'profiles_dir': '.', 'invocation_command': 'dbt build --profiles-dir . --target local', 'no_print': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'use_experimental_parser': 'False', 'version_check': 'True', 'printer_width': '80', 'log_format': 'default', 'fail_fast': 'False', 'cache_selected_only': 'False', 'empty': 'False', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'static_parser': 'True', 'introspect': 'True', 'use_colors': 'True', 'write_json': 'True', 'target_path': 'None'}
[0m23:41:17.808922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '42cad62e-8b3a-4f5e-9c48-ebb79677b313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005c0d453a0>]}
[0m23:41:17.913929 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '42cad62e-8b3a-4f5e-9c48-ebb79677b313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005be4ca3a0>]}
[0m23:41:17.915299 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:41:18.107177 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:41:18.377711 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:41:18.378397 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:41:18.483172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '42cad62e-8b3a-4f5e-9c48-ebb79677b313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005bdb72ee0>]}
[0m23:41:18.874072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '42cad62e-8b3a-4f5e-9c48-ebb79677b313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005bdb5cc70>]}
[0m23:41:18.875017 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:41:18.878427 [info ] [MainThread]: 
[0m23:41:18.879553 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:41:18.891724 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:41:18.892788 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:41:18.921335 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:41:18.929945 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:41:19.179393 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:41:19.182899 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:19.186087 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:41:19.191113 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:19.212142 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:41:19.213177 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:41:19.225075 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:41:19.228981 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:41:19.234960 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:41:19.236152 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:41:19.251220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '42cad62e-8b3a-4f5e-9c48-ebb79677b313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005be2ed370>]}
[0m23:41:19.252217 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:41:19.253010 [info ] [MainThread]: 
[0m23:41:19.266390 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:41:19.267582 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:41:19.268686 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:41:19.269479 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:41:19.286828 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:41:19.288350 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:41:19.356591 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:41:19.410392 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:41:19.411832 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:41:19.421716 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:41:19.501710 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:41:19.504841 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:19.506919 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:41:19.509725 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:19.515725 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:41:19.518632 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:19.520654 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:41:19.523425 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:19.571914 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:41:19.575064 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:19.581390 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42cad62e-8b3a-4f5e-9c48-ebb79677b313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005c0d3d7f0>]}
[0m23:41:19.582651 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.31s]
[0m23:41:19.584004 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:41:19.585702 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:41:19.586513 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:41:19.587362 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:41:19.588216 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:41:19.588999 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:41:19.590116 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:41:19.591033 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:41:19.592012 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:41:19.592909 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:41:19.593957 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:41:19.594783 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:41:19.611391 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:41:19.618364 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:41:19.625314 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:41:19.632461 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:41:19.633970 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:41:19.634987 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:41:19.635769 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:41:19.693043 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:41:19.707577 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:41:19.710205 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:41:19.712840 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:41:19.715734 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:41:19.717964 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:41:19.837395 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:41:19.846051 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:41:19.849781 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:41:19.855500 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:41:19.857432 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:41:19.866024 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:41:19.864066 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.27s]
[0m23:41:19.869480 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.28s]
[0m23:41:19.874118 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.28s]
[0m23:41:19.875814 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:41:19.877135 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:41:19.878561 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:41:19.880749 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:41:19.881749 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:41:19.882902 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:41:19.883912 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:41:19.885350 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:41:19.886699 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:41:19.887663 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:41:19.888504 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:41:19.889485 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:41:19.890518 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:41:19.891535 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:41:19.892312 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:41:19.912170 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:41:19.920479 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:41:19.927384 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:41:19.928930 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:41:19.929653 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:41:19.940764 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:41:19.988144 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:41:20.058135 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:41:20.133598 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313` 
  ...
[0m23:41:20.140629 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m23:41:20.145324 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313` 
  ...
[0m23:41:20.159624 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:41:20.157765 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:41:20.173648 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:41:20.212571 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:41:20.257638 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:41:20.258856 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:41:20.261142 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:41:20.268875 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:20.275689 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:41:20.278682 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:20.280973 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:41:20.284069 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:20.291512 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:41:20.292941 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:41:20.294561 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:41:20.314135 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:41:20.320149 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:41:20.324194 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:41:20.327522 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42cad62e-8b3a-4f5e-9c48-ebb79677b313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005be0e7d30>]}
[0m23:41:20.331989 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.44s]
[0m23:41:20.334031 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:41:20.335973 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:41:20.336950 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:41:20.343371 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:41:20.347201 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:41:20.348826 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:41:20.350189 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:41:20.370118 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:41:20.373781 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313`)
      
    ...
[0m23:41:20.376911 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:41:20.379251 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313`)
      
    ...
[0m23:41:20.401044 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:41:20.406745 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:41:20.408147 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:41:20.415318 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:41:20.416965 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:41:20.422452 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313` 
    ...
[0m23:41:20.424029 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:41:20.427652 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313` 
    ...
[0m23:41:20.432627 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:41:20.433904 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:41:20.440812 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313` 
  ...
[0m23:41:20.447733 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_42cad62e_8b3a_4f5e_9c48_ebb79677b313` 
  ...
[0m23:41:20.451466 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:20.452681 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:20.458536 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:41:20.464505 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:41:20.467857 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:20.469095 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:41:20.472259 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42cad62e-8b3a-4f5e-9c48-ebb79677b313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005bcde5d60>]}
[0m23:41:20.475257 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '42cad62e-8b3a-4f5e-9c48-ebb79677b313', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005be2ed550>]}
[0m23:41:20.476484 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.58s]
[0m23:41:20.477668 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.59s]
[0m23:41:20.478980 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:41:20.480392 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:41:20.482593 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:41:20.483138 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:41:20.483666 [debug] [MainThread]: On list__mart: Close
[0m23:41:20.484160 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:41:20.484655 [debug] [MainThread]: On list__clean: Close
[0m23:41:20.485111 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:41:20.485603 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:41:20.486061 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:41:20.486559 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:41:20.487004 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m23:41:20.487501 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m23:41:20.487955 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:41:20.488437 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:41:20.489609 [info ] [MainThread]: 
[0m23:41:20.490305 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.61 seconds (1.61s).
[0m23:41:20.494082 [debug] [MainThread]: Command end result
[0m23:41:20.551038 [info ] [MainThread]: 
[0m23:41:20.551913 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:41:20.552527 [info ] [MainThread]: 
[0m23:41:20.553143 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:41:20.554517 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.3769724, "process_in_blocks": "0", "process_kernel_time": 0.641327, "process_mem_max_rss": "114352", "process_out_blocks": "9744", "process_user_time": 5.926781}
[0m23:41:20.555218 [debug] [MainThread]: Command `dbt build` succeeded at 23:41:20.555035 after 3.38 seconds
[0m23:41:20.555861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005c17ad310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005bf73b850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7005bf738d00>]}
[0m23:41:20.556427 [debug] [MainThread]: Flushing usage events
[0m23:42:13.005172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f352967310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f34f5deb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f34f5dea00>]}


============================== 23:42:13.014993 | 387a5f24-ec68-4844-b542-839b5960497e ==============================
[0m23:42:13.014993 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:42:13.016082 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'no_print': 'None', 'empty': 'False', 'use_experimental_parser': 'False', 'profiles_dir': '.', 'debug': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'cache_selected_only': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'introspect': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'partial_parse': 'True', 'use_colors': 'True', 'target_path': 'None', 'version_check': 'True', 'write_json': 'True', 'log_format': 'default'}
[0m23:42:13.301665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '387a5f24-ec68-4844-b542-839b5960497e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f34f538fa0>]}
[0m23:42:13.396045 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '387a5f24-ec68-4844-b542-839b5960497e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f34f5aa3d0>]}
[0m23:42:13.397378 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:42:13.567759 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:42:13.833966 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:42:13.834985 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:42:13.949426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '387a5f24-ec68-4844-b542-839b5960497e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f34ed32e80>]}
[0m23:42:14.200554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '387a5f24-ec68-4844-b542-839b5960497e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f34ed47670>]}
[0m23:42:14.201492 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:42:14.204797 [info ] [MainThread]: 
[0m23:42:14.205928 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:42:14.217687 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:42:14.228341 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:42:14.253138 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:42:14.256349 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:42:14.510546 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:42:14.515868 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:14.518312 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:42:14.522928 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:14.545678 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:42:14.557402 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:42:14.558585 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:42:14.562350 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:42:14.569825 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:42:14.571391 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:42:14.586257 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '387a5f24-ec68-4844-b542-839b5960497e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f34f538cd0>]}
[0m23:42:14.587294 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:42:14.587933 [info ] [MainThread]: 
[0m23:42:14.600537 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:42:14.601756 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:42:14.602855 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:42:14.603613 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:42:14.620307 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:42:14.621534 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:42:14.689636 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:42:14.747365 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:42:14.748972 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:42:14.759679 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:42:14.837992 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:42:14.840989 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:14.843018 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:42:14.845799 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:14.851750 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:42:14.854749 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:14.856864 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:42:14.859653 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:14.909079 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:42:14.912247 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:14.918467 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '387a5f24-ec68-4844-b542-839b5960497e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f34dfc2f10>]}
[0m23:42:14.919736 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.31s]
[0m23:42:14.921040 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:42:14.922664 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:42:14.923490 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:42:14.924281 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:42:14.925193 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:42:14.926068 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:42:14.927262 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:42:14.928141 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:42:14.929157 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:42:14.929918 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:42:14.930877 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:42:14.931672 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:42:14.947925 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:42:14.956503 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:42:14.964095 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:42:14.972974 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:42:14.974451 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:42:14.975227 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:42:15.002556 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:42:15.010471 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:42:15.013493 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:42:15.018077 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:42:15.019724 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:42:15.020707 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:42:15.022139 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:42:15.121794 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:42:15.127509 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:42:15.131966 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:42:15.133230 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:42:15.139859 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.21s]
[0m23:42:15.141492 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:42:15.143901 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:42:15.147104 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.22s]
[0m23:42:15.148983 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:42:15.150748 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:42:15.153664 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.23s]
[0m23:42:15.154990 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:42:15.156549 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:42:15.157337 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:42:15.158207 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:42:15.159299 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:42:15.160478 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:42:15.161569 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:42:15.162496 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:42:15.163240 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:42:15.164050 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:42:15.164889 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:42:15.165695 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:42:15.166530 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:42:15.185659 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:42:15.194032 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:42:15.200903 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:42:15.202349 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:42:15.203063 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:42:15.239906 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:42:15.267908 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:42:15.373146 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:42:15.378727 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e` 
  ...
[0m23:42:15.391873 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e` 
  ...
[0m23:42:15.396718 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:15.414192 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:42:15.415364 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:42:15.451277 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:42:15.463604 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:42:15.464340 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:42:15.468511 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:15.470766 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:42:15.474165 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:15.480662 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:42:15.483998 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:15.486289 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:42:15.488632 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:42:15.489794 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:15.502025 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:42:15.507734 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:42:15.514734 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:42:15.519710 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:42:15.525043 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:15.528509 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '387a5f24-ec68-4844-b542-839b5960497e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f34d8bfd30>]}
[0m23:42:15.529968 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:42:15.531155 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.36s]
[0m23:42:15.532568 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:42:15.539391 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:42:15.540955 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:42:15.544102 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:42:15.546058 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:42:15.548601 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:42:15.568683 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:42:15.572920 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e`)
      
    ...
[0m23:42:15.576502 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:42:15.579010 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e`)
      
    ...
[0m23:42:15.601066 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:42:15.609253 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:42:15.610818 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:42:15.617273 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:42:15.618957 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:42:15.623326 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e` 
    ...
[0m23:42:15.625013 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:42:15.629104 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e` 
    ...
[0m23:42:15.632336 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:42:15.645480 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:42:15.646422 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e` 
  ...
[0m23:42:15.653663 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_387a5f24_ec68_4844_b542_839b5960497e` 
  ...
[0m23:42:15.657668 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:15.658874 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:15.664803 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:42:15.670900 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:42:15.673944 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:15.675141 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:42:15.678354 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '387a5f24-ec68-4844-b542-839b5960497e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f34e8ef1c0>]}
[0m23:42:15.681327 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '387a5f24-ec68-4844-b542-839b5960497e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f34e027b50>]}
[0m23:42:15.682461 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.52s]
[0m23:42:15.683651 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.52s]
[0m23:42:15.685007 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:42:15.686309 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:42:15.688531 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:42:15.689072 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:42:15.689604 [debug] [MainThread]: On list__mart: Close
[0m23:42:15.690076 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:42:15.690621 [debug] [MainThread]: On list__clean: Close
[0m23:42:15.691070 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:42:15.691630 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:42:15.692102 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m23:42:15.692691 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m23:42:15.693195 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:42:15.693716 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:42:15.694177 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:42:15.694699 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:42:15.695894 [info ] [MainThread]: 
[0m23:42:15.696632 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.49 seconds (1.49s).
[0m23:42:15.700879 [debug] [MainThread]: Command end result
[0m23:42:15.829318 [info ] [MainThread]: 
[0m23:42:15.830206 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:42:15.830789 [info ] [MainThread]: 
[0m23:42:15.831399 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:42:15.832704 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.9223466, "process_in_blocks": "0", "process_kernel_time": 0.644543, "process_mem_max_rss": "114292", "process_out_blocks": "9744", "process_user_time": 5.776912}
[0m23:42:15.833426 [debug] [MainThread]: Command `dbt build` succeeded at 23:42:15.833229 after 2.92 seconds
[0m23:42:15.834021 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f352967310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f35088b160>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x75f34f2a8f10>]}
[0m23:42:15.834597 [debug] [MainThread]: Flushing usage events
[0m23:43:12.880808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df924e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df5eb74f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df5eb7640>]}


============================== 23:43:12.890426 | e5166833-5738-4132-ae76-eb60a2cdcaba ==============================
[0m23:43:12.890426 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:43:12.891515 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'no_print': 'None', 'log_path': '/workdir/transforms/04_btc/logs', 'target_path': 'None', 'use_colors': 'True', 'debug': 'False', 'introspect': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default', 'write_json': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'warn_error': 'None', 'cache_selected_only': 'False', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'printer_width': '80', 'indirect_selection': 'eager', 'profiles_dir': '.', 'use_experimental_parser': 'False', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'partial_parse': 'True'}
[0m23:43:13.178383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e5166833-5738-4132-ae76-eb60a2cdcaba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df87e2ca0>]}
[0m23:43:13.277619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e5166833-5738-4132-ae76-eb60a2cdcaba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df7d1fca0>]}
[0m23:43:13.279108 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:43:13.450001 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:43:13.717839 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:43:13.718528 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:43:13.827977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e5166833-5738-4132-ae76-eb60a2cdcaba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df560eeb0>]}
[0m23:43:14.088166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e5166833-5738-4132-ae76-eb60a2cdcaba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df54fcdc0>]}
[0m23:43:14.089074 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:43:14.092486 [info ] [MainThread]: 
[0m23:43:14.093601 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:43:14.105485 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:43:14.106572 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:43:14.138923 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:43:14.141955 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:43:14.415389 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:43:14.420410 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:14.422668 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:43:14.427717 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:14.451001 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:43:14.457485 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:43:14.472117 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:43:14.473200 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:43:14.480532 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:43:14.482169 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:43:14.499920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e5166833-5738-4132-ae76-eb60a2cdcaba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df4d1fa00>]}
[0m23:43:14.501383 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:43:14.502204 [info ] [MainThread]: 
[0m23:43:14.515052 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:43:14.516222 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:43:14.517344 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:43:14.518125 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:43:14.535450 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:43:14.536646 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:43:14.604790 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:43:14.661930 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:43:14.663436 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:43:14.673374 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:43:14.752914 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:43:14.755898 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:14.758050 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:43:14.760906 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:14.766877 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:43:14.769753 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:14.771690 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:43:14.774496 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:14.823848 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:43:14.827042 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:14.833253 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e5166833-5738-4132-ae76-eb60a2cdcaba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df4972dc0>]}
[0m23:43:14.834575 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.31s]
[0m23:43:14.835912 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:43:14.837565 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:43:14.838327 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:43:14.839308 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:43:14.840370 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:43:14.841286 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:43:14.842278 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:43:14.843516 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:43:14.844521 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:43:14.845418 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:43:14.846182 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:43:14.846999 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:43:14.847773 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:43:14.873667 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:43:14.888335 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:43:14.902938 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:43:14.905200 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:43:14.906937 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:43:14.934178 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:43:14.953517 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:43:14.956957 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:43:14.961309 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:43:14.962954 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:43:14.963700 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:43:14.964454 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:43:15.069752 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:43:15.074508 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:43:15.078368 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:43:15.086452 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.24s]
[0m23:43:15.088356 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:43:15.089766 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:43:15.090992 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:43:15.094087 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.25s]
[0m23:43:15.096914 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:43:15.102421 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:43:15.105394 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.26s]
[0m23:43:15.106801 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:43:15.108402 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:43:15.109172 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:43:15.110172 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:43:15.111050 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:43:15.111981 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:43:15.112854 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:43:15.113885 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:43:15.114716 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:43:15.115499 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:43:15.116230 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:43:15.116984 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:43:15.135574 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:43:15.136446 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:43:15.144684 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:43:15.152041 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:43:15.153113 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:43:15.154124 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:43:15.170411 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:43:15.193455 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:43:15.288895 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:43:15.336110 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba` 
  ...
[0m23:43:15.347688 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba` 
  ...
[0m23:43:15.349649 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:43:15.353009 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:15.359681 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:43:15.361194 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:43:15.425346 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:43:15.437750 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:43:15.450291 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:43:15.452746 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:43:15.458819 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:43:15.461280 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:43:15.465501 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:15.469201 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:43:15.473388 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:15.485146 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:43:15.487010 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:43:15.489454 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:43:15.502105 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:43:15.507839 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:43:15.513301 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:43:15.517475 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e5166833-5738-4132-ae76-eb60a2cdcaba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df492e0d0>]}
[0m23:43:15.521580 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.40s]
[0m23:43:15.523527 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:15.525410 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:43:15.532557 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:43:15.533873 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:43:15.537019 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:43:15.538435 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:43:15.539470 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:43:15.559594 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:43:15.561718 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba`)
      
    ...
[0m23:43:15.563724 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:43:15.566012 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba`)
      
    ...
[0m23:43:15.588552 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:43:15.593985 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:43:15.595476 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:43:15.602621 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:43:15.605046 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:43:15.607982 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba` 
    ...
[0m23:43:15.610220 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:43:15.613227 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba` 
    ...
[0m23:43:15.618278 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:15.624839 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:43:15.625789 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba` 
  ...
[0m23:43:15.631589 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e5166833_5738_4132_ae76_eb60a2cdcaba` 
  ...
[0m23:43:15.635573 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:15.636809 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:15.642627 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:43:15.648702 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:43:15.651825 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:15.653328 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:43:15.656506 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e5166833-5738-4132-ae76-eb60a2cdcaba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df4fda460>]}
[0m23:43:15.659521 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e5166833-5738-4132-ae76-eb60a2cdcaba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df41ca460>]}
[0m23:43:15.660840 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.54s]
[0m23:43:15.662098 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.54s]
[0m23:43:15.663488 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:43:15.664809 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:43:15.667057 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:43:15.667632 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:43:15.668170 [debug] [MainThread]: On list__clean: Close
[0m23:43:15.668690 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:43:15.669198 [debug] [MainThread]: On list__mart: Close
[0m23:43:15.669723 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:43:15.670225 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:43:15.670731 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:43:15.671266 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:43:15.671745 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:43:15.672252 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:43:15.672779 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m23:43:15.673299 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m23:43:15.674482 [info ] [MainThread]: 
[0m23:43:15.675164 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.58 seconds (1.58s).
[0m23:43:15.678866 [debug] [MainThread]: Command end result
[0m23:43:15.794617 [info ] [MainThread]: 
[0m23:43:15.795551 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:43:15.796105 [info ] [MainThread]: 
[0m23:43:15.796721 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:43:15.798032 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.012994, "process_in_blocks": "0", "process_kernel_time": 0.648149, "process_mem_max_rss": "114176", "process_out_blocks": "9744", "process_user_time": 5.941541}
[0m23:43:15.798781 [debug] [MainThread]: Command `dbt build` succeeded at 23:43:15.798590 after 3.01 seconds
[0m23:43:15.799389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df924e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df7d1fca0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x793df87e2ca0>]}
[0m23:43:15.799968 [debug] [MainThread]: Flushing usage events
[0m23:44:12.192657 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70426c396e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704268fefbb0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704268fefa60>]}


============================== 23:44:12.202200 | e8bd5bb2-06bc-4e13-bc45-b5099c606eb3 ==============================
[0m23:44:12.202200 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:44:12.203369 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'profiles_dir': '.', 'indirect_selection': 'eager', 'quiet': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'version_check': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default', 'cache_selected_only': 'False', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'printer_width': '80', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'debug': 'False', 'no_print': 'None', 'partial_parse': 'True', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'write_json': 'True', 'use_colors': 'True'}
[0m23:44:12.488910 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e8bd5bb2-06bc-4e13-bc45-b5099c606eb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704268edcb20>]}
[0m23:44:12.583932 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e8bd5bb2-06bc-4e13-bc45-b5099c606eb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70426945f370>]}
[0m23:44:12.585307 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:44:12.758216 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:44:13.029966 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:44:13.030641 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:44:13.134055 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e8bd5bb2-06bc-4e13-bc45-b5099c606eb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70426875ee50>]}
[0m23:44:13.389778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e8bd5bb2-06bc-4e13-bc45-b5099c606eb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7042687812e0>]}
[0m23:44:13.390787 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:44:13.394585 [info ] [MainThread]: 
[0m23:44:13.395826 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:44:13.408343 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:44:13.409562 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:44:13.434056 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:44:13.438116 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:44:13.723169 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:44:13.726697 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:44:13.731848 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:44:13.737786 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:44:13.758055 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:44:13.759094 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:44:13.771145 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:44:13.775341 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:44:13.781613 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:13.788176 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:13.797579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8bd5bb2-06bc-4e13-bc45-b5099c606eb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7042690298b0>]}
[0m23:44:13.798571 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:44:13.799180 [info ] [MainThread]: 
[0m23:44:13.812054 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:44:13.813279 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:44:13.814403 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:44:13.815354 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:44:13.832040 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:44:13.833318 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:44:13.907340 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:44:13.967759 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:44:13.969128 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:44:13.981848 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:14.061523 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:44:14.064507 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:44:14.066551 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:44:14.069387 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:44:14.075288 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:44:14.078652 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:44:14.080650 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:44:14.084177 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:44:14.133918 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:44:14.136963 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:44:14.143145 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8bd5bb2-06bc-4e13-bc45-b5099c606eb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704267b26550>]}
[0m23:44:14.144536 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.33s]
[0m23:44:14.145902 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:44:14.147545 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:44:14.148353 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:44:14.149221 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:44:14.150030 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:44:14.150917 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:44:14.151800 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:44:14.152903 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:44:14.153824 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:44:14.154721 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:44:14.155521 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:44:14.156279 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:44:14.157025 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:44:14.185390 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:44:14.187381 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:44:14.194282 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:44:14.195828 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:44:14.201751 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:44:14.212912 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:44:14.250554 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:44:14.257130 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:44:14.256023 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:44:14.259358 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:44:14.260858 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:44:14.262478 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:44:14.370443 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:44:14.377916 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:44:14.379997 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:14.394156 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:14.392643 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.24s]
[0m23:44:14.395825 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:44:14.398581 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.24s]
[0m23:44:14.400437 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:44:14.403179 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:44:14.408554 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:14.411599 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.26s]
[0m23:44:14.412935 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:44:14.414440 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:44:14.415349 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:44:14.416420 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:44:14.417436 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:44:14.418798 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:44:14.420105 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:44:14.421007 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:44:14.421873 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:44:14.422899 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:44:14.423676 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:44:14.424593 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:44:14.425650 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:44:14.445050 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:44:14.459646 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:44:14.467638 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:44:14.469272 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:44:14.480715 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:44:14.492231 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:44:14.515438 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:44:14.557937 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:44:14.629009 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:44:14.677881 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3` 
  ...
[0m23:44:14.691969 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3` 
  ...
[0m23:44:14.693467 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:44:14.697470 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:44:14.698986 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:44:14.722337 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:44:14.768003 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:44:14.788693 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:44:14.797406 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:44:14.800437 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:14.809399 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:44:14.812663 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:44:14.814727 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:44:14.817692 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:44:14.824588 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:44:14.825999 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:44:14.827913 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:44:14.845706 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:44:14.866807 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:44:14.867873 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:44:14.870383 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8bd5bb2-06bc-4e13-bc45-b5099c606eb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7042684d6a90>]}
[0m23:44:14.875036 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.45s]
[0m23:44:14.877283 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:14.879040 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:44:14.880559 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:14.890868 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:44:14.894320 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:44:14.896088 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:44:14.897494 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:44:14.917982 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:44:14.920109 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3`)
      
    ...
[0m23:44:14.921377 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:44:14.925222 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3`)
      
    ...
[0m23:44:14.941809 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:44:14.947333 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:44:14.948722 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:44:14.955950 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:44:14.959296 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:14.962801 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3` 
    ...
[0m23:44:14.965198 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:14.968517 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3` 
    ...
[0m23:44:14.969814 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:14.978919 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3` 
  ...
[0m23:44:14.980337 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:14.986917 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e8bd5bb2_06bc_4e13_bc45_b5099c606eb3` 
  ...
[0m23:44:14.988446 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:14.995831 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:44:14.997111 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:15.004673 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:44:15.006229 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:44:15.010491 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8bd5bb2-06bc-4e13-bc45-b5099c606eb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704268318c40>]}
[0m23:44:15.011809 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:44:15.012970 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.59s]
[0m23:44:15.016207 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8bd5bb2-06bc-4e13-bc45-b5099c606eb3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7042672e8c70>]}
[0m23:44:15.017657 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:44:15.018900 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.59s]
[0m23:44:15.020553 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:44:15.022469 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:44:15.023003 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:44:15.023549 [debug] [MainThread]: On list__clean: Close
[0m23:44:15.024031 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:44:15.024537 [debug] [MainThread]: On list__mart: Close
[0m23:44:15.025002 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:44:15.025523 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:44:15.026011 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:44:15.026512 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:44:15.026964 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:44:15.027499 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:44:15.027951 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m23:44:15.028547 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m23:44:15.029693 [info ] [MainThread]: 
[0m23:44:15.030381 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.63 seconds (1.63s).
[0m23:44:15.034286 [debug] [MainThread]: Command end result
[0m23:44:15.093777 [info ] [MainThread]: 
[0m23:44:15.094597 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:44:15.095176 [info ] [MainThread]: 
[0m23:44:15.095786 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:44:15.097084 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.998145, "process_in_blocks": "0", "process_kernel_time": 0.71665, "process_mem_max_rss": "114108", "process_out_blocks": "9744", "process_user_time": 6.026471}
[0m23:44:15.097822 [debug] [MainThread]: Command `dbt build` succeeded at 23:44:15.097640 after 3.00 seconds
[0m23:44:15.098437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70426c396e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x704268edcb20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7042684ee3d0>]}
[0m23:44:15.099004 [debug] [MainThread]: Flushing usage events
[0m23:45:13.976181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fcb8a3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fc8501b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fc8501a30>]}


============================== 23:45:13.985960 | 890e9f56-7b14-451a-a73c-b2195e3101b9 ==============================
[0m23:45:13.985960 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:45:13.987024 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'printer_width': '80', 'no_print': 'None', 'log_cache_events': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'profiles_dir': '.', 'use_colors': 'True', 'fail_fast': 'False', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'introspect': 'True', 'quiet': 'False', 'write_json': 'True', 'empty': 'False', 'version_check': 'True', 'warn_error': 'None'}
[0m23:45:14.282927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '890e9f56-7b14-451a-a73c-b2195e3101b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fc85012b0>]}
[0m23:45:14.379977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '890e9f56-7b14-451a-a73c-b2195e3101b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fc84d71f0>]}
[0m23:45:14.381686 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:45:14.553820 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:45:14.830129 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:45:14.830820 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:45:14.933311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '890e9f56-7b14-451a-a73c-b2195e3101b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fc7c64e80>]}
[0m23:45:15.181683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '890e9f56-7b14-451a-a73c-b2195e3101b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fc7c4ef70>]}
[0m23:45:15.182591 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:45:15.186254 [info ] [MainThread]: 
[0m23:45:15.187437 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:45:15.199259 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:45:15.200498 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:45:15.230059 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:45:15.238216 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:45:15.498876 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:45:15.502894 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:45:15.504016 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:45:15.508452 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:45:15.531141 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:45:15.532202 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:45:15.544448 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:45:15.548493 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:45:15.555657 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:45:15.556629 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:15.572593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '890e9f56-7b14-451a-a73c-b2195e3101b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fc84e0640>]}
[0m23:45:15.573598 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:45:15.574211 [info ] [MainThread]: 
[0m23:45:15.587024 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:45:15.588195 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:45:15.589311 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:45:15.590049 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:45:15.606963 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:45:15.608193 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:45:15.675051 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:45:15.737090 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:45:15.738639 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:45:15.751488 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:15.834426 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:45:15.837384 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:45:15.839379 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:45:15.842027 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:45:15.848133 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:45:15.851009 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:45:15.852991 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:45:15.855668 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:45:15.908899 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:45:15.911984 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:45:15.918093 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '890e9f56-7b14-451a-a73c-b2195e3101b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fc8465670>]}
[0m23:45:15.919357 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.33s]
[0m23:45:15.920711 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:45:15.922577 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:45:15.923681 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:45:15.924434 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:45:15.925458 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:45:15.926726 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:45:15.927652 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:45:15.928726 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:45:15.929742 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:45:15.930670 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:45:15.931497 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:45:15.932317 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:45:15.933148 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:45:15.962165 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:45:15.966481 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:45:15.973591 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:45:15.975394 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:45:15.976216 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:45:15.976935 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:45:16.041626 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:45:16.042566 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:45:16.050402 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:45:16.052142 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:45:16.052935 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:45:16.054602 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:45:16.153625 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:45:16.163180 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:45:16.166777 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:16.168791 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:45:16.175962 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.25s]
[0m23:45:16.177568 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:16.180002 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:45:16.185406 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.26s]
[0m23:45:16.186982 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:16.188599 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:45:16.191666 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.26s]
[0m23:45:16.193349 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:45:16.194886 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:45:16.195717 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:45:16.196529 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:45:16.197741 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:45:16.202454 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:45:16.209765 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:45:16.208394 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:45:16.214028 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:45:16.211209 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:45:16.212605 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:45:16.215364 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:45:16.216672 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:45:16.243271 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:45:16.268581 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:45:16.270662 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:45:16.271953 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:45:16.293461 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:45:16.294472 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:45:16.346592 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:45:16.388159 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:45:16.427032 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:45:16.462686 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:45:16.501730 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9` 
  ...
[0m23:45:16.503684 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:45:16.512727 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9` 
  ...
[0m23:45:16.515065 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:45:16.516774 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:16.525746 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:16.553068 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:45:16.595389 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:45:16.628193 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:45:16.633135 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:45:16.635816 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:16.639024 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:45:16.642841 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:45:16.649986 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:45:16.653117 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:45:16.655708 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '890e9f56-7b14-451a-a73c-b2195e3101b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fc79fe7f0>]}
[0m23:45:16.656970 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.44s]
[0m23:45:16.658336 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:45:16.659604 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:45:16.672077 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:45:16.677496 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:45:16.686516 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:45:16.694111 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:16.697322 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:16.714668 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:45:16.719350 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:45:16.721877 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:45:16.723883 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:45:16.746328 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:45:16.747554 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:45:16.749779 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9`)
      
    ...
[0m23:45:16.752027 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9`)
      
    ...
[0m23:45:16.774465 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:45:16.779909 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:45:16.781385 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:45:16.788865 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:45:16.791587 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:16.794785 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9` 
    ...
[0m23:45:16.797137 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:16.800816 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9` 
    ...
[0m23:45:16.802783 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:16.813288 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9` 
  ...
[0m23:45:16.815627 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:16.829559 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:45:16.828041 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_890e9f56_7b14_451a_a73c_b2195e3101b9` 
  ...
[0m23:45:16.836702 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:45:16.841624 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:45:16.843443 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:45:16.850610 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:45:16.856209 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '890e9f56-7b14-451a-a73c-b2195e3101b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fc77473a0>]}
[0m23:45:16.859377 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.65s]
[0m23:45:16.861658 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:45:16.863917 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:45:16.867761 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '890e9f56-7b14-451a-a73c-b2195e3101b9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fc700f190>]}
[0m23:45:16.869383 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.66s]
[0m23:45:16.870779 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:45:16.872662 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:45:16.873211 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:45:16.873755 [debug] [MainThread]: On list__clean: Close
[0m23:45:16.874358 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:45:16.874964 [debug] [MainThread]: On list__mart: Close
[0m23:45:16.875480 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:45:16.876009 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:45:16.876521 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m23:45:16.877035 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m23:45:16.877541 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:45:16.878047 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:45:16.878564 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:45:16.879058 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:45:16.880273 [info ] [MainThread]: 
[0m23:45:16.881005 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.69 seconds (1.69s).
[0m23:45:16.884851 [debug] [MainThread]: Command end result
[0m23:45:16.943632 [info ] [MainThread]: 
[0m23:45:16.944637 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:45:16.945329 [info ] [MainThread]: 
[0m23:45:16.946000 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:45:16.947449 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.0650558, "process_in_blocks": "0", "process_kernel_time": 0.737756, "process_mem_max_rss": "114492", "process_out_blocks": "9744", "process_user_time": 6.038004}
[0m23:45:16.948323 [debug] [MainThread]: Command `dbt build` succeeded at 23:45:16.948091 after 3.07 seconds
[0m23:45:16.949002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fcb8a3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fc84d71f0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x751fc67da0a0>]}
[0m23:45:16.949649 [debug] [MainThread]: Flushing usage events
[0m23:46:12.739311 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821aed87310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821ab9e6b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821ab9e6a30>]}


============================== 23:46:12.749894 | 603bc8e0-5a30-4e6b-b7df-0277871af32b ==============================
[0m23:46:12.749894 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:46:12.750997 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'empty': 'False', 'profiles_dir': '.', 'log_path': '/workdir/transforms/04_btc/logs', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_colors': 'True', 'quiet': 'False', 'indirect_selection': 'eager', 'warn_error': 'None', 'introspect': 'True', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'cache_selected_only': 'False', 'partial_parse': 'True', 'version_check': 'True', 'log_format': 'default', 'debug': 'False'}
[0m23:46:13.040701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '603bc8e0-5a30-4e6b-b7df-0277871af32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821ab8d2af0>]}
[0m23:46:13.137643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '603bc8e0-5a30-4e6b-b7df-0277871af32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821aba1f3d0>]}
[0m23:46:13.138950 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:46:13.308127 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:46:13.576491 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:46:13.577173 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:46:13.677497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '603bc8e0-5a30-4e6b-b7df-0277871af32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821ab14be80>]}
[0m23:46:13.948426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '603bc8e0-5a30-4e6b-b7df-0277871af32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821ab1351f0>]}
[0m23:46:13.949385 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:46:13.952920 [info ] [MainThread]: 
[0m23:46:13.954149 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:46:13.966874 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:46:13.967838 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:46:13.993377 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:46:13.998967 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:46:14.274099 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:46:14.279104 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:46:14.280580 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:14.284218 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:46:14.316050 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:46:14.322565 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:46:14.337091 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:46:14.338133 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:46:14.344514 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:14.345854 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:14.360969 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '603bc8e0-5a30-4e6b-b7df-0277871af32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821ab0a8250>]}
[0m23:46:14.362062 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:46:14.362771 [info ] [MainThread]: 
[0m23:46:14.378095 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:46:14.379243 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:46:14.380426 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:46:14.381159 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:46:14.398016 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:46:14.399205 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:46:14.473840 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:46:14.531604 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:46:14.533196 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:46:14.543923 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:14.624401 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:46:14.627393 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:46:14.629408 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:46:14.632405 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:46:14.638477 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:46:14.641391 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:46:14.643352 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:46:14.646035 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:46:14.695105 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:46:14.698189 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:46:14.704412 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '603bc8e0-5a30-4e6b-b7df-0277871af32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821aa4b9b80>]}
[0m23:46:14.705633 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.32s]
[0m23:46:14.706907 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:46:14.708522 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:46:14.709341 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:46:14.710165 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:46:14.711028 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:46:14.711959 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:46:14.712853 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:46:14.714012 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:46:14.714987 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:46:14.715935 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:46:14.716783 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:46:14.717563 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:46:14.718327 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:46:14.746137 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:46:14.748228 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:46:14.755055 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:46:14.756426 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:46:14.757133 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:46:14.773548 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:46:14.799630 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:46:14.812935 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:46:14.818570 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:46:14.820437 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:46:14.821181 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:46:14.823298 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:46:14.931036 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:46:14.939753 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:46:14.941334 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:14.950479 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.24s]
[0m23:46:14.952438 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:46:14.953719 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:46:14.955135 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:14.960532 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.25s]
[0m23:46:14.962668 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:46:14.971686 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:46:14.975573 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.26s]
[0m23:46:14.977072 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:46:14.978917 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:46:14.980121 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:46:14.981134 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:46:14.982756 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:46:14.984463 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:46:14.985738 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:46:14.987001 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:46:14.988266 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:46:14.989108 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:46:14.990254 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:46:14.991630 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:46:14.992590 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:46:15.030422 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:46:15.033194 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:46:15.039824 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:46:15.041397 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:46:15.042101 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:46:15.048130 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:46:15.085685 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:46:15.159041 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:46:15.209516 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:46:15.236044 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:46:15.271496 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:46:15.270353 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b` 
  ...
[0m23:46:15.278853 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:46:15.276905 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b` 
  ...
[0m23:46:15.283456 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:46:15.290093 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:15.290954 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:46:15.292036 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:15.345870 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:46:15.346742 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:46:15.349968 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:46:15.351990 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:46:15.357786 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:46:15.365431 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:46:15.368913 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:46:15.371686 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '603bc8e0-5a30-4e6b-b7df-0277871af32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821aacc6550>]}
[0m23:46:15.372928 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.38s]
[0m23:46:15.374302 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:46:15.379961 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:46:15.395657 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:46:15.397872 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:46:15.403402 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:46:15.410319 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:15.416962 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:15.418295 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:46:15.421053 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:46:15.422608 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:46:15.423682 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:46:15.443461 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:46:15.444825 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:46:15.446756 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b`)
      
    ...
[0m23:46:15.448747 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b`)
      
    ...
[0m23:46:15.473392 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:46:15.480200 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:46:15.481554 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:46:15.487549 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:46:15.489018 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:15.492991 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b` 
    ...
[0m23:46:15.494440 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:46:15.498128 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b` 
    ...
[0m23:46:15.499646 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:46:15.507593 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b` 
  ...
[0m23:46:15.508902 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:15.516899 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_603bc8e0_5a30_4e6b_b7df_0277871af32b` 
  ...
[0m23:46:15.518643 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:15.527301 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:46:15.529114 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:15.539341 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:46:15.541193 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:15.546208 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '603bc8e0-5a30-4e6b-b7df-0277871af32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821ab8e0070>]}
[0m23:46:15.547772 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:46:15.549372 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.56s]
[0m23:46:15.553163 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '603bc8e0-5a30-4e6b-b7df-0277871af32b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821aac769d0>]}
[0m23:46:15.554645 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:46:15.556004 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.57s]
[0m23:46:15.557562 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:46:15.559762 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:46:15.560639 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:46:15.561500 [debug] [MainThread]: On list__mart: Close
[0m23:46:15.562307 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:46:15.563102 [debug] [MainThread]: On list__clean: Close
[0m23:46:15.563890 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:46:15.564751 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:46:15.565566 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:46:15.566386 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:46:15.567156 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:46:15.567979 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:46:15.568771 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m23:46:15.569559 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m23:46:15.570724 [info ] [MainThread]: 
[0m23:46:15.571429 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.62 seconds (1.62s).
[0m23:46:15.575229 [debug] [MainThread]: Command end result
[0m23:46:15.629823 [info ] [MainThread]: 
[0m23:46:15.630780 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:46:15.631371 [info ] [MainThread]: 
[0m23:46:15.632033 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:46:15.633409 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 2.9886422, "process_in_blocks": "0", "process_kernel_time": 0.670422, "process_mem_max_rss": "113960", "process_out_blocks": "9744", "process_user_time": 5.977766}
[0m23:46:15.634142 [debug] [MainThread]: Command `dbt build` succeeded at 23:46:15.633951 after 2.99 seconds
[0m23:46:15.634779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821aed87310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821aaff9b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7821ac507910>]}
[0m23:46:15.635365 [debug] [MainThread]: Flushing usage events
[0m23:47:11.543083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c16098310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c12cfcb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c12cfca00>]}


============================== 23:47:11.552749 | 41bf7740-4635-4606-8093-d80eac375b7c ==============================
[0m23:47:11.552749 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:47:11.553807 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'cache_selected_only': 'False', 'target_path': 'None', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'quiet': 'False', 'version_check': 'True', 'empty': 'False', 'static_parser': 'True', 'introspect': 'True', 'partial_parse': 'True', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'warn_error': 'None', 'log_cache_events': 'False', 'printer_width': '80', 'send_anonymous_usage_stats': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False', 'no_print': 'None', 'indirect_selection': 'eager', 'invocation_command': 'dbt build --profiles-dir . --target local', 'write_json': 'True'}
[0m23:47:11.839857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '41bf7740-4635-4606-8093-d80eac375b7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c147e45b0>]}
[0m23:47:11.945976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '41bf7740-4635-4606-8093-d80eac375b7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c13168ca0>]}
[0m23:47:11.947487 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:47:12.120616 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:47:12.383641 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:47:12.384368 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:47:12.488872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '41bf7740-4635-4606-8093-d80eac375b7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c12463eb0>]}
[0m23:47:12.860005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '41bf7740-4635-4606-8093-d80eac375b7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c123584c0>]}
[0m23:47:12.861622 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:47:12.867657 [info ] [MainThread]: 
[0m23:47:12.869574 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:47:12.894072 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:47:12.904801 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:47:12.981648 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:47:12.987765 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:47:13.294982 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:47:13.300210 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:47:13.301649 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:47:13.312685 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:13.329981 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:47:13.331362 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:47:13.346532 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:47:13.351038 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:47:13.357306 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:13.358704 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:13.373989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '41bf7740-4635-4606-8093-d80eac375b7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c15fee7c0>]}
[0m23:47:13.375002 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:47:13.375638 [info ] [MainThread]: 
[0m23:47:13.388505 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:47:13.389683 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:47:13.390806 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:47:13.391542 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:47:13.408855 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:47:13.410172 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:47:13.478033 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:47:13.539495 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:47:13.540885 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:47:13.550978 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:13.633753 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:47:13.637589 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:47:13.639629 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:47:13.642368 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:47:13.648220 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:47:13.651291 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:47:13.653356 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:47:13.656100 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:47:13.703252 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:47:13.706328 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:47:13.712798 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41bf7740-4635-4606-8093-d80eac375b7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c116ff910>]}
[0m23:47:13.714135 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.32s]
[0m23:47:13.715534 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:47:13.717096 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:47:13.717960 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:47:13.719041 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:47:13.719878 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:47:13.720845 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:47:13.721730 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:47:13.722848 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:47:13.723887 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:47:13.724833 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:47:13.725705 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:47:13.726477 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:47:13.727390 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:47:13.761091 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:47:13.761822 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:47:13.769434 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:47:13.770893 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:47:13.771731 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:47:13.783128 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:47:13.825569 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:47:13.835551 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:47:13.837083 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:47:13.838500 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:47:13.839336 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:47:13.840209 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:47:13.945849 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:47:13.952497 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:47:13.956611 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:13.963545 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.24s]
[0m23:47:13.965098 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:13.967673 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:47:13.970867 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.25s]
[0m23:47:13.972304 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:47:13.973814 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:47:13.981155 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:13.984180 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.26s]
[0m23:47:13.985621 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:47:13.987107 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:47:13.987886 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:47:13.989563 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:47:13.988833 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:47:13.991024 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:47:13.992435 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:47:13.993334 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:47:13.994197 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:47:13.995165 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:47:13.995903 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:47:13.996839 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:47:13.997874 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:47:14.022230 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:47:14.031004 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:47:14.038261 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:47:14.039654 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:47:14.045775 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:47:14.078399 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:47:14.125722 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:47:14.218465 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:47:14.212612 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c` 
  ...
[0m23:47:14.260074 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c` 
  ...
[0m23:47:14.262862 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:47:14.265891 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:47:14.272981 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:14.275852 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:47:14.362892 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:47:14.377759 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:47:14.378989 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:47:14.382198 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:47:14.388060 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:47:14.398875 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:47:14.403621 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:47:14.407274 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:47:14.410789 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:47:14.412751 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:47:14.414683 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:14.447557 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:47:14.441013 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:47:14.456121 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:47:14.461813 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:47:14.463355 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:47:14.466021 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41bf7740-4635-4606-8093-d80eac375b7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c121edf40>]}
[0m23:47:14.467444 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:14.473979 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:47:14.475380 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.47s]
[0m23:47:14.478636 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:47:14.480207 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:47:14.481440 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:47:14.483765 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:47:14.504045 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:47:14.505351 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:47:14.507315 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c`)
      
    ...
[0m23:47:14.509283 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c`)
      
    ...
[0m23:47:14.532830 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:47:14.542119 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:47:14.543885 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:47:14.551893 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:47:14.553865 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:14.559836 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c` 
    ...
[0m23:47:14.561899 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:14.566317 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c` 
    ...
[0m23:47:14.568911 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:14.579410 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c` 
  ...
[0m23:47:14.581105 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:14.588438 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_41bf7740_4635_4606_8093_d80eac375b7c` 
  ...
[0m23:47:14.590290 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:14.602981 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:47:14.601464 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:47:14.608872 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:47:14.613078 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:47:14.614576 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:47:14.619064 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41bf7740-4635-4606-8093-d80eac375b7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c1203f850>]}
[0m23:47:14.622126 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '41bf7740-4635-4606-8093-d80eac375b7c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c117741f0>]}
[0m23:47:14.623350 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.63s]
[0m23:47:14.624579 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.63s]
[0m23:47:14.625927 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:47:14.627188 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:47:14.629453 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:47:14.630029 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:47:14.630605 [debug] [MainThread]: On list__mart: Close
[0m23:47:14.631113 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:47:14.631652 [debug] [MainThread]: On list__clean: Close
[0m23:47:14.632147 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:47:14.632684 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:47:14.633181 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m23:47:14.633719 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m23:47:14.634214 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:47:14.634740 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:47:14.635229 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:47:14.635775 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:47:14.637008 [info ] [MainThread]: 
[0m23:47:14.637765 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.77 seconds (1.77s).
[0m23:47:14.642375 [debug] [MainThread]: Command end result
[0m23:47:14.704458 [info ] [MainThread]: 
[0m23:47:14.705355 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:47:14.705995 [info ] [MainThread]: 
[0m23:47:14.706725 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:47:14.708111 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.2615855, "process_in_blocks": "0", "process_kernel_time": 0.652652, "process_mem_max_rss": "114412", "process_out_blocks": "9744", "process_user_time": 6.02202}
[0m23:47:14.708876 [debug] [MainThread]: Command `dbt build` succeeded at 23:47:14.708684 after 3.26 seconds
[0m23:47:14.709500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c16098310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c147e45b0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x746c13168ca0>]}
[0m23:47:14.710092 [debug] [MainThread]: Flushing usage events
[0m23:48:11.528136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c47ac77e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c4778d9490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c4778d95e0>]}


============================== 23:48:11.539311 | ec080892-7b66-406d-9bad-b66e5514c66e ==============================
[0m23:48:11.539311 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:48:11.540549 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'profiles_dir': '.', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'empty': 'False', 'use_experimental_parser': 'False', 'introspect': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_format': 'default', 'debug': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True', 'no_print': 'None', 'quiet': 'False', 'static_parser': 'True', 'version_check': 'True', 'fail_fast': 'False', 'cache_selected_only': 'False', 'target_path': 'None', 'log_cache_events': 'False', 'partial_parse': 'True', 'printer_width': '80', 'warn_error': 'None'}
[0m23:48:11.830072 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ec080892-7b66-406d-9bad-b66e5514c66e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c477925b80>]}
[0m23:48:11.952162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ec080892-7b66-406d-9bad-b66e5514c66e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c4777c76d0>]}
[0m23:48:11.953670 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:48:12.146839 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:48:12.411044 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:48:12.411818 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:48:12.518317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ec080892-7b66-406d-9bad-b66e5514c66e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c477033e50>]}
[0m23:48:12.770819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ec080892-7b66-406d-9bad-b66e5514c66e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c476ff1e80>]}
[0m23:48:12.771719 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:48:12.775103 [info ] [MainThread]: 
[0m23:48:12.776271 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:48:12.787957 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:48:12.789022 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:48:12.817167 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:48:12.826328 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:48:13.098539 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:48:13.102616 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:48:13.113344 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:48:13.118847 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:48:13.139889 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:48:13.151173 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:48:13.153298 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:48:13.157189 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:48:13.163135 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:13.167123 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:13.179502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec080892-7b66-406d-9bad-b66e5514c66e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c477830670>]}
[0m23:48:13.180486 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:48:13.181111 [info ] [MainThread]: 
[0m23:48:13.194273 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:48:13.195426 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:48:13.196514 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:48:13.197245 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:48:13.214499 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:48:13.215685 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:48:13.284659 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:48:13.340147 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:48:13.341640 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:48:13.353554 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:13.436799 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:48:13.439791 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:48:13.441901 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:48:13.445093 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:48:13.452024 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:48:13.455095 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:48:13.457360 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:48:13.460470 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:48:13.515278 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:48:13.518527 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:48:13.524804 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec080892-7b66-406d-9bad-b66e5514c66e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c4762c3fa0>]}
[0m23:48:13.526072 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.33s]
[0m23:48:13.527447 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:48:13.529140 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:48:13.530005 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:48:13.530805 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:48:13.531675 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:48:13.532722 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:48:13.534214 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:48:13.535115 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:48:13.536471 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:48:13.537556 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:48:13.538755 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:48:13.539851 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:48:13.556704 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:48:13.563989 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:48:13.571241 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:48:13.582948 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:48:13.584829 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:48:13.585593 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:48:13.622683 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:48:13.628033 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:48:13.630888 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:48:13.638502 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:48:13.640434 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:48:13.641389 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:48:13.643561 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:48:13.753572 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:48:13.765910 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:48:13.770564 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:48:13.780442 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:48:13.782568 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.25s]
[0m23:48:13.784306 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:13.787643 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:48:13.792825 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.25s]
[0m23:48:13.795517 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:48:13.796674 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:13.801377 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.26s]
[0m23:48:13.803700 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:48:13.805777 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:48:13.806687 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:48:13.807519 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:48:13.808526 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:48:13.809930 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:48:13.811292 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:48:13.812177 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:48:13.813049 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:48:13.814067 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:48:13.815103 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:48:13.816134 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:48:13.816838 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:48:13.855717 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:48:13.858877 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:48:13.866433 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:48:13.867964 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:48:13.874297 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:48:13.880652 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:48:13.928292 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:48:13.988461 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:48:14.060760 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m23:48:14.107843 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e` 
  ...
[0m23:48:14.142487 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:48:14.144033 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e` 
  ...
[0m23:48:14.151032 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:48:14.155213 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:14.162975 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:14.174802 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:48:14.271375 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:48:14.316618 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:48:14.361664 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:48:14.365669 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:48:14.371893 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:48:14.379115 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:48:14.387095 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:48:14.401394 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:48:14.403916 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:48:14.406361 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:48:14.467175 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.06 seconds
[0m23:48:14.482392 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec080892-7b66-406d-9bad-b66e5514c66e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c476bd3550>]}
[0m23:48:14.488988 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.67s]
[0m23:48:14.486509 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:48:14.491573 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:48:14.477748 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:48:14.500178 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:14.508804 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:48:14.510144 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:14.514789 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:48:14.516415 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:48:14.518661 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:48:14.540121 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:48:14.541645 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:48:14.543763 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e`)
      
    ...
[0m23:48:14.546100 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e`)
      
    ...
[0m23:48:14.567737 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:48:14.575764 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:48:14.577536 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:48:14.585762 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:48:14.588185 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:14.591201 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e` 
    ...
[0m23:48:14.593497 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:14.596400 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e` 
    ...
[0m23:48:14.597924 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:14.605284 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e` 
  ...
[0m23:48:14.607487 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:14.613574 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_ec080892_7b66_406d_9bad_b66e5514c66e` 
  ...
[0m23:48:14.615695 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:14.621958 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:48:14.623379 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:14.630443 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:48:14.632533 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:14.635884 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec080892-7b66-406d-9bad-b66e5514c66e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c476b18c10>]}
[0m23:48:14.637161 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:48:14.638377 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.82s]
[0m23:48:14.643344 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec080892-7b66-406d-9bad-b66e5514c66e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c4762c3c10>]}
[0m23:48:14.644921 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:48:14.646623 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.83s]
[0m23:48:14.648562 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:48:14.650526 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:48:14.651058 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:48:14.651601 [debug] [MainThread]: On list__mart: Close
[0m23:48:14.652063 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:48:14.652559 [debug] [MainThread]: On list__clean: Close
[0m23:48:14.653005 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:48:14.653507 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:48:14.653954 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:48:14.654450 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:48:14.654898 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m23:48:14.655419 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m23:48:14.655868 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:48:14.656364 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:48:14.657478 [info ] [MainThread]: 
[0m23:48:14.658124 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.88 seconds (1.88s).
[0m23:48:14.661982 [debug] [MainThread]: Command end result
[0m23:48:14.716439 [info ] [MainThread]: 
[0m23:48:14.717305 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:48:14.717909 [info ] [MainThread]: 
[0m23:48:14.718548 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:48:14.719848 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.291277, "process_in_blocks": "0", "process_kernel_time": 0.714469, "process_mem_max_rss": "113812", "process_out_blocks": "9744", "process_user_time": 6.155047}
[0m23:48:14.720578 [debug] [MainThread]: Command `dbt build` succeeded at 23:48:14.720388 after 3.29 seconds
[0m23:48:14.721197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c47ac77e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c478bfb0a0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x76c4777c76d0>]}
[0m23:48:14.721827 [debug] [MainThread]: Flushing usage events
[0m23:49:11.840619 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c68a493310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c6870f2be0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c6870f2a90>]}


============================== 23:49:11.850612 | 842b457e-2f6d-49af-b886-d280f78dccf3 ==============================
[0m23:49:11.850612 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:49:11.851722 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'use_colors': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'warn_error': 'None', 'cache_selected_only': 'False', 'target_path': 'None', 'log_format': 'default', 'introspect': 'True', 'debug': 'False', 'fail_fast': 'False', 'empty': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'write_json': 'True', 'no_print': 'None', 'log_cache_events': 'False', 'version_check': 'True', 'partial_parse': 'True', 'printer_width': '80', 'static_parser': 'True', 'profiles_dir': '.'}
[0m23:49:12.196025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '842b457e-2f6d-49af-b886-d280f78dccf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c689a28b80>]}
[0m23:49:12.311095 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '842b457e-2f6d-49af-b886-d280f78dccf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c686fde610>]}
[0m23:49:12.312490 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:49:12.514744 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:49:12.780672 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:49:12.781685 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:49:12.892221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '842b457e-2f6d-49af-b886-d280f78dccf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c686857e80>]}
[0m23:49:13.147934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '842b457e-2f6d-49af-b886-d280f78dccf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c68686c8b0>]}
[0m23:49:13.148845 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:49:13.152189 [info ] [MainThread]: 
[0m23:49:13.153362 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:49:13.167595 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:49:13.169465 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:49:13.212278 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:49:13.217532 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:49:13.481511 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:49:13.488825 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:49:13.490390 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:49:13.502450 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:13.519989 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:49:13.521083 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:49:13.539359 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:49:13.543308 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:49:13.550058 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:13.559056 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:13.567031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '842b457e-2f6d-49af-b886-d280f78dccf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c687055670>]}
[0m23:49:13.568064 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:49:13.568759 [info ] [MainThread]: 
[0m23:49:13.581675 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:49:13.582832 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:49:13.583953 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:49:13.584706 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:49:13.601540 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:49:13.602748 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:49:13.671485 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:49:13.727577 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:49:13.729024 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:49:13.739105 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:13.821215 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:49:13.824624 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:49:13.827115 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:49:13.831073 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:49:13.837666 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:49:13.840985 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:49:13.843288 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:49:13.847081 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:49:13.897576 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:49:13.900694 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:49:13.906879 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '842b457e-2f6d-49af-b886-d280f78dccf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c685baafa0>]}
[0m23:49:13.908151 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.32s]
[0m23:49:13.909527 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:49:13.911156 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:49:13.911992 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:49:13.912786 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:49:13.913690 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:49:13.914559 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:49:13.915649 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:49:13.916478 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:49:13.917472 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:49:13.918278 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:49:13.919238 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:49:13.920046 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:49:13.941465 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:49:13.945071 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:49:13.952494 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:49:13.959593 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:49:13.961293 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:49:13.967423 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:49:13.973960 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:49:14.007126 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:49:14.019832 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:49:14.024320 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:49:14.026123 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:49:14.026864 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:49:14.027872 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:49:14.138554 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:49:14.149563 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:49:14.152571 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:14.159629 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:49:14.161006 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:14.162300 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.24s]
[0m23:49:14.167470 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.25s]
[0m23:49:14.170562 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:49:14.173001 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:14.174656 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:49:14.177939 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.26s]
[0m23:49:14.179625 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:49:14.181326 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:49:14.182077 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:49:14.182867 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:49:14.183845 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:49:14.184817 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:49:14.185829 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:49:14.186752 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:49:14.187458 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:49:14.188166 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:49:14.188935 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:49:14.189677 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:49:14.190446 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:49:14.209454 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:49:14.217665 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:49:14.224655 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:49:14.226287 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:49:14.232332 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:49:14.233090 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:49:14.290702 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:49:14.340224 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:49:14.399792 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:49:14.432482 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3` 
  ...
[0m23:49:14.437484 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:49:14.446088 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3` 
  ...
[0m23:49:14.449033 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:14.451499 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:49:14.459022 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:14.473617 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:49:14.536050 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:49:14.554137 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:49:14.555189 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:49:14.561334 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:49:14.567541 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:49:14.570274 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:49:14.573288 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:49:14.580553 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:49:14.583930 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:49:14.586714 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '842b457e-2f6d-49af-b886-d280f78dccf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c6853ea160>]}
[0m23:49:14.587858 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.40s]
[0m23:49:14.589298 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:49:14.590699 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:49:14.591852 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:49:14.612930 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:49:14.608186 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:49:14.618562 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:49:14.625529 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:49:14.626964 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:49:14.629237 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:49:14.632392 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:49:14.633903 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:49:14.645054 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:49:14.647151 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3`)
      
    ...
[0m23:49:14.656114 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:49:14.658888 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3`)
      
    ...
[0m23:49:14.666703 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:49:14.673656 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:49:14.680358 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:49:14.687475 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:14.689340 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:49:14.692276 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3` 
    ...
[0m23:49:14.697135 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:49:14.700190 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3` 
    ...
[0m23:49:14.701526 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:14.708437 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3` 
  ...
[0m23:49:14.709799 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:14.716540 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_842b457e_2f6d_49af_b886_d280f78dccf3` 
  ...
[0m23:49:14.719239 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:14.729424 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:49:14.732887 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:49:14.739731 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:49:14.741604 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:14.748072 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '842b457e-2f6d-49af-b886-d280f78dccf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c68674bd00>]}
[0m23:49:14.749765 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:49:14.751517 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.56s]
[0m23:49:14.755231 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '842b457e-2f6d-49af-b886-d280f78dccf3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c6853eafd0>]}
[0m23:49:14.757057 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:49:14.758746 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.57s]
[0m23:49:14.760495 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:49:14.762497 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:49:14.763027 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:49:14.763550 [debug] [MainThread]: On list__mart: Close
[0m23:49:14.764044 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:49:14.764534 [debug] [MainThread]: On list__clean: Close
[0m23:49:14.765004 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:49:14.765506 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:49:14.765974 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:49:14.766465 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:49:14.766918 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:49:14.767405 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:49:14.767861 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m23:49:14.768382 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m23:49:14.769574 [info ] [MainThread]: 
[0m23:49:14.770240 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.62 seconds (1.62s).
[0m23:49:14.773996 [debug] [MainThread]: Command end result
[0m23:49:14.836863 [info ] [MainThread]: 
[0m23:49:14.837717 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:49:14.838328 [info ] [MainThread]: 
[0m23:49:14.838942 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:49:14.840299 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.1362581, "process_in_blocks": "0", "process_kernel_time": 0.671947, "process_mem_max_rss": "114440", "process_out_blocks": "9744", "process_user_time": 6.253201}
[0m23:49:14.841031 [debug] [MainThread]: Command `dbt build` succeeded at 23:49:14.840832 after 3.14 seconds
[0m23:49:14.841660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c68a493310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c68684d400>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x78c685137910>]}
[0m23:49:14.842251 [debug] [MainThread]: Flushing usage events
[0m23:50:11.966823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e5a0b7e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e56d23430>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e56d23580>]}


============================== 23:50:11.976970 | f2defc15-d9f1-46a2-bc11-e5a07eec4b9c ==============================
[0m23:50:11.976970 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:50:11.978206 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt build --profiles-dir . --target local', 'debug': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'profiles_dir': '.', 'partial_parse': 'True', 'quiet': 'False', 'use_colors': 'True', 'log_format': 'default', 'introspect': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'no_print': 'None', 'empty': 'False', 'static_parser': 'True', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/workdir/transforms/04_btc/logs', 'use_experimental_parser': 'False'}
[0m23:50:12.358093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f2defc15-d9f1-46a2-bc11-e5a07eec4b9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e5954f910>]}
[0m23:50:12.459500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f2defc15-d9f1-46a2-bc11-e5a07eec4b9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e56b8b130>]}
[0m23:50:12.460838 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:50:12.626891 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:50:12.916654 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:50:12.917367 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:50:13.021712 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f2defc15-d9f1-46a2-bc11-e5a07eec4b9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e5647be50>]}
[0m23:50:13.279948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f2defc15-d9f1-46a2-bc11-e5a07eec4b9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e56491a30>]}
[0m23:50:13.280882 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:50:13.284337 [info ] [MainThread]: 
[0m23:50:13.285506 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:50:13.297605 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:50:13.308334 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:50:13.331644 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:50:13.334357 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:50:13.607567 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:50:13.609995 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:50:13.612888 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:50:13.623674 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:13.642819 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:50:13.643837 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:50:13.655655 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:50:13.659649 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:50:13.665560 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:13.666796 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:13.682116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2defc15-d9f1-46a2-bc11-e5a07eec4b9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e563d94c0>]}
[0m23:50:13.683152 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:50:13.683854 [info ] [MainThread]: 
[0m23:50:13.696860 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:50:13.698016 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:50:13.699164 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:50:13.700078 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:50:13.719848 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:50:13.721125 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:50:13.791386 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:50:13.848965 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:50:13.850438 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:50:13.861339 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:13.942916 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:50:13.946216 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:50:13.948597 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:50:13.951644 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:50:13.960229 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:50:13.964311 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:50:13.967688 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:50:13.971528 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:50:14.029801 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:50:14.032888 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:50:14.039145 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2defc15-d9f1-46a2-bc11-e5a07eec4b9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e55707e50>]}
[0m23:50:14.040430 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.34s]
[0m23:50:14.041791 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:50:14.043497 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:50:14.044286 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:50:14.045199 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:50:14.046111 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:50:14.046973 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:50:14.048101 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:50:14.049033 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:50:14.050358 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:50:14.051424 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:50:14.052438 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:50:14.053373 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:50:14.064853 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:50:14.077270 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:50:14.088836 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:50:14.097622 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:50:14.099277 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:50:14.100368 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:50:14.122209 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:50:14.152438 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:50:14.157189 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:50:14.177789 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:50:14.179488 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:50:14.180265 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:50:14.181477 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:50:14.287679 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:50:14.292250 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:50:14.296958 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.304549 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.26s]
[0m23:50:14.306043 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.307481 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:50:14.309044 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:50:14.312091 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.26s]
[0m23:50:14.314791 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:50:14.322916 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.326435 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.28s]
[0m23:50:14.327849 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:50:14.329399 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:50:14.330401 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:50:14.331503 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:50:14.332535 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:50:14.333780 [info ] [Thread-3  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:50:14.334772 [info ] [Thread-2  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:50:14.335648 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:50:14.336424 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:50:14.337214 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:50:14.337992 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:50:14.338834 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:50:14.339749 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:50:14.370207 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:50:14.376628 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:50:14.385048 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:50:14.386656 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:50:14.392592 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:50:14.403866 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:50:14.461698 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:50:14.549608 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c` 
  ...
[0m23:50:14.555982 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:50:14.578025 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c` 
  ...
[0m23:50:14.581700 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.605378 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:50:14.606550 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:50:14.640096 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:50:14.670352 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:50:14.669297 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:50:14.673562 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:50:14.678181 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:50:14.681180 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:50:14.687456 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:50:14.690422 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:50:14.692622 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:50:14.695808 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:50:14.697013 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:50:14.709578 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:50:14.715536 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:50:14.722505 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:50:14.730659 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:50:14.736085 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:50:14.737491 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.741474 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2defc15-d9f1-46a2-bc11-e5a07eec4b9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e561fd7c0>]}
[0m23:50:14.743187 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.749880 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:50:14.751292 [info ] [Thread-2  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.40s]
[0m23:50:14.755823 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:50:14.757794 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:50:14.759155 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:50:14.761706 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:50:14.781110 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:50:14.783313 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c`)
      
    ...
[0m23:50:14.784518 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:50:14.787445 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c`)
      
    ...
[0m23:50:14.806734 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:50:14.813173 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:50:14.814918 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:50:14.821987 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:50:14.823850 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.828424 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c` 
    ...
[0m23:50:14.830495 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.834648 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c` 
    ...
[0m23:50:14.837435 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.843999 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c` 
  ...
[0m23:50:14.845565 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.853698 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_f2defc15_d9f1_46a2_bc11_e5a07eec4b9c` 
  ...
[0m23:50:14.855181 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.866466 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:50:14.868194 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.875709 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:50:14.877620 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.884135 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2defc15-d9f1-46a2-bc11-e5a07eec4b9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e55707970>]}
[0m23:50:14.885821 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:50:14.887330 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.55s]
[0m23:50:14.891264 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2defc15-d9f1-46a2-bc11-e5a07eec4b9c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e56205700>]}
[0m23:50:14.893204 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:50:14.894999 [info ] [Thread-3  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.55s]
[0m23:50:14.896626 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:50:14.898529 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:50:14.899058 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:50:14.899605 [debug] [MainThread]: On list__mart: Close
[0m23:50:14.900086 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:50:14.900601 [debug] [MainThread]: On list__clean: Close
[0m23:50:14.901066 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:50:14.901582 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:50:14.902054 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:50:14.902588 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:50:14.903059 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a' was left open.
[0m23:50:14.903595 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: Close
[0m23:50:14.904044 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:50:14.904559 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:50:14.905727 [info ] [MainThread]: 
[0m23:50:14.906480 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.62 seconds (1.62s).
[0m23:50:14.910164 [debug] [MainThread]: Command end result
[0m23:50:14.966333 [info ] [MainThread]: 
[0m23:50:14.967190 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:50:14.967815 [info ] [MainThread]: 
[0m23:50:14.968463 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:50:14.969792 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.1015072, "process_in_blocks": "0", "process_kernel_time": 0.674596, "process_mem_max_rss": "114464", "process_out_blocks": "9744", "process_user_time": 6.012316}
[0m23:50:14.970537 [debug] [MainThread]: Command `dbt build` succeeded at 23:50:14.970349 after 3.10 seconds
[0m23:50:14.971187 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e5a0b7e20>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e54e0ed00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x719e57f44fd0>]}
[0m23:50:14.971985 [debug] [MainThread]: Flushing usage events
[0m23:51:11.606158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf66959310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf635b5b80>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf635b5a30>]}


============================== 23:51:11.622998 | e1d40e7c-8f51-49a9-b386-45b1e586ee76 ==============================
[0m23:51:11.622998 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:51:11.624983 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'partial_parse': 'True', 'no_print': 'None', 'fail_fast': 'False', 'write_json': 'True', 'target_path': 'None', 'debug': 'False', 'static_parser': 'True', 'profiles_dir': '.', 'version_check': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'use_colors': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt build --profiles-dir . --target local', 'log_path': '/workdir/transforms/04_btc/logs', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'quiet': 'False', 'use_experimental_parser': 'False', 'empty': 'False'}
[0m23:51:11.985931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e1d40e7c-8f51-49a9-b386-45b1e586ee76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf63582cd0>]}
[0m23:51:12.089088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e1d40e7c-8f51-49a9-b386-45b1e586ee76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf63ee6d30>]}
[0m23:51:12.090412 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:51:12.257204 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:51:12.557683 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:51:12.558450 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:51:12.744807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e1d40e7c-8f51-49a9-b386-45b1e586ee76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf62d25ee0>]}
[0m23:51:13.011140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e1d40e7c-8f51-49a9-b386-45b1e586ee76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf62d0fe80>]}
[0m23:51:13.012163 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:51:13.016138 [info ] [MainThread]: 
[0m23:51:13.017420 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:51:13.029638 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:51:13.030616 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:51:13.054031 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:51:13.057963 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:51:13.331189 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:51:13.336499 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:13.338545 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:51:13.349462 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:13.365407 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:51:13.377089 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:51:13.378138 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:51:13.382206 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:51:13.389106 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:13.401453 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:51:13.415494 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e1d40e7c-8f51-49a9-b386-45b1e586ee76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf65d71970>]}
[0m23:51:13.418141 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:51:13.419836 [info ] [MainThread]: 
[0m23:51:13.444124 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:51:13.445371 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:51:13.446494 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:51:13.447286 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:51:13.464075 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:51:13.465357 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:51:13.544822 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:51:13.609027 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:51:13.610794 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:51:13.624871 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:51:13.718603 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:51:13.721741 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:13.723989 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:51:13.727521 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:13.734786 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:51:13.738072 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:13.740300 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:51:13.743400 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:13.795811 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:51:13.799206 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:13.805731 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1d40e7c-8f51-49a9-b386-45b1e586ee76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf62086250>]}
[0m23:51:13.807081 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.36s]
[0m23:51:13.808549 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:51:13.810345 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:51:13.811561 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:51:13.812454 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:51:13.813314 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:51:13.814527 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:51:13.815776 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:51:13.816718 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:51:13.817742 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:51:13.819100 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:51:13.820045 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:51:13.836743 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:51:13.849920 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:51:13.851427 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:51:13.863507 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:51:13.871714 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:51:13.872711 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:51:13.874455 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:51:13.886282 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:51:13.953447 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:51:13.966071 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:51:13.964914 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:51:13.967638 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:51:13.968487 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:51:13.970075 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:51:14.082407 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:51:14.091318 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:51:14.092697 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:51:14.100132 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.28s]
[0m23:51:14.101851 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:51:14.104195 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:51:14.111166 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:51:14.113208 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:51:14.116519 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.30s]
[0m23:51:14.121469 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.31s]
[0m23:51:14.123485 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:51:14.125510 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:51:14.127893 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:51:14.128696 [debug] [Thread-2  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:51:14.129536 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:51:14.130563 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:51:14.131726 [info ] [Thread-2  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:51:14.132913 [info ] [Thread-4  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:51:14.133990 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:51:14.134806 [debug] [Thread-2  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:51:14.135662 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:51:14.136598 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:51:14.137398 [debug] [Thread-2  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:51:14.138200 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:51:14.157322 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:51:14.179716 [debug] [Thread-2  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:51:14.185919 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:51:14.188344 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:51:14.189466 [debug] [Thread-2  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:51:14.195804 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:51:14.252813 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:51:14.320592 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:51:14.374190 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.05 seconds
[0m23:51:14.378303 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76` 
  ...
[0m23:51:14.389544 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:51:14.400962 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76` 
  ...
[0m23:51:14.403364 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:14.426415 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:51:14.427586 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:51:14.467618 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:51:14.469904 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:51:14.472353 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:51:14.476593 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:14.485957 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:51:14.488791 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:14.491084 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:51:14.493873 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:14.501428 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:51:14.502899 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:51:14.504022 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:51:14.516670 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:51:14.528853 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:51:14.533903 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:51:14.536838 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1d40e7c-8f51-49a9-b386-45b1e586ee76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf62ab5c10>]}
[0m23:51:14.540915 [info ] [Thread-4  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.40s]
[0m23:51:14.542997 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:14.544348 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:51:14.545627 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:51:14.552211 [debug] [Thread-2  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:51:14.555075 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:51:14.556850 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:51:14.557817 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:51:14.580228 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:51:14.581995 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:51:14.584514 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76`)
      
    ...
[0m23:51:14.587491 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76`)
      
    ...
[0m23:51:14.617576 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:51:14.625389 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:51:14.626819 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:51:14.632815 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:51:14.635136 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:51:14.637924 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76` 
    ...
[0m23:51:14.642804 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:51:14.645784 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76` 
    ...
[0m23:51:14.647302 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:51:14.656855 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76` 
  ...
[0m23:51:14.658984 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:51:14.672460 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:51:14.673254 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_e1d40e7c_8f51_49a9_b386_45b1e586ee76` 
  ...
[0m23:51:14.682302 [debug] [Thread-2  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:51:14.686289 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:14.693167 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:51:14.694775 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:51:14.698187 [debug] [Thread-2  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1d40e7c-8f51-49a9-b386-45b1e586ee76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf635fbfa0>]}
[0m23:51:14.700648 [info ] [Thread-2  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.56s]
[0m23:51:14.702449 [debug] [Thread-2  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:51:14.703848 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:51:14.707572 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e1d40e7c-8f51-49a9-b386-45b1e586ee76', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf620d4f10>]}
[0m23:51:14.708758 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.57s]
[0m23:51:14.710040 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:51:14.712327 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:51:14.713205 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:51:14.714067 [debug] [MainThread]: On list__clean: Close
[0m23:51:14.714888 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:51:14.715725 [debug] [MainThread]: On list__mart: Close
[0m23:51:14.716525 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:51:14.717340 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:51:14.718105 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1' was left open.
[0m23:51:14.718923 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: Close
[0m23:51:14.719713 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:51:14.720526 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:51:14.721311 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:51:14.722107 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:51:14.723990 [info ] [MainThread]: 
[0m23:51:14.725016 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.71 seconds (1.71s).
[0m23:51:14.731143 [debug] [MainThread]: Command end result
[0m23:51:14.793193 [info ] [MainThread]: 
[0m23:51:14.794151 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:51:14.794881 [info ] [MainThread]: 
[0m23:51:14.795626 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:51:14.797049 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.3649552, "process_in_blocks": "0", "process_kernel_time": 0.70278, "process_mem_max_rss": "114164", "process_out_blocks": "9744", "process_user_time": 6.140344}
[0m23:51:14.797855 [debug] [MainThread]: Command `dbt build` succeeded at 23:51:14.797666 after 3.37 seconds
[0m23:51:14.798535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf66959310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf620b8340>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7ebf620b8ac0>]}
[0m23:51:14.799185 [debug] [MainThread]: Flushing usage events
[0m23:52:11.964469 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c9cb7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c6919af0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c69199a0>]}


============================== 23:52:11.974733 | c46aa814-8bda-443a-88a2-6d5cd235fe11 ==============================
[0m23:52:11.974733 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:52:11.975836 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '.', 'quiet': 'False', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_colors': 'True', 'log_format': 'default', 'target_path': 'None', 'warn_error': 'None', 'version_check': 'True', 'cache_selected_only': 'False', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'introspect': 'True', 'write_json': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'empty': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'fail_fast': 'False', 'partial_parse': 'True', 'no_print': 'None'}
[0m23:52:12.300337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c46aa814-8bda-443a-88a2-6d5cd235fe11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c925e3a0>]}
[0m23:52:12.401449 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c46aa814-8bda-443a-88a2-6d5cd235fe11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c697b3a0>]}
[0m23:52:12.402823 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:52:12.570128 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:52:12.836680 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:52:12.837342 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:52:12.940624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c46aa814-8bda-443a-88a2-6d5cd235fe11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c6087ee0>]}
[0m23:52:13.273580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c46aa814-8bda-443a-88a2-6d5cd235fe11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c6071c70>]}
[0m23:52:13.275081 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:52:13.280587 [info ] [MainThread]: 
[0m23:52:13.282289 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:52:13.299008 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:52:13.312313 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:52:13.332936 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:52:13.341518 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:52:13.651934 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:52:13.658769 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:52:13.660264 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:52:13.671908 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:13.690063 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:52:13.691119 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:52:13.705082 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:52:13.709146 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:52:13.715927 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:52:13.726354 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:52:13.732336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c46aa814-8bda-443a-88a2-6d5cd235fe11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c90da970>]}
[0m23:52:13.733387 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:52:13.734096 [info ] [MainThread]: 
[0m23:52:13.747377 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:52:13.748532 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:52:13.749612 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:52:13.750366 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:52:13.767213 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:52:13.768432 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:52:13.841063 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:52:13.910244 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:52:13.912391 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:52:13.923697 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.018815 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:52:14.021843 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:52:14.023953 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:52:14.027020 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:52:14.033021 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:52:14.035864 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:52:14.037856 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:52:14.040604 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:52:14.088994 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:52:14.092126 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:52:14.098563 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c46aa814-8bda-443a-88a2-6d5cd235fe11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c531d3a0>]}
[0m23:52:14.099868 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.35s]
[0m23:52:14.101263 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:52:14.103003 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:52:14.104037 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:52:14.105019 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:52:14.105941 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:52:14.106933 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:52:14.107827 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:52:14.108997 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:52:14.110055 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:52:14.111338 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:52:14.112197 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:52:14.113095 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:52:14.113931 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:52:14.146398 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:52:14.144914 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:52:14.154150 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:52:14.155751 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:52:14.156846 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:52:14.188890 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:52:14.200075 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:52:14.215732 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:52:14.217108 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:52:14.218415 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:52:14.219742 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:52:14.220478 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:52:14.315267 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:52:14.325040 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.333183 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.22s]
[0m23:52:14.337491 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:52:14.338838 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:52:14.342509 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:52:14.351012 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.352560 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.355409 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.25s]
[0m23:52:14.359850 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.25s]
[0m23:52:14.362098 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:52:14.364267 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:52:14.366694 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:52:14.368133 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:52:14.368984 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:52:14.370125 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:52:14.371634 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:52:14.373035 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:52:14.374166 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:52:14.374924 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:52:14.375715 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:52:14.376523 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:52:14.377347 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:52:14.378142 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:52:14.398465 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:52:14.406779 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:52:14.413567 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:52:14.415012 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:52:14.421187 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:52:14.458228 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:52:14.480703 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:52:14.576464 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:52:14.600485 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11` 
  ...
[0m23:52:14.616854 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11` 
  ...
[0m23:52:14.618287 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:52:14.620047 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.627086 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:52:14.633678 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.656746 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.685044 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:52:14.704034 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:52:14.706509 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:52:14.708060 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:52:14.715587 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:52:14.719193 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:52:14.722710 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:52:14.726065 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:52:14.733336 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:52:14.734812 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:52:14.736803 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:52:14.753739 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:52:14.755333 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:52:14.761579 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:52:14.765568 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c46aa814-8bda-443a-88a2-6d5cd235fe11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c5e0f4f0>]}
[0m23:52:14.768738 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.39s]
[0m23:52:14.770935 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.772299 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:52:14.773666 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.779827 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:52:14.782964 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:52:14.784519 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:52:14.787204 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:52:14.805267 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:52:14.807603 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11`)
      
    ...
[0m23:52:14.809772 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:52:14.811967 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11`)
      
    ...
[0m23:52:14.831452 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:52:14.836822 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:52:14.839215 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:52:14.844183 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:52:14.847244 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.851006 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11` 
    ...
[0m23:52:14.853274 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.859228 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11` 
    ...
[0m23:52:14.861103 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.869690 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.873482 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11` 
  ...
[0m23:52:14.882986 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c46aa814_8bda_443a_88a2_6d5cd235fe11` 
  ...
[0m23:52:14.886823 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:52:14.893959 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:52:14.895174 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:52:14.901784 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:52:14.905744 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:52:14.907209 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:52:14.911286 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c46aa814-8bda-443a-88a2-6d5cd235fe11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c53dd7c0>]}
[0m23:52:14.916261 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c46aa814-8bda-443a-88a2-6d5cd235fe11', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c5c43f40>]}
[0m23:52:14.918053 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.54s]
[0m23:52:14.920104 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.54s]
[0m23:52:14.921926 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:52:14.923459 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:52:14.925852 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:52:14.926504 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:52:14.927029 [debug] [MainThread]: On list__clean: Close
[0m23:52:14.927554 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:52:14.928044 [debug] [MainThread]: On list__mart: Close
[0m23:52:14.928575 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:52:14.929080 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:52:14.929608 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:52:14.930098 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:52:14.930603 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:52:14.931094 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:52:14.931599 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m23:52:14.932093 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m23:52:14.933291 [info ] [MainThread]: 
[0m23:52:14.934069 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.65 seconds (1.65s).
[0m23:52:14.937931 [debug] [MainThread]: Command end result
[0m23:52:15.003407 [info ] [MainThread]: 
[0m23:52:15.004259 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:52:15.004850 [info ] [MainThread]: 
[0m23:52:15.005438 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:52:15.006708 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.1839569, "process_in_blocks": "0", "process_kernel_time": 0.666743, "process_mem_max_rss": "114032", "process_out_blocks": "9744", "process_user_time": 6.157394}
[0m23:52:15.007466 [debug] [MainThread]: Command `dbt build` succeeded at 23:52:15.007255 after 3.18 seconds
[0m23:52:15.008113 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c9cb7310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c7c4ad00>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x7759c7c4d850>]}
[0m23:52:15.008704 [debug] [MainThread]: Flushing usage events
[0m23:53:12.725338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea74cc310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea4122b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea4122a00>]}


============================== 23:53:12.737834 | c4d04e9e-2147-45cf-9c7e-91538ab69d61 ==============================
[0m23:53:12.737834 [info ] [MainThread]: Running with dbt=1.8.9
[0m23:53:12.739022 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'fail_fast': 'False', 'empty': 'False', 'log_path': '/workdir/transforms/04_btc/logs', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'partial_parse': 'True', 'target_path': 'None', 'version_check': 'True', 'warn_error': 'None', 'write_json': 'True', 'introspect': 'True', 'no_print': 'None', 'printer_width': '80', 'profiles_dir': '.', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'invocation_command': 'dbt build --profiles-dir . --target local', 'use_experimental_parser': 'False', 'static_parser': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'quiet': 'False'}
[0m23:53:13.080926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c4d04e9e-2147-45cf-9c7e-91538ab69d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea401a490>]}
[0m23:53:13.179410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c4d04e9e-2147-45cf-9c7e-91538ab69d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea4c043a0>]}
[0m23:53:13.181304 [info ] [MainThread]: Registered adapter: clickhouse=1.8.6
[0m23:53:13.390193 [debug] [MainThread]: checksum: 134c0f7b96382cc6938697739bc32fb1adc530b177e30f60cebddf61dbd7e979, vars: {}, profile: , target: local, version: 1.8.9
[0m23:53:13.714261 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m23:53:13.714937 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m23:53:13.820779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c4d04e9e-2147-45cf-9c7e-91538ab69d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea388beb0>]}
[0m23:53:14.276826 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c4d04e9e-2147-45cf-9c7e-91538ab69d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea37804c0>]}
[0m23:53:14.277759 [info ] [MainThread]: Found 4 models, 3 data tests, 1 source, 471 macros
[0m23:53:14.281228 [info ] [MainThread]: 
[0m23:53:14.282399 [debug] [MainThread]: Acquiring new clickhouse connection 'master'
[0m23:53:14.294401 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:53:14.305574 [debug] [ThreadPool]: Acquiring new clickhouse connection 'list_'
[0m23:53:14.321387 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:53:14.325167 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m23:53:14.597776 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:53:14.603835 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:14.605823 [debug] [ThreadPool]: dbt_clickhouse adapter: On list_: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list_"} */

    select name from system.databases
  ...
[0m23:53:14.609521 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:14.633385 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__clean)
[0m23:53:14.634364 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_, now list__mart)
[0m23:53:14.646447 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__clean: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__clean"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'clean'
      

  ...
[0m23:53:14.650663 [debug] [ThreadPool]: dbt_clickhouse adapter: On list__mart: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "connection_name": "list__mart"} */
select
      t.name as name,
      t.database as schema,
      multiIf(
        engine in ('MaterializedView', 'View'), 'view',
        engine = 'Dictionary', 'dictionary',
        'table'
      ) as type,
      db.engine as db_engine,0 as is_on_cluster
          from system.tables as t join system.databases as db on t.database = db.name
        where schema = 'mart'
      

  ...
[0m23:53:14.658371 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:53:14.660039 [debug] [ThreadPool]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:53:14.677358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c4d04e9e-2147-45cf-9c7e-91538ab69d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea406a400>]}
[0m23:53:14.678461 [info ] [MainThread]: Concurrency: 4 threads (target='local')
[0m23:53:14.679159 [info ] [MainThread]: 
[0m23:53:14.692362 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.stg_btc__market_price
[0m23:53:14.693572 [info ] [Thread-1  ]: 1 of 7 START sql view model `clean`.`stg_btc__market_price` .................... [RUN]
[0m23:53:14.694750 [debug] [Thread-1  ]: Acquiring new clickhouse connection 'model.ex_03_meteo.stg_btc__market_price'
[0m23:53:14.695547 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.stg_btc__market_price
[0m23:53:14.713432 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:53:14.731269 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.stg_btc__market_price
[0m23:53:14.806989 [debug] [Thread-1  ]: Opening a new connection, currently in state init
[0m23:53:14.864949 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.stg_btc__market_price"
[0m23:53:14.871321 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */


  create view `clean`.`stg_btc__market_price__dbt_tmp` 
  
    
    
  as (
    -- models/clean/stg_btc__market_price.sql


select
  cast(id as String)                       as coin_id,
  cast(symbol as String)                   as symbol,
  cast(name as String)                     as name,
  cast(image as String)                    as image_url,
  toFloat64(current_price)                 as price_usd,
  toFloat64(market_cap)                    as market_cap_usd,
  toInt32(market_cap_rank)                 as market_cap_rank,
  toFloat64(total_volume)                  as total_volume_usd,
  toFloat64(high_24h)                      as high_24h_usd,
  toFloat64(low_24h)                       as low_24h_usd,
  toFloat64(price_change_24h)              as price_change_24h_usd,
  toFloat64(price_change_percentage_24h)   as price_change_pct_24h,

  -- Normalize last_updated to DateTime64(6,'UTC') whether it's already DT or a String
  ifNull(
    parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
    toDateTime64(last_updated, 6, 'UTC')
  )                                        as last_updated_utc,

  toTimeZone(
    ifNull(
      parseDateTime64BestEffortOrNull(toString(last_updated), 6, 'UTC'),
      toDateTime64(last_updated, 6, 'UTC')
    ),
    'Asia/Manila'
  )                                        as last_updated_manila

from `raw`.`btc___market_price`
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:53:14.882695 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:53:14.968643 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:53:14.972879 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:14.976262 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price` to `clean`.`stg_btc__market_price__dbt_backup` 
  
  ...
[0m23:53:14.979512 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:14.986557 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price` 
  
  ...
[0m23:53:14.990120 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:14.992380 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    rename table `clean`.`stg_btc__market_price__dbt_tmp` to `clean`.`stg_btc__market_price` 
  
  ...
[0m23:53:14.995324 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:15.046659 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.stg_btc__market_price: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.stg_btc__market_price"} */

    drop table if exists `clean`.`stg_btc__market_price__dbt_backup` 
  ...
[0m23:53:15.050455 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:15.059034 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4d04e9e-2147-45cf-9c7e-91538ab69d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea2bc9430>]}
[0m23:53:15.060427 [info ] [Thread-1  ]: 1 of 7 OK created sql view model `clean`.`stg_btc__market_price` ............... [[32mOK[0m in 0.36s]
[0m23:53:15.061792 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.stg_btc__market_price
[0m23:53:15.063392 [debug] [Thread-3  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:53:15.064183 [debug] [Thread-4  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:53:15.065213 [debug] [Thread-2  ]: Began running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:53:15.066153 [info ] [Thread-3  ]: 2 of 7 START test not_null_stg_btc__market_price_coin_id ....................... [RUN]
[0m23:53:15.067116 [info ] [Thread-4  ]: 3 of 7 START test not_null_stg_btc__market_price_last_updated_utc .............. [RUN]
[0m23:53:15.068042 [info ] [Thread-2  ]: 4 of 7 START test not_null_stg_btc__market_price_price_usd ..................... [RUN]
[0m23:53:15.069213 [debug] [Thread-3  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1'
[0m23:53:15.070382 [debug] [Thread-4  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a'
[0m23:53:15.071318 [debug] [Thread-2  ]: Acquiring new clickhouse connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6'
[0m23:53:15.072120 [debug] [Thread-3  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:53:15.072891 [debug] [Thread-4  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:53:15.073650 [debug] [Thread-2  ]: Began compiling node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:53:15.101550 [debug] [Thread-3  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:53:15.103563 [debug] [Thread-4  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:53:15.110627 [debug] [Thread-2  ]: Writing injected SQL for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:53:15.134160 [debug] [Thread-4  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:53:15.135108 [debug] [Thread-3  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:53:15.135987 [debug] [Thread-2  ]: Began executing node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:53:15.189807 [debug] [Thread-2  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"
[0m23:53:15.190698 [debug] [Thread-4  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"
[0m23:53:15.199492 [debug] [Thread-3  ]: Writing runtime sql for node "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"
[0m23:53:15.245869 [debug] [Thread-4  ]: Opening a new connection, currently in state init
[0m23:53:15.252136 [debug] [Thread-3  ]: Opening a new connection, currently in state init
[0m23:53:15.260251 [debug] [Thread-2  ]: Opening a new connection, currently in state init
[0m23:53:15.387278 [debug] [Thread-4  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select last_updated_utc
from `clean`.`stg_btc__market_price`
where last_updated_utc is null



    ) dbt_internal_test...
[0m23:53:15.395364 [debug] [Thread-3  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select coin_id
from `clean`.`stg_btc__market_price`
where coin_id is null



    ) dbt_internal_test...
[0m23:53:15.400817 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:53:15.403036 [debug] [Thread-2  ]: dbt_clickhouse adapter: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select price_usd
from `clean`.`stg_btc__market_price`
where price_usd is null



    ) dbt_internal_test...
[0m23:53:15.411595 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:53:15.409661 [info ] [Thread-4  ]: 3 of 7 PASS not_null_stg_btc__market_price_last_updated_utc .................... [[32mPASS[0m in 0.34s]
[0m23:53:15.416741 [info ] [Thread-3  ]: 2 of 7 PASS not_null_stg_btc__market_price_coin_id ............................. [[32mPASS[0m in 0.35s]
[0m23:53:15.419125 [debug] [Thread-4  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a
[0m23:53:15.420858 [debug] [Thread-2  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:53:15.422195 [debug] [Thread-3  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1
[0m23:53:15.425445 [info ] [Thread-2  ]: 4 of 7 PASS not_null_stg_btc__market_price_price_usd ........................... [[32mPASS[0m in 0.35s]
[0m23:53:15.427123 [debug] [Thread-2  ]: Finished running node test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6
[0m23:53:15.428756 [debug] [Thread-1  ]: Began running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:53:15.429543 [debug] [Thread-4  ]: Began running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:53:15.430286 [debug] [Thread-3  ]: Began running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:53:15.431265 [info ] [Thread-1  ]: 5 of 7 START sql incremental model `mart`.`mart_btc__daily_ohlc` ............... [RUN]
[0m23:53:15.432265 [info ] [Thread-4  ]: 6 of 7 START sql incremental model `mart`.`mart_btc__market_price_hourly` ...... [RUN]
[0m23:53:15.433320 [info ] [Thread-3  ]: 7 of 7 START sql view model `mart`.`vw_btc__latest_24h` ........................ [RUN]
[0m23:53:15.434221 [debug] [Thread-1  ]: Re-using an available connection from the pool (formerly model.ex_03_meteo.stg_btc__market_price, now model.ex_03_meteo.mart_btc__daily_ohlc)
[0m23:53:15.434938 [debug] [Thread-4  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_last_updated_utc.d63cb9517a, now model.ex_03_meteo.mart_btc__market_price_hourly)
[0m23:53:15.435657 [debug] [Thread-3  ]: Re-using an available connection from the pool (formerly test.ex_03_meteo.not_null_stg_btc__market_price_coin_id.022fc4d0c1, now model.ex_03_meteo.vw_btc__latest_24h)
[0m23:53:15.436475 [debug] [Thread-1  ]: Began compiling node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:53:15.437294 [debug] [Thread-4  ]: Began compiling node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:53:15.438015 [debug] [Thread-3  ]: Began compiling node model.ex_03_meteo.vw_btc__latest_24h
[0m23:53:15.458152 [debug] [Thread-1  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:53:15.466929 [debug] [Thread-4  ]: Writing injected SQL for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:53:15.473886 [debug] [Thread-3  ]: Writing injected SQL for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:53:15.521027 [debug] [Thread-1  ]: Began executing node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:53:15.521975 [debug] [Thread-4  ]: Began executing node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:53:15.522714 [debug] [Thread-3  ]: Began executing node model.ex_03_meteo.vw_btc__latest_24h
[0m23:53:15.603687 [debug] [Thread-3  ]: Writing runtime sql for node "model.ex_03_meteo.vw_btc__latest_24h"
[0m23:53:15.694461 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */


  create view `mart`.`vw_btc__latest_24h__dbt_tmp` 
  
    
    
  as (
    

WITH (SELECT max(last_updated_utc) FROM `clean`.`stg_btc__market_price`) AS ts_max
SELECT
  *
FROM `clean`.`stg_btc__market_price`
WHERE last_updated_utc >= ts_max - INTERVAL 24 HOUR
ORDER BY last_updated_utc
    
  )
      
      
                    -- end_of_sql
                    
                    ...
[0m23:53:15.719406 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61` 
  ...
[0m23:53:15.741328 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61` 
  ...
[0m23:53:15.745216 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:15.746694 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:15.764378 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:53:15.822224 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:53:15.842708 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

            

    
        create table `mart`.`mart_btc__market_price_hourly__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61`
        
  
        
  engine = MergeTree()
        order by (hour_local,coin_id)
        
        partition by (toYYYYMM(hour_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
          )
        
        ...
[0m23:53:15.844180 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

            

    
        create table `mart`.`mart_btc__daily_ohlc__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61`
        
  
        
  engine = MergeTree()
        order by (day_local,coin_id)
        
        partition by (toYYYYMM(day_local))
        
        
                    -- end_of_sql
                    SETTINGS  replicated_deduplication_window=0

                    
            empty
          as (
            

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
          )
        
        ...
[0m23:53:15.848240 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:15.853274 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h` to `mart`.`vw_btc__latest_24h__dbt_backup` 
  
  ...
[0m23:53:15.857321 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:15.867535 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:53:15.871030 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:53:15.873177 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:15.892061 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.04 seconds
[0m23:53:15.895542 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    rename table `mart`.`vw_btc__latest_24h__dbt_tmp` to `mart`.`vw_btc__latest_24h` 
  
  ...
[0m23:53:15.897175 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:53:15.906423 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:53:15.910483 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:15.913463 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:15.925362 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:53:15.926573 [debug] [Thread-3  ]: dbt_clickhouse adapter: On model.ex_03_meteo.vw_btc__latest_24h: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.vw_btc__latest_24h"} */

    drop table if exists `mart`.`vw_btc__latest_24h__dbt_backup` 
  ...
[0m23:53:15.934972 [debug] [Thread-4  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__market_price_hourly"
[0m23:53:15.937963 [debug] [Thread-1  ]: Writing runtime sql for node "model.ex_03_meteo.mart_btc__daily_ohlc"
[0m23:53:15.941104 [debug] [Thread-3  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:15.943772 [debug] [Thread-3  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4d04e9e-2147-45cf-9c7e-91538ab69d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea2b7f3a0>]}
[0m23:53:15.945028 [info ] [Thread-3  ]: 7 of 7 OK created sql view model `mart`.`vw_btc__latest_24h` ................... [[32mOK[0m in 0.51s]
[0m23:53:15.946723 [debug] [Thread-3  ]: Finished running node model.ex_03_meteo.vw_btc__latest_24h
[0m23:53:15.947942 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__market_price_hourly__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61`
        ("hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    -- non-nullable for MergeTree keys
    toStartOfHour(toTimeZone(assumeNotNull(last_updated_utc), 'Asia/Manila')) as hour_local,
    assumeNotNull(coin_id)                                                    as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                                      as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila hours
    and toStartOfHour(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(hour_local), toStartOfHour(now('Asia/Manila')) - interval 1 hour)
      from `mart`.`mart_btc__market_price_hourly`
    ) - interval 1 hour
  
)
select
  hour_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in hour
  argMax(price_usd, last_updated_utc) as close_usd   -- last in hour
from base
group by hour_local, coin_id
order by hour_local, coin_id
  
      ...
[0m23:53:15.966249 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:53:15.968440 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

      
            delete from `mart`.`mart_btc__market_price_hourly` where (hour_local, coin_id) in (select hour_local, coin_id
                                          from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61`)
      
    ...
[0m23:53:15.969386 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        
  
    
    
    
        
         


        insert into `mart`.`mart_btc__daily_ohlc__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61`
        ("day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd")

with base as (
  select
    assumeNotNull(toDate(toTimeZone(last_updated_utc,'Asia/Manila'))) as day_local,
    assumeNotNull(coin_id)                                            as coin_id,
    last_updated_utc,
    toFloat64(price_usd)                                              as price_usd
  from `clean`.`stg_btc__market_price`
  where last_updated_utc is not null

  
    -- Recompute only latest (and previous) Manila days
    and toDate(toTimeZone(last_updated_utc,'Asia/Manila')) >= (
      select coalesce(max(day_local), toDate(now('Asia/Manila')) - 1)
      from `mart`.`mart_btc__daily_ohlc`
    ) - 1
  
)
select
  day_local,
  coin_id,
  min(price_usd)                      as low_usd,
  max(price_usd)                      as high_usd,
  argMin(price_usd, last_updated_utc) as open_usd,   -- first in day
  argMax(price_usd, last_updated_utc) as close_usd   -- last in day
from base
group by day_local, coin_id
order by day_local, coin_id
  
      ...
[0m23:53:15.990692 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:53:15.992299 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.02 seconds
[0m23:53:15.999264 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    select name, type from system.columns where table = 'mart_btc__market_price_hourly'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:53:16.001515 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

      
            delete from `mart`.`mart_btc__daily_ohlc` where (day_local, coin_id) in (select day_local, coin_id
                                          from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61`)
      
    ...
[0m23:53:16.007702 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:53:16.010524 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

        insert into `mart`.`mart_btc__market_price_hourly` select "hour_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__market_price_hourly__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61` 
    ...
[0m23:53:16.017707 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:53:16.027287 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61` 
  ...
[0m23:53:16.028583 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.03 seconds
[0m23:53:16.034400 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    select name, type from system.columns where table = 'mart_btc__daily_ohlc'
    
      and database = 'mart'
    
    order by position
  ...
[0m23:53:16.035936 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:53:16.043054 [debug] [Thread-4  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__market_price_hourly: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__market_price_hourly"} */

    drop table if exists `mart`.`mart_btc__market_price_hourly__dbt_distributed_new_data` 
  ...
[0m23:53:16.044462 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:53:16.048425 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

        insert into `mart`.`mart_btc__daily_ohlc` select "day_local", "coin_id", "low_usd", "high_usd", "open_usd", "close_usd" from `mart`.`mart_btc__daily_ohlc__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61` 
    ...
[0m23:53:16.049816 [debug] [Thread-4  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:16.053587 [debug] [Thread-4  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4d04e9e-2147-45cf-9c7e-91538ab69d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea36238b0>]}
[0m23:53:16.054898 [info ] [Thread-4  ]: 6 of 7 OK created sql incremental model `mart`.`mart_btc__market_price_hourly` . [[32mOK[0m in 0.62s]
[0m23:53:16.056297 [debug] [Thread-4  ]: Finished running node model.ex_03_meteo.mart_btc__market_price_hourly
[0m23:53:16.057922 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.01 seconds
[0m23:53:16.063867 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_new_data_c4d04e9e_2147_45cf_9c7e_91538ab69d61` 
  ...
[0m23:53:16.068114 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:16.074523 [debug] [Thread-1  ]: dbt_clickhouse adapter: On model.ex_03_meteo.mart_btc__daily_ohlc: /* {"app": "dbt", "dbt_version": "1.8.9", "profile_name": "clickhouse_ftw", "target_name": "local", "node_id": "model.ex_03_meteo.mart_btc__daily_ohlc"} */

    drop table if exists `mart`.`mart_btc__daily_ohlc__dbt_distributed_new_data` 
  ...
[0m23:53:16.077576 [debug] [Thread-1  ]: dbt_clickhouse adapter: SQL status: OK in 0.00 seconds
[0m23:53:16.081221 [debug] [Thread-1  ]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c4d04e9e-2147-45cf-9c7e-91538ab69d61', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea3799b80>]}
[0m23:53:16.082590 [info ] [Thread-1  ]: 5 of 7 OK created sql incremental model `mart`.`mart_btc__daily_ohlc` .......... [[32mOK[0m in 0.65s]
[0m23:53:16.084115 [debug] [Thread-1  ]: Finished running node model.ex_03_meteo.mart_btc__daily_ohlc
[0m23:53:16.086121 [debug] [MainThread]: Connection 'master' was properly closed.
[0m23:53:16.086718 [debug] [MainThread]: Connection 'list__clean' was left open.
[0m23:53:16.087271 [debug] [MainThread]: On list__clean: Close
[0m23:53:16.088019 [debug] [MainThread]: Connection 'list__mart' was left open.
[0m23:53:16.088781 [debug] [MainThread]: On list__mart: Close
[0m23:53:16.089538 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__daily_ohlc' was left open.
[0m23:53:16.090290 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__daily_ohlc: Close
[0m23:53:16.091042 [debug] [MainThread]: Connection 'model.ex_03_meteo.vw_btc__latest_24h' was left open.
[0m23:53:16.091823 [debug] [MainThread]: On model.ex_03_meteo.vw_btc__latest_24h: Close
[0m23:53:16.092573 [debug] [MainThread]: Connection 'model.ex_03_meteo.mart_btc__market_price_hourly' was left open.
[0m23:53:16.093378 [debug] [MainThread]: On model.ex_03_meteo.mart_btc__market_price_hourly: Close
[0m23:53:16.094120 [debug] [MainThread]: Connection 'test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6' was left open.
[0m23:53:16.094934 [debug] [MainThread]: On test.ex_03_meteo.not_null_stg_btc__market_price_price_usd.639627ceb6: Close
[0m23:53:16.096674 [info ] [MainThread]: 
[0m23:53:16.097702 [info ] [MainThread]: Finished running 2 view models, 3 data tests, 2 incremental models in 0 hours 0 minutes and 1.81 seconds (1.81s).
[0m23:53:16.103762 [debug] [MainThread]: Command end result
[0m23:53:16.308107 [info ] [MainThread]: 
[0m23:53:16.309262 [info ] [MainThread]: [32mCompleted successfully[0m
[0m23:53:16.310053 [info ] [MainThread]: 
[0m23:53:16.310897 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m23:53:16.312698 [debug] [MainThread]: Resource report: {"command_name": "build", "command_success": true, "command_wall_clock_time": 3.7585378, "process_in_blocks": "0", "process_kernel_time": 0.636078, "process_mem_max_rss": "114024", "process_out_blocks": "9744", "process_user_time": 6.136402}
[0m23:53:16.313748 [debug] [MainThread]: Command `dbt build` succeeded at 23:53:16.313485 after 3.76 seconds
[0m23:53:16.314615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea74cc310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea53d5dc0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x70fea401a490>]}
[0m23:53:16.315472 [debug] [MainThread]: Flushing usage events
